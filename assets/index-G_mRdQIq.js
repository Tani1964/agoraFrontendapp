var D3=Object.defineProperty;var P3=(e,t,i)=>t in e?D3(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i;var Mu=(e,t,i)=>P3(e,typeof t!="symbol"?t+"":t,i);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const s of a)if(s.type==="childList")for(const c of s.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function i(a){const s={};return a.integrity&&(s.integrity=a.integrity),a.referrerPolicy&&(s.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?s.credentials="include":a.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(a){if(a.ep)return;a.ep=!0;const s=i(a);fetch(a.href,s)}})();var _S={exports:{}},Uu={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var oO;function L3(){if(oO)return Uu;oO=1;var e=Symbol.for("react.transitional.element"),t=Symbol.for("react.fragment");function i(r,a,s){var c=null;if(s!==void 0&&(c=""+s),a.key!==void 0&&(c=""+a.key),"key"in a){s={};for(var l in a)l!=="key"&&(s[l]=a[l])}else s=a;return a=s.ref,{$$typeof:e,type:r,key:c,ref:a!==void 0?a:null,props:s}}return Uu.Fragment=t,Uu.jsx=i,Uu.jsxs=i,Uu}var cO;function k3(){return cO||(cO=1,_S.exports=L3()),_S.exports}var ze=k3(),ES={exports:{}},ot={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var lO;function M3(){if(lO)return ot;lO=1;var e=Symbol.for("react.transitional.element"),t=Symbol.for("react.portal"),i=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),a=Symbol.for("react.profiler"),s=Symbol.for("react.consumer"),c=Symbol.for("react.context"),l=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),h=Symbol.for("react.memo"),p=Symbol.for("react.lazy"),_=Symbol.iterator;function m(L){return L===null||typeof L!="object"?null:(L=_&&L[_]||L["@@iterator"],typeof L=="function"?L:null)}var S={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},C=Object.assign,v={};function y(L,g,w){this.props=L,this.context=g,this.refs=v,this.updater=w||S}y.prototype.isReactComponent={},y.prototype.setState=function(L,g){if(typeof L!="object"&&typeof L!="function"&&L!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,L,g,"setState")},y.prototype.forceUpdate=function(L){this.updater.enqueueForceUpdate(this,L,"forceUpdate")};function I(){}I.prototype=y.prototype;function O(L,g,w){this.props=L,this.context=g,this.refs=v,this.updater=w||S}var P=O.prototype=new I;P.constructor=O,C(P,y.prototype),P.isPureReactComponent=!0;var U=Array.isArray,x={H:null,A:null,T:null,S:null},G=Object.prototype.hasOwnProperty;function Z(L,g,w,D,F,pe){return w=pe.ref,{$$typeof:e,type:L,key:g,ref:w!==void 0?w:null,props:pe}}function J(L,g){return Z(L.type,g,void 0,void 0,void 0,L.props)}function q(L){return typeof L=="object"&&L!==null&&L.$$typeof===e}function ie(L){var g={"=":"=0",":":"=2"};return"$"+L.replace(/[=:]/g,function(w){return g[w]})}var Ie=/\/+/g;function Ve(L,g){return typeof L=="object"&&L!==null&&L.key!=null?ie(""+L.key):g.toString(36)}function He(){}function ut(L){switch(L.status){case"fulfilled":return L.value;case"rejected":throw L.reason;default:switch(typeof L.status=="string"?L.then(He,He):(L.status="pending",L.then(function(g){L.status==="pending"&&(L.status="fulfilled",L.value=g)},function(g){L.status==="pending"&&(L.status="rejected",L.reason=g)})),L.status){case"fulfilled":return L.value;case"rejected":throw L.reason}}throw L}function st(L,g,w,D,F){var pe=typeof L;(pe==="undefined"||pe==="boolean")&&(L=null);var Re=!1;if(L===null)Re=!0;else switch(pe){case"bigint":case"string":case"number":Re=!0;break;case"object":switch(L.$$typeof){case e:case t:Re=!0;break;case p:return Re=L._init,st(Re(L._payload),g,w,D,F)}}if(Re)return F=F(L),Re=D===""?"."+Ve(L,0):D,U(F)?(w="",Re!=null&&(w=Re.replace(Ie,"$&/")+"/"),st(F,g,w,"",function(Ft){return Ft})):F!=null&&(q(F)&&(F=J(F,w+(F.key==null||L&&L.key===F.key?"":(""+F.key).replace(Ie,"$&/")+"/")+Re)),g.push(F)),1;Re=0;var rt=D===""?".":D+":";if(U(L))for(var Xe=0;Xe<L.length;Xe++)D=L[Xe],pe=rt+Ve(D,Xe),Re+=st(D,g,w,pe,F);else if(Xe=m(L),typeof Xe=="function")for(L=Xe.call(L),Xe=0;!(D=L.next()).done;)D=D.value,pe=rt+Ve(D,Xe++),Re+=st(D,g,w,pe,F);else if(pe==="object"){if(typeof L.then=="function")return st(ut(L),g,w,D,F);throw g=String(L),Error("Objects are not valid as a React child (found: "+(g==="[object Object]"?"object with keys {"+Object.keys(L).join(", ")+"}":g)+"). If you meant to render a collection of children, use an array instead.")}return Re}function ge(L,g,w){if(L==null)return L;var D=[],F=0;return st(L,D,"","",function(pe){return g.call(w,pe,F++)}),D}function j(L){if(L._status===-1){var g=L._result;g=g(),g.then(function(w){(L._status===0||L._status===-1)&&(L._status=1,L._result=w)},function(w){(L._status===0||L._status===-1)&&(L._status=2,L._result=w)}),L._status===-1&&(L._status=0,L._result=g)}if(L._status===1)return L._result.default;throw L._result}var K=typeof reportError=="function"?reportError:function(L){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var g=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof L=="object"&&L!==null&&typeof L.message=="string"?String(L.message):String(L),error:L});if(!window.dispatchEvent(g))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",L);return}console.error(L)};function te(){}return ot.Children={map:ge,forEach:function(L,g,w){ge(L,function(){g.apply(this,arguments)},w)},count:function(L){var g=0;return ge(L,function(){g++}),g},toArray:function(L){return ge(L,function(g){return g})||[]},only:function(L){if(!q(L))throw Error("React.Children.only expected to receive a single React element child.");return L}},ot.Component=y,ot.Fragment=i,ot.Profiler=a,ot.PureComponent=O,ot.StrictMode=r,ot.Suspense=u,ot.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=x,ot.act=function(){throw Error("act(...) is not supported in production builds of React.")},ot.cache=function(L){return function(){return L.apply(null,arguments)}},ot.cloneElement=function(L,g,w){if(L==null)throw Error("The argument must be a React element, but you passed "+L+".");var D=C({},L.props),F=L.key,pe=void 0;if(g!=null)for(Re in g.ref!==void 0&&(pe=void 0),g.key!==void 0&&(F=""+g.key),g)!G.call(g,Re)||Re==="key"||Re==="__self"||Re==="__source"||Re==="ref"&&g.ref===void 0||(D[Re]=g[Re]);var Re=arguments.length-2;if(Re===1)D.children=w;else if(1<Re){for(var rt=Array(Re),Xe=0;Xe<Re;Xe++)rt[Xe]=arguments[Xe+2];D.children=rt}return Z(L.type,F,void 0,void 0,pe,D)},ot.createContext=function(L){return L={$$typeof:c,_currentValue:L,_currentValue2:L,_threadCount:0,Provider:null,Consumer:null},L.Provider=L,L.Consumer={$$typeof:s,_context:L},L},ot.createElement=function(L,g,w){var D,F={},pe=null;if(g!=null)for(D in g.key!==void 0&&(pe=""+g.key),g)G.call(g,D)&&D!=="key"&&D!=="__self"&&D!=="__source"&&(F[D]=g[D]);var Re=arguments.length-2;if(Re===1)F.children=w;else if(1<Re){for(var rt=Array(Re),Xe=0;Xe<Re;Xe++)rt[Xe]=arguments[Xe+2];F.children=rt}if(L&&L.defaultProps)for(D in Re=L.defaultProps,Re)F[D]===void 0&&(F[D]=Re[D]);return Z(L,pe,void 0,void 0,null,F)},ot.createRef=function(){return{current:null}},ot.forwardRef=function(L){return{$$typeof:l,render:L}},ot.isValidElement=q,ot.lazy=function(L){return{$$typeof:p,_payload:{_status:-1,_result:L},_init:j}},ot.memo=function(L,g){return{$$typeof:h,type:L,compare:g===void 0?null:g}},ot.startTransition=function(L){var g=x.T,w={};x.T=w;try{var D=L(),F=x.S;F!==null&&F(w,D),typeof D=="object"&&D!==null&&typeof D.then=="function"&&D.then(te,K)}catch(pe){K(pe)}finally{x.T=g}},ot.unstable_useCacheRefresh=function(){return x.H.useCacheRefresh()},ot.use=function(L){return x.H.use(L)},ot.useActionState=function(L,g,w){return x.H.useActionState(L,g,w)},ot.useCallback=function(L,g){return x.H.useCallback(L,g)},ot.useContext=function(L){return x.H.useContext(L)},ot.useDebugValue=function(){},ot.useDeferredValue=function(L,g){return x.H.useDeferredValue(L,g)},ot.useEffect=function(L,g){return x.H.useEffect(L,g)},ot.useId=function(){return x.H.useId()},ot.useImperativeHandle=function(L,g,w){return x.H.useImperativeHandle(L,g,w)},ot.useInsertionEffect=function(L,g){return x.H.useInsertionEffect(L,g)},ot.useLayoutEffect=function(L,g){return x.H.useLayoutEffect(L,g)},ot.useMemo=function(L,g){return x.H.useMemo(L,g)},ot.useOptimistic=function(L,g){return x.H.useOptimistic(L,g)},ot.useReducer=function(L,g,w){return x.H.useReducer(L,g,w)},ot.useRef=function(L){return x.H.useRef(L)},ot.useState=function(L){return x.H.useState(L)},ot.useSyncExternalStore=function(L,g,w){return x.H.useSyncExternalStore(L,g,w)},ot.useTransition=function(){return x.H.useTransition()},ot.version="19.0.0",ot}var dO;function oy(){return dO||(dO=1,ES.exports=M3()),ES.exports}var ke=oy(),mS={exports:{}},xu={},gS={exports:{}},SS={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var uO;function U3(){return uO||(uO=1,function(e){function t(ge,j){var K=ge.length;ge.push(j);e:for(;0<K;){var te=K-1>>>1,L=ge[te];if(0<a(L,j))ge[te]=j,ge[K]=L,K=te;else break e}}function i(ge){return ge.length===0?null:ge[0]}function r(ge){if(ge.length===0)return null;var j=ge[0],K=ge.pop();if(K!==j){ge[0]=K;e:for(var te=0,L=ge.length,g=L>>>1;te<g;){var w=2*(te+1)-1,D=ge[w],F=w+1,pe=ge[F];if(0>a(D,K))F<L&&0>a(pe,D)?(ge[te]=pe,ge[F]=K,te=F):(ge[te]=D,ge[w]=K,te=w);else if(F<L&&0>a(pe,K))ge[te]=pe,ge[F]=K,te=F;else break e}}return j}function a(ge,j){var K=ge.sortIndex-j.sortIndex;return K!==0?K:ge.id-j.id}if(e.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var s=performance;e.unstable_now=function(){return s.now()}}else{var c=Date,l=c.now();e.unstable_now=function(){return c.now()-l}}var u=[],h=[],p=1,_=null,m=3,S=!1,C=!1,v=!1,y=typeof setTimeout=="function"?setTimeout:null,I=typeof clearTimeout=="function"?clearTimeout:null,O=typeof setImmediate<"u"?setImmediate:null;function P(ge){for(var j=i(h);j!==null;){if(j.callback===null)r(h);else if(j.startTime<=ge)r(h),j.sortIndex=j.expirationTime,t(u,j);else break;j=i(h)}}function U(ge){if(v=!1,P(ge),!C)if(i(u)!==null)C=!0,ut();else{var j=i(h);j!==null&&st(U,j.startTime-ge)}}var x=!1,G=-1,Z=5,J=-1;function q(){return!(e.unstable_now()-J<Z)}function ie(){if(x){var ge=e.unstable_now();J=ge;var j=!0;try{e:{C=!1,v&&(v=!1,I(G),G=-1),S=!0;var K=m;try{t:{for(P(ge),_=i(u);_!==null&&!(_.expirationTime>ge&&q());){var te=_.callback;if(typeof te=="function"){_.callback=null,m=_.priorityLevel;var L=te(_.expirationTime<=ge);if(ge=e.unstable_now(),typeof L=="function"){_.callback=L,P(ge),j=!0;break t}_===i(u)&&r(u),P(ge)}else r(u);_=i(u)}if(_!==null)j=!0;else{var g=i(h);g!==null&&st(U,g.startTime-ge),j=!1}}break e}finally{_=null,m=K,S=!1}j=void 0}}finally{j?Ie():x=!1}}}var Ie;if(typeof O=="function")Ie=function(){O(ie)};else if(typeof MessageChannel<"u"){var Ve=new MessageChannel,He=Ve.port2;Ve.port1.onmessage=ie,Ie=function(){He.postMessage(null)}}else Ie=function(){y(ie,0)};function ut(){x||(x=!0,Ie())}function st(ge,j){G=y(function(){ge(e.unstable_now())},j)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(ge){ge.callback=null},e.unstable_continueExecution=function(){C||S||(C=!0,ut())},e.unstable_forceFrameRate=function(ge){0>ge||125<ge?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Z=0<ge?Math.floor(1e3/ge):5},e.unstable_getCurrentPriorityLevel=function(){return m},e.unstable_getFirstCallbackNode=function(){return i(u)},e.unstable_next=function(ge){switch(m){case 1:case 2:case 3:var j=3;break;default:j=m}var K=m;m=j;try{return ge()}finally{m=K}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(ge,j){switch(ge){case 1:case 2:case 3:case 4:case 5:break;default:ge=3}var K=m;m=ge;try{return j()}finally{m=K}},e.unstable_scheduleCallback=function(ge,j,K){var te=e.unstable_now();switch(typeof K=="object"&&K!==null?(K=K.delay,K=typeof K=="number"&&0<K?te+K:te):K=te,ge){case 1:var L=-1;break;case 2:L=250;break;case 5:L=1073741823;break;case 4:L=1e4;break;default:L=5e3}return L=K+L,ge={id:p++,callback:j,priorityLevel:ge,startTime:K,expirationTime:L,sortIndex:-1},K>te?(ge.sortIndex=K,t(h,ge),i(u)===null&&ge===i(h)&&(v?(I(G),G=-1):v=!0,st(U,K-te))):(ge.sortIndex=L,t(u,ge),C||S||(C=!0,ut())),ge},e.unstable_shouldYield=q,e.unstable_wrapCallback=function(ge){var j=m;return function(){var K=m;m=j;try{return ge.apply(this,arguments)}finally{m=K}}}}(SS)),SS}var hO;function x3(){return hO||(hO=1,gS.exports=U3()),gS.exports}var TS={exports:{}},Ar={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var pO;function V3(){if(pO)return Ar;pO=1;var e=oy();function t(u){var h="https://react.dev/errors/"+u;if(1<arguments.length){h+="?args[]="+encodeURIComponent(arguments[1]);for(var p=2;p<arguments.length;p++)h+="&args[]="+encodeURIComponent(arguments[p])}return"Minified React error #"+u+"; visit "+h+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function i(){}var r={d:{f:i,r:function(){throw Error(t(522))},D:i,C:i,L:i,m:i,X:i,S:i,M:i},p:0,findDOMNode:null},a=Symbol.for("react.portal");function s(u,h,p){var _=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:a,key:_==null?null:""+_,children:u,containerInfo:h,implementation:p}}var c=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function l(u,h){if(u==="font")return"";if(typeof h=="string")return h==="use-credentials"?h:""}return Ar.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=r,Ar.createPortal=function(u,h){var p=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!h||h.nodeType!==1&&h.nodeType!==9&&h.nodeType!==11)throw Error(t(299));return s(u,h,null,p)},Ar.flushSync=function(u){var h=c.T,p=r.p;try{if(c.T=null,r.p=2,u)return u()}finally{c.T=h,r.p=p,r.d.f()}},Ar.preconnect=function(u,h){typeof u=="string"&&(h?(h=h.crossOrigin,h=typeof h=="string"?h==="use-credentials"?h:"":void 0):h=null,r.d.C(u,h))},Ar.prefetchDNS=function(u){typeof u=="string"&&r.d.D(u)},Ar.preinit=function(u,h){if(typeof u=="string"&&h&&typeof h.as=="string"){var p=h.as,_=l(p,h.crossOrigin),m=typeof h.integrity=="string"?h.integrity:void 0,S=typeof h.fetchPriority=="string"?h.fetchPriority:void 0;p==="style"?r.d.S(u,typeof h.precedence=="string"?h.precedence:void 0,{crossOrigin:_,integrity:m,fetchPriority:S}):p==="script"&&r.d.X(u,{crossOrigin:_,integrity:m,fetchPriority:S,nonce:typeof h.nonce=="string"?h.nonce:void 0})}},Ar.preinitModule=function(u,h){if(typeof u=="string")if(typeof h=="object"&&h!==null){if(h.as==null||h.as==="script"){var p=l(h.as,h.crossOrigin);r.d.M(u,{crossOrigin:p,integrity:typeof h.integrity=="string"?h.integrity:void 0,nonce:typeof h.nonce=="string"?h.nonce:void 0})}}else h==null&&r.d.M(u)},Ar.preload=function(u,h){if(typeof u=="string"&&typeof h=="object"&&h!==null&&typeof h.as=="string"){var p=h.as,_=l(p,h.crossOrigin);r.d.L(u,p,{crossOrigin:_,integrity:typeof h.integrity=="string"?h.integrity:void 0,nonce:typeof h.nonce=="string"?h.nonce:void 0,type:typeof h.type=="string"?h.type:void 0,fetchPriority:typeof h.fetchPriority=="string"?h.fetchPriority:void 0,referrerPolicy:typeof h.referrerPolicy=="string"?h.referrerPolicy:void 0,imageSrcSet:typeof h.imageSrcSet=="string"?h.imageSrcSet:void 0,imageSizes:typeof h.imageSizes=="string"?h.imageSizes:void 0,media:typeof h.media=="string"?h.media:void 0})}},Ar.preloadModule=function(u,h){if(typeof u=="string")if(h){var p=l(h.as,h.crossOrigin);r.d.m(u,{as:typeof h.as=="string"&&h.as!=="script"?h.as:void 0,crossOrigin:p,integrity:typeof h.integrity=="string"?h.integrity:void 0})}else r.d.m(u)},Ar.requestFormReset=function(u){r.d.r(u)},Ar.unstable_batchedUpdates=function(u,h){return u(h)},Ar.useFormState=function(u,h,p){return c.H.useFormState(u,h,p)},Ar.useFormStatus=function(){return c.H.useHostTransitionStatus()},Ar.version="19.0.0",Ar}var fO;function B3(){if(fO)return TS.exports;fO=1;function e(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}return e(),TS.exports=V3(),TS.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var _O;function j3(){if(_O)return xu;_O=1;var e=x3(),t=oy(),i=B3();function r(n){var o="https://react.dev/errors/"+n;if(1<arguments.length){o+="?args[]="+encodeURIComponent(arguments[1]);for(var d=2;d<arguments.length;d++)o+="&args[]="+encodeURIComponent(arguments[d])}return"Minified React error #"+n+"; visit "+o+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function a(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}var s=Symbol.for("react.element"),c=Symbol.for("react.transitional.element"),l=Symbol.for("react.portal"),u=Symbol.for("react.fragment"),h=Symbol.for("react.strict_mode"),p=Symbol.for("react.profiler"),_=Symbol.for("react.provider"),m=Symbol.for("react.consumer"),S=Symbol.for("react.context"),C=Symbol.for("react.forward_ref"),v=Symbol.for("react.suspense"),y=Symbol.for("react.suspense_list"),I=Symbol.for("react.memo"),O=Symbol.for("react.lazy"),P=Symbol.for("react.offscreen"),U=Symbol.for("react.memo_cache_sentinel"),x=Symbol.iterator;function G(n){return n===null||typeof n!="object"?null:(n=x&&n[x]||n["@@iterator"],typeof n=="function"?n:null)}var Z=Symbol.for("react.client.reference");function J(n){if(n==null)return null;if(typeof n=="function")return n.$$typeof===Z?null:n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case u:return"Fragment";case l:return"Portal";case p:return"Profiler";case h:return"StrictMode";case v:return"Suspense";case y:return"SuspenseList"}if(typeof n=="object")switch(n.$$typeof){case S:return(n.displayName||"Context")+".Provider";case m:return(n._context.displayName||"Context")+".Consumer";case C:var o=n.render;return n=n.displayName,n||(n=o.displayName||o.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case I:return o=n.displayName||null,o!==null?o:J(n.type)||"Memo";case O:o=n._payload,n=n._init;try{return J(n(o))}catch{}}return null}var q=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,ie=Object.assign,Ie,Ve;function He(n){if(Ie===void 0)try{throw Error()}catch(d){var o=d.stack.trim().match(/\n( *(at )?)/);Ie=o&&o[1]||"",Ve=-1<d.stack.indexOf(`
    at`)?" (<anonymous>)":-1<d.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Ie+n+Ve}var ut=!1;function st(n,o){if(!n||ut)return"";ut=!0;var d=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var f={DetermineComponentFrameRoot:function(){try{if(o){var Ee=function(){throw Error()};if(Object.defineProperty(Ee.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Ee,[])}catch(re){var ee=re}Reflect.construct(n,[],Ee)}else{try{Ee.call()}catch(re){ee=re}n.call(Ee.prototype)}}else{try{throw Error()}catch(re){ee=re}(Ee=n())&&typeof Ee.catch=="function"&&Ee.catch(function(){})}}catch(re){if(re&&ee&&typeof re.stack=="string")return[re.stack,ee.stack]}return[null,null]}};f.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var E=Object.getOwnPropertyDescriptor(f.DetermineComponentFrameRoot,"name");E&&E.configurable&&Object.defineProperty(f.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var T=f.DetermineComponentFrameRoot(),N=T[0],M=T[1];if(N&&M){var V=N.split(`
`),Y=M.split(`
`);for(E=f=0;f<V.length&&!V[f].includes("DetermineComponentFrameRoot");)f++;for(;E<Y.length&&!Y[E].includes("DetermineComponentFrameRoot");)E++;if(f===V.length||E===Y.length)for(f=V.length-1,E=Y.length-1;1<=f&&0<=E&&V[f]!==Y[E];)E--;for(;1<=f&&0<=E;f--,E--)if(V[f]!==Y[E]){if(f!==1||E!==1)do if(f--,E--,0>E||V[f]!==Y[E]){var ne=`
`+V[f].replace(" at new "," at ");return n.displayName&&ne.includes("<anonymous>")&&(ne=ne.replace("<anonymous>",n.displayName)),ne}while(1<=f&&0<=E);break}}}finally{ut=!1,Error.prepareStackTrace=d}return(d=n?n.displayName||n.name:"")?He(d):""}function ge(n){switch(n.tag){case 26:case 27:case 5:return He(n.type);case 16:return He("Lazy");case 13:return He("Suspense");case 19:return He("SuspenseList");case 0:case 15:return n=st(n.type,!1),n;case 11:return n=st(n.type.render,!1),n;case 1:return n=st(n.type,!0),n;default:return""}}function j(n){try{var o="";do o+=ge(n),n=n.return;while(n);return o}catch(d){return`
Error generating stack: `+d.message+`
`+d.stack}}function K(n){var o=n,d=n;if(n.alternate)for(;o.return;)o=o.return;else{n=o;do o=n,(o.flags&4098)!==0&&(d=o.return),n=o.return;while(n)}return o.tag===3?d:null}function te(n){if(n.tag===13){var o=n.memoizedState;if(o===null&&(n=n.alternate,n!==null&&(o=n.memoizedState)),o!==null)return o.dehydrated}return null}function L(n){if(K(n)!==n)throw Error(r(188))}function g(n){var o=n.alternate;if(!o){if(o=K(n),o===null)throw Error(r(188));return o!==n?null:n}for(var d=n,f=o;;){var E=d.return;if(E===null)break;var T=E.alternate;if(T===null){if(f=E.return,f!==null){d=f;continue}break}if(E.child===T.child){for(T=E.child;T;){if(T===d)return L(E),n;if(T===f)return L(E),o;T=T.sibling}throw Error(r(188))}if(d.return!==f.return)d=E,f=T;else{for(var N=!1,M=E.child;M;){if(M===d){N=!0,d=E,f=T;break}if(M===f){N=!0,f=E,d=T;break}M=M.sibling}if(!N){for(M=T.child;M;){if(M===d){N=!0,d=T,f=E;break}if(M===f){N=!0,f=T,d=E;break}M=M.sibling}if(!N)throw Error(r(189))}}if(d.alternate!==f)throw Error(r(190))}if(d.tag!==3)throw Error(r(188));return d.stateNode.current===d?n:o}function w(n){var o=n.tag;if(o===5||o===26||o===27||o===6)return n;for(n=n.child;n!==null;){if(o=w(n),o!==null)return o;n=n.sibling}return null}var D=Array.isArray,F=i.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,pe={pending:!1,data:null,method:null,action:null},Re=[],rt=-1;function Xe(n){return{current:n}}function Ft(n){0>rt||(n.current=Re[rt],Re[rt]=null,rt--)}function Yt(n,o){rt++,Re[rt]=n.current,n.current=o}var Dr=Xe(null),Xi=Xe(null),Er=Xe(null),rn=Xe(null);function vt(n,o){switch(Yt(Er,o),Yt(Xi,n),Yt(Dr,null),n=o.nodeType,n){case 9:case 11:o=(o=o.documentElement)&&(o=o.namespaceURI)?UI(o):0;break;default:if(n=n===8?o.parentNode:o,o=n.tagName,n=n.namespaceURI)n=UI(n),o=xI(n,o);else switch(o){case"svg":o=1;break;case"math":o=2;break;default:o=0}}Ft(Dr),Yt(Dr,o)}function yt(){Ft(Dr),Ft(Xi),Ft(Er)}function dt(n){n.memoizedState!==null&&Yt(rn,n);var o=Dr.current,d=xI(o,n.type);o!==d&&(Yt(Xi,n),Yt(Dr,d))}function Hi(n){Xi.current===n&&(Ft(Dr),Ft(Xi)),rn.current===n&&(Ft(rn),Nu._currentValue=pe)}var Fr=Object.prototype.hasOwnProperty,It=e.unstable_scheduleCallback,Be=e.unstable_cancelCallback,rr=e.unstable_shouldYield,yn=e.unstable_requestPaint,Ci=e.unstable_now,_p=e.unstable_getCurrentPriorityLevel,bC=e.unstable_ImmediatePriority,AC=e.unstable_UserBlockingPriority,Ep=e.unstable_NormalPriority,hj=e.unstable_LowPriority,IC=e.unstable_IdlePriority,pj=e.log,fj=e.unstable_setDisableYieldValue,Bd=null,ra=null;function _j(n){if(ra&&typeof ra.onCommitFiberRoot=="function")try{ra.onCommitFiberRoot(Bd,n,void 0,(n.current.flags&128)===128)}catch{}}function Ls(n){if(typeof pj=="function"&&fj(n),ra&&typeof ra.setStrictMode=="function")try{ra.setStrictMode(Bd,n)}catch{}}var aa=Math.clz32?Math.clz32:gj,Ej=Math.log,mj=Math.LN2;function gj(n){return n>>>=0,n===0?32:31-(Ej(n)/mj|0)|0}var mp=128,gp=4194304;function Vo(n){var o=n&42;if(o!==0)return o;switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n&4194176;case 4194304:case 8388608:case 16777216:case 33554432:return n&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return n}}function Sp(n,o){var d=n.pendingLanes;if(d===0)return 0;var f=0,E=n.suspendedLanes,T=n.pingedLanes,N=n.warmLanes;n=n.finishedLanes!==0;var M=d&134217727;return M!==0?(d=M&~E,d!==0?f=Vo(d):(T&=M,T!==0?f=Vo(T):n||(N=M&~N,N!==0&&(f=Vo(N))))):(M=d&~E,M!==0?f=Vo(M):T!==0?f=Vo(T):n||(N=d&~N,N!==0&&(f=Vo(N)))),f===0?0:o!==0&&o!==f&&(o&E)===0&&(E=f&-f,N=o&-o,E>=N||E===32&&(N&4194176)!==0)?o:f}function jd(n,o){return(n.pendingLanes&~(n.suspendedLanes&~n.pingedLanes)&o)===0}function Sj(n,o){switch(n){case 1:case 2:case 4:case 8:return o+250;case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return o+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function OC(){var n=mp;return mp<<=1,(mp&4194176)===0&&(mp=128),n}function wC(){var n=gp;return gp<<=1,(gp&62914560)===0&&(gp=4194304),n}function dm(n){for(var o=[],d=0;31>d;d++)o.push(n);return o}function Fd(n,o){n.pendingLanes|=o,o!==268435456&&(n.suspendedLanes=0,n.pingedLanes=0,n.warmLanes=0)}function Tj(n,o,d,f,E,T){var N=n.pendingLanes;n.pendingLanes=d,n.suspendedLanes=0,n.pingedLanes=0,n.warmLanes=0,n.expiredLanes&=d,n.entangledLanes&=d,n.errorRecoveryDisabledLanes&=d,n.shellSuspendCounter=0;var M=n.entanglements,V=n.expirationTimes,Y=n.hiddenUpdates;for(d=N&~d;0<d;){var ne=31-aa(d),Ee=1<<ne;M[ne]=0,V[ne]=-1;var ee=Y[ne];if(ee!==null)for(Y[ne]=null,ne=0;ne<ee.length;ne++){var re=ee[ne];re!==null&&(re.lane&=-536870913)}d&=~Ee}f!==0&&NC(n,f,0),T!==0&&E===0&&n.tag!==0&&(n.suspendedLanes|=T&~(N&~o))}function NC(n,o,d){n.pendingLanes|=o,n.suspendedLanes&=~o;var f=31-aa(o);n.entangledLanes|=o,n.entanglements[f]=n.entanglements[f]|1073741824|d&4194218}function DC(n,o){var d=n.entangledLanes|=o;for(n=n.entanglements;d;){var f=31-aa(d),E=1<<f;E&o|n[f]&o&&(n[f]|=o),d&=~E}}function PC(n){return n&=-n,2<n?8<n?(n&134217727)!==0?32:268435456:8:2}function LC(){var n=F.p;return n!==0?n:(n=window.event,n===void 0?32:tO(n.type))}function Rj(n,o){var d=F.p;try{return F.p=n,o()}finally{F.p=d}}var ks=Math.random().toString(36).slice(2),Cr="__reactFiber$"+ks,Gr="__reactProps$"+ks,Gc="__reactContainer$"+ks,um="__reactEvents$"+ks,vj="__reactListeners$"+ks,yj="__reactHandles$"+ks,kC="__reactResources$"+ks,Gd="__reactMarker$"+ks;function hm(n){delete n[Cr],delete n[Gr],delete n[um],delete n[vj],delete n[yj]}function Bo(n){var o=n[Cr];if(o)return o;for(var d=n.parentNode;d;){if(o=d[Gc]||d[Cr]){if(d=o.alternate,o.child!==null||d!==null&&d.child!==null)for(n=jI(n);n!==null;){if(d=n[Cr])return d;n=jI(n)}return o}n=d,d=n.parentNode}return null}function Hc(n){if(n=n[Cr]||n[Gc]){var o=n.tag;if(o===5||o===6||o===13||o===26||o===27||o===3)return n}return null}function Hd(n){var o=n.tag;if(o===5||o===26||o===27||o===6)return n.stateNode;throw Error(r(33))}function Wc(n){var o=n[kC];return o||(o=n[kC]={hoistableStyles:new Map,hoistableScripts:new Map}),o}function ar(n){n[Gd]=!0}var MC=new Set,UC={};function jo(n,o){Kc(n,o),Kc(n+"Capture",o)}function Kc(n,o){for(UC[n]=o,n=0;n<o.length;n++)MC.add(o[n])}var $n=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Cj=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),xC={},VC={};function bj(n){return Fr.call(VC,n)?!0:Fr.call(xC,n)?!1:Cj.test(n)?VC[n]=!0:(xC[n]=!0,!1)}function Tp(n,o,d){if(bj(o))if(d===null)n.removeAttribute(o);else{switch(typeof d){case"undefined":case"function":case"symbol":n.removeAttribute(o);return;case"boolean":var f=o.toLowerCase().slice(0,5);if(f!=="data-"&&f!=="aria-"){n.removeAttribute(o);return}}n.setAttribute(o,""+d)}}function Rp(n,o,d){if(d===null)n.removeAttribute(o);else{switch(typeof d){case"undefined":case"function":case"symbol":case"boolean":n.removeAttribute(o);return}n.setAttribute(o,""+d)}}function es(n,o,d,f){if(f===null)n.removeAttribute(d);else{switch(typeof f){case"undefined":case"function":case"symbol":case"boolean":n.removeAttribute(d);return}n.setAttributeNS(o,d,""+f)}}function va(n){switch(typeof n){case"bigint":case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function BC(n){var o=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(o==="checkbox"||o==="radio")}function Aj(n){var o=BC(n)?"checked":"value",d=Object.getOwnPropertyDescriptor(n.constructor.prototype,o),f=""+n[o];if(!n.hasOwnProperty(o)&&typeof d<"u"&&typeof d.get=="function"&&typeof d.set=="function"){var E=d.get,T=d.set;return Object.defineProperty(n,o,{configurable:!0,get:function(){return E.call(this)},set:function(N){f=""+N,T.call(this,N)}}),Object.defineProperty(n,o,{enumerable:d.enumerable}),{getValue:function(){return f},setValue:function(N){f=""+N},stopTracking:function(){n._valueTracker=null,delete n[o]}}}}function vp(n){n._valueTracker||(n._valueTracker=Aj(n))}function jC(n){if(!n)return!1;var o=n._valueTracker;if(!o)return!0;var d=o.getValue(),f="";return n&&(f=BC(n)?n.checked?"true":"false":n.value),n=f,n!==d?(o.setValue(n),!0):!1}function yp(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}var Ij=/[\n"\\]/g;function ya(n){return n.replace(Ij,function(o){return"\\"+o.charCodeAt(0).toString(16)+" "})}function pm(n,o,d,f,E,T,N,M){n.name="",N!=null&&typeof N!="function"&&typeof N!="symbol"&&typeof N!="boolean"?n.type=N:n.removeAttribute("type"),o!=null?N==="number"?(o===0&&n.value===""||n.value!=o)&&(n.value=""+va(o)):n.value!==""+va(o)&&(n.value=""+va(o)):N!=="submit"&&N!=="reset"||n.removeAttribute("value"),o!=null?fm(n,N,va(o)):d!=null?fm(n,N,va(d)):f!=null&&n.removeAttribute("value"),E==null&&T!=null&&(n.defaultChecked=!!T),E!=null&&(n.checked=E&&typeof E!="function"&&typeof E!="symbol"),M!=null&&typeof M!="function"&&typeof M!="symbol"&&typeof M!="boolean"?n.name=""+va(M):n.removeAttribute("name")}function FC(n,o,d,f,E,T,N,M){if(T!=null&&typeof T!="function"&&typeof T!="symbol"&&typeof T!="boolean"&&(n.type=T),o!=null||d!=null){if(!(T!=="submit"&&T!=="reset"||o!=null))return;d=d!=null?""+va(d):"",o=o!=null?""+va(o):d,M||o===n.value||(n.value=o),n.defaultValue=o}f=f??E,f=typeof f!="function"&&typeof f!="symbol"&&!!f,n.checked=M?n.checked:!!f,n.defaultChecked=!!f,N!=null&&typeof N!="function"&&typeof N!="symbol"&&typeof N!="boolean"&&(n.name=N)}function fm(n,o,d){o==="number"&&yp(n.ownerDocument)===n||n.defaultValue===""+d||(n.defaultValue=""+d)}function zc(n,o,d,f){if(n=n.options,o){o={};for(var E=0;E<d.length;E++)o["$"+d[E]]=!0;for(d=0;d<n.length;d++)E=o.hasOwnProperty("$"+n[d].value),n[d].selected!==E&&(n[d].selected=E),E&&f&&(n[d].defaultSelected=!0)}else{for(d=""+va(d),o=null,E=0;E<n.length;E++){if(n[E].value===d){n[E].selected=!0,f&&(n[E].defaultSelected=!0);return}o!==null||n[E].disabled||(o=n[E])}o!==null&&(o.selected=!0)}}function GC(n,o,d){if(o!=null&&(o=""+va(o),o!==n.value&&(n.value=o),d==null)){n.defaultValue!==o&&(n.defaultValue=o);return}n.defaultValue=d!=null?""+va(d):""}function HC(n,o,d,f){if(o==null){if(f!=null){if(d!=null)throw Error(r(92));if(D(f)){if(1<f.length)throw Error(r(93));f=f[0]}d=f}d==null&&(d=""),o=d}d=va(o),n.defaultValue=d,f=n.textContent,f===d&&f!==""&&f!==null&&(n.value=f)}function Yc(n,o){if(o){var d=n.firstChild;if(d&&d===n.lastChild&&d.nodeType===3){d.nodeValue=o;return}}n.textContent=o}var Oj=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function WC(n,o,d){var f=o.indexOf("--")===0;d==null||typeof d=="boolean"||d===""?f?n.setProperty(o,""):o==="float"?n.cssFloat="":n[o]="":f?n.setProperty(o,d):typeof d!="number"||d===0||Oj.has(o)?o==="float"?n.cssFloat=d:n[o]=(""+d).trim():n[o]=d+"px"}function KC(n,o,d){if(o!=null&&typeof o!="object")throw Error(r(62));if(n=n.style,d!=null){for(var f in d)!d.hasOwnProperty(f)||o!=null&&o.hasOwnProperty(f)||(f.indexOf("--")===0?n.setProperty(f,""):f==="float"?n.cssFloat="":n[f]="");for(var E in o)f=o[E],o.hasOwnProperty(E)&&d[E]!==f&&WC(n,E,f)}else for(var T in o)o.hasOwnProperty(T)&&WC(n,T,o[T])}function _m(n){if(n.indexOf("-")===-1)return!1;switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var wj=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Nj=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Cp(n){return Nj.test(""+n)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":n}var Em=null;function mm(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var qc=null,Xc=null;function zC(n){var o=Hc(n);if(o&&(n=o.stateNode)){var d=n[Gr]||null;e:switch(n=o.stateNode,o.type){case"input":if(pm(n,d.value,d.defaultValue,d.defaultValue,d.checked,d.defaultChecked,d.type,d.name),o=d.name,d.type==="radio"&&o!=null){for(d=n;d.parentNode;)d=d.parentNode;for(d=d.querySelectorAll('input[name="'+ya(""+o)+'"][type="radio"]'),o=0;o<d.length;o++){var f=d[o];if(f!==n&&f.form===n.form){var E=f[Gr]||null;if(!E)throw Error(r(90));pm(f,E.value,E.defaultValue,E.defaultValue,E.checked,E.defaultChecked,E.type,E.name)}}for(o=0;o<d.length;o++)f=d[o],f.form===n.form&&jC(f)}break e;case"textarea":GC(n,d.value,d.defaultValue);break e;case"select":o=d.value,o!=null&&zc(n,!!d.multiple,o,!1)}}}var gm=!1;function YC(n,o,d){if(gm)return n(o,d);gm=!0;try{var f=n(o);return f}finally{if(gm=!1,(qc!==null||Xc!==null)&&(cf(),qc&&(o=qc,n=Xc,Xc=qc=null,zC(o),n)))for(o=0;o<n.length;o++)zC(n[o])}}function Wd(n,o){var d=n.stateNode;if(d===null)return null;var f=d[Gr]||null;if(f===null)return null;d=f[o];e:switch(o){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(f=!f.disabled)||(n=n.type,f=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!f;break e;default:n=!1}if(n)return null;if(d&&typeof d!="function")throw Error(r(231,o,typeof d));return d}var Sm=!1;if($n)try{var Kd={};Object.defineProperty(Kd,"passive",{get:function(){Sm=!0}}),window.addEventListener("test",Kd,Kd),window.removeEventListener("test",Kd,Kd)}catch{Sm=!1}var Ms=null,Tm=null,bp=null;function qC(){if(bp)return bp;var n,o=Tm,d=o.length,f,E="value"in Ms?Ms.value:Ms.textContent,T=E.length;for(n=0;n<d&&o[n]===E[n];n++);var N=d-n;for(f=1;f<=N&&o[d-f]===E[T-f];f++);return bp=E.slice(n,1<f?1-f:void 0)}function Ap(n){var o=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&o===13&&(n=13)):n=o,n===10&&(n=13),32<=n||n===13?n:0}function Ip(){return!0}function XC(){return!1}function Hr(n){function o(d,f,E,T,N){this._reactName=d,this._targetInst=E,this.type=f,this.nativeEvent=T,this.target=N,this.currentTarget=null;for(var M in n)n.hasOwnProperty(M)&&(d=n[M],this[M]=d?d(T):T[M]);return this.isDefaultPrevented=(T.defaultPrevented!=null?T.defaultPrevented:T.returnValue===!1)?Ip:XC,this.isPropagationStopped=XC,this}return ie(o.prototype,{preventDefault:function(){this.defaultPrevented=!0;var d=this.nativeEvent;d&&(d.preventDefault?d.preventDefault():typeof d.returnValue!="unknown"&&(d.returnValue=!1),this.isDefaultPrevented=Ip)},stopPropagation:function(){var d=this.nativeEvent;d&&(d.stopPropagation?d.stopPropagation():typeof d.cancelBubble!="unknown"&&(d.cancelBubble=!0),this.isPropagationStopped=Ip)},persist:function(){},isPersistent:Ip}),o}var Fo={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Op=Hr(Fo),zd=ie({},Fo,{view:0,detail:0}),Dj=Hr(zd),Rm,vm,Yd,wp=ie({},zd,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Cm,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==Yd&&(Yd&&n.type==="mousemove"?(Rm=n.screenX-Yd.screenX,vm=n.screenY-Yd.screenY):vm=Rm=0,Yd=n),Rm)},movementY:function(n){return"movementY"in n?n.movementY:vm}}),JC=Hr(wp),Pj=ie({},wp,{dataTransfer:0}),Lj=Hr(Pj),kj=ie({},zd,{relatedTarget:0}),ym=Hr(kj),Mj=ie({},Fo,{animationName:0,elapsedTime:0,pseudoElement:0}),Uj=Hr(Mj),xj=ie({},Fo,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),Vj=Hr(xj),Bj=ie({},Fo,{data:0}),QC=Hr(Bj),jj={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Fj={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Gj={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Hj(n){var o=this.nativeEvent;return o.getModifierState?o.getModifierState(n):(n=Gj[n])?!!o[n]:!1}function Cm(){return Hj}var Wj=ie({},zd,{key:function(n){if(n.key){var o=jj[n.key]||n.key;if(o!=="Unidentified")return o}return n.type==="keypress"?(n=Ap(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?Fj[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Cm,charCode:function(n){return n.type==="keypress"?Ap(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?Ap(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),Kj=Hr(Wj),zj=ie({},wp,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),ZC=Hr(zj),Yj=ie({},zd,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Cm}),qj=Hr(Yj),Xj=ie({},Fo,{propertyName:0,elapsedTime:0,pseudoElement:0}),Jj=Hr(Xj),Qj=ie({},wp,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),Zj=Hr(Qj),$j=ie({},Fo,{newState:0,oldState:0}),eF=Hr($j),tF=[9,13,27,32],bm=$n&&"CompositionEvent"in window,qd=null;$n&&"documentMode"in document&&(qd=document.documentMode);var iF=$n&&"TextEvent"in window&&!qd,$C=$n&&(!bm||qd&&8<qd&&11>=qd),eb=" ",tb=!1;function ib(n,o){switch(n){case"keyup":return tF.indexOf(o.keyCode)!==-1;case"keydown":return o.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function rb(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var Jc=!1;function rF(n,o){switch(n){case"compositionend":return rb(o);case"keypress":return o.which!==32?null:(tb=!0,eb);case"textInput":return n=o.data,n===eb&&tb?null:n;default:return null}}function aF(n,o){if(Jc)return n==="compositionend"||!bm&&ib(n,o)?(n=qC(),bp=Tm=Ms=null,Jc=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(o.ctrlKey||o.altKey||o.metaKey)||o.ctrlKey&&o.altKey){if(o.char&&1<o.char.length)return o.char;if(o.which)return String.fromCharCode(o.which)}return null;case"compositionend":return $C&&o.locale!=="ko"?null:o.data;default:return null}}var nF={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function ab(n){var o=n&&n.nodeName&&n.nodeName.toLowerCase();return o==="input"?!!nF[n.type]:o==="textarea"}function nb(n,o,d,f){qc?Xc?Xc.push(f):Xc=[f]:qc=f,o=pf(o,"onChange"),0<o.length&&(d=new Op("onChange","change",null,d,f),n.push({event:d,listeners:o}))}var Xd=null,Jd=null;function sF(n){DI(n,0)}function Np(n){var o=Hd(n);if(jC(o))return n}function sb(n,o){if(n==="change")return o}var ob=!1;if($n){var Am;if($n){var Im="oninput"in document;if(!Im){var cb=document.createElement("div");cb.setAttribute("oninput","return;"),Im=typeof cb.oninput=="function"}Am=Im}else Am=!1;ob=Am&&(!document.documentMode||9<document.documentMode)}function lb(){Xd&&(Xd.detachEvent("onpropertychange",db),Jd=Xd=null)}function db(n){if(n.propertyName==="value"&&Np(Jd)){var o=[];nb(o,Jd,n,mm(n)),YC(sF,o)}}function oF(n,o,d){n==="focusin"?(lb(),Xd=o,Jd=d,Xd.attachEvent("onpropertychange",db)):n==="focusout"&&lb()}function cF(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return Np(Jd)}function lF(n,o){if(n==="click")return Np(o)}function dF(n,o){if(n==="input"||n==="change")return Np(o)}function uF(n,o){return n===o&&(n!==0||1/n===1/o)||n!==n&&o!==o}var na=typeof Object.is=="function"?Object.is:uF;function Qd(n,o){if(na(n,o))return!0;if(typeof n!="object"||n===null||typeof o!="object"||o===null)return!1;var d=Object.keys(n),f=Object.keys(o);if(d.length!==f.length)return!1;for(f=0;f<d.length;f++){var E=d[f];if(!Fr.call(o,E)||!na(n[E],o[E]))return!1}return!0}function ub(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function hb(n,o){var d=ub(n);n=0;for(var f;d;){if(d.nodeType===3){if(f=n+d.textContent.length,n<=o&&f>=o)return{node:d,offset:o-n};n=f}e:{for(;d;){if(d.nextSibling){d=d.nextSibling;break e}d=d.parentNode}d=void 0}d=ub(d)}}function pb(n,o){return n&&o?n===o?!0:n&&n.nodeType===3?!1:o&&o.nodeType===3?pb(n,o.parentNode):"contains"in n?n.contains(o):n.compareDocumentPosition?!!(n.compareDocumentPosition(o)&16):!1:!1}function fb(n){n=n!=null&&n.ownerDocument!=null&&n.ownerDocument.defaultView!=null?n.ownerDocument.defaultView:window;for(var o=yp(n.document);o instanceof n.HTMLIFrameElement;){try{var d=typeof o.contentWindow.location.href=="string"}catch{d=!1}if(d)n=o.contentWindow;else break;o=yp(n.document)}return o}function Om(n){var o=n&&n.nodeName&&n.nodeName.toLowerCase();return o&&(o==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||o==="textarea"||n.contentEditable==="true")}function hF(n,o){var d=fb(o);o=n.focusedElem;var f=n.selectionRange;if(d!==o&&o&&o.ownerDocument&&pb(o.ownerDocument.documentElement,o)){if(f!==null&&Om(o)){if(n=f.start,d=f.end,d===void 0&&(d=n),"selectionStart"in o)o.selectionStart=n,o.selectionEnd=Math.min(d,o.value.length);else if(d=(n=o.ownerDocument||document)&&n.defaultView||window,d.getSelection){d=d.getSelection();var E=o.textContent.length,T=Math.min(f.start,E);f=f.end===void 0?T:Math.min(f.end,E),!d.extend&&T>f&&(E=f,f=T,T=E),E=hb(o,T);var N=hb(o,f);E&&N&&(d.rangeCount!==1||d.anchorNode!==E.node||d.anchorOffset!==E.offset||d.focusNode!==N.node||d.focusOffset!==N.offset)&&(n=n.createRange(),n.setStart(E.node,E.offset),d.removeAllRanges(),T>f?(d.addRange(n),d.extend(N.node,N.offset)):(n.setEnd(N.node,N.offset),d.addRange(n)))}}for(n=[],d=o;d=d.parentNode;)d.nodeType===1&&n.push({element:d,left:d.scrollLeft,top:d.scrollTop});for(typeof o.focus=="function"&&o.focus(),o=0;o<n.length;o++)d=n[o],d.element.scrollLeft=d.left,d.element.scrollTop=d.top}}var pF=$n&&"documentMode"in document&&11>=document.documentMode,Qc=null,wm=null,Zd=null,Nm=!1;function _b(n,o,d){var f=d.window===d?d.document:d.nodeType===9?d:d.ownerDocument;Nm||Qc==null||Qc!==yp(f)||(f=Qc,"selectionStart"in f&&Om(f)?f={start:f.selectionStart,end:f.selectionEnd}:(f=(f.ownerDocument&&f.ownerDocument.defaultView||window).getSelection(),f={anchorNode:f.anchorNode,anchorOffset:f.anchorOffset,focusNode:f.focusNode,focusOffset:f.focusOffset}),Zd&&Qd(Zd,f)||(Zd=f,f=pf(wm,"onSelect"),0<f.length&&(o=new Op("onSelect","select",null,o,d),n.push({event:o,listeners:f}),o.target=Qc)))}function Go(n,o){var d={};return d[n.toLowerCase()]=o.toLowerCase(),d["Webkit"+n]="webkit"+o,d["Moz"+n]="moz"+o,d}var Zc={animationend:Go("Animation","AnimationEnd"),animationiteration:Go("Animation","AnimationIteration"),animationstart:Go("Animation","AnimationStart"),transitionrun:Go("Transition","TransitionRun"),transitionstart:Go("Transition","TransitionStart"),transitioncancel:Go("Transition","TransitionCancel"),transitionend:Go("Transition","TransitionEnd")},Dm={},Eb={};$n&&(Eb=document.createElement("div").style,"AnimationEvent"in window||(delete Zc.animationend.animation,delete Zc.animationiteration.animation,delete Zc.animationstart.animation),"TransitionEvent"in window||delete Zc.transitionend.transition);function Ho(n){if(Dm[n])return Dm[n];if(!Zc[n])return n;var o=Zc[n],d;for(d in o)if(o.hasOwnProperty(d)&&d in Eb)return Dm[n]=o[d];return n}var mb=Ho("animationend"),gb=Ho("animationiteration"),Sb=Ho("animationstart"),fF=Ho("transitionrun"),_F=Ho("transitionstart"),EF=Ho("transitioncancel"),Tb=Ho("transitionend"),Rb=new Map,vb="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll scrollEnd toggle touchMove waiting wheel".split(" ");function an(n,o){Rb.set(n,o),jo(o,[n])}var Ca=[],$c=0,Pm=0;function Dp(){for(var n=$c,o=Pm=$c=0;o<n;){var d=Ca[o];Ca[o++]=null;var f=Ca[o];Ca[o++]=null;var E=Ca[o];Ca[o++]=null;var T=Ca[o];if(Ca[o++]=null,f!==null&&E!==null){var N=f.pending;N===null?E.next=E:(E.next=N.next,N.next=E),f.pending=E}T!==0&&yb(d,E,T)}}function Pp(n,o,d,f){Ca[$c++]=n,Ca[$c++]=o,Ca[$c++]=d,Ca[$c++]=f,Pm|=f,n.lanes|=f,n=n.alternate,n!==null&&(n.lanes|=f)}function Lm(n,o,d,f){return Pp(n,o,d,f),Lp(n)}function Us(n,o){return Pp(n,null,null,o),Lp(n)}function yb(n,o,d){n.lanes|=d;var f=n.alternate;f!==null&&(f.lanes|=d);for(var E=!1,T=n.return;T!==null;)T.childLanes|=d,f=T.alternate,f!==null&&(f.childLanes|=d),T.tag===22&&(n=T.stateNode,n===null||n._visibility&1||(E=!0)),n=T,T=T.return;E&&o!==null&&n.tag===3&&(T=n.stateNode,E=31-aa(d),T=T.hiddenUpdates,n=T[E],n===null?T[E]=[o]:n.push(o),o.lane=d|536870912)}function Lp(n){if(50<yu)throw yu=0,Bg=null,Error(r(185));for(var o=n.return;o!==null;)n=o,o=n.return;return n.tag===3?n.stateNode:null}var el={},Cb=new WeakMap;function ba(n,o){if(typeof n=="object"&&n!==null){var d=Cb.get(n);return d!==void 0?d:(o={value:n,source:o,stack:j(o)},Cb.set(n,o),o)}return{value:n,source:o,stack:j(o)}}var tl=[],il=0,kp=null,Mp=0,Aa=[],Ia=0,Wo=null,ts=1,is="";function Ko(n,o){tl[il++]=Mp,tl[il++]=kp,kp=n,Mp=o}function bb(n,o,d){Aa[Ia++]=ts,Aa[Ia++]=is,Aa[Ia++]=Wo,Wo=n;var f=ts;n=is;var E=32-aa(f)-1;f&=~(1<<E),d+=1;var T=32-aa(o)+E;if(30<T){var N=E-E%5;T=(f&(1<<N)-1).toString(32),f>>=N,E-=N,ts=1<<32-aa(o)+E|d<<E|f,is=T+n}else ts=1<<T|d<<E|f,is=n}function km(n){n.return!==null&&(Ko(n,1),bb(n,1,0))}function Mm(n){for(;n===kp;)kp=tl[--il],tl[il]=null,Mp=tl[--il],tl[il]=null;for(;n===Wo;)Wo=Aa[--Ia],Aa[Ia]=null,is=Aa[--Ia],Aa[Ia]=null,ts=Aa[--Ia],Aa[Ia]=null}var Pr=null,mr=null,kt=!1,nn=null,Cn=!1,Um=Error(r(519));function zo(n){var o=Error(r(418,""));throw tu(ba(o,n)),Um}function Ab(n){var o=n.stateNode,d=n.type,f=n.memoizedProps;switch(o[Cr]=n,o[Gr]=f,d){case"dialog":Ct("cancel",o),Ct("close",o);break;case"iframe":case"object":case"embed":Ct("load",o);break;case"video":case"audio":for(d=0;d<bu.length;d++)Ct(bu[d],o);break;case"source":Ct("error",o);break;case"img":case"image":case"link":Ct("error",o),Ct("load",o);break;case"details":Ct("toggle",o);break;case"input":Ct("invalid",o),FC(o,f.value,f.defaultValue,f.checked,f.defaultChecked,f.type,f.name,!0),vp(o);break;case"select":Ct("invalid",o);break;case"textarea":Ct("invalid",o),HC(o,f.value,f.defaultValue,f.children),vp(o)}d=f.children,typeof d!="string"&&typeof d!="number"&&typeof d!="bigint"||o.textContent===""+d||f.suppressHydrationWarning===!0||MI(o.textContent,d)?(f.popover!=null&&(Ct("beforetoggle",o),Ct("toggle",o)),f.onScroll!=null&&Ct("scroll",o),f.onScrollEnd!=null&&Ct("scrollend",o),f.onClick!=null&&(o.onclick=ff),o=!0):o=!1,o||zo(n)}function Ib(n){for(Pr=n.return;Pr;)switch(Pr.tag){case 3:case 27:Cn=!0;return;case 5:case 13:Cn=!1;return;default:Pr=Pr.return}}function $d(n){if(n!==Pr)return!1;if(!kt)return Ib(n),kt=!0,!1;var o=!1,d;if((d=n.tag!==3&&n.tag!==27)&&((d=n.tag===5)&&(d=n.type,d=!(d!=="form"&&d!=="button")||iS(n.type,n.memoizedProps)),d=!d),d&&(o=!0),o&&mr&&zo(n),Ib(n),n.tag===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(r(317));e:{for(n=n.nextSibling,o=0;n;){if(n.nodeType===8)if(d=n.data,d==="/$"){if(o===0){mr=on(n.nextSibling);break e}o--}else d!=="$"&&d!=="$!"&&d!=="$?"||o++;n=n.nextSibling}mr=null}}else mr=Pr?on(n.stateNode.nextSibling):null;return!0}function eu(){mr=Pr=null,kt=!1}function tu(n){nn===null?nn=[n]:nn.push(n)}var iu=Error(r(460)),Ob=Error(r(474)),xm={then:function(){}};function wb(n){return n=n.status,n==="fulfilled"||n==="rejected"}function Up(){}function Nb(n,o,d){switch(d=n[d],d===void 0?n.push(o):d!==o&&(o.then(Up,Up),o=d),o.status){case"fulfilled":return o.value;case"rejected":throw n=o.reason,n===iu?Error(r(483)):n;default:if(typeof o.status=="string")o.then(Up,Up);else{if(n=oi,n!==null&&100<n.shellSuspendCounter)throw Error(r(482));n=o,n.status="pending",n.then(function(f){if(o.status==="pending"){var E=o;E.status="fulfilled",E.value=f}},function(f){if(o.status==="pending"){var E=o;E.status="rejected",E.reason=f}})}switch(o.status){case"fulfilled":return o.value;case"rejected":throw n=o.reason,n===iu?Error(r(483)):n}throw ru=o,iu}}var ru=null;function Db(){if(ru===null)throw Error(r(459));var n=ru;return ru=null,n}var rl=null,au=0;function xp(n){var o=au;return au+=1,rl===null&&(rl=[]),Nb(rl,n,o)}function nu(n,o){o=o.props.ref,n.ref=o!==void 0?o:null}function Vp(n,o){throw o.$$typeof===s?Error(r(525)):(n=Object.prototype.toString.call(o),Error(r(31,n==="[object Object]"?"object with keys {"+Object.keys(o).join(", ")+"}":n)))}function Pb(n){var o=n._init;return o(n._payload)}function Lb(n){function o(X,z){if(n){var $=X.deletions;$===null?(X.deletions=[z],X.flags|=16):$.push(z)}}function d(X,z){if(!n)return null;for(;z!==null;)o(X,z),z=z.sibling;return null}function f(X){for(var z=new Map;X!==null;)X.key!==null?z.set(X.key,X):z.set(X.index,X),X=X.sibling;return z}function E(X,z){return X=qs(X,z),X.index=0,X.sibling=null,X}function T(X,z,$){return X.index=$,n?($=X.alternate,$!==null?($=$.index,$<z?(X.flags|=33554434,z):$):(X.flags|=33554434,z)):(X.flags|=1048576,z)}function N(X){return n&&X.alternate===null&&(X.flags|=33554434),X}function M(X,z,$,ue){return z===null||z.tag!==6?(z=Dg($,X.mode,ue),z.return=X,z):(z=E(z,$),z.return=X,z)}function V(X,z,$,ue){var be=$.type;return be===u?ne(X,z,$.props.children,ue,$.key):z!==null&&(z.elementType===be||typeof be=="object"&&be!==null&&be.$$typeof===O&&Pb(be)===z.type)?(z=E(z,$.props),nu(z,$),z.return=X,z):(z=rf($.type,$.key,$.props,null,X.mode,ue),nu(z,$),z.return=X,z)}function Y(X,z,$,ue){return z===null||z.tag!==4||z.stateNode.containerInfo!==$.containerInfo||z.stateNode.implementation!==$.implementation?(z=Pg($,X.mode,ue),z.return=X,z):(z=E(z,$.children||[]),z.return=X,z)}function ne(X,z,$,ue,be){return z===null||z.tag!==7?(z=ic($,X.mode,ue,be),z.return=X,z):(z=E(z,$),z.return=X,z)}function Ee(X,z,$){if(typeof z=="string"&&z!==""||typeof z=="number"||typeof z=="bigint")return z=Dg(""+z,X.mode,$),z.return=X,z;if(typeof z=="object"&&z!==null){switch(z.$$typeof){case c:return $=rf(z.type,z.key,z.props,null,X.mode,$),nu($,z),$.return=X,$;case l:return z=Pg(z,X.mode,$),z.return=X,z;case O:var ue=z._init;return z=ue(z._payload),Ee(X,z,$)}if(D(z)||G(z))return z=ic(z,X.mode,$,null),z.return=X,z;if(typeof z.then=="function")return Ee(X,xp(z),$);if(z.$$typeof===S)return Ee(X,$p(X,z),$);Vp(X,z)}return null}function ee(X,z,$,ue){var be=z!==null?z.key:null;if(typeof $=="string"&&$!==""||typeof $=="number"||typeof $=="bigint")return be!==null?null:M(X,z,""+$,ue);if(typeof $=="object"&&$!==null){switch($.$$typeof){case c:return $.key===be?V(X,z,$,ue):null;case l:return $.key===be?Y(X,z,$,ue):null;case O:return be=$._init,$=be($._payload),ee(X,z,$,ue)}if(D($)||G($))return be!==null?null:ne(X,z,$,ue,null);if(typeof $.then=="function")return ee(X,z,xp($),ue);if($.$$typeof===S)return ee(X,z,$p(X,$),ue);Vp(X,$)}return null}function re(X,z,$,ue,be){if(typeof ue=="string"&&ue!==""||typeof ue=="number"||typeof ue=="bigint")return X=X.get($)||null,M(z,X,""+ue,be);if(typeof ue=="object"&&ue!==null){switch(ue.$$typeof){case c:return X=X.get(ue.key===null?$:ue.key)||null,V(z,X,ue,be);case l:return X=X.get(ue.key===null?$:ue.key)||null,Y(z,X,ue,be);case O:var Et=ue._init;return ue=Et(ue._payload),re(X,z,$,ue,be)}if(D(ue)||G(ue))return X=X.get($)||null,ne(z,X,ue,be,null);if(typeof ue.then=="function")return re(X,z,$,xp(ue),be);if(ue.$$typeof===S)return re(X,z,$,$p(z,ue),be);Vp(z,ue)}return null}function we(X,z,$,ue){for(var be=null,Et=null,De=z,We=z=0,or=null;De!==null&&We<$.length;We++){De.index>We?(or=De,De=null):or=De.sibling;var Mt=ee(X,De,$[We],ue);if(Mt===null){De===null&&(De=or);break}n&&De&&Mt.alternate===null&&o(X,De),z=T(Mt,z,We),Et===null?be=Mt:Et.sibling=Mt,Et=Mt,De=or}if(We===$.length)return d(X,De),kt&&Ko(X,We),be;if(De===null){for(;We<$.length;We++)De=Ee(X,$[We],ue),De!==null&&(z=T(De,z,We),Et===null?be=De:Et.sibling=De,Et=De);return kt&&Ko(X,We),be}for(De=f(De);We<$.length;We++)or=re(De,X,We,$[We],ue),or!==null&&(n&&or.alternate!==null&&De.delete(or.key===null?We:or.key),z=T(or,z,We),Et===null?be=or:Et.sibling=or,Et=or);return n&&De.forEach(function(to){return o(X,to)}),kt&&Ko(X,We),be}function $e(X,z,$,ue){if($==null)throw Error(r(151));for(var be=null,Et=null,De=z,We=z=0,or=null,Mt=$.next();De!==null&&!Mt.done;We++,Mt=$.next()){De.index>We?(or=De,De=null):or=De.sibling;var to=ee(X,De,Mt.value,ue);if(to===null){De===null&&(De=or);break}n&&De&&to.alternate===null&&o(X,De),z=T(to,z,We),Et===null?be=to:Et.sibling=to,Et=to,De=or}if(Mt.done)return d(X,De),kt&&Ko(X,We),be;if(De===null){for(;!Mt.done;We++,Mt=$.next())Mt=Ee(X,Mt.value,ue),Mt!==null&&(z=T(Mt,z,We),Et===null?be=Mt:Et.sibling=Mt,Et=Mt);return kt&&Ko(X,We),be}for(De=f(De);!Mt.done;We++,Mt=$.next())Mt=re(De,X,We,Mt.value,ue),Mt!==null&&(n&&Mt.alternate!==null&&De.delete(Mt.key===null?We:Mt.key),z=T(Mt,z,We),Et===null?be=Mt:Et.sibling=Mt,Et=Mt);return n&&De.forEach(function(N3){return o(X,N3)}),kt&&Ko(X,We),be}function Ii(X,z,$,ue){if(typeof $=="object"&&$!==null&&$.type===u&&$.key===null&&($=$.props.children),typeof $=="object"&&$!==null){switch($.$$typeof){case c:e:{for(var be=$.key;z!==null;){if(z.key===be){if(be=$.type,be===u){if(z.tag===7){d(X,z.sibling),ue=E(z,$.props.children),ue.return=X,X=ue;break e}}else if(z.elementType===be||typeof be=="object"&&be!==null&&be.$$typeof===O&&Pb(be)===z.type){d(X,z.sibling),ue=E(z,$.props),nu(ue,$),ue.return=X,X=ue;break e}d(X,z);break}else o(X,z);z=z.sibling}$.type===u?(ue=ic($.props.children,X.mode,ue,$.key),ue.return=X,X=ue):(ue=rf($.type,$.key,$.props,null,X.mode,ue),nu(ue,$),ue.return=X,X=ue)}return N(X);case l:e:{for(be=$.key;z!==null;){if(z.key===be)if(z.tag===4&&z.stateNode.containerInfo===$.containerInfo&&z.stateNode.implementation===$.implementation){d(X,z.sibling),ue=E(z,$.children||[]),ue.return=X,X=ue;break e}else{d(X,z);break}else o(X,z);z=z.sibling}ue=Pg($,X.mode,ue),ue.return=X,X=ue}return N(X);case O:return be=$._init,$=be($._payload),Ii(X,z,$,ue)}if(D($))return we(X,z,$,ue);if(G($)){if(be=G($),typeof be!="function")throw Error(r(150));return $=be.call($),$e(X,z,$,ue)}if(typeof $.then=="function")return Ii(X,z,xp($),ue);if($.$$typeof===S)return Ii(X,z,$p(X,$),ue);Vp(X,$)}return typeof $=="string"&&$!==""||typeof $=="number"||typeof $=="bigint"?($=""+$,z!==null&&z.tag===6?(d(X,z.sibling),ue=E(z,$),ue.return=X,X=ue):(d(X,z),ue=Dg($,X.mode,ue),ue.return=X,X=ue),N(X)):d(X,z)}return function(X,z,$,ue){try{au=0;var be=Ii(X,z,$,ue);return rl=null,be}catch(De){if(De===iu)throw De;var Et=Da(29,De,null,X.mode);return Et.lanes=ue,Et.return=X,Et}finally{}}}var Yo=Lb(!0),kb=Lb(!1),al=Xe(null),Bp=Xe(0);function Mb(n,o){n=ps,Yt(Bp,n),Yt(al,o),ps=n|o.baseLanes}function Vm(){Yt(Bp,ps),Yt(al,al.current)}function Bm(){ps=Bp.current,Ft(al),Ft(Bp)}var Oa=Xe(null),bn=null;function xs(n){var o=n.alternate;Yt(Ji,Ji.current&1),Yt(Oa,n),bn===null&&(o===null||al.current!==null||o.memoizedState!==null)&&(bn=n)}function Ub(n){if(n.tag===22){if(Yt(Ji,Ji.current),Yt(Oa,n),bn===null){var o=n.alternate;o!==null&&o.memoizedState!==null&&(bn=n)}}else Vs()}function Vs(){Yt(Ji,Ji.current),Yt(Oa,Oa.current)}function rs(n){Ft(Oa),bn===n&&(bn=null),Ft(Ji)}var Ji=Xe(0);function jp(n){for(var o=n;o!==null;){if(o.tag===13){var d=o.memoizedState;if(d!==null&&(d=d.dehydrated,d===null||d.data==="$?"||d.data==="$!"))return o}else if(o.tag===19&&o.memoizedProps.revealOrder!==void 0){if((o.flags&128)!==0)return o}else if(o.child!==null){o.child.return=o,o=o.child;continue}if(o===n)break;for(;o.sibling===null;){if(o.return===null||o.return===n)return null;o=o.return}o.sibling.return=o.return,o=o.sibling}return null}var mF=typeof AbortController<"u"?AbortController:function(){var n=[],o=this.signal={aborted:!1,addEventListener:function(d,f){n.push(f)}};this.abort=function(){o.aborted=!0,n.forEach(function(d){return d()})}},gF=e.unstable_scheduleCallback,SF=e.unstable_NormalPriority,Qi={$$typeof:S,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function jm(){return{controller:new mF,data:new Map,refCount:0}}function su(n){n.refCount--,n.refCount===0&&gF(SF,function(){n.controller.abort()})}var ou=null,Fm=0,nl=0,sl=null;function TF(n,o){if(ou===null){var d=ou=[];Fm=0,nl=Yg(),sl={status:"pending",value:void 0,then:function(f){d.push(f)}}}return Fm++,o.then(xb,xb),o}function xb(){if(--Fm===0&&ou!==null){sl!==null&&(sl.status="fulfilled");var n=ou;ou=null,nl=0,sl=null;for(var o=0;o<n.length;o++)(0,n[o])()}}function RF(n,o){var d=[],f={status:"pending",value:null,reason:null,then:function(E){d.push(E)}};return n.then(function(){f.status="fulfilled",f.value=o;for(var E=0;E<d.length;E++)(0,d[E])(o)},function(E){for(f.status="rejected",f.reason=E,E=0;E<d.length;E++)(0,d[E])(void 0)}),f}var Vb=q.S;q.S=function(n,o){typeof o=="object"&&o!==null&&typeof o.then=="function"&&TF(n,o),Vb!==null&&Vb(n,o)};var qo=Xe(null);function Gm(){var n=qo.current;return n!==null?n:oi.pooledCache}function Fp(n,o){o===null?Yt(qo,qo.current):Yt(qo,o.pool)}function Bb(){var n=Gm();return n===null?null:{parent:Qi._currentValue,pool:n}}var Bs=0,ht=null,$t=null,Wi=null,Gp=!1,ol=!1,Xo=!1,Hp=0,cu=0,cl=null,vF=0;function Vi(){throw Error(r(321))}function Hm(n,o){if(o===null)return!1;for(var d=0;d<o.length&&d<n.length;d++)if(!na(n[d],o[d]))return!1;return!0}function Wm(n,o,d,f,E,T){return Bs=T,ht=o,o.memoizedState=null,o.updateQueue=null,o.lanes=0,q.H=n===null||n.memoizedState===null?Jo:js,Xo=!1,T=d(f,E),Xo=!1,ol&&(T=Fb(o,d,f,E)),jb(n),T}function jb(n){q.H=An;var o=$t!==null&&$t.next!==null;if(Bs=0,Wi=$t=ht=null,Gp=!1,cu=0,cl=null,o)throw Error(r(300));n===null||nr||(n=n.dependencies,n!==null&&Zp(n)&&(nr=!0))}function Fb(n,o,d,f){ht=n;var E=0;do{if(ol&&(cl=null),cu=0,ol=!1,25<=E)throw Error(r(301));if(E+=1,Wi=$t=null,n.updateQueue!=null){var T=n.updateQueue;T.lastEffect=null,T.events=null,T.stores=null,T.memoCache!=null&&(T.memoCache.index=0)}q.H=Qo,T=o(d,f)}while(ol);return T}function yF(){var n=q.H,o=n.useState()[0];return o=typeof o.then=="function"?lu(o):o,n=n.useState()[0],($t!==null?$t.memoizedState:null)!==n&&(ht.flags|=1024),o}function Km(){var n=Hp!==0;return Hp=0,n}function zm(n,o,d){o.updateQueue=n.updateQueue,o.flags&=-2053,n.lanes&=~d}function Ym(n){if(Gp){for(n=n.memoizedState;n!==null;){var o=n.queue;o!==null&&(o.pending=null),n=n.next}Gp=!1}Bs=0,Wi=$t=ht=null,ol=!1,cu=Hp=0,cl=null}function Wr(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Wi===null?ht.memoizedState=Wi=n:Wi=Wi.next=n,Wi}function Ki(){if($t===null){var n=ht.alternate;n=n!==null?n.memoizedState:null}else n=$t.next;var o=Wi===null?ht.memoizedState:Wi.next;if(o!==null)Wi=o,$t=n;else{if(n===null)throw ht.alternate===null?Error(r(467)):Error(r(310));$t=n,n={memoizedState:$t.memoizedState,baseState:$t.baseState,baseQueue:$t.baseQueue,queue:$t.queue,next:null},Wi===null?ht.memoizedState=Wi=n:Wi=Wi.next=n}return Wi}var Wp;Wp=function(){return{lastEffect:null,events:null,stores:null,memoCache:null}};function lu(n){var o=cu;return cu+=1,cl===null&&(cl=[]),n=Nb(cl,n,o),o=ht,(Wi===null?o.memoizedState:Wi.next)===null&&(o=o.alternate,q.H=o===null||o.memoizedState===null?Jo:js),n}function Kp(n){if(n!==null&&typeof n=="object"){if(typeof n.then=="function")return lu(n);if(n.$$typeof===S)return br(n)}throw Error(r(438,String(n)))}function qm(n){var o=null,d=ht.updateQueue;if(d!==null&&(o=d.memoCache),o==null){var f=ht.alternate;f!==null&&(f=f.updateQueue,f!==null&&(f=f.memoCache,f!=null&&(o={data:f.data.map(function(E){return E.slice()}),index:0})))}if(o==null&&(o={data:[],index:0}),d===null&&(d=Wp(),ht.updateQueue=d),d.memoCache=o,d=o.data[o.index],d===void 0)for(d=o.data[o.index]=Array(n),f=0;f<n;f++)d[f]=U;return o.index++,d}function as(n,o){return typeof o=="function"?o(n):o}function zp(n){var o=Ki();return Xm(o,$t,n)}function Xm(n,o,d){var f=n.queue;if(f===null)throw Error(r(311));f.lastRenderedReducer=d;var E=n.baseQueue,T=f.pending;if(T!==null){if(E!==null){var N=E.next;E.next=T.next,T.next=N}o.baseQueue=E=T,f.pending=null}if(T=n.baseState,E===null)n.memoizedState=T;else{o=E.next;var M=N=null,V=null,Y=o,ne=!1;do{var Ee=Y.lane&-536870913;if(Ee!==Y.lane?(Ot&Ee)===Ee:(Bs&Ee)===Ee){var ee=Y.revertLane;if(ee===0)V!==null&&(V=V.next={lane:0,revertLane:0,action:Y.action,hasEagerState:Y.hasEagerState,eagerState:Y.eagerState,next:null}),Ee===nl&&(ne=!0);else if((Bs&ee)===ee){Y=Y.next,ee===nl&&(ne=!0);continue}else Ee={lane:0,revertLane:Y.revertLane,action:Y.action,hasEagerState:Y.hasEagerState,eagerState:Y.eagerState,next:null},V===null?(M=V=Ee,N=T):V=V.next=Ee,ht.lanes|=ee,Xs|=ee;Ee=Y.action,Xo&&d(T,Ee),T=Y.hasEagerState?Y.eagerState:d(T,Ee)}else ee={lane:Ee,revertLane:Y.revertLane,action:Y.action,hasEagerState:Y.hasEagerState,eagerState:Y.eagerState,next:null},V===null?(M=V=ee,N=T):V=V.next=ee,ht.lanes|=Ee,Xs|=Ee;Y=Y.next}while(Y!==null&&Y!==o);if(V===null?N=T:V.next=M,!na(T,n.memoizedState)&&(nr=!0,ne&&(d=sl,d!==null)))throw d;n.memoizedState=T,n.baseState=N,n.baseQueue=V,f.lastRenderedState=T}return E===null&&(f.lanes=0),[n.memoizedState,f.dispatch]}function Jm(n){var o=Ki(),d=o.queue;if(d===null)throw Error(r(311));d.lastRenderedReducer=n;var f=d.dispatch,E=d.pending,T=o.memoizedState;if(E!==null){d.pending=null;var N=E=E.next;do T=n(T,N.action),N=N.next;while(N!==E);na(T,o.memoizedState)||(nr=!0),o.memoizedState=T,o.baseQueue===null&&(o.baseState=T),d.lastRenderedState=T}return[T,f]}function Gb(n,o,d){var f=ht,E=Ki(),T=kt;if(T){if(d===void 0)throw Error(r(407));d=d()}else d=o();var N=!na(($t||E).memoizedState,d);if(N&&(E.memoizedState=d,nr=!0),E=E.queue,$m(Kb.bind(null,f,E,n),[n]),E.getSnapshot!==o||N||Wi!==null&&Wi.memoizedState.tag&1){if(f.flags|=2048,ll(9,Wb.bind(null,f,E,d,o),{destroy:void 0},null),oi===null)throw Error(r(349));T||(Bs&60)!==0||Hb(f,o,d)}return d}function Hb(n,o,d){n.flags|=16384,n={getSnapshot:o,value:d},o=ht.updateQueue,o===null?(o=Wp(),ht.updateQueue=o,o.stores=[n]):(d=o.stores,d===null?o.stores=[n]:d.push(n))}function Wb(n,o,d,f){o.value=d,o.getSnapshot=f,zb(o)&&Yb(n)}function Kb(n,o,d){return d(function(){zb(o)&&Yb(n)})}function zb(n){var o=n.getSnapshot;n=n.value;try{var d=o();return!na(n,d)}catch{return!0}}function Yb(n){var o=Us(n,2);o!==null&&Lr(o,n,2)}function Qm(n){var o=Wr();if(typeof n=="function"){var d=n;if(n=d(),Xo){Ls(!0);try{d()}finally{Ls(!1)}}}return o.memoizedState=o.baseState=n,o.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:as,lastRenderedState:n},o}function qb(n,o,d,f){return n.baseState=d,Xm(n,$t,typeof f=="function"?f:as)}function CF(n,o,d,f,E){if(Xp(n))throw Error(r(485));if(n=o.action,n!==null){var T={payload:E,action:n,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(N){T.listeners.push(N)}};q.T!==null?d(!0):T.isTransition=!1,f(T),d=o.pending,d===null?(T.next=o.pending=T,Xb(o,T)):(T.next=d.next,o.pending=d.next=T)}}function Xb(n,o){var d=o.action,f=o.payload,E=n.state;if(o.isTransition){var T=q.T,N={};q.T=N;try{var M=d(E,f),V=q.S;V!==null&&V(N,M),Jb(n,o,M)}catch(Y){Zm(n,o,Y)}finally{q.T=T}}else try{T=d(E,f),Jb(n,o,T)}catch(Y){Zm(n,o,Y)}}function Jb(n,o,d){d!==null&&typeof d=="object"&&typeof d.then=="function"?d.then(function(f){Qb(n,o,f)},function(f){return Zm(n,o,f)}):Qb(n,o,d)}function Qb(n,o,d){o.status="fulfilled",o.value=d,Zb(o),n.state=d,o=n.pending,o!==null&&(d=o.next,d===o?n.pending=null:(d=d.next,o.next=d,Xb(n,d)))}function Zm(n,o,d){var f=n.pending;if(n.pending=null,f!==null){f=f.next;do o.status="rejected",o.reason=d,Zb(o),o=o.next;while(o!==f)}n.action=null}function Zb(n){n=n.listeners;for(var o=0;o<n.length;o++)(0,n[o])()}function $b(n,o){return o}function eA(n,o){if(kt){var d=oi.formState;if(d!==null){e:{var f=ht;if(kt){if(mr){t:{for(var E=mr,T=Cn;E.nodeType!==8;){if(!T){E=null;break t}if(E=on(E.nextSibling),E===null){E=null;break t}}T=E.data,E=T==="F!"||T==="F"?E:null}if(E){mr=on(E.nextSibling),f=E.data==="F!";break e}}zo(f)}f=!1}f&&(o=d[0])}}return d=Wr(),d.memoizedState=d.baseState=o,f={pending:null,lanes:0,dispatch:null,lastRenderedReducer:$b,lastRenderedState:o},d.queue=f,d=gA.bind(null,ht,f),f.dispatch=d,f=Qm(!1),T=ag.bind(null,ht,!1,f.queue),f=Wr(),E={state:o,dispatch:null,action:n,pending:null},f.queue=E,d=CF.bind(null,ht,E,T,d),E.dispatch=d,f.memoizedState=n,[o,d,!1]}function tA(n){var o=Ki();return iA(o,$t,n)}function iA(n,o,d){o=Xm(n,o,$b)[0],n=zp(as)[0],o=typeof o=="object"&&o!==null&&typeof o.then=="function"?lu(o):o;var f=Ki(),E=f.queue,T=E.dispatch;return d!==f.memoizedState&&(ht.flags|=2048,ll(9,bF.bind(null,E,d),{destroy:void 0},null)),[o,T,n]}function bF(n,o){n.action=o}function rA(n){var o=Ki(),d=$t;if(d!==null)return iA(o,d,n);Ki(),o=o.memoizedState,d=Ki();var f=d.queue.dispatch;return d.memoizedState=n,[o,f,!1]}function ll(n,o,d,f){return n={tag:n,create:o,inst:d,deps:f,next:null},o=ht.updateQueue,o===null&&(o=Wp(),ht.updateQueue=o),d=o.lastEffect,d===null?o.lastEffect=n.next=n:(f=d.next,d.next=n,n.next=f,o.lastEffect=n),n}function aA(){return Ki().memoizedState}function Yp(n,o,d,f){var E=Wr();ht.flags|=n,E.memoizedState=ll(1|o,d,{destroy:void 0},f===void 0?null:f)}function qp(n,o,d,f){var E=Ki();f=f===void 0?null:f;var T=E.memoizedState.inst;$t!==null&&f!==null&&Hm(f,$t.memoizedState.deps)?E.memoizedState=ll(o,d,T,f):(ht.flags|=n,E.memoizedState=ll(1|o,d,T,f))}function nA(n,o){Yp(8390656,8,n,o)}function $m(n,o){qp(2048,8,n,o)}function sA(n,o){return qp(4,2,n,o)}function oA(n,o){return qp(4,4,n,o)}function cA(n,o){if(typeof o=="function"){n=n();var d=o(n);return function(){typeof d=="function"?d():o(null)}}if(o!=null)return n=n(),o.current=n,function(){o.current=null}}function lA(n,o,d){d=d!=null?d.concat([n]):null,qp(4,4,cA.bind(null,o,n),d)}function eg(){}function dA(n,o){var d=Ki();o=o===void 0?null:o;var f=d.memoizedState;return o!==null&&Hm(o,f[1])?f[0]:(d.memoizedState=[n,o],n)}function uA(n,o){var d=Ki();o=o===void 0?null:o;var f=d.memoizedState;if(o!==null&&Hm(o,f[1]))return f[0];if(f=n(),Xo){Ls(!0);try{n()}finally{Ls(!1)}}return d.memoizedState=[f,o],f}function tg(n,o,d){return d===void 0||(Bs&1073741824)!==0?n.memoizedState=o:(n.memoizedState=d,n=pI(),ht.lanes|=n,Xs|=n,d)}function hA(n,o,d,f){return na(d,o)?d:al.current!==null?(n=tg(n,d,f),na(n,o)||(nr=!0),n):(Bs&42)===0?(nr=!0,n.memoizedState=d):(n=pI(),ht.lanes|=n,Xs|=n,o)}function pA(n,o,d,f,E){var T=F.p;F.p=T!==0&&8>T?T:8;var N=q.T,M={};q.T=M,ag(n,!1,o,d);try{var V=E(),Y=q.S;if(Y!==null&&Y(M,V),V!==null&&typeof V=="object"&&typeof V.then=="function"){var ne=RF(V,f);du(n,o,ne,la(n))}else du(n,o,f,la(n))}catch(Ee){du(n,o,{then:function(){},status:"rejected",reason:Ee},la())}finally{F.p=T,q.T=N}}function AF(){}function ig(n,o,d,f){if(n.tag!==5)throw Error(r(476));var E=fA(n).queue;pA(n,E,o,pe,d===null?AF:function(){return _A(n),d(f)})}function fA(n){var o=n.memoizedState;if(o!==null)return o;o={memoizedState:pe,baseState:pe,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:as,lastRenderedState:pe},next:null};var d={};return o.next={memoizedState:d,baseState:d,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:as,lastRenderedState:d},next:null},n.memoizedState=o,n=n.alternate,n!==null&&(n.memoizedState=o),o}function _A(n){var o=fA(n).next.queue;du(n,o,{},la())}function rg(){return br(Nu)}function EA(){return Ki().memoizedState}function mA(){return Ki().memoizedState}function IF(n){for(var o=n.return;o!==null;){switch(o.tag){case 24:case 3:var d=la();n=Hs(d);var f=Ws(o,n,d);f!==null&&(Lr(f,o,d),pu(f,o,d)),o={cache:jm()},n.payload=o;return}o=o.return}}function OF(n,o,d){var f=la();d={lane:f,revertLane:0,action:d,hasEagerState:!1,eagerState:null,next:null},Xp(n)?SA(o,d):(d=Lm(n,o,d,f),d!==null&&(Lr(d,n,f),TA(d,o,f)))}function gA(n,o,d){var f=la();du(n,o,d,f)}function du(n,o,d,f){var E={lane:f,revertLane:0,action:d,hasEagerState:!1,eagerState:null,next:null};if(Xp(n))SA(o,E);else{var T=n.alternate;if(n.lanes===0&&(T===null||T.lanes===0)&&(T=o.lastRenderedReducer,T!==null))try{var N=o.lastRenderedState,M=T(N,d);if(E.hasEagerState=!0,E.eagerState=M,na(M,N))return Pp(n,o,E,0),oi===null&&Dp(),!1}catch{}finally{}if(d=Lm(n,o,E,f),d!==null)return Lr(d,n,f),TA(d,o,f),!0}return!1}function ag(n,o,d,f){if(f={lane:2,revertLane:Yg(),action:f,hasEagerState:!1,eagerState:null,next:null},Xp(n)){if(o)throw Error(r(479))}else o=Lm(n,d,f,2),o!==null&&Lr(o,n,2)}function Xp(n){var o=n.alternate;return n===ht||o!==null&&o===ht}function SA(n,o){ol=Gp=!0;var d=n.pending;d===null?o.next=o:(o.next=d.next,d.next=o),n.pending=o}function TA(n,o,d){if((d&4194176)!==0){var f=o.lanes;f&=n.pendingLanes,d|=f,o.lanes=d,DC(n,d)}}var An={readContext:br,use:Kp,useCallback:Vi,useContext:Vi,useEffect:Vi,useImperativeHandle:Vi,useLayoutEffect:Vi,useInsertionEffect:Vi,useMemo:Vi,useReducer:Vi,useRef:Vi,useState:Vi,useDebugValue:Vi,useDeferredValue:Vi,useTransition:Vi,useSyncExternalStore:Vi,useId:Vi};An.useCacheRefresh=Vi,An.useMemoCache=Vi,An.useHostTransitionStatus=Vi,An.useFormState=Vi,An.useActionState=Vi,An.useOptimistic=Vi;var Jo={readContext:br,use:Kp,useCallback:function(n,o){return Wr().memoizedState=[n,o===void 0?null:o],n},useContext:br,useEffect:nA,useImperativeHandle:function(n,o,d){d=d!=null?d.concat([n]):null,Yp(4194308,4,cA.bind(null,o,n),d)},useLayoutEffect:function(n,o){return Yp(4194308,4,n,o)},useInsertionEffect:function(n,o){Yp(4,2,n,o)},useMemo:function(n,o){var d=Wr();o=o===void 0?null:o;var f=n();if(Xo){Ls(!0);try{n()}finally{Ls(!1)}}return d.memoizedState=[f,o],f},useReducer:function(n,o,d){var f=Wr();if(d!==void 0){var E=d(o);if(Xo){Ls(!0);try{d(o)}finally{Ls(!1)}}}else E=o;return f.memoizedState=f.baseState=E,n={pending:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:E},f.queue=n,n=n.dispatch=OF.bind(null,ht,n),[f.memoizedState,n]},useRef:function(n){var o=Wr();return n={current:n},o.memoizedState=n},useState:function(n){n=Qm(n);var o=n.queue,d=gA.bind(null,ht,o);return o.dispatch=d,[n.memoizedState,d]},useDebugValue:eg,useDeferredValue:function(n,o){var d=Wr();return tg(d,n,o)},useTransition:function(){var n=Qm(!1);return n=pA.bind(null,ht,n.queue,!0,!1),Wr().memoizedState=n,[!1,n]},useSyncExternalStore:function(n,o,d){var f=ht,E=Wr();if(kt){if(d===void 0)throw Error(r(407));d=d()}else{if(d=o(),oi===null)throw Error(r(349));(Ot&60)!==0||Hb(f,o,d)}E.memoizedState=d;var T={value:d,getSnapshot:o};return E.queue=T,nA(Kb.bind(null,f,T,n),[n]),f.flags|=2048,ll(9,Wb.bind(null,f,T,d,o),{destroy:void 0},null),d},useId:function(){var n=Wr(),o=oi.identifierPrefix;if(kt){var d=is,f=ts;d=(f&~(1<<32-aa(f)-1)).toString(32)+d,o=":"+o+"R"+d,d=Hp++,0<d&&(o+="H"+d.toString(32)),o+=":"}else d=vF++,o=":"+o+"r"+d.toString(32)+":";return n.memoizedState=o},useCacheRefresh:function(){return Wr().memoizedState=IF.bind(null,ht)}};Jo.useMemoCache=qm,Jo.useHostTransitionStatus=rg,Jo.useFormState=eA,Jo.useActionState=eA,Jo.useOptimistic=function(n){var o=Wr();o.memoizedState=o.baseState=n;var d={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return o.queue=d,o=ag.bind(null,ht,!0,d),d.dispatch=o,[n,o]};var js={readContext:br,use:Kp,useCallback:dA,useContext:br,useEffect:$m,useImperativeHandle:lA,useInsertionEffect:sA,useLayoutEffect:oA,useMemo:uA,useReducer:zp,useRef:aA,useState:function(){return zp(as)},useDebugValue:eg,useDeferredValue:function(n,o){var d=Ki();return hA(d,$t.memoizedState,n,o)},useTransition:function(){var n=zp(as)[0],o=Ki().memoizedState;return[typeof n=="boolean"?n:lu(n),o]},useSyncExternalStore:Gb,useId:EA};js.useCacheRefresh=mA,js.useMemoCache=qm,js.useHostTransitionStatus=rg,js.useFormState=tA,js.useActionState=tA,js.useOptimistic=function(n,o){var d=Ki();return qb(d,$t,n,o)};var Qo={readContext:br,use:Kp,useCallback:dA,useContext:br,useEffect:$m,useImperativeHandle:lA,useInsertionEffect:sA,useLayoutEffect:oA,useMemo:uA,useReducer:Jm,useRef:aA,useState:function(){return Jm(as)},useDebugValue:eg,useDeferredValue:function(n,o){var d=Ki();return $t===null?tg(d,n,o):hA(d,$t.memoizedState,n,o)},useTransition:function(){var n=Jm(as)[0],o=Ki().memoizedState;return[typeof n=="boolean"?n:lu(n),o]},useSyncExternalStore:Gb,useId:EA};Qo.useCacheRefresh=mA,Qo.useMemoCache=qm,Qo.useHostTransitionStatus=rg,Qo.useFormState=rA,Qo.useActionState=rA,Qo.useOptimistic=function(n,o){var d=Ki();return $t!==null?qb(d,$t,n,o):(d.baseState=n,[n,d.queue.dispatch])};function ng(n,o,d,f){o=n.memoizedState,d=d(f,o),d=d==null?o:ie({},o,d),n.memoizedState=d,n.lanes===0&&(n.updateQueue.baseState=d)}var sg={isMounted:function(n){return(n=n._reactInternals)?K(n)===n:!1},enqueueSetState:function(n,o,d){n=n._reactInternals;var f=la(),E=Hs(f);E.payload=o,d!=null&&(E.callback=d),o=Ws(n,E,f),o!==null&&(Lr(o,n,f),pu(o,n,f))},enqueueReplaceState:function(n,o,d){n=n._reactInternals;var f=la(),E=Hs(f);E.tag=1,E.payload=o,d!=null&&(E.callback=d),o=Ws(n,E,f),o!==null&&(Lr(o,n,f),pu(o,n,f))},enqueueForceUpdate:function(n,o){n=n._reactInternals;var d=la(),f=Hs(d);f.tag=2,o!=null&&(f.callback=o),o=Ws(n,f,d),o!==null&&(Lr(o,n,d),pu(o,n,d))}};function RA(n,o,d,f,E,T,N){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(f,T,N):o.prototype&&o.prototype.isPureReactComponent?!Qd(d,f)||!Qd(E,T):!0}function vA(n,o,d,f){n=o.state,typeof o.componentWillReceiveProps=="function"&&o.componentWillReceiveProps(d,f),typeof o.UNSAFE_componentWillReceiveProps=="function"&&o.UNSAFE_componentWillReceiveProps(d,f),o.state!==n&&sg.enqueueReplaceState(o,o.state,null)}function Zo(n,o){var d=o;if("ref"in o){d={};for(var f in o)f!=="ref"&&(d[f]=o[f])}if(n=n.defaultProps){d===o&&(d=ie({},d));for(var E in n)d[E]===void 0&&(d[E]=n[E])}return d}var Jp=typeof reportError=="function"?reportError:function(n){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var o=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof n=="object"&&n!==null&&typeof n.message=="string"?String(n.message):String(n),error:n});if(!window.dispatchEvent(o))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",n);return}console.error(n)};function yA(n){Jp(n)}function CA(n){console.error(n)}function bA(n){Jp(n)}function Qp(n,o){try{var d=n.onUncaughtError;d(o.value,{componentStack:o.stack})}catch(f){setTimeout(function(){throw f})}}function AA(n,o,d){try{var f=n.onCaughtError;f(d.value,{componentStack:d.stack,errorBoundary:o.tag===1?o.stateNode:null})}catch(E){setTimeout(function(){throw E})}}function og(n,o,d){return d=Hs(d),d.tag=3,d.payload={element:null},d.callback=function(){Qp(n,o)},d}function IA(n){return n=Hs(n),n.tag=3,n}function OA(n,o,d,f){var E=d.type.getDerivedStateFromError;if(typeof E=="function"){var T=f.value;n.payload=function(){return E(T)},n.callback=function(){AA(o,d,f)}}var N=d.stateNode;N!==null&&typeof N.componentDidCatch=="function"&&(n.callback=function(){AA(o,d,f),typeof E!="function"&&(Js===null?Js=new Set([this]):Js.add(this));var M=f.stack;this.componentDidCatch(f.value,{componentStack:M!==null?M:""})})}function wF(n,o,d,f,E){if(d.flags|=32768,f!==null&&typeof f=="object"&&typeof f.then=="function"){if(o=d.alternate,o!==null&&hu(o,d,E,!0),d=Oa.current,d!==null){switch(d.tag){case 13:return bn===null?Gg():d.alternate===null&&Ai===0&&(Ai=3),d.flags&=-257,d.flags|=65536,d.lanes=E,f===xm?d.flags|=16384:(o=d.updateQueue,o===null?d.updateQueue=new Set([f]):o.add(f),Wg(n,f,E)),!1;case 22:return d.flags|=65536,f===xm?d.flags|=16384:(o=d.updateQueue,o===null?(o={transitions:null,markerInstances:null,retryQueue:new Set([f])},d.updateQueue=o):(d=o.retryQueue,d===null?o.retryQueue=new Set([f]):d.add(f)),Wg(n,f,E)),!1}throw Error(r(435,d.tag))}return Wg(n,f,E),Gg(),!1}if(kt)return o=Oa.current,o!==null?((o.flags&65536)===0&&(o.flags|=256),o.flags|=65536,o.lanes=E,f!==Um&&(n=Error(r(422),{cause:f}),tu(ba(n,d)))):(f!==Um&&(o=Error(r(423),{cause:f}),tu(ba(o,d))),n=n.current.alternate,n.flags|=65536,E&=-E,n.lanes|=E,f=ba(f,d),E=og(n.stateNode,f,E),vg(n,E),Ai!==4&&(Ai=2)),!1;var T=Error(r(520),{cause:f});if(T=ba(T,d),Ru===null?Ru=[T]:Ru.push(T),Ai!==4&&(Ai=2),o===null)return!0;f=ba(f,d),d=o;do{switch(d.tag){case 3:return d.flags|=65536,n=E&-E,d.lanes|=n,n=og(d.stateNode,f,n),vg(d,n),!1;case 1:if(o=d.type,T=d.stateNode,(d.flags&128)===0&&(typeof o.getDerivedStateFromError=="function"||T!==null&&typeof T.componentDidCatch=="function"&&(Js===null||!Js.has(T))))return d.flags|=65536,E&=-E,d.lanes|=E,E=IA(E),OA(E,n,d,f),vg(d,E),!1}d=d.return}while(d!==null);return!1}var wA=Error(r(461)),nr=!1;function gr(n,o,d,f){o.child=n===null?kb(o,null,d,f):Yo(o,n.child,d,f)}function NA(n,o,d,f,E){d=d.render;var T=o.ref;if("ref"in f){var N={};for(var M in f)M!=="ref"&&(N[M]=f[M])}else N=f;return ec(o),f=Wm(n,o,d,N,T,E),M=Km(),n!==null&&!nr?(zm(n,o,E),ns(n,o,E)):(kt&&M&&km(o),o.flags|=1,gr(n,o,f,E),o.child)}function DA(n,o,d,f,E){if(n===null){var T=d.type;return typeof T=="function"&&!Ng(T)&&T.defaultProps===void 0&&d.compare===null?(o.tag=15,o.type=T,PA(n,o,T,f,E)):(n=rf(d.type,null,f,o,o.mode,E),n.ref=o.ref,n.return=o,o.child=n)}if(T=n.child,!Eg(n,E)){var N=T.memoizedProps;if(d=d.compare,d=d!==null?d:Qd,d(N,f)&&n.ref===o.ref)return ns(n,o,E)}return o.flags|=1,n=qs(T,f),n.ref=o.ref,n.return=o,o.child=n}function PA(n,o,d,f,E){if(n!==null){var T=n.memoizedProps;if(Qd(T,f)&&n.ref===o.ref)if(nr=!1,o.pendingProps=f=T,Eg(n,E))(n.flags&131072)!==0&&(nr=!0);else return o.lanes=n.lanes,ns(n,o,E)}return cg(n,o,d,f,E)}function LA(n,o,d){var f=o.pendingProps,E=f.children,T=(o.stateNode._pendingVisibility&2)!==0,N=n!==null?n.memoizedState:null;if(uu(n,o),f.mode==="hidden"||T){if((o.flags&128)!==0){if(f=N!==null?N.baseLanes|d:d,n!==null){for(E=o.child=n.child,T=0;E!==null;)T=T|E.lanes|E.childLanes,E=E.sibling;o.childLanes=T&~f}else o.childLanes=0,o.child=null;return kA(n,o,f,d)}if((d&536870912)!==0)o.memoizedState={baseLanes:0,cachePool:null},n!==null&&Fp(o,N!==null?N.cachePool:null),N!==null?Mb(o,N):Vm(),Ub(o);else return o.lanes=o.childLanes=536870912,kA(n,o,N!==null?N.baseLanes|d:d,d)}else N!==null?(Fp(o,N.cachePool),Mb(o,N),Vs(),o.memoizedState=null):(n!==null&&Fp(o,null),Vm(),Vs());return gr(n,o,E,d),o.child}function kA(n,o,d,f){var E=Gm();return E=E===null?null:{parent:Qi._currentValue,pool:E},o.memoizedState={baseLanes:d,cachePool:E},n!==null&&Fp(o,null),Vm(),Ub(o),n!==null&&hu(n,o,f,!0),null}function uu(n,o){var d=o.ref;if(d===null)n!==null&&n.ref!==null&&(o.flags|=2097664);else{if(typeof d!="function"&&typeof d!="object")throw Error(r(284));(n===null||n.ref!==d)&&(o.flags|=2097664)}}function cg(n,o,d,f,E){return ec(o),d=Wm(n,o,d,f,void 0,E),f=Km(),n!==null&&!nr?(zm(n,o,E),ns(n,o,E)):(kt&&f&&km(o),o.flags|=1,gr(n,o,d,E),o.child)}function MA(n,o,d,f,E,T){return ec(o),o.updateQueue=null,d=Fb(o,f,d,E),jb(n),f=Km(),n!==null&&!nr?(zm(n,o,T),ns(n,o,T)):(kt&&f&&km(o),o.flags|=1,gr(n,o,d,T),o.child)}function UA(n,o,d,f,E){if(ec(o),o.stateNode===null){var T=el,N=d.contextType;typeof N=="object"&&N!==null&&(T=br(N)),T=new d(f,T),o.memoizedState=T.state!==null&&T.state!==void 0?T.state:null,T.updater=sg,o.stateNode=T,T._reactInternals=o,T=o.stateNode,T.props=f,T.state=o.memoizedState,T.refs={},Tg(o),N=d.contextType,T.context=typeof N=="object"&&N!==null?br(N):el,T.state=o.memoizedState,N=d.getDerivedStateFromProps,typeof N=="function"&&(ng(o,d,N,f),T.state=o.memoizedState),typeof d.getDerivedStateFromProps=="function"||typeof T.getSnapshotBeforeUpdate=="function"||typeof T.UNSAFE_componentWillMount!="function"&&typeof T.componentWillMount!="function"||(N=T.state,typeof T.componentWillMount=="function"&&T.componentWillMount(),typeof T.UNSAFE_componentWillMount=="function"&&T.UNSAFE_componentWillMount(),N!==T.state&&sg.enqueueReplaceState(T,T.state,null),_u(o,f,T,E),fu(),T.state=o.memoizedState),typeof T.componentDidMount=="function"&&(o.flags|=4194308),f=!0}else if(n===null){T=o.stateNode;var M=o.memoizedProps,V=Zo(d,M);T.props=V;var Y=T.context,ne=d.contextType;N=el,typeof ne=="object"&&ne!==null&&(N=br(ne));var Ee=d.getDerivedStateFromProps;ne=typeof Ee=="function"||typeof T.getSnapshotBeforeUpdate=="function",M=o.pendingProps!==M,ne||typeof T.UNSAFE_componentWillReceiveProps!="function"&&typeof T.componentWillReceiveProps!="function"||(M||Y!==N)&&vA(o,T,f,N),Gs=!1;var ee=o.memoizedState;T.state=ee,_u(o,f,T,E),fu(),Y=o.memoizedState,M||ee!==Y||Gs?(typeof Ee=="function"&&(ng(o,d,Ee,f),Y=o.memoizedState),(V=Gs||RA(o,d,V,f,ee,Y,N))?(ne||typeof T.UNSAFE_componentWillMount!="function"&&typeof T.componentWillMount!="function"||(typeof T.componentWillMount=="function"&&T.componentWillMount(),typeof T.UNSAFE_componentWillMount=="function"&&T.UNSAFE_componentWillMount()),typeof T.componentDidMount=="function"&&(o.flags|=4194308)):(typeof T.componentDidMount=="function"&&(o.flags|=4194308),o.memoizedProps=f,o.memoizedState=Y),T.props=f,T.state=Y,T.context=N,f=V):(typeof T.componentDidMount=="function"&&(o.flags|=4194308),f=!1)}else{T=o.stateNode,Rg(n,o),N=o.memoizedProps,ne=Zo(d,N),T.props=ne,Ee=o.pendingProps,ee=T.context,Y=d.contextType,V=el,typeof Y=="object"&&Y!==null&&(V=br(Y)),M=d.getDerivedStateFromProps,(Y=typeof M=="function"||typeof T.getSnapshotBeforeUpdate=="function")||typeof T.UNSAFE_componentWillReceiveProps!="function"&&typeof T.componentWillReceiveProps!="function"||(N!==Ee||ee!==V)&&vA(o,T,f,V),Gs=!1,ee=o.memoizedState,T.state=ee,_u(o,f,T,E),fu();var re=o.memoizedState;N!==Ee||ee!==re||Gs||n!==null&&n.dependencies!==null&&Zp(n.dependencies)?(typeof M=="function"&&(ng(o,d,M,f),re=o.memoizedState),(ne=Gs||RA(o,d,ne,f,ee,re,V)||n!==null&&n.dependencies!==null&&Zp(n.dependencies))?(Y||typeof T.UNSAFE_componentWillUpdate!="function"&&typeof T.componentWillUpdate!="function"||(typeof T.componentWillUpdate=="function"&&T.componentWillUpdate(f,re,V),typeof T.UNSAFE_componentWillUpdate=="function"&&T.UNSAFE_componentWillUpdate(f,re,V)),typeof T.componentDidUpdate=="function"&&(o.flags|=4),typeof T.getSnapshotBeforeUpdate=="function"&&(o.flags|=1024)):(typeof T.componentDidUpdate!="function"||N===n.memoizedProps&&ee===n.memoizedState||(o.flags|=4),typeof T.getSnapshotBeforeUpdate!="function"||N===n.memoizedProps&&ee===n.memoizedState||(o.flags|=1024),o.memoizedProps=f,o.memoizedState=re),T.props=f,T.state=re,T.context=V,f=ne):(typeof T.componentDidUpdate!="function"||N===n.memoizedProps&&ee===n.memoizedState||(o.flags|=4),typeof T.getSnapshotBeforeUpdate!="function"||N===n.memoizedProps&&ee===n.memoizedState||(o.flags|=1024),f=!1)}return T=f,uu(n,o),f=(o.flags&128)!==0,T||f?(T=o.stateNode,d=f&&typeof d.getDerivedStateFromError!="function"?null:T.render(),o.flags|=1,n!==null&&f?(o.child=Yo(o,n.child,null,E),o.child=Yo(o,null,d,E)):gr(n,o,d,E),o.memoizedState=T.state,n=o.child):n=ns(n,o,E),n}function xA(n,o,d,f){return eu(),o.flags|=256,gr(n,o,d,f),o.child}var lg={dehydrated:null,treeContext:null,retryLane:0};function dg(n){return{baseLanes:n,cachePool:Bb()}}function ug(n,o,d){return n=n!==null?n.childLanes&~d:0,o&&(n|=Pa),n}function VA(n,o,d){var f=o.pendingProps,E=!1,T=(o.flags&128)!==0,N;if((N=T)||(N=n!==null&&n.memoizedState===null?!1:(Ji.current&2)!==0),N&&(E=!0,o.flags&=-129),N=(o.flags&32)!==0,o.flags&=-33,n===null){if(kt){if(E?xs(o):Vs(),kt){var M=mr,V;if(V=M){e:{for(V=M,M=Cn;V.nodeType!==8;){if(!M){M=null;break e}if(V=on(V.nextSibling),V===null){M=null;break e}}M=V}M!==null?(o.memoizedState={dehydrated:M,treeContext:Wo!==null?{id:ts,overflow:is}:null,retryLane:536870912},V=Da(18,null,null,0),V.stateNode=M,V.return=o,o.child=V,Pr=o,mr=null,V=!0):V=!1}V||zo(o)}if(M=o.memoizedState,M!==null&&(M=M.dehydrated,M!==null))return M.data==="$!"?o.lanes=16:o.lanes=536870912,null;rs(o)}return M=f.children,f=f.fallback,E?(Vs(),E=o.mode,M=pg({mode:"hidden",children:M},E),f=ic(f,E,d,null),M.return=o,f.return=o,M.sibling=f,o.child=M,E=o.child,E.memoizedState=dg(d),E.childLanes=ug(n,N,d),o.memoizedState=lg,f):(xs(o),hg(o,M))}if(V=n.memoizedState,V!==null&&(M=V.dehydrated,M!==null)){if(T)o.flags&256?(xs(o),o.flags&=-257,o=fg(n,o,d)):o.memoizedState!==null?(Vs(),o.child=n.child,o.flags|=128,o=null):(Vs(),E=f.fallback,M=o.mode,f=pg({mode:"visible",children:f.children},M),E=ic(E,M,d,null),E.flags|=2,f.return=o,E.return=o,f.sibling=E,o.child=f,Yo(o,n.child,null,d),f=o.child,f.memoizedState=dg(d),f.childLanes=ug(n,N,d),o.memoizedState=lg,o=E);else if(xs(o),M.data==="$!"){if(N=M.nextSibling&&M.nextSibling.dataset,N)var Y=N.dgst;N=Y,f=Error(r(419)),f.stack="",f.digest=N,tu({value:f,source:null,stack:null}),o=fg(n,o,d)}else if(nr||hu(n,o,d,!1),N=(d&n.childLanes)!==0,nr||N){if(N=oi,N!==null){if(f=d&-d,(f&42)!==0)f=1;else switch(f){case 2:f=1;break;case 8:f=4;break;case 32:f=16;break;case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:f=64;break;case 268435456:f=134217728;break;default:f=0}if(f=(f&(N.suspendedLanes|d))!==0?0:f,f!==0&&f!==V.retryLane)throw V.retryLane=f,Us(n,f),Lr(N,n,f),wA}M.data==="$?"||Gg(),o=fg(n,o,d)}else M.data==="$?"?(o.flags|=128,o.child=n.child,o=WF.bind(null,n),M._reactRetry=o,o=null):(n=V.treeContext,mr=on(M.nextSibling),Pr=o,kt=!0,nn=null,Cn=!1,n!==null&&(Aa[Ia++]=ts,Aa[Ia++]=is,Aa[Ia++]=Wo,ts=n.id,is=n.overflow,Wo=o),o=hg(o,f.children),o.flags|=4096);return o}return E?(Vs(),E=f.fallback,M=o.mode,V=n.child,Y=V.sibling,f=qs(V,{mode:"hidden",children:f.children}),f.subtreeFlags=V.subtreeFlags&31457280,Y!==null?E=qs(Y,E):(E=ic(E,M,d,null),E.flags|=2),E.return=o,f.return=o,f.sibling=E,o.child=f,f=E,E=o.child,M=n.child.memoizedState,M===null?M=dg(d):(V=M.cachePool,V!==null?(Y=Qi._currentValue,V=V.parent!==Y?{parent:Y,pool:Y}:V):V=Bb(),M={baseLanes:M.baseLanes|d,cachePool:V}),E.memoizedState=M,E.childLanes=ug(n,N,d),o.memoizedState=lg,f):(xs(o),d=n.child,n=d.sibling,d=qs(d,{mode:"visible",children:f.children}),d.return=o,d.sibling=null,n!==null&&(N=o.deletions,N===null?(o.deletions=[n],o.flags|=16):N.push(n)),o.child=d,o.memoizedState=null,d)}function hg(n,o){return o=pg({mode:"visible",children:o},n.mode),o.return=n,n.child=o}function pg(n,o){return dI(n,o,0,null)}function fg(n,o,d){return Yo(o,n.child,null,d),n=hg(o,o.pendingProps.children),n.flags|=2,o.memoizedState=null,n}function BA(n,o,d){n.lanes|=o;var f=n.alternate;f!==null&&(f.lanes|=o),gg(n.return,o,d)}function _g(n,o,d,f,E){var T=n.memoizedState;T===null?n.memoizedState={isBackwards:o,rendering:null,renderingStartTime:0,last:f,tail:d,tailMode:E}:(T.isBackwards=o,T.rendering=null,T.renderingStartTime=0,T.last=f,T.tail=d,T.tailMode=E)}function jA(n,o,d){var f=o.pendingProps,E=f.revealOrder,T=f.tail;if(gr(n,o,f.children,d),f=Ji.current,(f&2)!==0)f=f&1|2,o.flags|=128;else{if(n!==null&&(n.flags&128)!==0)e:for(n=o.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&BA(n,d,o);else if(n.tag===19)BA(n,d,o);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===o)break e;for(;n.sibling===null;){if(n.return===null||n.return===o)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}f&=1}switch(Yt(Ji,f),E){case"forwards":for(d=o.child,E=null;d!==null;)n=d.alternate,n!==null&&jp(n)===null&&(E=d),d=d.sibling;d=E,d===null?(E=o.child,o.child=null):(E=d.sibling,d.sibling=null),_g(o,!1,E,d,T);break;case"backwards":for(d=null,E=o.child,o.child=null;E!==null;){if(n=E.alternate,n!==null&&jp(n)===null){o.child=E;break}n=E.sibling,E.sibling=d,d=E,E=n}_g(o,!0,d,null,T);break;case"together":_g(o,!1,null,null,void 0);break;default:o.memoizedState=null}return o.child}function ns(n,o,d){if(n!==null&&(o.dependencies=n.dependencies),Xs|=o.lanes,(d&o.childLanes)===0)if(n!==null){if(hu(n,o,d,!1),(d&o.childLanes)===0)return null}else return null;if(n!==null&&o.child!==n.child)throw Error(r(153));if(o.child!==null){for(n=o.child,d=qs(n,n.pendingProps),o.child=d,d.return=o;n.sibling!==null;)n=n.sibling,d=d.sibling=qs(n,n.pendingProps),d.return=o;d.sibling=null}return o.child}function Eg(n,o){return(n.lanes&o)!==0?!0:(n=n.dependencies,!!(n!==null&&Zp(n)))}function NF(n,o,d){switch(o.tag){case 3:vt(o,o.stateNode.containerInfo),Fs(o,Qi,n.memoizedState.cache),eu();break;case 27:case 5:dt(o);break;case 4:vt(o,o.stateNode.containerInfo);break;case 10:Fs(o,o.type,o.memoizedProps.value);break;case 13:var f=o.memoizedState;if(f!==null)return f.dehydrated!==null?(xs(o),o.flags|=128,null):(d&o.child.childLanes)!==0?VA(n,o,d):(xs(o),n=ns(n,o,d),n!==null?n.sibling:null);xs(o);break;case 19:var E=(n.flags&128)!==0;if(f=(d&o.childLanes)!==0,f||(hu(n,o,d,!1),f=(d&o.childLanes)!==0),E){if(f)return jA(n,o,d);o.flags|=128}if(E=o.memoizedState,E!==null&&(E.rendering=null,E.tail=null,E.lastEffect=null),Yt(Ji,Ji.current),f)break;return null;case 22:case 23:return o.lanes=0,LA(n,o,d);case 24:Fs(o,Qi,n.memoizedState.cache)}return ns(n,o,d)}function FA(n,o,d){if(n!==null)if(n.memoizedProps!==o.pendingProps)nr=!0;else{if(!Eg(n,d)&&(o.flags&128)===0)return nr=!1,NF(n,o,d);nr=(n.flags&131072)!==0}else nr=!1,kt&&(o.flags&1048576)!==0&&bb(o,Mp,o.index);switch(o.lanes=0,o.tag){case 16:e:{n=o.pendingProps;var f=o.elementType,E=f._init;if(f=E(f._payload),o.type=f,typeof f=="function")Ng(f)?(n=Zo(f,n),o.tag=1,o=UA(null,o,f,n,d)):(o.tag=0,o=cg(null,o,f,n,d));else{if(f!=null){if(E=f.$$typeof,E===C){o.tag=11,o=NA(null,o,f,n,d);break e}else if(E===I){o.tag=14,o=DA(null,o,f,n,d);break e}}throw o=J(f)||f,Error(r(306,o,""))}}return o;case 0:return cg(n,o,o.type,o.pendingProps,d);case 1:return f=o.type,E=Zo(f,o.pendingProps),UA(n,o,f,E,d);case 3:e:{if(vt(o,o.stateNode.containerInfo),n===null)throw Error(r(387));var T=o.pendingProps;E=o.memoizedState,f=E.element,Rg(n,o),_u(o,T,null,d);var N=o.memoizedState;if(T=N.cache,Fs(o,Qi,T),T!==E.cache&&Sg(o,[Qi],d,!0),fu(),T=N.element,E.isDehydrated)if(E={element:T,isDehydrated:!1,cache:N.cache},o.updateQueue.baseState=E,o.memoizedState=E,o.flags&256){o=xA(n,o,T,d);break e}else if(T!==f){f=ba(Error(r(424)),o),tu(f),o=xA(n,o,T,d);break e}else for(mr=on(o.stateNode.containerInfo.firstChild),Pr=o,kt=!0,nn=null,Cn=!0,d=kb(o,null,T,d),o.child=d;d;)d.flags=d.flags&-3|4096,d=d.sibling;else{if(eu(),T===f){o=ns(n,o,d);break e}gr(n,o,T,d)}o=o.child}return o;case 26:return uu(n,o),n===null?(d=WI(o.type,null,o.pendingProps,null))?o.memoizedState=d:kt||(d=o.type,n=o.pendingProps,f=_f(Er.current).createElement(d),f[Cr]=o,f[Gr]=n,Sr(f,d,n),ar(f),o.stateNode=f):o.memoizedState=WI(o.type,n.memoizedProps,o.pendingProps,n.memoizedState),null;case 27:return dt(o),n===null&&kt&&(f=o.stateNode=FI(o.type,o.pendingProps,Er.current),Pr=o,Cn=!0,mr=on(f.firstChild)),f=o.pendingProps.children,n!==null||kt?gr(n,o,f,d):o.child=Yo(o,null,f,d),uu(n,o),o.child;case 5:return n===null&&kt&&((E=f=mr)&&(f=s3(f,o.type,o.pendingProps,Cn),f!==null?(o.stateNode=f,Pr=o,mr=on(f.firstChild),Cn=!1,E=!0):E=!1),E||zo(o)),dt(o),E=o.type,T=o.pendingProps,N=n!==null?n.memoizedProps:null,f=T.children,iS(E,T)?f=null:N!==null&&iS(E,N)&&(o.flags|=32),o.memoizedState!==null&&(E=Wm(n,o,yF,null,null,d),Nu._currentValue=E),uu(n,o),gr(n,o,f,d),o.child;case 6:return n===null&&kt&&((n=d=mr)&&(d=o3(d,o.pendingProps,Cn),d!==null?(o.stateNode=d,Pr=o,mr=null,n=!0):n=!1),n||zo(o)),null;case 13:return VA(n,o,d);case 4:return vt(o,o.stateNode.containerInfo),f=o.pendingProps,n===null?o.child=Yo(o,null,f,d):gr(n,o,f,d),o.child;case 11:return NA(n,o,o.type,o.pendingProps,d);case 7:return gr(n,o,o.pendingProps,d),o.child;case 8:return gr(n,o,o.pendingProps.children,d),o.child;case 12:return gr(n,o,o.pendingProps.children,d),o.child;case 10:return f=o.pendingProps,Fs(o,o.type,f.value),gr(n,o,f.children,d),o.child;case 9:return E=o.type._context,f=o.pendingProps.children,ec(o),E=br(E),f=f(E),o.flags|=1,gr(n,o,f,d),o.child;case 14:return DA(n,o,o.type,o.pendingProps,d);case 15:return PA(n,o,o.type,o.pendingProps,d);case 19:return jA(n,o,d);case 22:return LA(n,o,d);case 24:return ec(o),f=br(Qi),n===null?(E=Gm(),E===null&&(E=oi,T=jm(),E.pooledCache=T,T.refCount++,T!==null&&(E.pooledCacheLanes|=d),E=T),o.memoizedState={parent:f,cache:E},Tg(o),Fs(o,Qi,E)):((n.lanes&d)!==0&&(Rg(n,o),_u(o,null,null,d),fu()),E=n.memoizedState,T=o.memoizedState,E.parent!==f?(E={parent:f,cache:f},o.memoizedState=E,o.lanes===0&&(o.memoizedState=o.updateQueue.baseState=E),Fs(o,Qi,f)):(f=T.cache,Fs(o,Qi,f),f!==E.cache&&Sg(o,[Qi],d,!0))),gr(n,o,o.pendingProps.children,d),o.child;case 29:throw o.pendingProps}throw Error(r(156,o.tag))}var mg=Xe(null),$o=null,ss=null;function Fs(n,o,d){Yt(mg,o._currentValue),o._currentValue=d}function os(n){n._currentValue=mg.current,Ft(mg)}function gg(n,o,d){for(;n!==null;){var f=n.alternate;if((n.childLanes&o)!==o?(n.childLanes|=o,f!==null&&(f.childLanes|=o)):f!==null&&(f.childLanes&o)!==o&&(f.childLanes|=o),n===d)break;n=n.return}}function Sg(n,o,d,f){var E=n.child;for(E!==null&&(E.return=n);E!==null;){var T=E.dependencies;if(T!==null){var N=E.child;T=T.firstContext;e:for(;T!==null;){var M=T;T=E;for(var V=0;V<o.length;V++)if(M.context===o[V]){T.lanes|=d,M=T.alternate,M!==null&&(M.lanes|=d),gg(T.return,d,n),f||(N=null);break e}T=M.next}}else if(E.tag===18){if(N=E.return,N===null)throw Error(r(341));N.lanes|=d,T=N.alternate,T!==null&&(T.lanes|=d),gg(N,d,n),N=null}else N=E.child;if(N!==null)N.return=E;else for(N=E;N!==null;){if(N===n){N=null;break}if(E=N.sibling,E!==null){E.return=N.return,N=E;break}N=N.return}E=N}}function hu(n,o,d,f){n=null;for(var E=o,T=!1;E!==null;){if(!T){if((E.flags&524288)!==0)T=!0;else if((E.flags&262144)!==0)break}if(E.tag===10){var N=E.alternate;if(N===null)throw Error(r(387));if(N=N.memoizedProps,N!==null){var M=E.type;na(E.pendingProps.value,N.value)||(n!==null?n.push(M):n=[M])}}else if(E===rn.current){if(N=E.alternate,N===null)throw Error(r(387));N.memoizedState.memoizedState!==E.memoizedState.memoizedState&&(n!==null?n.push(Nu):n=[Nu])}E=E.return}n!==null&&Sg(o,n,d,f),o.flags|=262144}function Zp(n){for(n=n.firstContext;n!==null;){if(!na(n.context._currentValue,n.memoizedValue))return!0;n=n.next}return!1}function ec(n){$o=n,ss=null,n=n.dependencies,n!==null&&(n.firstContext=null)}function br(n){return GA($o,n)}function $p(n,o){return $o===null&&ec(n),GA(n,o)}function GA(n,o){var d=o._currentValue;if(o={context:o,memoizedValue:d,next:null},ss===null){if(n===null)throw Error(r(308));ss=o,n.dependencies={lanes:0,firstContext:o},n.flags|=524288}else ss=ss.next=o;return d}var Gs=!1;function Tg(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Rg(n,o){n=n.updateQueue,o.updateQueue===n&&(o.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,callbacks:null})}function Hs(n){return{lane:n,tag:0,payload:null,callback:null,next:null}}function Ws(n,o,d){var f=n.updateQueue;if(f===null)return null;if(f=f.shared,(mi&2)!==0){var E=f.pending;return E===null?o.next=o:(o.next=E.next,E.next=o),f.pending=o,o=Lp(n),yb(n,null,d),o}return Pp(n,f,o,d),Lp(n)}function pu(n,o,d){if(o=o.updateQueue,o!==null&&(o=o.shared,(d&4194176)!==0)){var f=o.lanes;f&=n.pendingLanes,d|=f,o.lanes=d,DC(n,d)}}function vg(n,o){var d=n.updateQueue,f=n.alternate;if(f!==null&&(f=f.updateQueue,d===f)){var E=null,T=null;if(d=d.firstBaseUpdate,d!==null){do{var N={lane:d.lane,tag:d.tag,payload:d.payload,callback:null,next:null};T===null?E=T=N:T=T.next=N,d=d.next}while(d!==null);T===null?E=T=o:T=T.next=o}else E=T=o;d={baseState:f.baseState,firstBaseUpdate:E,lastBaseUpdate:T,shared:f.shared,callbacks:f.callbacks},n.updateQueue=d;return}n=d.lastBaseUpdate,n===null?d.firstBaseUpdate=o:n.next=o,d.lastBaseUpdate=o}var yg=!1;function fu(){if(yg){var n=sl;if(n!==null)throw n}}function _u(n,o,d,f){yg=!1;var E=n.updateQueue;Gs=!1;var T=E.firstBaseUpdate,N=E.lastBaseUpdate,M=E.shared.pending;if(M!==null){E.shared.pending=null;var V=M,Y=V.next;V.next=null,N===null?T=Y:N.next=Y,N=V;var ne=n.alternate;ne!==null&&(ne=ne.updateQueue,M=ne.lastBaseUpdate,M!==N&&(M===null?ne.firstBaseUpdate=Y:M.next=Y,ne.lastBaseUpdate=V))}if(T!==null){var Ee=E.baseState;N=0,ne=Y=V=null,M=T;do{var ee=M.lane&-536870913,re=ee!==M.lane;if(re?(Ot&ee)===ee:(f&ee)===ee){ee!==0&&ee===nl&&(yg=!0),ne!==null&&(ne=ne.next={lane:0,tag:M.tag,payload:M.payload,callback:null,next:null});e:{var we=n,$e=M;ee=o;var Ii=d;switch($e.tag){case 1:if(we=$e.payload,typeof we=="function"){Ee=we.call(Ii,Ee,ee);break e}Ee=we;break e;case 3:we.flags=we.flags&-65537|128;case 0:if(we=$e.payload,ee=typeof we=="function"?we.call(Ii,Ee,ee):we,ee==null)break e;Ee=ie({},Ee,ee);break e;case 2:Gs=!0}}ee=M.callback,ee!==null&&(n.flags|=64,re&&(n.flags|=8192),re=E.callbacks,re===null?E.callbacks=[ee]:re.push(ee))}else re={lane:ee,tag:M.tag,payload:M.payload,callback:M.callback,next:null},ne===null?(Y=ne=re,V=Ee):ne=ne.next=re,N|=ee;if(M=M.next,M===null){if(M=E.shared.pending,M===null)break;re=M,M=re.next,re.next=null,E.lastBaseUpdate=re,E.shared.pending=null}}while(!0);ne===null&&(V=Ee),E.baseState=V,E.firstBaseUpdate=Y,E.lastBaseUpdate=ne,T===null&&(E.shared.lanes=0),Xs|=N,n.lanes=N,n.memoizedState=Ee}}function HA(n,o){if(typeof n!="function")throw Error(r(191,n));n.call(o)}function WA(n,o){var d=n.callbacks;if(d!==null)for(n.callbacks=null,n=0;n<d.length;n++)HA(d[n],o)}function Eu(n,o){try{var d=o.updateQueue,f=d!==null?d.lastEffect:null;if(f!==null){var E=f.next;d=E;do{if((d.tag&n)===n){f=void 0;var T=d.create,N=d.inst;f=T(),N.destroy=f}d=d.next}while(d!==E)}}catch(M){ri(o,o.return,M)}}function Ks(n,o,d){try{var f=o.updateQueue,E=f!==null?f.lastEffect:null;if(E!==null){var T=E.next;f=T;do{if((f.tag&n)===n){var N=f.inst,M=N.destroy;if(M!==void 0){N.destroy=void 0,E=o;var V=d;try{M()}catch(Y){ri(E,V,Y)}}}f=f.next}while(f!==T)}}catch(Y){ri(o,o.return,Y)}}function KA(n){var o=n.updateQueue;if(o!==null){var d=n.stateNode;try{WA(o,d)}catch(f){ri(n,n.return,f)}}}function zA(n,o,d){d.props=Zo(n.type,n.memoizedProps),d.state=n.memoizedState;try{d.componentWillUnmount()}catch(f){ri(n,o,f)}}function tc(n,o){try{var d=n.ref;if(d!==null){var f=n.stateNode;switch(n.tag){case 26:case 27:case 5:var E=f;break;default:E=f}typeof d=="function"?n.refCleanup=d(E):d.current=E}}catch(T){ri(n,o,T)}}function sa(n,o){var d=n.ref,f=n.refCleanup;if(d!==null)if(typeof f=="function")try{f()}catch(E){ri(n,o,E)}finally{n.refCleanup=null,n=n.alternate,n!=null&&(n.refCleanup=null)}else if(typeof d=="function")try{d(null)}catch(E){ri(n,o,E)}else d.current=null}function YA(n){var o=n.type,d=n.memoizedProps,f=n.stateNode;try{e:switch(o){case"button":case"input":case"select":case"textarea":d.autoFocus&&f.focus();break e;case"img":d.src?f.src=d.src:d.srcSet&&(f.srcset=d.srcSet)}}catch(E){ri(n,n.return,E)}}function qA(n,o,d){try{var f=n.stateNode;t3(f,n.type,d,o),f[Gr]=o}catch(E){ri(n,n.return,E)}}function XA(n){return n.tag===5||n.tag===3||n.tag===26||n.tag===27||n.tag===4}function Cg(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||XA(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==27&&n.tag!==18;){if(n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function bg(n,o,d){var f=n.tag;if(f===5||f===6)n=n.stateNode,o?d.nodeType===8?d.parentNode.insertBefore(n,o):d.insertBefore(n,o):(d.nodeType===8?(o=d.parentNode,o.insertBefore(n,d)):(o=d,o.appendChild(n)),d=d._reactRootContainer,d!=null||o.onclick!==null||(o.onclick=ff));else if(f!==4&&f!==27&&(n=n.child,n!==null))for(bg(n,o,d),n=n.sibling;n!==null;)bg(n,o,d),n=n.sibling}function ef(n,o,d){var f=n.tag;if(f===5||f===6)n=n.stateNode,o?d.insertBefore(n,o):d.appendChild(n);else if(f!==4&&f!==27&&(n=n.child,n!==null))for(ef(n,o,d),n=n.sibling;n!==null;)ef(n,o,d),n=n.sibling}var cs=!1,bi=!1,Ag=!1,JA=typeof WeakSet=="function"?WeakSet:Set,sr=null,QA=!1;function DF(n,o){if(n=n.containerInfo,eS=Rf,n=fb(n),Om(n)){if("selectionStart"in n)var d={start:n.selectionStart,end:n.selectionEnd};else e:{d=(d=n.ownerDocument)&&d.defaultView||window;var f=d.getSelection&&d.getSelection();if(f&&f.rangeCount!==0){d=f.anchorNode;var E=f.anchorOffset,T=f.focusNode;f=f.focusOffset;try{d.nodeType,T.nodeType}catch{d=null;break e}var N=0,M=-1,V=-1,Y=0,ne=0,Ee=n,ee=null;t:for(;;){for(var re;Ee!==d||E!==0&&Ee.nodeType!==3||(M=N+E),Ee!==T||f!==0&&Ee.nodeType!==3||(V=N+f),Ee.nodeType===3&&(N+=Ee.nodeValue.length),(re=Ee.firstChild)!==null;)ee=Ee,Ee=re;for(;;){if(Ee===n)break t;if(ee===d&&++Y===E&&(M=N),ee===T&&++ne===f&&(V=N),(re=Ee.nextSibling)!==null)break;Ee=ee,ee=Ee.parentNode}Ee=re}d=M===-1||V===-1?null:{start:M,end:V}}else d=null}d=d||{start:0,end:0}}else d=null;for(tS={focusedElem:n,selectionRange:d},Rf=!1,sr=o;sr!==null;)if(o=sr,n=o.child,(o.subtreeFlags&1028)!==0&&n!==null)n.return=o,sr=n;else for(;sr!==null;){switch(o=sr,T=o.alternate,n=o.flags,o.tag){case 0:break;case 11:case 15:break;case 1:if((n&1024)!==0&&T!==null){n=void 0,d=o,E=T.memoizedProps,T=T.memoizedState,f=d.stateNode;try{var we=Zo(d.type,E,d.elementType===d.type);n=f.getSnapshotBeforeUpdate(we,T),f.__reactInternalSnapshotBeforeUpdate=n}catch($e){ri(d,d.return,$e)}}break;case 3:if((n&1024)!==0){if(n=o.stateNode.containerInfo,d=n.nodeType,d===9)nS(n);else if(d===1)switch(n.nodeName){case"HEAD":case"HTML":case"BODY":nS(n);break;default:n.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((n&1024)!==0)throw Error(r(163))}if(n=o.sibling,n!==null){n.return=o.return,sr=n;break}sr=o.return}return we=QA,QA=!1,we}function ZA(n,o,d){var f=d.flags;switch(d.tag){case 0:case 11:case 15:ds(n,d),f&4&&Eu(5,d);break;case 1:if(ds(n,d),f&4)if(n=d.stateNode,o===null)try{n.componentDidMount()}catch(M){ri(d,d.return,M)}else{var E=Zo(d.type,o.memoizedProps);o=o.memoizedState;try{n.componentDidUpdate(E,o,n.__reactInternalSnapshotBeforeUpdate)}catch(M){ri(d,d.return,M)}}f&64&&KA(d),f&512&&tc(d,d.return);break;case 3:if(ds(n,d),f&64&&(f=d.updateQueue,f!==null)){if(n=null,d.child!==null)switch(d.child.tag){case 27:case 5:n=d.child.stateNode;break;case 1:n=d.child.stateNode}try{WA(f,n)}catch(M){ri(d,d.return,M)}}break;case 26:ds(n,d),f&512&&tc(d,d.return);break;case 27:case 5:ds(n,d),o===null&&f&4&&YA(d),f&512&&tc(d,d.return);break;case 12:ds(n,d);break;case 13:ds(n,d),f&4&&tI(n,d);break;case 22:if(E=d.memoizedState!==null||cs,!E){o=o!==null&&o.memoizedState!==null||bi;var T=cs,N=bi;cs=E,(bi=o)&&!N?zs(n,d,(d.subtreeFlags&8772)!==0):ds(n,d),cs=T,bi=N}f&512&&(d.memoizedProps.mode==="manual"?tc(d,d.return):sa(d,d.return));break;default:ds(n,d)}}function $A(n){var o=n.alternate;o!==null&&(n.alternate=null,$A(o)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(o=n.stateNode,o!==null&&hm(o)),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}var zi=null,oa=!1;function ls(n,o,d){for(d=d.child;d!==null;)eI(n,o,d),d=d.sibling}function eI(n,o,d){if(ra&&typeof ra.onCommitFiberUnmount=="function")try{ra.onCommitFiberUnmount(Bd,d)}catch{}switch(d.tag){case 26:bi||sa(d,o),ls(n,o,d),d.memoizedState?d.memoizedState.count--:d.stateNode&&(d=d.stateNode,d.parentNode.removeChild(d));break;case 27:bi||sa(d,o);var f=zi,E=oa;for(zi=d.stateNode,ls(n,o,d),d=d.stateNode,o=d.attributes;o.length;)d.removeAttributeNode(o[0]);hm(d),zi=f,oa=E;break;case 5:bi||sa(d,o);case 6:E=zi;var T=oa;if(zi=null,ls(n,o,d),zi=E,oa=T,zi!==null)if(oa)try{n=zi,f=d.stateNode,n.nodeType===8?n.parentNode.removeChild(f):n.removeChild(f)}catch(N){ri(d,o,N)}else try{zi.removeChild(d.stateNode)}catch(N){ri(d,o,N)}break;case 18:zi!==null&&(oa?(o=zi,d=d.stateNode,o.nodeType===8?aS(o.parentNode,d):o.nodeType===1&&aS(o,d),ku(o)):aS(zi,d.stateNode));break;case 4:f=zi,E=oa,zi=d.stateNode.containerInfo,oa=!0,ls(n,o,d),zi=f,oa=E;break;case 0:case 11:case 14:case 15:bi||Ks(2,d,o),bi||Ks(4,d,o),ls(n,o,d);break;case 1:bi||(sa(d,o),f=d.stateNode,typeof f.componentWillUnmount=="function"&&zA(d,o,f)),ls(n,o,d);break;case 21:ls(n,o,d);break;case 22:bi||sa(d,o),bi=(f=bi)||d.memoizedState!==null,ls(n,o,d),bi=f;break;default:ls(n,o,d)}}function tI(n,o){if(o.memoizedState===null&&(n=o.alternate,n!==null&&(n=n.memoizedState,n!==null&&(n=n.dehydrated,n!==null))))try{ku(n)}catch(d){ri(o,o.return,d)}}function PF(n){switch(n.tag){case 13:case 19:var o=n.stateNode;return o===null&&(o=n.stateNode=new JA),o;case 22:return n=n.stateNode,o=n._retryCache,o===null&&(o=n._retryCache=new JA),o;default:throw Error(r(435,n.tag))}}function Ig(n,o){var d=PF(n);o.forEach(function(f){var E=KF.bind(null,n,f);d.has(f)||(d.add(f),f.then(E,E))})}function wa(n,o){var d=o.deletions;if(d!==null)for(var f=0;f<d.length;f++){var E=d[f],T=n,N=o,M=N;e:for(;M!==null;){switch(M.tag){case 27:case 5:zi=M.stateNode,oa=!1;break e;case 3:zi=M.stateNode.containerInfo,oa=!0;break e;case 4:zi=M.stateNode.containerInfo,oa=!0;break e}M=M.return}if(zi===null)throw Error(r(160));eI(T,N,E),zi=null,oa=!1,T=E.alternate,T!==null&&(T.return=null),E.return=null}if(o.subtreeFlags&13878)for(o=o.child;o!==null;)iI(o,n),o=o.sibling}var sn=null;function iI(n,o){var d=n.alternate,f=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:wa(o,n),Na(n),f&4&&(Ks(3,n,n.return),Eu(3,n),Ks(5,n,n.return));break;case 1:wa(o,n),Na(n),f&512&&(bi||d===null||sa(d,d.return)),f&64&&cs&&(n=n.updateQueue,n!==null&&(f=n.callbacks,f!==null&&(d=n.shared.hiddenCallbacks,n.shared.hiddenCallbacks=d===null?f:d.concat(f))));break;case 26:var E=sn;if(wa(o,n),Na(n),f&512&&(bi||d===null||sa(d,d.return)),f&4){var T=d!==null?d.memoizedState:null;if(f=n.memoizedState,d===null)if(f===null)if(n.stateNode===null){e:{f=n.type,d=n.memoizedProps,E=E.ownerDocument||E;t:switch(f){case"title":T=E.getElementsByTagName("title")[0],(!T||T[Gd]||T[Cr]||T.namespaceURI==="http://www.w3.org/2000/svg"||T.hasAttribute("itemprop"))&&(T=E.createElement(f),E.head.insertBefore(T,E.querySelector("head > title"))),Sr(T,f,d),T[Cr]=n,ar(T),f=T;break e;case"link":var N=YI("link","href",E).get(f+(d.href||""));if(N){for(var M=0;M<N.length;M++)if(T=N[M],T.getAttribute("href")===(d.href==null?null:d.href)&&T.getAttribute("rel")===(d.rel==null?null:d.rel)&&T.getAttribute("title")===(d.title==null?null:d.title)&&T.getAttribute("crossorigin")===(d.crossOrigin==null?null:d.crossOrigin)){N.splice(M,1);break t}}T=E.createElement(f),Sr(T,f,d),E.head.appendChild(T);break;case"meta":if(N=YI("meta","content",E).get(f+(d.content||""))){for(M=0;M<N.length;M++)if(T=N[M],T.getAttribute("content")===(d.content==null?null:""+d.content)&&T.getAttribute("name")===(d.name==null?null:d.name)&&T.getAttribute("property")===(d.property==null?null:d.property)&&T.getAttribute("http-equiv")===(d.httpEquiv==null?null:d.httpEquiv)&&T.getAttribute("charset")===(d.charSet==null?null:d.charSet)){N.splice(M,1);break t}}T=E.createElement(f),Sr(T,f,d),E.head.appendChild(T);break;default:throw Error(r(468,f))}T[Cr]=n,ar(T),f=T}n.stateNode=f}else qI(E,n.type,n.stateNode);else n.stateNode=zI(E,f,n.memoizedProps);else T!==f?(T===null?d.stateNode!==null&&(d=d.stateNode,d.parentNode.removeChild(d)):T.count--,f===null?qI(E,n.type,n.stateNode):zI(E,f,n.memoizedProps)):f===null&&n.stateNode!==null&&qA(n,n.memoizedProps,d.memoizedProps)}break;case 27:if(f&4&&n.alternate===null){E=n.stateNode,T=n.memoizedProps;try{for(var V=E.firstChild;V;){var Y=V.nextSibling,ne=V.nodeName;V[Gd]||ne==="HEAD"||ne==="BODY"||ne==="SCRIPT"||ne==="STYLE"||ne==="LINK"&&V.rel.toLowerCase()==="stylesheet"||E.removeChild(V),V=Y}for(var Ee=n.type,ee=E.attributes;ee.length;)E.removeAttributeNode(ee[0]);Sr(E,Ee,T),E[Cr]=n,E[Gr]=T}catch(we){ri(n,n.return,we)}}case 5:if(wa(o,n),Na(n),f&512&&(bi||d===null||sa(d,d.return)),n.flags&32){E=n.stateNode;try{Yc(E,"")}catch(we){ri(n,n.return,we)}}f&4&&n.stateNode!=null&&(E=n.memoizedProps,qA(n,E,d!==null?d.memoizedProps:E)),f&1024&&(Ag=!0);break;case 6:if(wa(o,n),Na(n),f&4){if(n.stateNode===null)throw Error(r(162));f=n.memoizedProps,d=n.stateNode;try{d.nodeValue=f}catch(we){ri(n,n.return,we)}}break;case 3:if(gf=null,E=sn,sn=Ef(o.containerInfo),wa(o,n),sn=E,Na(n),f&4&&d!==null&&d.memoizedState.isDehydrated)try{ku(o.containerInfo)}catch(we){ri(n,n.return,we)}Ag&&(Ag=!1,rI(n));break;case 4:f=sn,sn=Ef(n.stateNode.containerInfo),wa(o,n),Na(n),sn=f;break;case 12:wa(o,n),Na(n);break;case 13:wa(o,n),Na(n),n.child.flags&8192&&n.memoizedState!==null!=(d!==null&&d.memoizedState!==null)&&(Ug=Ci()),f&4&&(f=n.updateQueue,f!==null&&(n.updateQueue=null,Ig(n,f)));break;case 22:if(f&512&&(bi||d===null||sa(d,d.return)),V=n.memoizedState!==null,Y=d!==null&&d.memoizedState!==null,ne=cs,Ee=bi,cs=ne||V,bi=Ee||Y,wa(o,n),bi=Ee,cs=ne,Na(n),o=n.stateNode,o._current=n,o._visibility&=-3,o._visibility|=o._pendingVisibility&2,f&8192&&(o._visibility=V?o._visibility&-2:o._visibility|1,V&&(o=cs||bi,d===null||Y||o||dl(n)),n.memoizedProps===null||n.memoizedProps.mode!=="manual"))e:for(d=null,o=n;;){if(o.tag===5||o.tag===26||o.tag===27){if(d===null){Y=d=o;try{if(E=Y.stateNode,V)T=E.style,typeof T.setProperty=="function"?T.setProperty("display","none","important"):T.display="none";else{N=Y.stateNode,M=Y.memoizedProps.style;var re=M!=null&&M.hasOwnProperty("display")?M.display:null;N.style.display=re==null||typeof re=="boolean"?"":(""+re).trim()}}catch(we){ri(Y,Y.return,we)}}}else if(o.tag===6){if(d===null){Y=o;try{Y.stateNode.nodeValue=V?"":Y.memoizedProps}catch(we){ri(Y,Y.return,we)}}}else if((o.tag!==22&&o.tag!==23||o.memoizedState===null||o===n)&&o.child!==null){o.child.return=o,o=o.child;continue}if(o===n)break e;for(;o.sibling===null;){if(o.return===null||o.return===n)break e;d===o&&(d=null),o=o.return}d===o&&(d=null),o.sibling.return=o.return,o=o.sibling}f&4&&(f=n.updateQueue,f!==null&&(d=f.retryQueue,d!==null&&(f.retryQueue=null,Ig(n,d))));break;case 19:wa(o,n),Na(n),f&4&&(f=n.updateQueue,f!==null&&(n.updateQueue=null,Ig(n,f)));break;case 21:break;default:wa(o,n),Na(n)}}function Na(n){var o=n.flags;if(o&2){try{if(n.tag!==27){e:{for(var d=n.return;d!==null;){if(XA(d)){var f=d;break e}d=d.return}throw Error(r(160))}switch(f.tag){case 27:var E=f.stateNode,T=Cg(n);ef(n,T,E);break;case 5:var N=f.stateNode;f.flags&32&&(Yc(N,""),f.flags&=-33);var M=Cg(n);ef(n,M,N);break;case 3:case 4:var V=f.stateNode.containerInfo,Y=Cg(n);bg(n,Y,V);break;default:throw Error(r(161))}}}catch(ne){ri(n,n.return,ne)}n.flags&=-3}o&4096&&(n.flags&=-4097)}function rI(n){if(n.subtreeFlags&1024)for(n=n.child;n!==null;){var o=n;rI(o),o.tag===5&&o.flags&1024&&o.stateNode.reset(),n=n.sibling}}function ds(n,o){if(o.subtreeFlags&8772)for(o=o.child;o!==null;)ZA(n,o.alternate,o),o=o.sibling}function dl(n){for(n=n.child;n!==null;){var o=n;switch(o.tag){case 0:case 11:case 14:case 15:Ks(4,o,o.return),dl(o);break;case 1:sa(o,o.return);var d=o.stateNode;typeof d.componentWillUnmount=="function"&&zA(o,o.return,d),dl(o);break;case 26:case 27:case 5:sa(o,o.return),dl(o);break;case 22:sa(o,o.return),o.memoizedState===null&&dl(o);break;default:dl(o)}n=n.sibling}}function zs(n,o,d){for(d=d&&(o.subtreeFlags&8772)!==0,o=o.child;o!==null;){var f=o.alternate,E=n,T=o,N=T.flags;switch(T.tag){case 0:case 11:case 15:zs(E,T,d),Eu(4,T);break;case 1:if(zs(E,T,d),f=T,E=f.stateNode,typeof E.componentDidMount=="function")try{E.componentDidMount()}catch(Y){ri(f,f.return,Y)}if(f=T,E=f.updateQueue,E!==null){var M=f.stateNode;try{var V=E.shared.hiddenCallbacks;if(V!==null)for(E.shared.hiddenCallbacks=null,E=0;E<V.length;E++)HA(V[E],M)}catch(Y){ri(f,f.return,Y)}}d&&N&64&&KA(T),tc(T,T.return);break;case 26:case 27:case 5:zs(E,T,d),d&&f===null&&N&4&&YA(T),tc(T,T.return);break;case 12:zs(E,T,d);break;case 13:zs(E,T,d),d&&N&4&&tI(E,T);break;case 22:T.memoizedState===null&&zs(E,T,d),tc(T,T.return);break;default:zs(E,T,d)}o=o.sibling}}function Og(n,o){var d=null;n!==null&&n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(d=n.memoizedState.cachePool.pool),n=null,o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(n=o.memoizedState.cachePool.pool),n!==d&&(n!=null&&n.refCount++,d!=null&&su(d))}function wg(n,o){n=null,o.alternate!==null&&(n=o.alternate.memoizedState.cache),o=o.memoizedState.cache,o!==n&&(o.refCount++,n!=null&&su(n))}function Ys(n,o,d,f){if(o.subtreeFlags&10256)for(o=o.child;o!==null;)aI(n,o,d,f),o=o.sibling}function aI(n,o,d,f){var E=o.flags;switch(o.tag){case 0:case 11:case 15:Ys(n,o,d,f),E&2048&&Eu(9,o);break;case 3:Ys(n,o,d,f),E&2048&&(n=null,o.alternate!==null&&(n=o.alternate.memoizedState.cache),o=o.memoizedState.cache,o!==n&&(o.refCount++,n!=null&&su(n)));break;case 12:if(E&2048){Ys(n,o,d,f),n=o.stateNode;try{var T=o.memoizedProps,N=T.id,M=T.onPostCommit;typeof M=="function"&&M(N,o.alternate===null?"mount":"update",n.passiveEffectDuration,-0)}catch(V){ri(o,o.return,V)}}else Ys(n,o,d,f);break;case 23:break;case 22:T=o.stateNode,o.memoizedState!==null?T._visibility&4?Ys(n,o,d,f):mu(n,o):T._visibility&4?Ys(n,o,d,f):(T._visibility|=4,ul(n,o,d,f,(o.subtreeFlags&10256)!==0)),E&2048&&Og(o.alternate,o);break;case 24:Ys(n,o,d,f),E&2048&&wg(o.alternate,o);break;default:Ys(n,o,d,f)}}function ul(n,o,d,f,E){for(E=E&&(o.subtreeFlags&10256)!==0,o=o.child;o!==null;){var T=n,N=o,M=d,V=f,Y=N.flags;switch(N.tag){case 0:case 11:case 15:ul(T,N,M,V,E),Eu(8,N);break;case 23:break;case 22:var ne=N.stateNode;N.memoizedState!==null?ne._visibility&4?ul(T,N,M,V,E):mu(T,N):(ne._visibility|=4,ul(T,N,M,V,E)),E&&Y&2048&&Og(N.alternate,N);break;case 24:ul(T,N,M,V,E),E&&Y&2048&&wg(N.alternate,N);break;default:ul(T,N,M,V,E)}o=o.sibling}}function mu(n,o){if(o.subtreeFlags&10256)for(o=o.child;o!==null;){var d=n,f=o,E=f.flags;switch(f.tag){case 22:mu(d,f),E&2048&&Og(f.alternate,f);break;case 24:mu(d,f),E&2048&&wg(f.alternate,f);break;default:mu(d,f)}o=o.sibling}}var gu=8192;function hl(n){if(n.subtreeFlags&gu)for(n=n.child;n!==null;)nI(n),n=n.sibling}function nI(n){switch(n.tag){case 26:hl(n),n.flags&gu&&n.memoizedState!==null&&T3(sn,n.memoizedState,n.memoizedProps);break;case 5:hl(n);break;case 3:case 4:var o=sn;sn=Ef(n.stateNode.containerInfo),hl(n),sn=o;break;case 22:n.memoizedState===null&&(o=n.alternate,o!==null&&o.memoizedState!==null?(o=gu,gu=16777216,hl(n),gu=o):hl(n));break;default:hl(n)}}function sI(n){var o=n.alternate;if(o!==null&&(n=o.child,n!==null)){o.child=null;do o=n.sibling,n.sibling=null,n=o;while(n!==null)}}function Su(n){var o=n.deletions;if((n.flags&16)!==0){if(o!==null)for(var d=0;d<o.length;d++){var f=o[d];sr=f,cI(f,n)}sI(n)}if(n.subtreeFlags&10256)for(n=n.child;n!==null;)oI(n),n=n.sibling}function oI(n){switch(n.tag){case 0:case 11:case 15:Su(n),n.flags&2048&&Ks(9,n,n.return);break;case 3:Su(n);break;case 12:Su(n);break;case 22:var o=n.stateNode;n.memoizedState!==null&&o._visibility&4&&(n.return===null||n.return.tag!==13)?(o._visibility&=-5,tf(n)):Su(n);break;default:Su(n)}}function tf(n){var o=n.deletions;if((n.flags&16)!==0){if(o!==null)for(var d=0;d<o.length;d++){var f=o[d];sr=f,cI(f,n)}sI(n)}for(n=n.child;n!==null;){switch(o=n,o.tag){case 0:case 11:case 15:Ks(8,o,o.return),tf(o);break;case 22:d=o.stateNode,d._visibility&4&&(d._visibility&=-5,tf(o));break;default:tf(o)}n=n.sibling}}function cI(n,o){for(;sr!==null;){var d=sr;switch(d.tag){case 0:case 11:case 15:Ks(8,d,o);break;case 23:case 22:if(d.memoizedState!==null&&d.memoizedState.cachePool!==null){var f=d.memoizedState.cachePool.pool;f!=null&&f.refCount++}break;case 24:su(d.memoizedState.cache)}if(f=d.child,f!==null)f.return=d,sr=f;else e:for(d=n;sr!==null;){f=sr;var E=f.sibling,T=f.return;if($A(f),f===d){sr=null;break e}if(E!==null){E.return=T,sr=E;break e}sr=T}}}function LF(n,o,d,f){this.tag=n,this.key=d,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=o,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=f,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Da(n,o,d,f){return new LF(n,o,d,f)}function Ng(n){return n=n.prototype,!(!n||!n.isReactComponent)}function qs(n,o){var d=n.alternate;return d===null?(d=Da(n.tag,o,n.key,n.mode),d.elementType=n.elementType,d.type=n.type,d.stateNode=n.stateNode,d.alternate=n,n.alternate=d):(d.pendingProps=o,d.type=n.type,d.flags=0,d.subtreeFlags=0,d.deletions=null),d.flags=n.flags&31457280,d.childLanes=n.childLanes,d.lanes=n.lanes,d.child=n.child,d.memoizedProps=n.memoizedProps,d.memoizedState=n.memoizedState,d.updateQueue=n.updateQueue,o=n.dependencies,d.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext},d.sibling=n.sibling,d.index=n.index,d.ref=n.ref,d.refCleanup=n.refCleanup,d}function lI(n,o){n.flags&=31457282;var d=n.alternate;return d===null?(n.childLanes=0,n.lanes=o,n.child=null,n.subtreeFlags=0,n.memoizedProps=null,n.memoizedState=null,n.updateQueue=null,n.dependencies=null,n.stateNode=null):(n.childLanes=d.childLanes,n.lanes=d.lanes,n.child=d.child,n.subtreeFlags=0,n.deletions=null,n.memoizedProps=d.memoizedProps,n.memoizedState=d.memoizedState,n.updateQueue=d.updateQueue,n.type=d.type,o=d.dependencies,n.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext}),n}function rf(n,o,d,f,E,T){var N=0;if(f=n,typeof n=="function")Ng(n)&&(N=1);else if(typeof n=="string")N=g3(n,d,Dr.current)?26:n==="html"||n==="head"||n==="body"?27:5;else e:switch(n){case u:return ic(d.children,E,T,o);case h:N=8,E|=24;break;case p:return n=Da(12,d,o,E|2),n.elementType=p,n.lanes=T,n;case v:return n=Da(13,d,o,E),n.elementType=v,n.lanes=T,n;case y:return n=Da(19,d,o,E),n.elementType=y,n.lanes=T,n;case P:return dI(d,E,T,o);default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case _:case S:N=10;break e;case m:N=9;break e;case C:N=11;break e;case I:N=14;break e;case O:N=16,f=null;break e}N=29,d=Error(r(130,n===null?"null":typeof n,"")),f=null}return o=Da(N,d,o,E),o.elementType=n,o.type=f,o.lanes=T,o}function ic(n,o,d,f){return n=Da(7,n,f,o),n.lanes=d,n}function dI(n,o,d,f){n=Da(22,n,f,o),n.elementType=P,n.lanes=d;var E={_visibility:1,_pendingVisibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null,_current:null,detach:function(){var T=E._current;if(T===null)throw Error(r(456));if((E._pendingVisibility&2)===0){var N=Us(T,2);N!==null&&(E._pendingVisibility|=2,Lr(N,T,2))}},attach:function(){var T=E._current;if(T===null)throw Error(r(456));if((E._pendingVisibility&2)!==0){var N=Us(T,2);N!==null&&(E._pendingVisibility&=-3,Lr(N,T,2))}}};return n.stateNode=E,n}function Dg(n,o,d){return n=Da(6,n,null,o),n.lanes=d,n}function Pg(n,o,d){return o=Da(4,n.children!==null?n.children:[],n.key,o),o.lanes=d,o.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},o}function us(n){n.flags|=4}function uI(n,o){if(o.type!=="stylesheet"||(o.state.loading&4)!==0)n.flags&=-16777217;else if(n.flags|=16777216,!XI(o)){if(o=Oa.current,o!==null&&((Ot&4194176)===Ot?bn!==null:(Ot&62914560)!==Ot&&(Ot&536870912)===0||o!==bn))throw ru=xm,Ob;n.flags|=8192}}function af(n,o){o!==null&&(n.flags|=4),n.flags&16384&&(o=n.tag!==22?wC():536870912,n.lanes|=o,fl|=o)}function Tu(n,o){if(!kt)switch(n.tailMode){case"hidden":o=n.tail;for(var d=null;o!==null;)o.alternate!==null&&(d=o),o=o.sibling;d===null?n.tail=null:d.sibling=null;break;case"collapsed":d=n.tail;for(var f=null;d!==null;)d.alternate!==null&&(f=d),d=d.sibling;f===null?o||n.tail===null?n.tail=null:n.tail.sibling=null:f.sibling=null}}function Ei(n){var o=n.alternate!==null&&n.alternate.child===n.child,d=0,f=0;if(o)for(var E=n.child;E!==null;)d|=E.lanes|E.childLanes,f|=E.subtreeFlags&31457280,f|=E.flags&31457280,E.return=n,E=E.sibling;else for(E=n.child;E!==null;)d|=E.lanes|E.childLanes,f|=E.subtreeFlags,f|=E.flags,E.return=n,E=E.sibling;return n.subtreeFlags|=f,n.childLanes=d,o}function kF(n,o,d){var f=o.pendingProps;switch(Mm(o),o.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ei(o),null;case 1:return Ei(o),null;case 3:return d=o.stateNode,f=null,n!==null&&(f=n.memoizedState.cache),o.memoizedState.cache!==f&&(o.flags|=2048),os(Qi),yt(),d.pendingContext&&(d.context=d.pendingContext,d.pendingContext=null),(n===null||n.child===null)&&($d(o)?us(o):n===null||n.memoizedState.isDehydrated&&(o.flags&256)===0||(o.flags|=1024,nn!==null&&(jg(nn),nn=null))),Ei(o),null;case 26:return d=o.memoizedState,n===null?(us(o),d!==null?(Ei(o),uI(o,d)):(Ei(o),o.flags&=-16777217)):d?d!==n.memoizedState?(us(o),Ei(o),uI(o,d)):(Ei(o),o.flags&=-16777217):(n.memoizedProps!==f&&us(o),Ei(o),o.flags&=-16777217),null;case 27:Hi(o),d=Er.current;var E=o.type;if(n!==null&&o.stateNode!=null)n.memoizedProps!==f&&us(o);else{if(!f){if(o.stateNode===null)throw Error(r(166));return Ei(o),null}n=Dr.current,$d(o)?Ab(o):(n=FI(E,f,d),o.stateNode=n,us(o))}return Ei(o),null;case 5:if(Hi(o),d=o.type,n!==null&&o.stateNode!=null)n.memoizedProps!==f&&us(o);else{if(!f){if(o.stateNode===null)throw Error(r(166));return Ei(o),null}if(n=Dr.current,$d(o))Ab(o);else{switch(E=_f(Er.current),n){case 1:n=E.createElementNS("http://www.w3.org/2000/svg",d);break;case 2:n=E.createElementNS("http://www.w3.org/1998/Math/MathML",d);break;default:switch(d){case"svg":n=E.createElementNS("http://www.w3.org/2000/svg",d);break;case"math":n=E.createElementNS("http://www.w3.org/1998/Math/MathML",d);break;case"script":n=E.createElement("div"),n.innerHTML="<script><\/script>",n=n.removeChild(n.firstChild);break;case"select":n=typeof f.is=="string"?E.createElement("select",{is:f.is}):E.createElement("select"),f.multiple?n.multiple=!0:f.size&&(n.size=f.size);break;default:n=typeof f.is=="string"?E.createElement(d,{is:f.is}):E.createElement(d)}}n[Cr]=o,n[Gr]=f;e:for(E=o.child;E!==null;){if(E.tag===5||E.tag===6)n.appendChild(E.stateNode);else if(E.tag!==4&&E.tag!==27&&E.child!==null){E.child.return=E,E=E.child;continue}if(E===o)break e;for(;E.sibling===null;){if(E.return===null||E.return===o)break e;E=E.return}E.sibling.return=E.return,E=E.sibling}o.stateNode=n;e:switch(Sr(n,d,f),d){case"button":case"input":case"select":case"textarea":n=!!f.autoFocus;break e;case"img":n=!0;break e;default:n=!1}n&&us(o)}}return Ei(o),o.flags&=-16777217,null;case 6:if(n&&o.stateNode!=null)n.memoizedProps!==f&&us(o);else{if(typeof f!="string"&&o.stateNode===null)throw Error(r(166));if(n=Er.current,$d(o)){if(n=o.stateNode,d=o.memoizedProps,f=null,E=Pr,E!==null)switch(E.tag){case 27:case 5:f=E.memoizedProps}n[Cr]=o,n=!!(n.nodeValue===d||f!==null&&f.suppressHydrationWarning===!0||MI(n.nodeValue,d)),n||zo(o)}else n=_f(n).createTextNode(f),n[Cr]=o,o.stateNode=n}return Ei(o),null;case 13:if(f=o.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(E=$d(o),f!==null&&f.dehydrated!==null){if(n===null){if(!E)throw Error(r(318));if(E=o.memoizedState,E=E!==null?E.dehydrated:null,!E)throw Error(r(317));E[Cr]=o}else eu(),(o.flags&128)===0&&(o.memoizedState=null),o.flags|=4;Ei(o),E=!1}else nn!==null&&(jg(nn),nn=null),E=!0;if(!E)return o.flags&256?(rs(o),o):(rs(o),null)}if(rs(o),(o.flags&128)!==0)return o.lanes=d,o;if(d=f!==null,n=n!==null&&n.memoizedState!==null,d){f=o.child,E=null,f.alternate!==null&&f.alternate.memoizedState!==null&&f.alternate.memoizedState.cachePool!==null&&(E=f.alternate.memoizedState.cachePool.pool);var T=null;f.memoizedState!==null&&f.memoizedState.cachePool!==null&&(T=f.memoizedState.cachePool.pool),T!==E&&(f.flags|=2048)}return d!==n&&d&&(o.child.flags|=8192),af(o,o.updateQueue),Ei(o),null;case 4:return yt(),n===null&&Qg(o.stateNode.containerInfo),Ei(o),null;case 10:return os(o.type),Ei(o),null;case 19:if(Ft(Ji),E=o.memoizedState,E===null)return Ei(o),null;if(f=(o.flags&128)!==0,T=E.rendering,T===null)if(f)Tu(E,!1);else{if(Ai!==0||n!==null&&(n.flags&128)!==0)for(n=o.child;n!==null;){if(T=jp(n),T!==null){for(o.flags|=128,Tu(E,!1),n=T.updateQueue,o.updateQueue=n,af(o,n),o.subtreeFlags=0,n=d,d=o.child;d!==null;)lI(d,n),d=d.sibling;return Yt(Ji,Ji.current&1|2),o.child}n=n.sibling}E.tail!==null&&Ci()>nf&&(o.flags|=128,f=!0,Tu(E,!1),o.lanes=4194304)}else{if(!f)if(n=jp(T),n!==null){if(o.flags|=128,f=!0,n=n.updateQueue,o.updateQueue=n,af(o,n),Tu(E,!0),E.tail===null&&E.tailMode==="hidden"&&!T.alternate&&!kt)return Ei(o),null}else 2*Ci()-E.renderingStartTime>nf&&d!==536870912&&(o.flags|=128,f=!0,Tu(E,!1),o.lanes=4194304);E.isBackwards?(T.sibling=o.child,o.child=T):(n=E.last,n!==null?n.sibling=T:o.child=T,E.last=T)}return E.tail!==null?(o=E.tail,E.rendering=o,E.tail=o.sibling,E.renderingStartTime=Ci(),o.sibling=null,n=Ji.current,Yt(Ji,f?n&1|2:n&1),o):(Ei(o),null);case 22:case 23:return rs(o),Bm(),f=o.memoizedState!==null,n!==null?n.memoizedState!==null!==f&&(o.flags|=8192):f&&(o.flags|=8192),f?(d&536870912)!==0&&(o.flags&128)===0&&(Ei(o),o.subtreeFlags&6&&(o.flags|=8192)):Ei(o),d=o.updateQueue,d!==null&&af(o,d.retryQueue),d=null,n!==null&&n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(d=n.memoizedState.cachePool.pool),f=null,o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(f=o.memoizedState.cachePool.pool),f!==d&&(o.flags|=2048),n!==null&&Ft(qo),null;case 24:return d=null,n!==null&&(d=n.memoizedState.cache),o.memoizedState.cache!==d&&(o.flags|=2048),os(Qi),Ei(o),null;case 25:return null}throw Error(r(156,o.tag))}function MF(n,o){switch(Mm(o),o.tag){case 1:return n=o.flags,n&65536?(o.flags=n&-65537|128,o):null;case 3:return os(Qi),yt(),n=o.flags,(n&65536)!==0&&(n&128)===0?(o.flags=n&-65537|128,o):null;case 26:case 27:case 5:return Hi(o),null;case 13:if(rs(o),n=o.memoizedState,n!==null&&n.dehydrated!==null){if(o.alternate===null)throw Error(r(340));eu()}return n=o.flags,n&65536?(o.flags=n&-65537|128,o):null;case 19:return Ft(Ji),null;case 4:return yt(),null;case 10:return os(o.type),null;case 22:case 23:return rs(o),Bm(),n!==null&&Ft(qo),n=o.flags,n&65536?(o.flags=n&-65537|128,o):null;case 24:return os(Qi),null;case 25:return null;default:return null}}function hI(n,o){switch(Mm(o),o.tag){case 3:os(Qi),yt();break;case 26:case 27:case 5:Hi(o);break;case 4:yt();break;case 13:rs(o);break;case 19:Ft(Ji);break;case 10:os(o.type);break;case 22:case 23:rs(o),Bm(),n!==null&&Ft(qo);break;case 24:os(Qi)}}var UF={getCacheForType:function(n){var o=br(Qi),d=o.data.get(n);return d===void 0&&(d=n(),o.data.set(n,d)),d}},xF=typeof WeakMap=="function"?WeakMap:Map,mi=0,oi=null,gt=null,Ot=0,ci=0,ca=null,hs=!1,pl=!1,Lg=!1,ps=0,Ai=0,Xs=0,rc=0,kg=0,Pa=0,fl=0,Ru=null,In=null,Mg=!1,Ug=0,nf=1/0,sf=null,Js=null,of=!1,ac=null,vu=0,xg=0,Vg=null,yu=0,Bg=null;function la(){if((mi&2)!==0&&Ot!==0)return Ot&-Ot;if(q.T!==null){var n=nl;return n!==0?n:Yg()}return LC()}function pI(){Pa===0&&(Pa=(Ot&536870912)===0||kt?OC():536870912);var n=Oa.current;return n!==null&&(n.flags|=32),Pa}function Lr(n,o,d){(n===oi&&ci===2||n.cancelPendingCommit!==null)&&(_l(n,0),fs(n,Ot,Pa,!1)),Fd(n,d),((mi&2)===0||n!==oi)&&(n===oi&&((mi&2)===0&&(rc|=d),Ai===4&&fs(n,Ot,Pa,!1)),On(n))}function fI(n,o,d){if((mi&6)!==0)throw Error(r(327));var f=!d&&(o&60)===0&&(o&n.expiredLanes)===0||jd(n,o),E=f?jF(n,o):Hg(n,o,!0),T=f;do{if(E===0){pl&&!f&&fs(n,o,0,!1);break}else if(E===6)fs(n,o,0,!hs);else{if(d=n.current.alternate,T&&!VF(d)){E=Hg(n,o,!1),T=!1;continue}if(E===2){if(T=o,n.errorRecoveryDisabledLanes&T)var N=0;else N=n.pendingLanes&-536870913,N=N!==0?N:N&536870912?536870912:0;if(N!==0){o=N;e:{var M=n;E=Ru;var V=M.current.memoizedState.isDehydrated;if(V&&(_l(M,N).flags|=256),N=Hg(M,N,!1),N!==2){if(Lg&&!V){M.errorRecoveryDisabledLanes|=T,rc|=T,E=4;break e}T=In,In=E,T!==null&&jg(T)}E=N}if(T=!1,E!==2)continue}}if(E===1){_l(n,0),fs(n,o,0,!0);break}e:{switch(f=n,E){case 0:case 1:throw Error(r(345));case 4:if((o&4194176)===o){fs(f,o,Pa,!hs);break e}break;case 2:In=null;break;case 3:case 5:break;default:throw Error(r(329))}if(f.finishedWork=d,f.finishedLanes=o,(o&62914560)===o&&(T=Ug+300-Ci(),10<T)){if(fs(f,o,Pa,!hs),Sp(f,0)!==0)break e;f.timeoutHandle=VI(_I.bind(null,f,d,In,sf,Mg,o,Pa,rc,fl,hs,2,-0,0),T);break e}_I(f,d,In,sf,Mg,o,Pa,rc,fl,hs,0,-0,0)}}break}while(!0);On(n)}function jg(n){In===null?In=n:In.push.apply(In,n)}function _I(n,o,d,f,E,T,N,M,V,Y,ne,Ee,ee){var re=o.subtreeFlags;if((re&8192||(re&16785408)===16785408)&&(wu={stylesheets:null,count:0,unsuspend:S3},nI(o),o=R3(),o!==null)){n.cancelPendingCommit=o(vI.bind(null,n,d,f,E,N,M,V,1,Ee,ee)),fs(n,T,N,!Y);return}vI(n,d,f,E,N,M,V,ne,Ee,ee)}function VF(n){for(var o=n;;){var d=o.tag;if((d===0||d===11||d===15)&&o.flags&16384&&(d=o.updateQueue,d!==null&&(d=d.stores,d!==null)))for(var f=0;f<d.length;f++){var E=d[f],T=E.getSnapshot;E=E.value;try{if(!na(T(),E))return!1}catch{return!1}}if(d=o.child,o.subtreeFlags&16384&&d!==null)d.return=o,o=d;else{if(o===n)break;for(;o.sibling===null;){if(o.return===null||o.return===n)return!0;o=o.return}o.sibling.return=o.return,o=o.sibling}}return!0}function fs(n,o,d,f){o&=~kg,o&=~rc,n.suspendedLanes|=o,n.pingedLanes&=~o,f&&(n.warmLanes|=o),f=n.expirationTimes;for(var E=o;0<E;){var T=31-aa(E),N=1<<T;f[T]=-1,E&=~N}d!==0&&NC(n,d,o)}function cf(){return(mi&6)===0?(Cu(0),!1):!0}function Fg(){if(gt!==null){if(ci===0)var n=gt.return;else n=gt,ss=$o=null,Ym(n),rl=null,au=0,n=gt;for(;n!==null;)hI(n.alternate,n),n=n.return;gt=null}}function _l(n,o){n.finishedWork=null,n.finishedLanes=0;var d=n.timeoutHandle;d!==-1&&(n.timeoutHandle=-1,r3(d)),d=n.cancelPendingCommit,d!==null&&(n.cancelPendingCommit=null,d()),Fg(),oi=n,gt=d=qs(n.current,null),Ot=o,ci=0,ca=null,hs=!1,pl=jd(n,o),Lg=!1,fl=Pa=kg=rc=Xs=Ai=0,In=Ru=null,Mg=!1,(o&8)!==0&&(o|=o&32);var f=n.entangledLanes;if(f!==0)for(n=n.entanglements,f&=o;0<f;){var E=31-aa(f),T=1<<E;o|=n[E],f&=~T}return ps=o,Dp(),d}function EI(n,o){ht=null,q.H=An,o===iu?(o=Db(),ci=3):o===Ob?(o=Db(),ci=4):ci=o===wA?8:o!==null&&typeof o=="object"&&typeof o.then=="function"?6:1,ca=o,gt===null&&(Ai=1,Qp(n,ba(o,n.current)))}function mI(){var n=q.H;return q.H=An,n===null?An:n}function gI(){var n=q.A;return q.A=UF,n}function Gg(){Ai=4,hs||(Ot&4194176)!==Ot&&Oa.current!==null||(pl=!0),(Xs&134217727)===0&&(rc&134217727)===0||oi===null||fs(oi,Ot,Pa,!1)}function Hg(n,o,d){var f=mi;mi|=2;var E=mI(),T=gI();(oi!==n||Ot!==o)&&(sf=null,_l(n,o)),o=!1;var N=Ai;e:do try{if(ci!==0&&gt!==null){var M=gt,V=ca;switch(ci){case 8:Fg(),N=6;break e;case 3:case 2:case 6:Oa.current===null&&(o=!0);var Y=ci;if(ci=0,ca=null,El(n,M,V,Y),d&&pl){N=0;break e}break;default:Y=ci,ci=0,ca=null,El(n,M,V,Y)}}BF(),N=Ai;break}catch(ne){EI(n,ne)}while(!0);return o&&n.shellSuspendCounter++,ss=$o=null,mi=f,q.H=E,q.A=T,gt===null&&(oi=null,Ot=0,Dp()),N}function BF(){for(;gt!==null;)SI(gt)}function jF(n,o){var d=mi;mi|=2;var f=mI(),E=gI();oi!==n||Ot!==o?(sf=null,nf=Ci()+500,_l(n,o)):pl=jd(n,o);e:do try{if(ci!==0&&gt!==null){o=gt;var T=ca;t:switch(ci){case 1:ci=0,ca=null,El(n,o,T,1);break;case 2:if(wb(T)){ci=0,ca=null,TI(o);break}o=function(){ci===2&&oi===n&&(ci=7),On(n)},T.then(o,o);break e;case 3:ci=7;break e;case 4:ci=5;break e;case 7:wb(T)?(ci=0,ca=null,TI(o)):(ci=0,ca=null,El(n,o,T,7));break;case 5:var N=null;switch(gt.tag){case 26:N=gt.memoizedState;case 5:case 27:var M=gt;if(!N||XI(N)){ci=0,ca=null;var V=M.sibling;if(V!==null)gt=V;else{var Y=M.return;Y!==null?(gt=Y,lf(Y)):gt=null}break t}}ci=0,ca=null,El(n,o,T,5);break;case 6:ci=0,ca=null,El(n,o,T,6);break;case 8:Fg(),Ai=6;break e;default:throw Error(r(462))}}FF();break}catch(ne){EI(n,ne)}while(!0);return ss=$o=null,q.H=f,q.A=E,mi=d,gt!==null?0:(oi=null,Ot=0,Dp(),Ai)}function FF(){for(;gt!==null&&!rr();)SI(gt)}function SI(n){var o=FA(n.alternate,n,ps);n.memoizedProps=n.pendingProps,o===null?lf(n):gt=o}function TI(n){var o=n,d=o.alternate;switch(o.tag){case 15:case 0:o=MA(d,o,o.pendingProps,o.type,void 0,Ot);break;case 11:o=MA(d,o,o.pendingProps,o.type.render,o.ref,Ot);break;case 5:Ym(o);default:hI(d,o),o=gt=lI(o,ps),o=FA(d,o,ps)}n.memoizedProps=n.pendingProps,o===null?lf(n):gt=o}function El(n,o,d,f){ss=$o=null,Ym(o),rl=null,au=0;var E=o.return;try{if(wF(n,E,o,d,Ot)){Ai=1,Qp(n,ba(d,n.current)),gt=null;return}}catch(T){if(E!==null)throw gt=E,T;Ai=1,Qp(n,ba(d,n.current)),gt=null;return}o.flags&32768?(kt||f===1?n=!0:pl||(Ot&536870912)!==0?n=!1:(hs=n=!0,(f===2||f===3||f===6)&&(f=Oa.current,f!==null&&f.tag===13&&(f.flags|=16384))),RI(o,n)):lf(o)}function lf(n){var o=n;do{if((o.flags&32768)!==0){RI(o,hs);return}n=o.return;var d=kF(o.alternate,o,ps);if(d!==null){gt=d;return}if(o=o.sibling,o!==null){gt=o;return}gt=o=n}while(o!==null);Ai===0&&(Ai=5)}function RI(n,o){do{var d=MF(n.alternate,n);if(d!==null){d.flags&=32767,gt=d;return}if(d=n.return,d!==null&&(d.flags|=32768,d.subtreeFlags=0,d.deletions=null),!o&&(n=n.sibling,n!==null)){gt=n;return}gt=n=d}while(n!==null);Ai=6,gt=null}function vI(n,o,d,f,E,T,N,M,V,Y){var ne=q.T,Ee=F.p;try{F.p=2,q.T=null,GF(n,o,d,f,Ee,E,T,N,M,V,Y)}finally{q.T=ne,F.p=Ee}}function GF(n,o,d,f,E,T,N,M){do ml();while(ac!==null);if((mi&6)!==0)throw Error(r(327));var V=n.finishedWork;if(f=n.finishedLanes,V===null)return null;if(n.finishedWork=null,n.finishedLanes=0,V===n.current)throw Error(r(177));n.callbackNode=null,n.callbackPriority=0,n.cancelPendingCommit=null;var Y=V.lanes|V.childLanes;if(Y|=Pm,Tj(n,f,Y,T,N,M),n===oi&&(gt=oi=null,Ot=0),(V.subtreeFlags&10256)===0&&(V.flags&10256)===0||of||(of=!0,xg=Y,Vg=d,zF(Ep,function(){return ml(),null})),d=(V.flags&15990)!==0,(V.subtreeFlags&15990)!==0||d?(d=q.T,q.T=null,T=F.p,F.p=2,N=mi,mi|=4,DF(n,V),iI(V,n),hF(tS,n.containerInfo),Rf=!!eS,tS=eS=null,n.current=V,ZA(n,V.alternate,V),yn(),mi=N,F.p=T,q.T=d):n.current=V,of?(of=!1,ac=n,vu=f):yI(n,Y),Y=n.pendingLanes,Y===0&&(Js=null),_j(V.stateNode),On(n),o!==null)for(E=n.onRecoverableError,V=0;V<o.length;V++)Y=o[V],E(Y.value,{componentStack:Y.stack});return(vu&3)!==0&&ml(),Y=n.pendingLanes,(f&4194218)!==0&&(Y&42)!==0?n===Bg?yu++:(yu=0,Bg=n):yu=0,Cu(0),null}function yI(n,o){(n.pooledCacheLanes&=o)===0&&(o=n.pooledCache,o!=null&&(n.pooledCache=null,su(o)))}function ml(){if(ac!==null){var n=ac,o=xg;xg=0;var d=PC(vu),f=q.T,E=F.p;try{if(F.p=32>d?32:d,q.T=null,ac===null)var T=!1;else{d=Vg,Vg=null;var N=ac,M=vu;if(ac=null,vu=0,(mi&6)!==0)throw Error(r(331));var V=mi;if(mi|=4,oI(N.current),aI(N,N.current,M,d),mi=V,Cu(0,!1),ra&&typeof ra.onPostCommitFiberRoot=="function")try{ra.onPostCommitFiberRoot(Bd,N)}catch{}T=!0}return T}finally{F.p=E,q.T=f,yI(n,o)}}return!1}function CI(n,o,d){o=ba(d,o),o=og(n.stateNode,o,2),n=Ws(n,o,2),n!==null&&(Fd(n,2),On(n))}function ri(n,o,d){if(n.tag===3)CI(n,n,d);else for(;o!==null;){if(o.tag===3){CI(o,n,d);break}else if(o.tag===1){var f=o.stateNode;if(typeof o.type.getDerivedStateFromError=="function"||typeof f.componentDidCatch=="function"&&(Js===null||!Js.has(f))){n=ba(d,n),d=IA(2),f=Ws(o,d,2),f!==null&&(OA(d,f,o,n),Fd(f,2),On(f));break}}o=o.return}}function Wg(n,o,d){var f=n.pingCache;if(f===null){f=n.pingCache=new xF;var E=new Set;f.set(o,E)}else E=f.get(o),E===void 0&&(E=new Set,f.set(o,E));E.has(d)||(Lg=!0,E.add(d),n=HF.bind(null,n,o,d),o.then(n,n))}function HF(n,o,d){var f=n.pingCache;f!==null&&f.delete(o),n.pingedLanes|=n.suspendedLanes&d,n.warmLanes&=~d,oi===n&&(Ot&d)===d&&(Ai===4||Ai===3&&(Ot&62914560)===Ot&&300>Ci()-Ug?(mi&2)===0&&_l(n,0):kg|=d,fl===Ot&&(fl=0)),On(n)}function bI(n,o){o===0&&(o=wC()),n=Us(n,o),n!==null&&(Fd(n,o),On(n))}function WF(n){var o=n.memoizedState,d=0;o!==null&&(d=o.retryLane),bI(n,d)}function KF(n,o){var d=0;switch(n.tag){case 13:var f=n.stateNode,E=n.memoizedState;E!==null&&(d=E.retryLane);break;case 19:f=n.stateNode;break;case 22:f=n.stateNode._retryCache;break;default:throw Error(r(314))}f!==null&&f.delete(o),bI(n,d)}function zF(n,o){return It(n,o)}var df=null,gl=null,Kg=!1,uf=!1,zg=!1,nc=0;function On(n){n!==gl&&n.next===null&&(gl===null?df=gl=n:gl=gl.next=n),uf=!0,Kg||(Kg=!0,qF(YF))}function Cu(n,o){if(!zg&&uf){zg=!0;do for(var d=!1,f=df;f!==null;){if(n!==0){var E=f.pendingLanes;if(E===0)var T=0;else{var N=f.suspendedLanes,M=f.pingedLanes;T=(1<<31-aa(42|n)+1)-1,T&=E&~(N&~M),T=T&201326677?T&201326677|1:T?T|2:0}T!==0&&(d=!0,OI(f,T))}else T=Ot,T=Sp(f,f===oi?T:0),(T&3)===0||jd(f,T)||(d=!0,OI(f,T));f=f.next}while(d);zg=!1}}function YF(){uf=Kg=!1;var n=0;nc!==0&&(i3()&&(n=nc),nc=0);for(var o=Ci(),d=null,f=df;f!==null;){var E=f.next,T=AI(f,o);T===0?(f.next=null,d===null?df=E:d.next=E,E===null&&(gl=d)):(d=f,(n!==0||(T&3)!==0)&&(uf=!0)),f=E}Cu(n)}function AI(n,o){for(var d=n.suspendedLanes,f=n.pingedLanes,E=n.expirationTimes,T=n.pendingLanes&-62914561;0<T;){var N=31-aa(T),M=1<<N,V=E[N];V===-1?((M&d)===0||(M&f)!==0)&&(E[N]=Sj(M,o)):V<=o&&(n.expiredLanes|=M),T&=~M}if(o=oi,d=Ot,d=Sp(n,n===o?d:0),f=n.callbackNode,d===0||n===o&&ci===2||n.cancelPendingCommit!==null)return f!==null&&f!==null&&Be(f),n.callbackNode=null,n.callbackPriority=0;if((d&3)===0||jd(n,d)){if(o=d&-d,o===n.callbackPriority)return o;switch(f!==null&&Be(f),PC(d)){case 2:case 8:d=AC;break;case 32:d=Ep;break;case 268435456:d=IC;break;default:d=Ep}return f=II.bind(null,n),d=It(d,f),n.callbackPriority=o,n.callbackNode=d,o}return f!==null&&f!==null&&Be(f),n.callbackPriority=2,n.callbackNode=null,2}function II(n,o){var d=n.callbackNode;if(ml()&&n.callbackNode!==d)return null;var f=Ot;return f=Sp(n,n===oi?f:0),f===0?null:(fI(n,f,o),AI(n,Ci()),n.callbackNode!=null&&n.callbackNode===d?II.bind(null,n):null)}function OI(n,o){if(ml())return null;fI(n,o,!0)}function qF(n){a3(function(){(mi&6)!==0?It(bC,n):n()})}function Yg(){return nc===0&&(nc=OC()),nc}function wI(n){return n==null||typeof n=="symbol"||typeof n=="boolean"?null:typeof n=="function"?n:Cp(""+n)}function NI(n,o){var d=o.ownerDocument.createElement("input");return d.name=o.name,d.value=o.value,n.id&&d.setAttribute("form",n.id),o.parentNode.insertBefore(d,o),n=new FormData(n),d.parentNode.removeChild(d),n}function XF(n,o,d,f,E){if(o==="submit"&&d&&d.stateNode===E){var T=wI((E[Gr]||null).action),N=f.submitter;N&&(o=(o=N[Gr]||null)?wI(o.formAction):N.getAttribute("formAction"),o!==null&&(T=o,N=null));var M=new Op("action","action",null,f,E);n.push({event:M,listeners:[{instance:null,listener:function(){if(f.defaultPrevented){if(nc!==0){var V=N?NI(E,N):new FormData(E);ig(d,{pending:!0,data:V,method:E.method,action:T},null,V)}}else typeof T=="function"&&(M.preventDefault(),V=N?NI(E,N):new FormData(E),ig(d,{pending:!0,data:V,method:E.method,action:T},T,V))},currentTarget:E}]})}}for(var qg=0;qg<vb.length;qg++){var Xg=vb[qg],JF=Xg.toLowerCase(),QF=Xg[0].toUpperCase()+Xg.slice(1);an(JF,"on"+QF)}an(mb,"onAnimationEnd"),an(gb,"onAnimationIteration"),an(Sb,"onAnimationStart"),an("dblclick","onDoubleClick"),an("focusin","onFocus"),an("focusout","onBlur"),an(fF,"onTransitionRun"),an(_F,"onTransitionStart"),an(EF,"onTransitionCancel"),an(Tb,"onTransitionEnd"),Kc("onMouseEnter",["mouseout","mouseover"]),Kc("onMouseLeave",["mouseout","mouseover"]),Kc("onPointerEnter",["pointerout","pointerover"]),Kc("onPointerLeave",["pointerout","pointerover"]),jo("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),jo("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),jo("onBeforeInput",["compositionend","keypress","textInput","paste"]),jo("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),jo("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),jo("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var bu="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),ZF=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(bu));function DI(n,o){o=(o&4)!==0;for(var d=0;d<n.length;d++){var f=n[d],E=f.event;f=f.listeners;e:{var T=void 0;if(o)for(var N=f.length-1;0<=N;N--){var M=f[N],V=M.instance,Y=M.currentTarget;if(M=M.listener,V!==T&&E.isPropagationStopped())break e;T=M,E.currentTarget=Y;try{T(E)}catch(ne){Jp(ne)}E.currentTarget=null,T=V}else for(N=0;N<f.length;N++){if(M=f[N],V=M.instance,Y=M.currentTarget,M=M.listener,V!==T&&E.isPropagationStopped())break e;T=M,E.currentTarget=Y;try{T(E)}catch(ne){Jp(ne)}E.currentTarget=null,T=V}}}}function Ct(n,o){var d=o[um];d===void 0&&(d=o[um]=new Set);var f=n+"__bubble";d.has(f)||(PI(o,n,2,!1),d.add(f))}function Jg(n,o,d){var f=0;o&&(f|=4),PI(d,n,f,o)}var hf="_reactListening"+Math.random().toString(36).slice(2);function Qg(n){if(!n[hf]){n[hf]=!0,MC.forEach(function(d){d!=="selectionchange"&&(ZF.has(d)||Jg(d,!1,n),Jg(d,!0,n))});var o=n.nodeType===9?n:n.ownerDocument;o===null||o[hf]||(o[hf]=!0,Jg("selectionchange",!1,o))}}function PI(n,o,d,f){switch(tO(o)){case 2:var E=C3;break;case 8:E=b3;break;default:E=dS}d=E.bind(null,o,d,n),E=void 0,!Sm||o!=="touchstart"&&o!=="touchmove"&&o!=="wheel"||(E=!0),f?E!==void 0?n.addEventListener(o,d,{capture:!0,passive:E}):n.addEventListener(o,d,!0):E!==void 0?n.addEventListener(o,d,{passive:E}):n.addEventListener(o,d,!1)}function Zg(n,o,d,f,E){var T=f;if((o&1)===0&&(o&2)===0&&f!==null)e:for(;;){if(f===null)return;var N=f.tag;if(N===3||N===4){var M=f.stateNode.containerInfo;if(M===E||M.nodeType===8&&M.parentNode===E)break;if(N===4)for(N=f.return;N!==null;){var V=N.tag;if((V===3||V===4)&&(V=N.stateNode.containerInfo,V===E||V.nodeType===8&&V.parentNode===E))return;N=N.return}for(;M!==null;){if(N=Bo(M),N===null)return;if(V=N.tag,V===5||V===6||V===26||V===27){f=T=N;continue e}M=M.parentNode}}f=f.return}YC(function(){var Y=T,ne=mm(d),Ee=[];e:{var ee=Rb.get(n);if(ee!==void 0){var re=Op,we=n;switch(n){case"keypress":if(Ap(d)===0)break e;case"keydown":case"keyup":re=Kj;break;case"focusin":we="focus",re=ym;break;case"focusout":we="blur",re=ym;break;case"beforeblur":case"afterblur":re=ym;break;case"click":if(d.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":re=JC;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":re=Lj;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":re=qj;break;case mb:case gb:case Sb:re=Uj;break;case Tb:re=Jj;break;case"scroll":case"scrollend":re=Dj;break;case"wheel":re=Zj;break;case"copy":case"cut":case"paste":re=Vj;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":re=ZC;break;case"toggle":case"beforetoggle":re=eF}var $e=(o&4)!==0,Ii=!$e&&(n==="scroll"||n==="scrollend"),X=$e?ee!==null?ee+"Capture":null:ee;$e=[];for(var z=Y,$;z!==null;){var ue=z;if($=ue.stateNode,ue=ue.tag,ue!==5&&ue!==26&&ue!==27||$===null||X===null||(ue=Wd(z,X),ue!=null&&$e.push(Au(z,ue,$))),Ii)break;z=z.return}0<$e.length&&(ee=new re(ee,we,null,d,ne),Ee.push({event:ee,listeners:$e}))}}if((o&7)===0){e:{if(ee=n==="mouseover"||n==="pointerover",re=n==="mouseout"||n==="pointerout",ee&&d!==Em&&(we=d.relatedTarget||d.fromElement)&&(Bo(we)||we[Gc]))break e;if((re||ee)&&(ee=ne.window===ne?ne:(ee=ne.ownerDocument)?ee.defaultView||ee.parentWindow:window,re?(we=d.relatedTarget||d.toElement,re=Y,we=we?Bo(we):null,we!==null&&(Ii=K(we),$e=we.tag,we!==Ii||$e!==5&&$e!==27&&$e!==6)&&(we=null)):(re=null,we=Y),re!==we)){if($e=JC,ue="onMouseLeave",X="onMouseEnter",z="mouse",(n==="pointerout"||n==="pointerover")&&($e=ZC,ue="onPointerLeave",X="onPointerEnter",z="pointer"),Ii=re==null?ee:Hd(re),$=we==null?ee:Hd(we),ee=new $e(ue,z+"leave",re,d,ne),ee.target=Ii,ee.relatedTarget=$,ue=null,Bo(ne)===Y&&($e=new $e(X,z+"enter",we,d,ne),$e.target=$,$e.relatedTarget=Ii,ue=$e),Ii=ue,re&&we)t:{for($e=re,X=we,z=0,$=$e;$;$=Sl($))z++;for($=0,ue=X;ue;ue=Sl(ue))$++;for(;0<z-$;)$e=Sl($e),z--;for(;0<$-z;)X=Sl(X),$--;for(;z--;){if($e===X||X!==null&&$e===X.alternate)break t;$e=Sl($e),X=Sl(X)}$e=null}else $e=null;re!==null&&LI(Ee,ee,re,$e,!1),we!==null&&Ii!==null&&LI(Ee,Ii,we,$e,!0)}}e:{if(ee=Y?Hd(Y):window,re=ee.nodeName&&ee.nodeName.toLowerCase(),re==="select"||re==="input"&&ee.type==="file")var be=sb;else if(ab(ee))if(ob)be=dF;else{be=cF;var Et=oF}else re=ee.nodeName,!re||re.toLowerCase()!=="input"||ee.type!=="checkbox"&&ee.type!=="radio"?Y&&_m(Y.elementType)&&(be=sb):be=lF;if(be&&(be=be(n,Y))){nb(Ee,be,d,ne);break e}Et&&Et(n,ee,Y),n==="focusout"&&Y&&ee.type==="number"&&Y.memoizedProps.value!=null&&fm(ee,"number",ee.value)}switch(Et=Y?Hd(Y):window,n){case"focusin":(ab(Et)||Et.contentEditable==="true")&&(Qc=Et,wm=Y,Zd=null);break;case"focusout":Zd=wm=Qc=null;break;case"mousedown":Nm=!0;break;case"contextmenu":case"mouseup":case"dragend":Nm=!1,_b(Ee,d,ne);break;case"selectionchange":if(pF)break;case"keydown":case"keyup":_b(Ee,d,ne)}var De;if(bm)e:{switch(n){case"compositionstart":var We="onCompositionStart";break e;case"compositionend":We="onCompositionEnd";break e;case"compositionupdate":We="onCompositionUpdate";break e}We=void 0}else Jc?ib(n,d)&&(We="onCompositionEnd"):n==="keydown"&&d.keyCode===229&&(We="onCompositionStart");We&&($C&&d.locale!=="ko"&&(Jc||We!=="onCompositionStart"?We==="onCompositionEnd"&&Jc&&(De=qC()):(Ms=ne,Tm="value"in Ms?Ms.value:Ms.textContent,Jc=!0)),Et=pf(Y,We),0<Et.length&&(We=new QC(We,n,null,d,ne),Ee.push({event:We,listeners:Et}),De?We.data=De:(De=rb(d),De!==null&&(We.data=De)))),(De=iF?rF(n,d):aF(n,d))&&(We=pf(Y,"onBeforeInput"),0<We.length&&(Et=new QC("onBeforeInput","beforeinput",null,d,ne),Ee.push({event:Et,listeners:We}),Et.data=De)),XF(Ee,n,Y,d,ne)}DI(Ee,o)})}function Au(n,o,d){return{instance:n,listener:o,currentTarget:d}}function pf(n,o){for(var d=o+"Capture",f=[];n!==null;){var E=n,T=E.stateNode;E=E.tag,E!==5&&E!==26&&E!==27||T===null||(E=Wd(n,d),E!=null&&f.unshift(Au(n,E,T)),E=Wd(n,o),E!=null&&f.push(Au(n,E,T))),n=n.return}return f}function Sl(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5&&n.tag!==27);return n||null}function LI(n,o,d,f,E){for(var T=o._reactName,N=[];d!==null&&d!==f;){var M=d,V=M.alternate,Y=M.stateNode;if(M=M.tag,V!==null&&V===f)break;M!==5&&M!==26&&M!==27||Y===null||(V=Y,E?(Y=Wd(d,T),Y!=null&&N.unshift(Au(d,Y,V))):E||(Y=Wd(d,T),Y!=null&&N.push(Au(d,Y,V)))),d=d.return}N.length!==0&&n.push({event:o,listeners:N})}var $F=/\r\n?/g,e3=/\u0000|\uFFFD/g;function kI(n){return(typeof n=="string"?n:""+n).replace($F,`
`).replace(e3,"")}function MI(n,o){return o=kI(o),kI(n)===o}function ff(){}function ei(n,o,d,f,E,T){switch(d){case"children":typeof f=="string"?o==="body"||o==="textarea"&&f===""||Yc(n,f):(typeof f=="number"||typeof f=="bigint")&&o!=="body"&&Yc(n,""+f);break;case"className":Rp(n,"class",f);break;case"tabIndex":Rp(n,"tabindex",f);break;case"dir":case"role":case"viewBox":case"width":case"height":Rp(n,d,f);break;case"style":KC(n,f,T);break;case"data":if(o!=="object"){Rp(n,"data",f);break}case"src":case"href":if(f===""&&(o!=="a"||d!=="href")){n.removeAttribute(d);break}if(f==null||typeof f=="function"||typeof f=="symbol"||typeof f=="boolean"){n.removeAttribute(d);break}f=Cp(""+f),n.setAttribute(d,f);break;case"action":case"formAction":if(typeof f=="function"){n.setAttribute(d,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof T=="function"&&(d==="formAction"?(o!=="input"&&ei(n,o,"name",E.name,E,null),ei(n,o,"formEncType",E.formEncType,E,null),ei(n,o,"formMethod",E.formMethod,E,null),ei(n,o,"formTarget",E.formTarget,E,null)):(ei(n,o,"encType",E.encType,E,null),ei(n,o,"method",E.method,E,null),ei(n,o,"target",E.target,E,null)));if(f==null||typeof f=="symbol"||typeof f=="boolean"){n.removeAttribute(d);break}f=Cp(""+f),n.setAttribute(d,f);break;case"onClick":f!=null&&(n.onclick=ff);break;case"onScroll":f!=null&&Ct("scroll",n);break;case"onScrollEnd":f!=null&&Ct("scrollend",n);break;case"dangerouslySetInnerHTML":if(f!=null){if(typeof f!="object"||!("__html"in f))throw Error(r(61));if(d=f.__html,d!=null){if(E.children!=null)throw Error(r(60));n.innerHTML=d}}break;case"multiple":n.multiple=f&&typeof f!="function"&&typeof f!="symbol";break;case"muted":n.muted=f&&typeof f!="function"&&typeof f!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(f==null||typeof f=="function"||typeof f=="boolean"||typeof f=="symbol"){n.removeAttribute("xlink:href");break}d=Cp(""+f),n.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",d);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":f!=null&&typeof f!="function"&&typeof f!="symbol"?n.setAttribute(d,""+f):n.removeAttribute(d);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":f&&typeof f!="function"&&typeof f!="symbol"?n.setAttribute(d,""):n.removeAttribute(d);break;case"capture":case"download":f===!0?n.setAttribute(d,""):f!==!1&&f!=null&&typeof f!="function"&&typeof f!="symbol"?n.setAttribute(d,f):n.removeAttribute(d);break;case"cols":case"rows":case"size":case"span":f!=null&&typeof f!="function"&&typeof f!="symbol"&&!isNaN(f)&&1<=f?n.setAttribute(d,f):n.removeAttribute(d);break;case"rowSpan":case"start":f==null||typeof f=="function"||typeof f=="symbol"||isNaN(f)?n.removeAttribute(d):n.setAttribute(d,f);break;case"popover":Ct("beforetoggle",n),Ct("toggle",n),Tp(n,"popover",f);break;case"xlinkActuate":es(n,"http://www.w3.org/1999/xlink","xlink:actuate",f);break;case"xlinkArcrole":es(n,"http://www.w3.org/1999/xlink","xlink:arcrole",f);break;case"xlinkRole":es(n,"http://www.w3.org/1999/xlink","xlink:role",f);break;case"xlinkShow":es(n,"http://www.w3.org/1999/xlink","xlink:show",f);break;case"xlinkTitle":es(n,"http://www.w3.org/1999/xlink","xlink:title",f);break;case"xlinkType":es(n,"http://www.w3.org/1999/xlink","xlink:type",f);break;case"xmlBase":es(n,"http://www.w3.org/XML/1998/namespace","xml:base",f);break;case"xmlLang":es(n,"http://www.w3.org/XML/1998/namespace","xml:lang",f);break;case"xmlSpace":es(n,"http://www.w3.org/XML/1998/namespace","xml:space",f);break;case"is":Tp(n,"is",f);break;case"innerText":case"textContent":break;default:(!(2<d.length)||d[0]!=="o"&&d[0]!=="O"||d[1]!=="n"&&d[1]!=="N")&&(d=wj.get(d)||d,Tp(n,d,f))}}function $g(n,o,d,f,E,T){switch(d){case"style":KC(n,f,T);break;case"dangerouslySetInnerHTML":if(f!=null){if(typeof f!="object"||!("__html"in f))throw Error(r(61));if(d=f.__html,d!=null){if(E.children!=null)throw Error(r(60));n.innerHTML=d}}break;case"children":typeof f=="string"?Yc(n,f):(typeof f=="number"||typeof f=="bigint")&&Yc(n,""+f);break;case"onScroll":f!=null&&Ct("scroll",n);break;case"onScrollEnd":f!=null&&Ct("scrollend",n);break;case"onClick":f!=null&&(n.onclick=ff);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!UC.hasOwnProperty(d))e:{if(d[0]==="o"&&d[1]==="n"&&(E=d.endsWith("Capture"),o=d.slice(2,E?d.length-7:void 0),T=n[Gr]||null,T=T!=null?T[d]:null,typeof T=="function"&&n.removeEventListener(o,T,E),typeof f=="function")){typeof T!="function"&&T!==null&&(d in n?n[d]=null:n.hasAttribute(d)&&n.removeAttribute(d)),n.addEventListener(o,f,E);break e}d in n?n[d]=f:f===!0?n.setAttribute(d,""):Tp(n,d,f)}}}function Sr(n,o,d){switch(o){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Ct("error",n),Ct("load",n);var f=!1,E=!1,T;for(T in d)if(d.hasOwnProperty(T)){var N=d[T];if(N!=null)switch(T){case"src":f=!0;break;case"srcSet":E=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(r(137,o));default:ei(n,o,T,N,d,null)}}E&&ei(n,o,"srcSet",d.srcSet,d,null),f&&ei(n,o,"src",d.src,d,null);return;case"input":Ct("invalid",n);var M=T=N=E=null,V=null,Y=null;for(f in d)if(d.hasOwnProperty(f)){var ne=d[f];if(ne!=null)switch(f){case"name":E=ne;break;case"type":N=ne;break;case"checked":V=ne;break;case"defaultChecked":Y=ne;break;case"value":T=ne;break;case"defaultValue":M=ne;break;case"children":case"dangerouslySetInnerHTML":if(ne!=null)throw Error(r(137,o));break;default:ei(n,o,f,ne,d,null)}}FC(n,T,M,V,Y,N,E,!1),vp(n);return;case"select":Ct("invalid",n),f=N=T=null;for(E in d)if(d.hasOwnProperty(E)&&(M=d[E],M!=null))switch(E){case"value":T=M;break;case"defaultValue":N=M;break;case"multiple":f=M;default:ei(n,o,E,M,d,null)}o=T,d=N,n.multiple=!!f,o!=null?zc(n,!!f,o,!1):d!=null&&zc(n,!!f,d,!0);return;case"textarea":Ct("invalid",n),T=E=f=null;for(N in d)if(d.hasOwnProperty(N)&&(M=d[N],M!=null))switch(N){case"value":f=M;break;case"defaultValue":E=M;break;case"children":T=M;break;case"dangerouslySetInnerHTML":if(M!=null)throw Error(r(91));break;default:ei(n,o,N,M,d,null)}HC(n,f,E,T),vp(n);return;case"option":for(V in d)if(d.hasOwnProperty(V)&&(f=d[V],f!=null))switch(V){case"selected":n.selected=f&&typeof f!="function"&&typeof f!="symbol";break;default:ei(n,o,V,f,d,null)}return;case"dialog":Ct("cancel",n),Ct("close",n);break;case"iframe":case"object":Ct("load",n);break;case"video":case"audio":for(f=0;f<bu.length;f++)Ct(bu[f],n);break;case"image":Ct("error",n),Ct("load",n);break;case"details":Ct("toggle",n);break;case"embed":case"source":case"link":Ct("error",n),Ct("load",n);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(Y in d)if(d.hasOwnProperty(Y)&&(f=d[Y],f!=null))switch(Y){case"children":case"dangerouslySetInnerHTML":throw Error(r(137,o));default:ei(n,o,Y,f,d,null)}return;default:if(_m(o)){for(ne in d)d.hasOwnProperty(ne)&&(f=d[ne],f!==void 0&&$g(n,o,ne,f,d,void 0));return}}for(M in d)d.hasOwnProperty(M)&&(f=d[M],f!=null&&ei(n,o,M,f,d,null))}function t3(n,o,d,f){switch(o){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var E=null,T=null,N=null,M=null,V=null,Y=null,ne=null;for(re in d){var Ee=d[re];if(d.hasOwnProperty(re)&&Ee!=null)switch(re){case"checked":break;case"value":break;case"defaultValue":V=Ee;default:f.hasOwnProperty(re)||ei(n,o,re,null,f,Ee)}}for(var ee in f){var re=f[ee];if(Ee=d[ee],f.hasOwnProperty(ee)&&(re!=null||Ee!=null))switch(ee){case"type":T=re;break;case"name":E=re;break;case"checked":Y=re;break;case"defaultChecked":ne=re;break;case"value":N=re;break;case"defaultValue":M=re;break;case"children":case"dangerouslySetInnerHTML":if(re!=null)throw Error(r(137,o));break;default:re!==Ee&&ei(n,o,ee,re,f,Ee)}}pm(n,N,M,V,Y,ne,T,E);return;case"select":re=N=M=ee=null;for(T in d)if(V=d[T],d.hasOwnProperty(T)&&V!=null)switch(T){case"value":break;case"multiple":re=V;default:f.hasOwnProperty(T)||ei(n,o,T,null,f,V)}for(E in f)if(T=f[E],V=d[E],f.hasOwnProperty(E)&&(T!=null||V!=null))switch(E){case"value":ee=T;break;case"defaultValue":M=T;break;case"multiple":N=T;default:T!==V&&ei(n,o,E,T,f,V)}o=M,d=N,f=re,ee!=null?zc(n,!!d,ee,!1):!!f!=!!d&&(o!=null?zc(n,!!d,o,!0):zc(n,!!d,d?[]:"",!1));return;case"textarea":re=ee=null;for(M in d)if(E=d[M],d.hasOwnProperty(M)&&E!=null&&!f.hasOwnProperty(M))switch(M){case"value":break;case"children":break;default:ei(n,o,M,null,f,E)}for(N in f)if(E=f[N],T=d[N],f.hasOwnProperty(N)&&(E!=null||T!=null))switch(N){case"value":ee=E;break;case"defaultValue":re=E;break;case"children":break;case"dangerouslySetInnerHTML":if(E!=null)throw Error(r(91));break;default:E!==T&&ei(n,o,N,E,f,T)}GC(n,ee,re);return;case"option":for(var we in d)if(ee=d[we],d.hasOwnProperty(we)&&ee!=null&&!f.hasOwnProperty(we))switch(we){case"selected":n.selected=!1;break;default:ei(n,o,we,null,f,ee)}for(V in f)if(ee=f[V],re=d[V],f.hasOwnProperty(V)&&ee!==re&&(ee!=null||re!=null))switch(V){case"selected":n.selected=ee&&typeof ee!="function"&&typeof ee!="symbol";break;default:ei(n,o,V,ee,f,re)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var $e in d)ee=d[$e],d.hasOwnProperty($e)&&ee!=null&&!f.hasOwnProperty($e)&&ei(n,o,$e,null,f,ee);for(Y in f)if(ee=f[Y],re=d[Y],f.hasOwnProperty(Y)&&ee!==re&&(ee!=null||re!=null))switch(Y){case"children":case"dangerouslySetInnerHTML":if(ee!=null)throw Error(r(137,o));break;default:ei(n,o,Y,ee,f,re)}return;default:if(_m(o)){for(var Ii in d)ee=d[Ii],d.hasOwnProperty(Ii)&&ee!==void 0&&!f.hasOwnProperty(Ii)&&$g(n,o,Ii,void 0,f,ee);for(ne in f)ee=f[ne],re=d[ne],!f.hasOwnProperty(ne)||ee===re||ee===void 0&&re===void 0||$g(n,o,ne,ee,f,re);return}}for(var X in d)ee=d[X],d.hasOwnProperty(X)&&ee!=null&&!f.hasOwnProperty(X)&&ei(n,o,X,null,f,ee);for(Ee in f)ee=f[Ee],re=d[Ee],!f.hasOwnProperty(Ee)||ee===re||ee==null&&re==null||ei(n,o,Ee,ee,f,re)}var eS=null,tS=null;function _f(n){return n.nodeType===9?n:n.ownerDocument}function UI(n){switch(n){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function xI(n,o){if(n===0)switch(o){case"svg":return 1;case"math":return 2;default:return 0}return n===1&&o==="foreignObject"?0:n}function iS(n,o){return n==="textarea"||n==="noscript"||typeof o.children=="string"||typeof o.children=="number"||typeof o.children=="bigint"||typeof o.dangerouslySetInnerHTML=="object"&&o.dangerouslySetInnerHTML!==null&&o.dangerouslySetInnerHTML.__html!=null}var rS=null;function i3(){var n=window.event;return n&&n.type==="popstate"?n===rS?!1:(rS=n,!0):(rS=null,!1)}var VI=typeof setTimeout=="function"?setTimeout:void 0,r3=typeof clearTimeout=="function"?clearTimeout:void 0,BI=typeof Promise=="function"?Promise:void 0,a3=typeof queueMicrotask=="function"?queueMicrotask:typeof BI<"u"?function(n){return BI.resolve(null).then(n).catch(n3)}:VI;function n3(n){setTimeout(function(){throw n})}function aS(n,o){var d=o,f=0;do{var E=d.nextSibling;if(n.removeChild(d),E&&E.nodeType===8)if(d=E.data,d==="/$"){if(f===0){n.removeChild(E),ku(o);return}f--}else d!=="$"&&d!=="$?"&&d!=="$!"||f++;d=E}while(d);ku(o)}function nS(n){var o=n.firstChild;for(o&&o.nodeType===10&&(o=o.nextSibling);o;){var d=o;switch(o=o.nextSibling,d.nodeName){case"HTML":case"HEAD":case"BODY":nS(d),hm(d);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(d.rel.toLowerCase()==="stylesheet")continue}n.removeChild(d)}}function s3(n,o,d,f){for(;n.nodeType===1;){var E=d;if(n.nodeName.toLowerCase()!==o.toLowerCase()){if(!f&&(n.nodeName!=="INPUT"||n.type!=="hidden"))break}else if(f){if(!n[Gd])switch(o){case"meta":if(!n.hasAttribute("itemprop"))break;return n;case"link":if(T=n.getAttribute("rel"),T==="stylesheet"&&n.hasAttribute("data-precedence"))break;if(T!==E.rel||n.getAttribute("href")!==(E.href==null?null:E.href)||n.getAttribute("crossorigin")!==(E.crossOrigin==null?null:E.crossOrigin)||n.getAttribute("title")!==(E.title==null?null:E.title))break;return n;case"style":if(n.hasAttribute("data-precedence"))break;return n;case"script":if(T=n.getAttribute("src"),(T!==(E.src==null?null:E.src)||n.getAttribute("type")!==(E.type==null?null:E.type)||n.getAttribute("crossorigin")!==(E.crossOrigin==null?null:E.crossOrigin))&&T&&n.hasAttribute("async")&&!n.hasAttribute("itemprop"))break;return n;default:return n}}else if(o==="input"&&n.type==="hidden"){var T=E.name==null?null:""+E.name;if(E.type==="hidden"&&n.getAttribute("name")===T)return n}else return n;if(n=on(n.nextSibling),n===null)break}return null}function o3(n,o,d){if(o==="")return null;for(;n.nodeType!==3;)if((n.nodeType!==1||n.nodeName!=="INPUT"||n.type!=="hidden")&&!d||(n=on(n.nextSibling),n===null))return null;return n}function on(n){for(;n!=null;n=n.nextSibling){var o=n.nodeType;if(o===1||o===3)break;if(o===8){if(o=n.data,o==="$"||o==="$!"||o==="$?"||o==="F!"||o==="F")break;if(o==="/$")return null}}return n}function jI(n){n=n.previousSibling;for(var o=0;n;){if(n.nodeType===8){var d=n.data;if(d==="$"||d==="$!"||d==="$?"){if(o===0)return n;o--}else d==="/$"&&o++}n=n.previousSibling}return null}function FI(n,o,d){switch(o=_f(d),n){case"html":if(n=o.documentElement,!n)throw Error(r(452));return n;case"head":if(n=o.head,!n)throw Error(r(453));return n;case"body":if(n=o.body,!n)throw Error(r(454));return n;default:throw Error(r(451))}}var La=new Map,GI=new Set;function Ef(n){return typeof n.getRootNode=="function"?n.getRootNode():n.ownerDocument}var _s=F.d;F.d={f:c3,r:l3,D:d3,C:u3,L:h3,m:p3,X:_3,S:f3,M:E3};function c3(){var n=_s.f(),o=cf();return n||o}function l3(n){var o=Hc(n);o!==null&&o.tag===5&&o.type==="form"?_A(o):_s.r(n)}var Tl=typeof document>"u"?null:document;function HI(n,o,d){var f=Tl;if(f&&typeof o=="string"&&o){var E=ya(o);E='link[rel="'+n+'"][href="'+E+'"]',typeof d=="string"&&(E+='[crossorigin="'+d+'"]'),GI.has(E)||(GI.add(E),n={rel:n,crossOrigin:d,href:o},f.querySelector(E)===null&&(o=f.createElement("link"),Sr(o,"link",n),ar(o),f.head.appendChild(o)))}}function d3(n){_s.D(n),HI("dns-prefetch",n,null)}function u3(n,o){_s.C(n,o),HI("preconnect",n,o)}function h3(n,o,d){_s.L(n,o,d);var f=Tl;if(f&&n&&o){var E='link[rel="preload"][as="'+ya(o)+'"]';o==="image"&&d&&d.imageSrcSet?(E+='[imagesrcset="'+ya(d.imageSrcSet)+'"]',typeof d.imageSizes=="string"&&(E+='[imagesizes="'+ya(d.imageSizes)+'"]')):E+='[href="'+ya(n)+'"]';var T=E;switch(o){case"style":T=Rl(n);break;case"script":T=vl(n)}La.has(T)||(n=ie({rel:"preload",href:o==="image"&&d&&d.imageSrcSet?void 0:n,as:o},d),La.set(T,n),f.querySelector(E)!==null||o==="style"&&f.querySelector(Iu(T))||o==="script"&&f.querySelector(Ou(T))||(o=f.createElement("link"),Sr(o,"link",n),ar(o),f.head.appendChild(o)))}}function p3(n,o){_s.m(n,o);var d=Tl;if(d&&n){var f=o&&typeof o.as=="string"?o.as:"script",E='link[rel="modulepreload"][as="'+ya(f)+'"][href="'+ya(n)+'"]',T=E;switch(f){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":T=vl(n)}if(!La.has(T)&&(n=ie({rel:"modulepreload",href:n},o),La.set(T,n),d.querySelector(E)===null)){switch(f){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(d.querySelector(Ou(T)))return}f=d.createElement("link"),Sr(f,"link",n),ar(f),d.head.appendChild(f)}}}function f3(n,o,d){_s.S(n,o,d);var f=Tl;if(f&&n){var E=Wc(f).hoistableStyles,T=Rl(n);o=o||"default";var N=E.get(T);if(!N){var M={loading:0,preload:null};if(N=f.querySelector(Iu(T)))M.loading=5;else{n=ie({rel:"stylesheet",href:n,"data-precedence":o},d),(d=La.get(T))&&sS(n,d);var V=N=f.createElement("link");ar(V),Sr(V,"link",n),V._p=new Promise(function(Y,ne){V.onload=Y,V.onerror=ne}),V.addEventListener("load",function(){M.loading|=1}),V.addEventListener("error",function(){M.loading|=2}),M.loading|=4,mf(N,o,f)}N={type:"stylesheet",instance:N,count:1,state:M},E.set(T,N)}}}function _3(n,o){_s.X(n,o);var d=Tl;if(d&&n){var f=Wc(d).hoistableScripts,E=vl(n),T=f.get(E);T||(T=d.querySelector(Ou(E)),T||(n=ie({src:n,async:!0},o),(o=La.get(E))&&oS(n,o),T=d.createElement("script"),ar(T),Sr(T,"link",n),d.head.appendChild(T)),T={type:"script",instance:T,count:1,state:null},f.set(E,T))}}function E3(n,o){_s.M(n,o);var d=Tl;if(d&&n){var f=Wc(d).hoistableScripts,E=vl(n),T=f.get(E);T||(T=d.querySelector(Ou(E)),T||(n=ie({src:n,async:!0,type:"module"},o),(o=La.get(E))&&oS(n,o),T=d.createElement("script"),ar(T),Sr(T,"link",n),d.head.appendChild(T)),T={type:"script",instance:T,count:1,state:null},f.set(E,T))}}function WI(n,o,d,f){var E=(E=Er.current)?Ef(E):null;if(!E)throw Error(r(446));switch(n){case"meta":case"title":return null;case"style":return typeof d.precedence=="string"&&typeof d.href=="string"?(o=Rl(d.href),d=Wc(E).hoistableStyles,f=d.get(o),f||(f={type:"style",instance:null,count:0,state:null},d.set(o,f)),f):{type:"void",instance:null,count:0,state:null};case"link":if(d.rel==="stylesheet"&&typeof d.href=="string"&&typeof d.precedence=="string"){n=Rl(d.href);var T=Wc(E).hoistableStyles,N=T.get(n);if(N||(E=E.ownerDocument||E,N={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},T.set(n,N),(T=E.querySelector(Iu(n)))&&!T._p&&(N.instance=T,N.state.loading=5),La.has(n)||(d={rel:"preload",as:"style",href:d.href,crossOrigin:d.crossOrigin,integrity:d.integrity,media:d.media,hrefLang:d.hrefLang,referrerPolicy:d.referrerPolicy},La.set(n,d),T||m3(E,n,d,N.state))),o&&f===null)throw Error(r(528,""));return N}if(o&&f!==null)throw Error(r(529,""));return null;case"script":return o=d.async,d=d.src,typeof d=="string"&&o&&typeof o!="function"&&typeof o!="symbol"?(o=vl(d),d=Wc(E).hoistableScripts,f=d.get(o),f||(f={type:"script",instance:null,count:0,state:null},d.set(o,f)),f):{type:"void",instance:null,count:0,state:null};default:throw Error(r(444,n))}}function Rl(n){return'href="'+ya(n)+'"'}function Iu(n){return'link[rel="stylesheet"]['+n+"]"}function KI(n){return ie({},n,{"data-precedence":n.precedence,precedence:null})}function m3(n,o,d,f){n.querySelector('link[rel="preload"][as="style"]['+o+"]")?f.loading=1:(o=n.createElement("link"),f.preload=o,o.addEventListener("load",function(){return f.loading|=1}),o.addEventListener("error",function(){return f.loading|=2}),Sr(o,"link",d),ar(o),n.head.appendChild(o))}function vl(n){return'[src="'+ya(n)+'"]'}function Ou(n){return"script[async]"+n}function zI(n,o,d){if(o.count++,o.instance===null)switch(o.type){case"style":var f=n.querySelector('style[data-href~="'+ya(d.href)+'"]');if(f)return o.instance=f,ar(f),f;var E=ie({},d,{"data-href":d.href,"data-precedence":d.precedence,href:null,precedence:null});return f=(n.ownerDocument||n).createElement("style"),ar(f),Sr(f,"style",E),mf(f,d.precedence,n),o.instance=f;case"stylesheet":E=Rl(d.href);var T=n.querySelector(Iu(E));if(T)return o.state.loading|=4,o.instance=T,ar(T),T;f=KI(d),(E=La.get(E))&&sS(f,E),T=(n.ownerDocument||n).createElement("link"),ar(T);var N=T;return N._p=new Promise(function(M,V){N.onload=M,N.onerror=V}),Sr(T,"link",f),o.state.loading|=4,mf(T,d.precedence,n),o.instance=T;case"script":return T=vl(d.src),(E=n.querySelector(Ou(T)))?(o.instance=E,ar(E),E):(f=d,(E=La.get(T))&&(f=ie({},d),oS(f,E)),n=n.ownerDocument||n,E=n.createElement("script"),ar(E),Sr(E,"link",f),n.head.appendChild(E),o.instance=E);case"void":return null;default:throw Error(r(443,o.type))}else o.type==="stylesheet"&&(o.state.loading&4)===0&&(f=o.instance,o.state.loading|=4,mf(f,d.precedence,n));return o.instance}function mf(n,o,d){for(var f=d.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),E=f.length?f[f.length-1]:null,T=E,N=0;N<f.length;N++){var M=f[N];if(M.dataset.precedence===o)T=M;else if(T!==E)break}T?T.parentNode.insertBefore(n,T.nextSibling):(o=d.nodeType===9?d.head:d,o.insertBefore(n,o.firstChild))}function sS(n,o){n.crossOrigin==null&&(n.crossOrigin=o.crossOrigin),n.referrerPolicy==null&&(n.referrerPolicy=o.referrerPolicy),n.title==null&&(n.title=o.title)}function oS(n,o){n.crossOrigin==null&&(n.crossOrigin=o.crossOrigin),n.referrerPolicy==null&&(n.referrerPolicy=o.referrerPolicy),n.integrity==null&&(n.integrity=o.integrity)}var gf=null;function YI(n,o,d){if(gf===null){var f=new Map,E=gf=new Map;E.set(d,f)}else E=gf,f=E.get(d),f||(f=new Map,E.set(d,f));if(f.has(n))return f;for(f.set(n,null),d=d.getElementsByTagName(n),E=0;E<d.length;E++){var T=d[E];if(!(T[Gd]||T[Cr]||n==="link"&&T.getAttribute("rel")==="stylesheet")&&T.namespaceURI!=="http://www.w3.org/2000/svg"){var N=T.getAttribute(o)||"";N=n+N;var M=f.get(N);M?M.push(T):f.set(N,[T])}}return f}function qI(n,o,d){n=n.ownerDocument||n,n.head.insertBefore(d,o==="title"?n.querySelector("head > title"):null)}function g3(n,o,d){if(d===1||o.itemProp!=null)return!1;switch(n){case"meta":case"title":return!0;case"style":if(typeof o.precedence!="string"||typeof o.href!="string"||o.href==="")break;return!0;case"link":if(typeof o.rel!="string"||typeof o.href!="string"||o.href===""||o.onLoad||o.onError)break;switch(o.rel){case"stylesheet":return n=o.disabled,typeof o.precedence=="string"&&n==null;default:return!0}case"script":if(o.async&&typeof o.async!="function"&&typeof o.async!="symbol"&&!o.onLoad&&!o.onError&&o.src&&typeof o.src=="string")return!0}return!1}function XI(n){return!(n.type==="stylesheet"&&(n.state.loading&3)===0)}var wu=null;function S3(){}function T3(n,o,d){if(wu===null)throw Error(r(475));var f=wu;if(o.type==="stylesheet"&&(typeof d.media!="string"||matchMedia(d.media).matches!==!1)&&(o.state.loading&4)===0){if(o.instance===null){var E=Rl(d.href),T=n.querySelector(Iu(E));if(T){n=T._p,n!==null&&typeof n=="object"&&typeof n.then=="function"&&(f.count++,f=Sf.bind(f),n.then(f,f)),o.state.loading|=4,o.instance=T,ar(T);return}T=n.ownerDocument||n,d=KI(d),(E=La.get(E))&&sS(d,E),T=T.createElement("link"),ar(T);var N=T;N._p=new Promise(function(M,V){N.onload=M,N.onerror=V}),Sr(T,"link",d),o.instance=T}f.stylesheets===null&&(f.stylesheets=new Map),f.stylesheets.set(o,n),(n=o.state.preload)&&(o.state.loading&3)===0&&(f.count++,o=Sf.bind(f),n.addEventListener("load",o),n.addEventListener("error",o))}}function R3(){if(wu===null)throw Error(r(475));var n=wu;return n.stylesheets&&n.count===0&&cS(n,n.stylesheets),0<n.count?function(o){var d=setTimeout(function(){if(n.stylesheets&&cS(n,n.stylesheets),n.unsuspend){var f=n.unsuspend;n.unsuspend=null,f()}},6e4);return n.unsuspend=o,function(){n.unsuspend=null,clearTimeout(d)}}:null}function Sf(){if(this.count--,this.count===0){if(this.stylesheets)cS(this,this.stylesheets);else if(this.unsuspend){var n=this.unsuspend;this.unsuspend=null,n()}}}var Tf=null;function cS(n,o){n.stylesheets=null,n.unsuspend!==null&&(n.count++,Tf=new Map,o.forEach(v3,n),Tf=null,Sf.call(n))}function v3(n,o){if(!(o.state.loading&4)){var d=Tf.get(n);if(d)var f=d.get(null);else{d=new Map,Tf.set(n,d);for(var E=n.querySelectorAll("link[data-precedence],style[data-precedence]"),T=0;T<E.length;T++){var N=E[T];(N.nodeName==="LINK"||N.getAttribute("media")!=="not all")&&(d.set(N.dataset.precedence,N),f=N)}f&&d.set(null,f)}E=o.instance,N=E.getAttribute("data-precedence"),T=d.get(N)||f,T===f&&d.set(null,E),d.set(N,E),this.count++,f=Sf.bind(this),E.addEventListener("load",f),E.addEventListener("error",f),T?T.parentNode.insertBefore(E,T.nextSibling):(n=n.nodeType===9?n.head:n,n.insertBefore(E,n.firstChild)),o.state.loading|=4}}var Nu={$$typeof:S,Provider:null,Consumer:null,_currentValue:pe,_currentValue2:pe,_threadCount:0};function y3(n,o,d,f,E,T,N,M){this.tag=1,this.containerInfo=n,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=dm(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.finishedLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=dm(0),this.hiddenUpdates=dm(null),this.identifierPrefix=f,this.onUncaughtError=E,this.onCaughtError=T,this.onRecoverableError=N,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=M,this.incompleteTransitions=new Map}function JI(n,o,d,f,E,T,N,M,V,Y,ne,Ee){return n=new y3(n,o,d,N,M,V,Y,Ee),o=1,T===!0&&(o|=24),T=Da(3,null,null,o),n.current=T,T.stateNode=n,o=jm(),o.refCount++,n.pooledCache=o,o.refCount++,T.memoizedState={element:f,isDehydrated:d,cache:o},Tg(T),n}function QI(n){return n?(n=el,n):el}function ZI(n,o,d,f,E,T){E=QI(E),f.context===null?f.context=E:f.pendingContext=E,f=Hs(o),f.payload={element:d},T=T===void 0?null:T,T!==null&&(f.callback=T),d=Ws(n,f,o),d!==null&&(Lr(d,n,o),pu(d,n,o))}function $I(n,o){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var d=n.retryLane;n.retryLane=d!==0&&d<o?d:o}}function lS(n,o){$I(n,o),(n=n.alternate)&&$I(n,o)}function eO(n){if(n.tag===13){var o=Us(n,67108864);o!==null&&Lr(o,n,67108864),lS(n,67108864)}}var Rf=!0;function C3(n,o,d,f){var E=q.T;q.T=null;var T=F.p;try{F.p=2,dS(n,o,d,f)}finally{F.p=T,q.T=E}}function b3(n,o,d,f){var E=q.T;q.T=null;var T=F.p;try{F.p=8,dS(n,o,d,f)}finally{F.p=T,q.T=E}}function dS(n,o,d,f){if(Rf){var E=uS(f);if(E===null)Zg(n,o,f,vf,d),iO(n,f);else if(I3(E,n,o,d,f))f.stopPropagation();else if(iO(n,f),o&4&&-1<A3.indexOf(n)){for(;E!==null;){var T=Hc(E);if(T!==null)switch(T.tag){case 3:if(T=T.stateNode,T.current.memoizedState.isDehydrated){var N=Vo(T.pendingLanes);if(N!==0){var M=T;for(M.pendingLanes|=2,M.entangledLanes|=2;N;){var V=1<<31-aa(N);M.entanglements[1]|=V,N&=~V}On(T),(mi&6)===0&&(nf=Ci()+500,Cu(0))}}break;case 13:M=Us(T,2),M!==null&&Lr(M,T,2),cf(),lS(T,2)}if(T=uS(f),T===null&&Zg(n,o,f,vf,d),T===E)break;E=T}E!==null&&f.stopPropagation()}else Zg(n,o,f,null,d)}}function uS(n){return n=mm(n),hS(n)}var vf=null;function hS(n){if(vf=null,n=Bo(n),n!==null){var o=K(n);if(o===null)n=null;else{var d=o.tag;if(d===13){if(n=te(o),n!==null)return n;n=null}else if(d===3){if(o.stateNode.current.memoizedState.isDehydrated)return o.tag===3?o.stateNode.containerInfo:null;n=null}else o!==n&&(n=null)}}return vf=n,null}function tO(n){switch(n){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(_p()){case bC:return 2;case AC:return 8;case Ep:case hj:return 32;case IC:return 268435456;default:return 32}default:return 32}}var pS=!1,Qs=null,Zs=null,$s=null,Du=new Map,Pu=new Map,eo=[],A3="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function iO(n,o){switch(n){case"focusin":case"focusout":Qs=null;break;case"dragenter":case"dragleave":Zs=null;break;case"mouseover":case"mouseout":$s=null;break;case"pointerover":case"pointerout":Du.delete(o.pointerId);break;case"gotpointercapture":case"lostpointercapture":Pu.delete(o.pointerId)}}function Lu(n,o,d,f,E,T){return n===null||n.nativeEvent!==T?(n={blockedOn:o,domEventName:d,eventSystemFlags:f,nativeEvent:T,targetContainers:[E]},o!==null&&(o=Hc(o),o!==null&&eO(o)),n):(n.eventSystemFlags|=f,o=n.targetContainers,E!==null&&o.indexOf(E)===-1&&o.push(E),n)}function I3(n,o,d,f,E){switch(o){case"focusin":return Qs=Lu(Qs,n,o,d,f,E),!0;case"dragenter":return Zs=Lu(Zs,n,o,d,f,E),!0;case"mouseover":return $s=Lu($s,n,o,d,f,E),!0;case"pointerover":var T=E.pointerId;return Du.set(T,Lu(Du.get(T)||null,n,o,d,f,E)),!0;case"gotpointercapture":return T=E.pointerId,Pu.set(T,Lu(Pu.get(T)||null,n,o,d,f,E)),!0}return!1}function rO(n){var o=Bo(n.target);if(o!==null){var d=K(o);if(d!==null){if(o=d.tag,o===13){if(o=te(d),o!==null){n.blockedOn=o,Rj(n.priority,function(){if(d.tag===13){var f=la(),E=Us(d,f);E!==null&&Lr(E,d,f),lS(d,f)}});return}}else if(o===3&&d.stateNode.current.memoizedState.isDehydrated){n.blockedOn=d.tag===3?d.stateNode.containerInfo:null;return}}}n.blockedOn=null}function yf(n){if(n.blockedOn!==null)return!1;for(var o=n.targetContainers;0<o.length;){var d=uS(n.nativeEvent);if(d===null){d=n.nativeEvent;var f=new d.constructor(d.type,d);Em=f,d.target.dispatchEvent(f),Em=null}else return o=Hc(d),o!==null&&eO(o),n.blockedOn=d,!1;o.shift()}return!0}function aO(n,o,d){yf(n)&&d.delete(o)}function O3(){pS=!1,Qs!==null&&yf(Qs)&&(Qs=null),Zs!==null&&yf(Zs)&&(Zs=null),$s!==null&&yf($s)&&($s=null),Du.forEach(aO),Pu.forEach(aO)}function Cf(n,o){n.blockedOn===o&&(n.blockedOn=null,pS||(pS=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,O3)))}var bf=null;function nO(n){bf!==n&&(bf=n,e.unstable_scheduleCallback(e.unstable_NormalPriority,function(){bf===n&&(bf=null);for(var o=0;o<n.length;o+=3){var d=n[o],f=n[o+1],E=n[o+2];if(typeof f!="function"){if(hS(f||d)===null)continue;break}var T=Hc(d);T!==null&&(n.splice(o,3),o-=3,ig(T,{pending:!0,data:E,method:d.method,action:f},f,E))}}))}function ku(n){function o(V){return Cf(V,n)}Qs!==null&&Cf(Qs,n),Zs!==null&&Cf(Zs,n),$s!==null&&Cf($s,n),Du.forEach(o),Pu.forEach(o);for(var d=0;d<eo.length;d++){var f=eo[d];f.blockedOn===n&&(f.blockedOn=null)}for(;0<eo.length&&(d=eo[0],d.blockedOn===null);)rO(d),d.blockedOn===null&&eo.shift();if(d=(n.ownerDocument||n).$$reactFormReplay,d!=null)for(f=0;f<d.length;f+=3){var E=d[f],T=d[f+1],N=E[Gr]||null;if(typeof T=="function")N||nO(d);else if(N){var M=null;if(T&&T.hasAttribute("formAction")){if(E=T,N=T[Gr]||null)M=N.formAction;else if(hS(E)!==null)continue}else M=N.action;typeof M=="function"?d[f+1]=M:(d.splice(f,3),f-=3),nO(d)}}}function fS(n){this._internalRoot=n}Af.prototype.render=fS.prototype.render=function(n){var o=this._internalRoot;if(o===null)throw Error(r(409));var d=o.current,f=la();ZI(d,f,n,o,null,null)},Af.prototype.unmount=fS.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var o=n.containerInfo;n.tag===0&&ml(),ZI(n.current,2,null,n,null,null),cf(),o[Gc]=null}};function Af(n){this._internalRoot=n}Af.prototype.unstable_scheduleHydration=function(n){if(n){var o=LC();n={blockedOn:null,target:n,priority:o};for(var d=0;d<eo.length&&o!==0&&o<eo[d].priority;d++);eo.splice(d,0,n),d===0&&rO(n)}};var sO=t.version;if(sO!=="19.0.0")throw Error(r(527,sO,"19.0.0"));F.findDOMNode=function(n){var o=n._reactInternals;if(o===void 0)throw typeof n.render=="function"?Error(r(188)):(n=Object.keys(n).join(","),Error(r(268,n)));return n=g(o),n=n!==null?w(n):null,n=n===null?null:n.stateNode,n};var w3={bundleType:0,version:"19.0.0",rendererPackageName:"react-dom",currentDispatcherRef:q,findFiberByHostInstance:Bo,reconcilerVersion:"19.0.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var If=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!If.isDisabled&&If.supportsFiber)try{Bd=If.inject(w3),ra=If}catch{}}return xu.createRoot=function(n,o){if(!a(n))throw Error(r(299));var d=!1,f="",E=yA,T=CA,N=bA,M=null;return o!=null&&(o.unstable_strictMode===!0&&(d=!0),o.identifierPrefix!==void 0&&(f=o.identifierPrefix),o.onUncaughtError!==void 0&&(E=o.onUncaughtError),o.onCaughtError!==void 0&&(T=o.onCaughtError),o.onRecoverableError!==void 0&&(N=o.onRecoverableError),o.unstable_transitionCallbacks!==void 0&&(M=o.unstable_transitionCallbacks)),o=JI(n,1,!1,null,null,d,f,E,T,N,M,null),n[Gc]=o.current,Qg(n.nodeType===8?n.parentNode:n),new fS(o)},xu.hydrateRoot=function(n,o,d){if(!a(n))throw Error(r(299));var f=!1,E="",T=yA,N=CA,M=bA,V=null,Y=null;return d!=null&&(d.unstable_strictMode===!0&&(f=!0),d.identifierPrefix!==void 0&&(E=d.identifierPrefix),d.onUncaughtError!==void 0&&(T=d.onUncaughtError),d.onCaughtError!==void 0&&(N=d.onCaughtError),d.onRecoverableError!==void 0&&(M=d.onRecoverableError),d.unstable_transitionCallbacks!==void 0&&(V=d.unstable_transitionCallbacks),d.formState!==void 0&&(Y=d.formState)),o=JI(n,1,!0,o,d??null,f,E,T,N,M,V,Y),o.context=QI(null),d=o.current,f=la(),E=Hs(f),E.callback=null,Ws(d,E,f),o.current.lanes=f,Fd(o,f),On(o),n[Gc]=o.current,Qg(n),new Af(o)},xu.version="19.0.0",xu}var EO;function F3(){if(EO)return mS.exports;EO=1;function e(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}return e(),mS.exports=j3(),mS.exports}var G3=F3();/**
 * @license agora-rtc-react
 * @version 2.3.0
 *
 * Copyright (c) Agora, Inc.
 *
 * This source code is licensed under the MIT license.
 */function H3(e,t){return t.forEach(function(i){i&&typeof i!="string"&&!Array.isArray(i)&&Object.keys(i).forEach(function(r){if(r!=="default"&&!(r in e)){var a=Object.getOwnPropertyDescriptor(i,r);Object.defineProperty(e,r,a.get?a:{enumerable:!0,get:function(){return i[r]}})}})}),Object.freeze(e)}var rd=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function zt(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var si=function(e){try{return!!e()}catch{return!0}},IE=!si(function(){var e=(function(){}).bind();return typeof e!="function"||e.hasOwnProperty("prototype")}),JM=IE,QM=Function.prototype,KR=QM.call,W3=JM&&QM.bind.bind(KR,KR),ii=JM?W3:function(e){return function(){return KR.apply(e,arguments)}},_r=ii({}.isPrototypeOf),Of=function(e){return e&&e.Math==Math&&e},Mi=Of(typeof globalThis=="object"&&globalThis)||Of(typeof window=="object"&&window)||Of(typeof self=="object"&&self)||Of(typeof rd=="object"&&rd)||function(){return this}()||rd||Function("return this")(),K3=IE,ZM=Function.prototype,mO=ZM.apply,gO=ZM.call,cy=typeof Reflect=="object"&&Reflect.apply||(K3?gO.bind(mO):function(){return gO.apply(mO,arguments)}),$M=ii,z3=$M({}.toString),Y3=$M("".slice),qn=function(e){return Y3(z3(e),8,-1)},q3=qn,X3=ii,Oh=function(e){if(q3(e)==="Function")return X3(e)},RS=typeof document=="object"&&document.all,OE={all:RS,IS_HTMLDDA:RS===void 0&&RS!==void 0},J3=OE.all,Ui=OE.IS_HTMLDDA?function(e){return typeof e=="function"||e===J3}:function(e){return typeof e=="function"},$h={},Ta=!si(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7}),Q3=IE,wf=Function.prototype.call,xi=Q3?wf.bind(wf):function(){return wf.apply(wf,arguments)},wE={},eU={}.propertyIsEnumerable,tU=Object.getOwnPropertyDescriptor,Z3=tU&&!eU.call({1:2},1);wE.f=Z3?function(e){var t=tU(this,e);return!!t&&t.enumerable}:eU;var io,C_,Po=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},$3=si,eG=qn,vS=Object,tG=ii("".split),NE=$3(function(){return!vS("z").propertyIsEnumerable(0)})?function(e){return eG(e)=="String"?tG(e,""):vS(e)}:vS,bd=function(e){return e==null},iG=bd,rG=TypeError,Ad=function(e){if(iG(e))throw rG("Can't call method on "+e);return e},aG=NE,nG=Ad,Lo=function(e){return aG(nG(e))},SO=Ui,sG=OE.all,ia=OE.IS_HTMLDDA?function(e){return typeof e=="object"?e!==null:SO(e)||e===sG}:function(e){return typeof e=="object"?e!==null:SO(e)},Tn={},yS=Tn,CS=Mi,oG=Ui,TO=function(e){return oG(e)?e:void 0},jr=function(e,t){return arguments.length<2?TO(yS[e])||TO(CS[e]):yS[e]&&yS[e][t]||CS[e]&&CS[e][t]},xc=typeof navigator<"u"&&String(navigator.userAgent)||"",iU=Mi,bS=xc,RO=iU.process,vO=iU.Deno,yO=RO&&RO.versions||vO&&vO.version,CO=yO&&yO.v8;CO&&(C_=(io=CO.split("."))[0]>0&&io[0]<4?1:+(io[0]+io[1])),!C_&&bS&&(!(io=bS.match(/Edge\/(\d+)/))||io[1]>=74)&&(io=bS.match(/Chrome\/(\d+)/))&&(C_=+io[1]);var Pc=C_,bO=Pc,cG=si,lG=Mi.String,Id=!!Object.getOwnPropertySymbols&&!cG(function(){var e=Symbol();return!lG(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&bO&&bO<41}),rU=Id&&!Symbol.sham&&typeof Symbol.iterator=="symbol",dG=jr,uG=Ui,hG=_r,pG=Object,ep=rU?function(e){return typeof e=="symbol"}:function(e){var t=dG("Symbol");return uG(t)&&hG(t.prototype,pG(e))},fG=String,Od=function(e){try{return fG(e)}catch{return"Object"}},_G=Ui,EG=Od,mG=TypeError,Za=function(e){if(_G(e))return e;throw mG(EG(e)+" is not a function")},gG=Za,SG=bd,DE=function(e,t){var i=e[t];return SG(i)?void 0:gG(i)},AO=xi,IO=Ui,OO=ia,TG=TypeError,aU={exports:{}},wO=Mi,RG=Object.defineProperty,vG=function(e,t){try{RG(wO,e,{value:t,configurable:!0,writable:!0})}catch{wO[e]=t}return t},NO="__core-js_shared__",ly=Mi[NO]||vG(NO,{}),DO=ly;(aU.exports=function(e,t){return DO[e]||(DO[e]=t!==void 0?t:{})})("versions",[]).push({version:"3.31.1",mode:"pure",copyright:"© 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.31.1/LICENSE",source:"https://github.com/zloirock/core-js"});var wd=aU.exports,yG=Ad,CG=Object,Xn=function(e){return CG(yG(e))},bG=Xn,AG=ii({}.hasOwnProperty),Gi=Object.hasOwn||function(e,t){return AG(bG(e),t)},IG=ii,OG=0,wG=Math.random(),NG=IG(1 .toString),dy=function(e){return"Symbol("+(e===void 0?"":e)+")_"+NG(++OG+wG,36)},DG=wd,PO=Gi,PG=dy,LG=Id,kG=rU,zl=Mi.Symbol,AS=DG("wks"),MG=kG?zl.for||zl:zl&&zl.withoutSetter||PG,Zt=function(e){return PO(AS,e)||(AS[e]=LG&&PO(zl,e)?zl[e]:MG("Symbol."+e)),AS[e]},UG=xi,LO=ia,kO=ep,xG=DE,VG=function(e,t){var i,r;if(IO(i=e.toString)&&!OO(r=AO(i,e))||IO(i=e.valueOf)&&!OO(r=AO(i,e))||t!=="string")return r;throw TG("Can't convert object to primitive value")},BG=TypeError,jG=Zt("toPrimitive"),FG=function(e,t){if(!LO(e)||kO(e))return e;var i,r=xG(e,jG);if(r){if(i=UG(r,e,t),!LO(i)||kO(i))return i;throw BG("Can't convert object to primitive value")}return VG(e,t)},GG=ep,PE=function(e){var t=FG(e,"string");return GG(t)?t:t+""},MO=ia,zR=Mi.document,HG=MO(zR)&&MO(zR.createElement),uy=function(e){return HG?zR.createElement(e):{}},WG=uy,nU=!Ta&&!si(function(){return Object.defineProperty(WG("div"),"a",{get:function(){return 7}}).a!=7}),KG=Ta,zG=xi,YG=wE,qG=Po,XG=Lo,JG=PE,QG=Gi,ZG=nU,UO=Object.getOwnPropertyDescriptor;$h.f=KG?UO:function(e,t){if(e=XG(e),t=JG(t),ZG)try{return UO(e,t)}catch{}if(QG(e,t))return qG(!zG(YG.f,e,t),e[t])};var $G=si,e4=Ui,t4=/#|\.prototype\./,tp=function(e,t){var i=r4[i4(e)];return i==n4||i!=a4&&(e4(t)?$G(t):!!t)},i4=tp.normalize=function(e){return String(e).replace(t4,".").toLowerCase()},r4=tp.data={},a4=tp.NATIVE="N",n4=tp.POLYFILL="P",sU=tp,s4=Za,o4=IE,c4=Oh(Oh.bind),ko=function(e,t){return s4(e),t===void 0?e:o4?c4(e,t):function(){return e.apply(t,arguments)}},$a={},oU=Ta&&si(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!=42}),l4=ia,d4=String,u4=TypeError,Nr=function(e){if(l4(e))return e;throw u4(d4(e)+" is not an object")},h4=Ta,p4=nU,f4=oU,Nf=Nr,xO=PE,_4=TypeError,IS=Object.defineProperty,E4=Object.getOwnPropertyDescriptor,OS="enumerable",wS="configurable",NS="writable";$a.f=h4?f4?function(e,t,i){if(Nf(e),t=xO(t),Nf(i),typeof e=="function"&&t==="prototype"&&"value"in i&&NS in i&&!i[NS]){var r=E4(e,t);r&&r[NS]&&(e[t]=i.value,i={configurable:wS in i?i[wS]:r[wS],enumerable:OS in i?i[OS]:r[OS],writable:!1})}return IS(e,t,i)}:IS:function(e,t,i){if(Nf(e),t=xO(t),Nf(i),p4)try{return IS(e,t,i)}catch{}if("get"in i||"set"in i)throw _4("Accessors not supported");return"value"in i&&(e[t]=i.value),e};var m4=$a,g4=Po,Mo=Ta?function(e,t,i){return m4.f(e,t,g4(1,i))}:function(e,t,i){return e[t]=i,e},Df=Mi,S4=cy,T4=Oh,R4=Ui,v4=$h.f,y4=sU,yl=Tn,C4=ko,Cl=Mo,VO=Gi,b4=function(e){var t=function(i,r,a){if(this instanceof t){switch(arguments.length){case 0:return new e;case 1:return new e(i);case 2:return new e(i,r)}return new e(i,r,a)}return S4(e,this,arguments)};return t.prototype=e.prototype,t},_t=function(e,t){var i,r,a,s,c,l,u,h,p,_=e.target,m=e.global,S=e.stat,C=e.proto,v=m?Df:S?Df[_]:(Df[_]||{}).prototype,y=m?yl:yl[_]||Cl(yl,_,{})[_],I=y.prototype;for(s in t)r=!(i=y4(m?s:_+(S?".":"#")+s,e.forced))&&v&&VO(v,s),l=y[s],r&&(u=e.dontCallGetSet?(p=v4(v,s))&&p.value:v[s]),c=r&&u?u:t[s],r&&typeof l==typeof c||(h=e.bind&&r?C4(c,Df):e.wrap&&r?b4(c):C&&R4(c)?T4(c):c,(e.sham||c&&c.sham||l&&l.sham)&&Cl(h,"sham",!0),Cl(y,s,h),C&&(VO(yl,a=_+"Prototype")||Cl(yl,a,{}),Cl(yl[a],s,c),e.real&&I&&(i||!I[s])&&Cl(I,s,c)))},A4=Math.ceil,I4=Math.floor,O4=Math.trunc||function(e){var t=+e;return(t>0?I4:A4)(t)},w4=O4,hy=function(e){var t=+e;return t!=t||t===0?0:w4(t)},N4=hy,D4=Math.max,P4=Math.min,py=function(e,t){var i=N4(e);return i<0?D4(i+t,0):P4(i,t)},L4=hy,k4=Math.min,cU=function(e){return e>0?k4(L4(e),9007199254740991):0},M4=cU,Ps=function(e){return M4(e.length)},U4=Lo,x4=py,V4=Ps,BO=function(e){return function(t,i,r){var a,s=U4(t),c=V4(s),l=x4(r,c);if(e&&i!=i){for(;c>l;)if((a=s[l++])!=a)return!0}else for(;c>l;l++)if((e||l in s)&&s[l]===i)return e||l||0;return!e&&-1}},fy={includes:BO(!0),indexOf:BO(!1)},B4=fy.includes;_t({target:"Array",proto:!0,forced:si(function(){return!Array(1).includes()})},{includes:function(e){return B4(this,e,arguments.length>1?arguments[1]:void 0)}});var j4=Tn,en=function(e){return j4[e+"Prototype"]},F4=en("Array").includes,G4=ia,H4=qn,W4=Zt("match"),lU=function(e){var t;return G4(e)&&((t=e[W4])!==void 0?!!t:H4(e)=="RegExp")},K4=lU,z4=TypeError,dU={};dU[Zt("toStringTag")]="z";var _y=String(dU)==="[object z]",Y4=_y,q4=Ui,b_=qn,X4=Zt("toStringTag"),J4=Object,Q4=b_(function(){return arguments}())=="Arguments",Jn=Y4?b_:function(e){var t,i,r;return e===void 0?"Undefined":e===null?"Null":typeof(i=function(a,s){try{return a[s]}catch{}}(t=J4(e),X4))=="string"?i:Q4?b_(t):(r=b_(t))=="Object"&&q4(t.callee)?"Arguments":r},Z4=Jn,$4=String,Ra=function(e){if(Z4(e)==="Symbol")throw TypeError("Cannot convert a Symbol value to a string");return $4(e)},e5=Zt("match"),t5=_t,i5=function(e){if(K4(e))throw z4("The method doesn't accept regular expressions");return e},r5=Ad,jO=Ra,a5=function(e){var t=/./;try{"/./"[e](t)}catch{try{return t[e5]=!1,"/./"[e](t)}catch{}}return!1},n5=ii("".indexOf);t5({target:"String",proto:!0,forced:!a5("includes")},{includes:function(e){return!!~n5(jO(r5(this)),jO(i5(e)),arguments.length>1?arguments[1]:void 0)}});var s5=en("String").includes,FO=_r,o5=F4,c5=s5,DS=Array.prototype,PS=String.prototype,l5=function(e){var t=e.includes;return e===DS||FO(DS,e)&&t===DS.includes?o5:typeof e=="string"||e===PS||FO(PS,e)&&t===PS.includes?c5:t},oe=zt(l5),d5=Za,u5=Xn,h5=NE,p5=Ps,f5=TypeError,_5=function(e){return function(t,i,r,a){d5(i);var s=u5(t),c=h5(s),l=p5(s),u=e?l-1:0,h=e?-1:1;if(r<2)for(;;){if(u in c){a=c[u],u+=h;break}if(u+=h,e?u<0:l<=u)throw f5("Reduce of empty array with no initial value")}for(;e?u>=0:l>u;u+=h)u in c&&(a=i(a,c[u],u,s));return a}},E5={left:_5(!1)},m5=si,LE=function(e,t){var i=[][e];return!!i&&m5(function(){i.call(null,t||function(){return 1},1)})},ip=typeof process<"u"&&qn(process)=="process",g5=E5.left;_t({target:"Array",proto:!0,forced:!ip&&Pc>79&&Pc<83||!LE("reduce")},{reduce:function(e){var t=arguments.length;return g5(this,e,t,t>1?arguments[1]:void 0)}});var S5=en("Array").reduce,T5=_r,R5=S5,LS=Array.prototype,v5=function(e){var t=e.reduce;return e===LS||T5(LS,e)&&t===LS.reduce?R5:t},uU=v5,Sn=zt(uU),hU=!0,pU=!0;function Pf(e,t,i){let r=e.match(t);return r&&r.length>=i&&parseInt(r[i],10)}function Vc(e,t,i){if(!e.RTCPeerConnection)return;let r=e.RTCPeerConnection.prototype,a=r.addEventListener;r.addEventListener=function(c,l){if(c!==t)return a.apply(this,arguments);let u=h=>{let p=i(h);p&&(l.handleEvent?l.handleEvent(p):l(p))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(l,u),a.apply(this,[c,u])};let s=r.removeEventListener;r.removeEventListener=function(c,l){if(c!==t||!this._eventMap||!this._eventMap[t])return s.apply(this,arguments);if(!this._eventMap[t].has(l))return s.apply(this,arguments);let u=this._eventMap[t].get(l);return this._eventMap[t].delete(l),this._eventMap[t].size===0&&delete this._eventMap[t],Object.keys(this._eventMap).length===0&&delete this._eventMap,s.apply(this,[c,u])},Object.defineProperty(r,"on"+t,{get(){return this["_on"+t]},set(c){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),c&&this.addEventListener(t,this["_on"+t]=c)},enumerable:!0,configurable:!0})}function y5(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(hU=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function C5(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(pU=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function fU(){if(typeof window=="object"){if(hU)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function Ey(e,t){pU&&console.warn(e+" is deprecated, please use "+t+" instead.")}function GO(e){return Object.prototype.toString.call(e)==="[object Object]"}function _U(e){var t;return GO(e)?Sn(t=Object.keys(e)).call(t,function(i,r){let a=GO(e[r]),s=a?_U(e[r]):e[r],c=a&&!Object.keys(s).length;return s===void 0||c?i:Object.assign(i,{[r]:s})},{}):e}function YR(e,t,i){t&&!i.has(t.id)&&(i.set(t.id,t),Object.keys(t).forEach(r=>{r.endsWith("Id")?YR(e,e.get(t[r]),i):r.endsWith("Ids")&&t[r].forEach(a=>{YR(e,e.get(a),i)})}))}function HO(e,t,i){let r=i?"outbound-rtp":"inbound-rtp",a=new Map;if(t===null)return a;let s=[];return e.forEach(c=>{c.type==="track"&&c.trackIdentifier===t.id&&s.push(c)}),s.forEach(c=>{e.forEach(l=>{l.type===r&&l.trackId===c.id&&YR(e,l,a)})}),a}var b5=dy,WO=wd("keys"),kE=function(e){return WO[e]||(WO[e]=b5(e))},A5=!si(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}),I5=Gi,O5=Ui,w5=Xn,N5=A5,KO=kE("IE_PROTO"),qR=Object,D5=qR.prototype,my=N5?qR.getPrototypeOf:function(e){var t=w5(e);if(I5(t,KO))return t[KO];var i=t.constructor;return O5(i)&&t instanceof i?i.prototype:t instanceof qR?D5:null},P5=ii,L5=Za,k5=Ui,M5=String,U5=TypeError,x5=function(e,t,i){try{return P5(L5(Object.getOwnPropertyDescriptor(e,t)[i]))}catch{}},V5=Nr,B5=function(e){if(typeof e=="object"||k5(e))return e;throw U5("Can't set "+M5(e)+" as a prototype")},j5=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,i={};try{(e=x5(Object.prototype,"__proto__","set"))(i,[]),t=i instanceof Array}catch{}return function(r,a){return V5(r),B5(a),t?e(r,a):r.__proto__=a,r}}():void 0),ME={},UE={},kS=Gi,F5=Lo,G5=fy.indexOf,H5=UE,zO=ii([].push),EU=function(e,t){var i,r=F5(e),a=0,s=[];for(i in r)!kS(H5,i)&&kS(r,i)&&zO(s,i);for(;t.length>a;)kS(r,i=t[a++])&&(~G5(s,i)||zO(s,i));return s},gy=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],W5=EU,K5=gy.concat("length","prototype");ME.f=Object.getOwnPropertyNames||function(e){return W5(e,K5)};var rp={};rp.f=Object.getOwnPropertySymbols;var z5=jr,Y5=ME,q5=rp,X5=Nr,J5=ii([].concat),Q5=z5("Reflect","ownKeys")||function(e){var t=Y5.f(X5(e)),i=q5.f;return i?J5(t,i(e)):t},YO=Gi,Z5=Q5,$5=$h,eH=$a,Sy={},tH=EU,iH=gy,xE=Object.keys||function(e){return tH(e,iH)},rH=Ta,aH=oU,nH=$a,sH=Nr,oH=Lo,cH=xE;Sy.f=rH&&!aH?Object.defineProperties:function(e,t){sH(e);for(var i,r=oH(t),a=cH(t),s=a.length,c=0;s>c;)nH.f(e,i=a[c++],r[i]);return e};var Lf,mU=jr("document","documentElement"),lH=Nr,dH=Sy,qO=gy,uH=UE,hH=mU,pH=uy,XR="prototype",JR="script",gU=kE("IE_PROTO"),MS=function(){},SU=function(e){return"<"+JR+">"+e+"</"+JR+">"},XO=function(e){e.write(SU("")),e.close();var t=e.parentWindow.Object;return e=null,t},A_=function(){try{Lf=new ActiveXObject("htmlfile")}catch{}var e,t,i;A_=typeof document<"u"?document.domain&&Lf?XO(Lf):(t=pH("iframe"),i="java"+JR+":",t.style.display="none",hH.appendChild(t),t.src=String(i),(e=t.contentWindow.document).open(),e.write(SU("document.F=Object")),e.close(),e.F):XO(Lf);for(var r=qO.length;r--;)delete A_[XR][qO[r]];return A_()};uH[gU]=!0;var ap=Object.create||function(e,t){var i;return e!==null?(MS[XR]=lH(e),i=new MS,MS[XR]=null,i[gU]=e):i=A_(),t===void 0?i:dH.f(i,t)},fH=ia,_H=Mo,TU=Error,EH=ii("".replace),mH=String(TU("zxcasd").stack),RU=/\n\s*at [^:]*:[^\n]*/,gH=RU.test(mH),SH=Po,TH=!si(function(){var e=Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",SH(1,7)),e.stack!==7)}),RH=Mo,vH=function(e,t){if(gH&&typeof e=="string"&&!TU.prepareStackTrace)for(;t--;)e=EH(e,RU,"");return e},yH=TH,JO=Error.captureStackTrace,Bc={},CH=Bc,bH=Zt("iterator"),AH=Array.prototype,vU=function(e){return e!==void 0&&(CH.Array===e||AH[bH]===e)},IH=Jn,QO=DE,OH=bd,wH=Bc,NH=Zt("iterator"),VE=function(e){if(!OH(e))return QO(e,NH)||QO(e,"@@iterator")||wH[IH(e)]},DH=xi,PH=Za,LH=Nr,kH=Od,MH=VE,UH=TypeError,Ty=function(e,t){var i=arguments.length<2?MH(e):t;if(PH(i))return LH(DH(i,e));throw UH(kH(e)+" is not iterable")},xH=xi,ZO=Nr,VH=DE,yU=function(e,t,i){var r,a;ZO(e);try{if(!(r=VH(e,"return"))){if(t==="throw")throw i;return i}r=xH(r,e)}catch(s){a=!0,r=s}if(t==="throw")throw i;if(a)throw r;return ZO(r),i},BH=ko,jH=xi,FH=Nr,GH=Od,HH=vU,WH=Ps,$O=_r,KH=Ty,zH=VE,ew=yU,YH=TypeError,I_=function(e,t){this.stopped=e,this.result=t},tw=I_.prototype,np=function(e,t,i){var r,a,s,c,l,u,h,p=i&&i.that,_=!(!i||!i.AS_ENTRIES),m=!(!i||!i.IS_RECORD),S=!(!i||!i.IS_ITERATOR),C=!(!i||!i.INTERRUPTED),v=BH(t,p),y=function(O){return r&&ew(r,"normal",O),new I_(!0,O)},I=function(O){return _?(FH(O),C?v(O[0],O[1],y):v(O[0],O[1])):C?v(O,y):v(O)};if(m)r=e.iterator;else if(S)r=e;else{if(!(a=zH(e)))throw YH(GH(e)+" is not iterable");if(HH(a)){for(s=0,c=WH(e);c>s;s++)if((l=I(e[s]))&&$O(tw,l))return l;return new I_(!1)}r=KH(e,a)}for(u=m?e.next:r.next;!(h=jH(u,r)).done;){try{l=I(h.value)}catch(O){ew(r,"throw",O)}if(typeof l=="object"&&l&&$O(tw,l))return l}return new I_(!1)},qH=Ra,XH=_t,JH=_r,QH=my,$_=j5,ZH=function(e,t,i){for(var r=Z5(t),a=eH.f,s=$5.f,c=0;c<r.length;c++){var l=r[c];YO(e,l)||i&&YO(i,l)||a(e,l,s(t,l))}},CU=ap,US=Mo,xS=Po,$H=function(e,t){fH(t)&&"cause"in t&&_H(e,"cause",t.cause)},e6=function(e,t,i,r){yH&&(JO?JO(e,t):RH(e,"stack",vH(i,r)))},t6=np,i6=function(e,t){return e===void 0?arguments.length<2?"":t:qH(e)},r6=Zt("toStringTag"),eE=Error,a6=[].push,pd=function(e,t){var i,r=JH(VS,this);$_?i=$_(eE(),r?QH(this):VS):(i=r?this:CU(VS),US(i,r6,"Error")),t!==void 0&&US(i,"message",i6(t)),e6(i,pd,i.stack,1),arguments.length>2&&$H(i,arguments[2]);var a=[];return t6(e,a6,{that:a}),US(i,"errors",a),i};$_?$_(pd,eE):ZH(pd,eE,{name:!0});var VS=pd.prototype=CU(eE.prototype,{constructor:xS(1,pd),message:xS(1,""),name:xS(1,"AggregateError")});XH({global:!0},{AggregateError:pd});var tE,_h,iE,n6=Ui,iw=Mi.WeakMap,s6=n6(iw)&&/native code/.test(String(iw)),bU=Mi,o6=ia,c6=Mo,BS=Gi,jS=ly,l6=kE,d6=UE,rw="Object already initialized",QR=bU.TypeError,u6=bU.WeakMap;s6||jS.state?(cn=jS.state||(jS.state=new u6),cn.get=cn.get,cn.has=cn.has,cn.set=cn.set,tE=function(e,t){if(cn.has(e))throw QR(rw);return t.facade=e,cn.set(e,t),t},_h=function(e){return cn.get(e)||{}},iE=function(e){return cn.has(e)}):(sc=l6("state"),d6[sc]=!0,tE=function(e,t){if(BS(e,sc))throw QR(rw);return t.facade=e,c6(e,sc,t),t},_h=function(e){return BS(e,sc)?e[sc]:{}},iE=function(e){return BS(e,sc)});var cn,sc,Oc,aw,nw,jc={set:tE,get:_h,has:iE,enforce:function(e){return iE(e)?_h(e):tE(e,{})},getterFor:function(e){return function(t){var i;if(!o6(t)||(i=_h(t)).type!==e)throw QR("Incompatible receiver, "+e+" required");return i}}},ZR=Ta,h6=Gi,AU=Function.prototype,p6=ZR&&Object.getOwnPropertyDescriptor,sw=h6(AU,"name"),IU={PROPER:sw&&(function(){}).name==="something",CONFIGURABLE:sw&&(!ZR||ZR&&p6(AU,"name").configurable)},f6=Mo,Uo=function(e,t,i,r){return r&&r.enumerable?e[t]=i:f6(e,t,i),e},_6=si,E6=Ui,m6=ia,g6=ap,ow=my,S6=Uo,$R=Zt("iterator"),OU=!1;[].keys&&("next"in(nw=[].keys())?(aw=ow(ow(nw)))!==Object.prototype&&(Oc=aw):OU=!0);var T6=!m6(Oc)||_6(function(){var e={};return Oc[$R].call(e)!==e});E6((Oc=T6?{}:g6(Oc))[$R])||S6(Oc,$R,function(){return this});var wU={IteratorPrototype:Oc,BUGGY_SAFARI_ITERATORS:OU},R6=Jn,v6=_y?{}.toString:function(){return"[object "+R6(this)+"]"},y6=_y,C6=$a.f,b6=Mo,A6=Gi,I6=v6,cw=Zt("toStringTag"),xo=function(e,t,i,r){if(e){var a=i?e:e.prototype;A6(a,cw)||C6(a,cw,{configurable:!0,value:t}),r&&!y6&&b6(a,"toString",I6)}},O6=wU.IteratorPrototype,w6=ap,N6=Po,D6=xo,P6=Bc,L6=function(){return this},Ry=function(e,t,i,r){var a=t+" Iterator";return e.prototype=w6(O6,{next:N6(+!r,i)}),D6(e,a,!1,!0),P6[a]=L6,e},k6=_t,M6=xi,U6=IU,x6=Ry,V6=my,B6=xo,lw=Uo,dw=Bc,j6=wU,F6=U6.PROPER,kf=j6.BUGGY_SAFARI_ITERATORS,FS=Zt("iterator"),uw="keys",Mf="values",hw="entries",G6=function(){return this},NU=function(e,t,i,r,a,s,c){x6(i,t,r);var l,u,h,p=function(I){if(I===a&&v)return v;if(!kf&&I in S)return S[I];switch(I){case uw:case Mf:case hw:return function(){return new i(this,I)}}return function(){return new i(this)}},_=t+" Iterator",m=!1,S=e.prototype,C=S[FS]||S["@@iterator"]||a&&S[a],v=!kf&&C||p(a),y=t=="Array"&&S.entries||C;if(y&&(l=V6(y.call(new e)))!==Object.prototype&&l.next&&(B6(l,_,!0,!0),dw[_]=G6),F6&&a==Mf&&C&&C.name!==Mf&&(m=!0,v=function(){return M6(C,this)}),a)if(u={values:p(Mf),keys:s?v:p(uw),entries:p(hw)},c)for(h in u)(kf||m||!(h in S))&&lw(S,h,u[h]);else k6({target:t,proto:!0,forced:kf||m},u);return c&&S[FS]!==v&&lw(S,FS,v,{}),dw[t]=v,u},vy=function(e,t){return{value:e,done:t}},H6=Lo,pw=Bc,DU=jc;$a.f;var W6=NU,fw=vy,PU="Array Iterator",K6=DU.set,z6=DU.getterFor(PU);W6(Array,"Array",function(e,t){K6(this,{type:PU,target:H6(e),index:0,kind:t})},function(){var e=z6(this),t=e.target,i=e.kind,r=e.index++;return!t||r>=t.length?(e.target=void 0,fw(void 0,!0)):fw(i=="keys"?r:i=="values"?t[r]:[r,t[r]],!1)},"values"),pw.Arguments=pw.Array;var Y6=$a,BE=function(e,t,i){return Y6.f(e,t,i)},q6=jr,X6=BE,J6=Ta,_w=Zt("species"),Q6=_r,Z6=TypeError,yy=function(e,t){if(Q6(t,e))return e;throw Z6("Incorrect invocation")},$6=Ui,ev=ly,e8=ii(Function.toString);$6(ev.inspectSource)||(ev.inspectSource=function(e){return e8(e)});var LU=ev.inspectSource,t8=ii,i8=si,kU=Ui,r8=Jn,a8=LU,MU=function(){},n8=[],UU=jr("Reflect","construct"),Cy=/^\s*(?:class|function)\b/,s8=t8(Cy.exec),o8=!Cy.exec(MU),Vu=function(e){if(!kU(e))return!1;try{return UU(MU,n8,e),!0}catch{return!1}},xU=function(e){if(!kU(e))return!1;switch(r8(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return o8||!!s8(Cy,a8(e))}catch{return!0}};xU.sham=!0;var wh,bl,Ew,GS,jE=!UU||i8(function(){var e;return Vu(Vu.call)||!Vu(Object)||!Vu(function(){e=!0})||e})?xU:Vu,c8=jE,l8=Od,d8=TypeError,mw=Nr,u8=function(e){if(c8(e))return e;throw d8(l8(e)+" is not a constructor")},h8=bd,p8=Zt("species"),by=function(e,t){var i,r=mw(e).constructor;return r===void 0||h8(i=mw(r)[p8])?t:u8(i)},Ay=ii([].slice),f8=TypeError,FE=function(e,t){if(e<t)throw f8("Not enough arguments");return e},VU=/(?:ipad|iphone|ipod).*applewebkit/i.test(xc),ma=Mi,_8=cy,E8=ko,gw=Ui,m8=Gi,BU=si,Sw=mU,g8=Ay,Tw=uy,S8=FE,T8=VU,R8=ip,tv=ma.setImmediate,Rw=ma.clearImmediate,v8=ma.process,HS=ma.Dispatch,y8=ma.Function,vw=ma.MessageChannel,C8=ma.String,WS=0,Eh={},yw="onreadystatechange";BU(function(){wh=ma.location});var Iy=function(e){if(m8(Eh,e)){var t=Eh[e];delete Eh[e],t()}},KS=function(e){return function(){Iy(e)}},Cw=function(e){Iy(e.data)},bw=function(e){ma.postMessage(C8(e),wh.protocol+"//"+wh.host)};tv&&Rw||(tv=function(e){S8(arguments.length,1);var t=gw(e)?e:y8(e),i=g8(arguments,1);return Eh[++WS]=function(){_8(t,void 0,i)},bl(WS),WS},Rw=function(e){delete Eh[e]},R8?bl=function(e){v8.nextTick(KS(e))}:HS&&HS.now?bl=function(e){HS.now(KS(e))}:vw&&!T8?(GS=(Ew=new vw).port2,Ew.port1.onmessage=Cw,bl=E8(GS.postMessage,GS)):ma.addEventListener&&gw(ma.postMessage)&&!ma.importScripts&&wh&&wh.protocol!=="file:"&&!BU(bw)?(bl=bw,ma.addEventListener("message",Cw,!1)):bl=yw in Tw("script")?function(e){Sw.appendChild(Tw("script"))[yw]=function(){Sw.removeChild(this),Iy(e)}}:function(e){setTimeout(KS(e),0)});var jU={set:tv},FU=function(){this.head=null,this.tail=null};FU.prototype={add:function(e){var t={item:e,next:null},i=this.tail;i?i.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return(this.head=e.next)===null&&(this.tail=null),e.item}};var Al,zS,YS,qS,Aw,GU=FU,b8=/ipad|iphone|ipod/i.test(xc)&&typeof Pebble<"u",A8=/web0s(?!.*chrome)/i.test(xc),Lc=Mi,Iw=ko,I8=$h.f,XS=jU.set,O8=GU,w8=VU,N8=b8,D8=A8,JS=ip,Ow=Lc.MutationObserver||Lc.WebKitMutationObserver,ww=Lc.document,Nw=Lc.process,Uf=Lc.Promise,Dw=I8(Lc,"queueMicrotask"),iv=Dw&&Dw.value;iv||(Bu=new O8,ju=function(){var e,t;for(JS&&(e=Nw.domain)&&e.exit();t=Bu.get();)try{t()}catch(i){throw Bu.head&&Al(),i}e&&e.enter()},w8||JS||D8||!Ow||!ww?!N8&&Uf&&Uf.resolve?((qS=Uf.resolve(void 0)).constructor=Uf,Aw=Iw(qS.then,qS),Al=function(){Aw(ju)}):JS?Al=function(){Nw.nextTick(ju)}:(XS=Iw(XS,Lc),Al=function(){XS(ju)}):(zS=!0,YS=ww.createTextNode(""),new Ow(ju).observe(YS,{characterData:!0}),Al=function(){YS.data=zS=!zS}),iv=function(e){Bu.head||Al(),Bu.add(e)});var Bu,ju,P8=iv,Nd=function(e){try{return{error:!1,value:e()}}catch(t){return{error:!0,value:t}}},kc=Mi.Promise,HU=typeof Deno=="object"&&Deno&&typeof Deno.version=="object",L8=!HU&&!ip&&typeof window=="object"&&typeof document=="object",k8=Mi,mh=kc,M8=Ui,U8=sU,x8=LU,V8=Zt,B8=L8,j8=HU,QS=Pc,Pw=mh&&mh.prototype,F8=V8("species"),WU=M8(k8.PromiseRejectionEvent),G8=U8("Promise",function(){var e=x8(mh),t=e!==String(mh);if(!t&&QS===66||!Pw.catch||!Pw.finally)return!0;if(!QS||QS<51||!/native code/.test(e)){var i=new mh(function(a){a(1)}),r=function(a){a(function(){},function(){})};if((i.constructor={})[F8]=r,!(i.then(function(){})instanceof r))return!0}return!t&&(B8||j8)&&!WU}),sp={CONSTRUCTOR:G8,REJECTION_EVENT:WU},Qn={},Lw=Za,H8=TypeError,W8=function(e){var t,i;this.promise=new e(function(r,a){if(t!==void 0||i!==void 0)throw H8("Bad Promise constructor");t=r,i=a}),this.resolve=Lw(t),this.reject=Lw(i)};Qn.f=function(e){return new W8(e)};var ZS,kw,K8=_t,rE=ip,wo=Mi,op=xi,z8=Uo,Y8=xo,q8=function(e){var t=q6(e);J6&&t&&!t[_w]&&X6(t,_w,{configurable:!0,get:function(){return this}})},X8=Za,rv=Ui,J8=ia,Q8=yy,Z8=by,KU=jU.set,Oy=P8,$8=function(e,t){try{arguments.length==1?console.error(e):console.error(e,t)}catch{}},eW=Nd,tW=GU,zU=jc,av=kc,YU=sp,qU=Qn,O_="Promise",Mw=YU.CONSTRUCTOR,iW=YU.REJECTION_EVENT,$S=zU.getterFor(O_),rW=zU.set,aW=av&&av.prototype,Fu=av,eT=aW,XU=wo.TypeError,nv=wo.document,wy=wo.process,sv=qU.f,nW=sv,sW=!!(nv&&nv.createEvent&&wo.dispatchEvent),JU="unhandledrejection",QU=function(e){var t;return!(!J8(e)||!rv(t=e.then))&&t},ZU=function(e,t){var i,r,a,s=t.value,c=t.state==1,l=c?e.ok:e.fail,u=e.resolve,h=e.reject,p=e.domain;try{l?(c||(t.rejection===2&&cW(t),t.rejection=1),l===!0?i=s:(p&&p.enter(),i=l(s),p&&(p.exit(),a=!0)),i===e.promise?h(XU("Promise-chain cycle")):(r=QU(i))?op(r,i,u,h):u(i)):h(s)}catch(_){p&&!a&&p.exit(),h(_)}},$U=function(e,t){e.notified||(e.notified=!0,Oy(function(){for(var i,r=e.reactions;i=r.get();)ZU(i,e);e.notified=!1,t&&!e.rejection&&oW(e)}))},e2=function(e,t,i){var r,a;sW?((r=nv.createEvent("Event")).promise=t,r.reason=i,r.initEvent(e,!1,!0),wo.dispatchEvent(r)):r={promise:t,reason:i},!iW&&(a=wo["on"+e])?a(r):e===JU&&$8("Unhandled promise rejection",i)},oW=function(e){op(KU,wo,function(){var t,i=e.facade,r=e.value;if(Uw(e)&&(t=eW(function(){rE?wy.emit("unhandledRejection",r,i):e2(JU,i,r)}),e.rejection=rE||Uw(e)?2:1,t.error))throw t.value})},Uw=function(e){return e.rejection!==1&&!e.parent},cW=function(e){op(KU,wo,function(){var t=e.facade;rE?wy.emit("rejectionHandled",t):e2("rejectionhandled",t,e.value)})},Yl=function(e,t,i){return function(r){e(t,r,i)}},ad=function(e,t,i){e.done||(e.done=!0,i&&(e=i),e.value=t,e.state=2,$U(e,!0))},ov=function(e,t,i){if(!e.done){e.done=!0,i&&(e=i);try{if(e.facade===t)throw XU("Promise can't be resolved itself");var r=QU(t);r?Oy(function(){var a={done:!1};try{op(r,t,Yl(ov,a,e),Yl(ad,a,e))}catch(s){ad(a,s,e)}}):(e.value=t,e.state=1,$U(e,!1))}catch(a){ad({done:!1},a,e)}}};Mw&&(eT=(Fu=function(e){Q8(this,eT),X8(e),op(ZS,this);var t=$S(this);try{e(Yl(ov,t),Yl(ad,t))}catch(i){ad(t,i)}}).prototype,(ZS=function(e){rW(this,{type:O_,done:!1,notified:!1,parent:!1,reactions:new tW,rejection:!1,state:0,value:void 0})}).prototype=z8(eT,"then",function(e,t){var i=$S(this),r=sv(Z8(this,Fu));return i.parent=!0,r.ok=!rv(e)||e,r.fail=rv(t)&&t,r.domain=rE?wy.domain:void 0,i.state==0?i.reactions.add(r):Oy(function(){ZU(r,i)}),r.promise}),kw=function(){var e=new ZS,t=$S(e);this.promise=e,this.resolve=Yl(ov,t),this.reject=Yl(ad,t)},qU.f=sv=function(e){return e===Fu||e===void 0?new kw(e):nW(e)}),K8({global:!0,wrap:!0,forced:Mw},{Promise:Fu}),Y8(Fu,O_,!1,!0),q8(O_);var t2=Zt("iterator"),i2=!1;try{xw=0,tT={next:function(){return{done:!!xw++}},return:function(){i2=!0}},tT[t2]=function(){return this},Array.from(tT,function(){throw 2})}catch{}var xw,tT,lW=kc,dW=function(e,t){if(!i2)return!1;var i=!1;try{var r={};r[t2]=function(){return{next:function(){return{done:i=!0}}}},e(r)}catch{}return i},GE=sp.CONSTRUCTOR||!dW(function(e){lW.all(e).then(void 0,function(){})}),uW=xi,hW=Za,pW=Qn,fW=Nd,_W=np;_t({target:"Promise",stat:!0,forced:GE},{all:function(e){var t=this,i=pW.f(t),r=i.resolve,a=i.reject,s=fW(function(){var c=hW(t.resolve),l=[],u=0,h=1;_W(e,function(p){var _=u++,m=!1;h++,uW(c,t,p).then(function(S){m||(m=!0,l[_]=S,--h||r(l))},a)}),--h||r(l)});return s.error&&a(s.value),i.promise}});var EW=_t,mW=sp.CONSTRUCTOR;kc&&kc.prototype,EW({target:"Promise",proto:!0,forced:mW,real:!0},{catch:function(e){return this.then(void 0,e)}});var gW=xi,SW=Za,TW=Qn,RW=Nd,vW=np;_t({target:"Promise",stat:!0,forced:GE},{race:function(e){var t=this,i=TW.f(t),r=i.reject,a=RW(function(){var s=SW(t.resolve);vW(e,function(c){gW(s,t,c).then(i.resolve,r)})});return a.error&&r(a.value),i.promise}});var yW=xi,CW=Qn;_t({target:"Promise",stat:!0,forced:sp.CONSTRUCTOR},{reject:function(e){var t=CW.f(this);return yW(t.reject,void 0,e),t.promise}});var bW=Nr,AW=ia,IW=Qn,r2=function(e,t){if(bW(e),AW(t)&&t.constructor===e)return t;var i=IW.f(e);return(0,i.resolve)(t),i.promise},OW=_t,wW=kc,NW=sp.CONSTRUCTOR,DW=r2,PW=jr("Promise"),LW=!NW;OW({target:"Promise",stat:!0,forced:!0},{resolve:function(e){return DW(LW&&this===PW?wW:this,e)}});var kW=xi,MW=Za,UW=Qn,xW=Nd,VW=np;_t({target:"Promise",stat:!0,forced:GE},{allSettled:function(e){var t=this,i=UW.f(t),r=i.resolve,a=i.reject,s=xW(function(){var c=MW(t.resolve),l=[],u=0,h=1;VW(e,function(p){var _=u++,m=!1;h++,kW(c,t,p).then(function(S){m||(m=!0,l[_]={status:"fulfilled",value:S},--h||r(l))},function(S){m||(m=!0,l[_]={status:"rejected",reason:S},--h||r(l))})}),--h||r(l)});return s.error&&a(s.value),i.promise}});var BW=xi,jW=Za,FW=jr,GW=Qn,HW=Nd,WW=np,Vw="No one promise resolved";_t({target:"Promise",stat:!0,forced:GE},{any:function(e){var t=this,i=FW("AggregateError"),r=GW.f(t),a=r.resolve,s=r.reject,c=HW(function(){var l=jW(t.resolve),u=[],h=0,p=1,_=!1;WW(e,function(m){var S=h++,C=!1;p++,BW(l,t,m).then(function(v){C||_||(_=!0,a(v))},function(v){C||_||(C=!0,u[S]=v,--p||s(new i(u,Vw)))})}),--p||s(new i(u,Vw))});return c.error&&s(c.value),r.promise}});var KW=_t,cv=kc,zW=si,YW=jr,qW=Ui,XW=by,Bw=r2,JW=cv&&cv.prototype;KW({target:"Promise",proto:!0,real:!0,forced:!!cv&&zW(function(){JW.finally.call({then:function(){}},function(){})})},{finally:function(e){var t=XW(this,YW("Promise")),i=qW(e);return this.then(i?function(r){return Bw(t,e()).then(function(){return r})}:e,i?function(r){return Bw(t,e()).then(function(){throw r})}:e)}});var Ny=ii,QW=hy,ZW=Ra,$W=Ad,eK=Ny("".charAt),jw=Ny("".charCodeAt),tK=Ny("".slice),Fw=function(e){return function(t,i){var r,a,s=ZW($W(t)),c=QW(i),l=s.length;return c<0||c>=l?e?"":void 0:(r=jw(s,c))<55296||r>56319||c+1===l||(a=jw(s,c+1))<56320||a>57343?e?eK(s,c):r:e?tK(s,c,c+2):a-56320+(r-55296<<10)+65536}},Dy={codeAt:Fw(!1),charAt:Fw(!0)},iK=Dy.charAt,rK=Ra,a2=jc,aK=NU,Gw=vy,n2="String Iterator",nK=a2.set,sK=a2.getterFor(n2);aK(String,"String",function(e){nK(this,{type:n2,string:rK(e),index:0})},function(){var e,t=sK(this),i=t.string,r=t.index;return r>=i.length?Gw(void 0,!0):(e=iK(i,r),t.index+=e.length,Gw(e,!1))});var oK=Tn.Promise,cK={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},lK=Mi,dK=Jn,uK=Mo,Hw=Bc,Ww=Zt("toStringTag");for(Vf in cK)iT=lK[Vf],xf=iT&&iT.prototype,xf&&dK(xf)!==Ww&&uK(xf,Ww,Vf),Hw[Vf]=Hw.Array;var iT,xf,Vf,s2=oK,ae=zt(s2),Kw=fU;function o2(e,t){let i=e&&e.navigator;if(!i.mediaDevices)return;let r=function(c){if(typeof c!="object"||c.mandatory||c.optional)return c;let l={};return Object.keys(c).forEach(u=>{if(u==="require"||u==="advanced"||u==="mediaSource")return;let h=typeof c[u]=="object"?c[u]:{ideal:c[u]};h.exact!==void 0&&typeof h.exact=="number"&&(h.min=h.max=h.exact);let p=function(_,m){return _?_+m.charAt(0).toUpperCase()+m.slice(1):m==="deviceId"?"sourceId":m};if(h.ideal!==void 0){l.optional=l.optional||[];let _={};typeof h.ideal=="number"?(_[p("min",u)]=h.ideal,l.optional.push(_),_={},_[p("max",u)]=h.ideal,l.optional.push(_)):(_[p("",u)]=h.ideal,l.optional.push(_))}h.exact!==void 0&&typeof h.exact!="number"?(l.mandatory=l.mandatory||{},l.mandatory[p("",u)]=h.exact):["min","max"].forEach(_=>{h[_]!==void 0&&(l.mandatory=l.mandatory||{},l.mandatory[p(_,u)]=h[_])})}),c.advanced&&(l.optional=(l.optional||[]).concat(c.advanced)),l},a=function(c,l){if(t.version>=61)return l(c);if((c=JSON.parse(JSON.stringify(c)))&&typeof c.audio=="object"){let u=function(h,p,_){p in h&&!(_ in h)&&(h[_]=h[p],delete h[p])};u((c=JSON.parse(JSON.stringify(c))).audio,"autoGainControl","googAutoGainControl"),u(c.audio,"noiseSuppression","googNoiseSuppression"),c.audio=r(c.audio)}if(c&&typeof c.video=="object"){let u=c.video.facingMode;u=u&&(typeof u=="object"?u:{ideal:u});let h=t.version<66;if(u&&(u.exact==="user"||u.exact==="environment"||u.ideal==="user"||u.ideal==="environment")&&(!i.mediaDevices.getSupportedConstraints||!i.mediaDevices.getSupportedConstraints().facingMode||h)){let p;if(delete c.video.facingMode,u.exact==="environment"||u.ideal==="environment"?p=["back","rear"]:u.exact!=="user"&&u.ideal!=="user"||(p=["front"]),p)return i.mediaDevices.enumerateDevices().then(_=>{let m=(_=_.filter(S=>S.kind==="videoinput")).find(S=>p.some(C=>{var v;return oe(v=S.label.toLowerCase()).call(v,C)}));return!m&&_.length&&oe(p).call(p,"back")&&(m=_[_.length-1]),m&&(c.video.deviceId=u.exact?{exact:m.deviceId}:{ideal:m.deviceId}),c.video=r(c.video),Kw("chrome: "+JSON.stringify(c)),l(c)})}c.video=r(c.video)}return Kw("chrome: "+JSON.stringify(c)),l(c)},s=function(c){return t.version>=64?c:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[c.name]||c.name,message:c.message,constraint:c.constraint||c.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(i.getUserMedia=(function(c,l,u){a(c,h=>{i.webkitGetUserMedia(h,l,p=>{u&&u(s(p))})})}).bind(i),i.mediaDevices.getUserMedia){let c=i.mediaDevices.getUserMedia.bind(i.mediaDevices);i.mediaDevices.getUserMedia=function(l){return a(l,u=>c(u).then(h=>{if(u.audio&&!h.getAudioTracks().length||u.video&&!h.getVideoTracks().length)throw h.getTracks().forEach(p=>{p.stop()}),new DOMException("","NotFoundError");return h},h=>ae.reject(s(h))))}}}function c2(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function l2(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(i){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=i)},enumerable:!0,configurable:!0});let t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=i=>{i.stream.addEventListener("addtrack",r=>{let a;a=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(c=>c.track&&c.track.id===r.track.id):{track:r.track};let s=new Event("track");s.track=r.track,s.receiver=a,s.transceiver={receiver:a},s.streams=[i.stream],this.dispatchEvent(s)}),i.stream.getTracks().forEach(r=>{let a;a=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(c=>c.track&&c.track.id===r.id):{track:r};let s=new Event("track");s.track=r,s.receiver=a,s.transceiver={receiver:a},s.streams=[i.stream],this.dispatchEvent(s)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else Vc(e,"track",t=>(t.transceiver||Object.defineProperty(t,"transceiver",{value:{receiver:t.receiver}}),t))}function d2(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){let t=function(a,s){return{track:s,get dtmf(){return this._dtmf===void 0&&(s.kind==="audio"?this._dtmf=a.createDTMFSender(s):this._dtmf=null),this._dtmf},_pc:a}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};let a=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(c,l){let u=a.apply(this,arguments);return u||(u=t(this,c),this._senders.push(u)),u};let s=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(c){s.apply(this,arguments);let l=this._senders.indexOf(c);l!==-1&&this._senders.splice(l,1)}}let i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(a){this._senders=this._senders||[],i.apply(this,[a]),a.getTracks().forEach(s=>{this._senders.push(t(this,s))})};let r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(a){this._senders=this._senders||[],r.apply(this,[a]),a.getTracks().forEach(s=>{let c=this._senders.find(l=>l.track===s);c&&this._senders.splice(this._senders.indexOf(c),1)})}}else if(typeof e=="object"&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){let t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){let i=t.apply(this,[]);return i.forEach(r=>r._pc=this),i},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function u2(e){if(!e.RTCPeerConnection)return;let t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){let[i,r,a]=arguments;if(arguments.length>0&&typeof i=="function")return t.apply(this,arguments);if(t.length===0&&(arguments.length===0||typeof i!="function"))return t.apply(this,[]);let s=function(l){let u={};return l.result().forEach(h=>{let p={id:h.id,timestamp:h.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[h.type]||h.type};h.names().forEach(_=>{p[_]=h.stat(_)}),u[p.id]=p}),u},c=function(l){return new Map(Object.keys(l).map(u=>[u,l[u]]))};if(arguments.length>=2){let l=function(u){r(c(s(u)))};return t.apply(this,[l,i])}return new ae((l,u)=>{t.apply(this,[function(h){l(c(s(h)))},u])}).then(r,a)}}function h2(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){let i=e.RTCPeerConnection.prototype.getSenders;i&&(e.RTCPeerConnection.prototype.getSenders=function(){let a=i.apply(this,[]);return a.forEach(s=>s._pc=this),a});let r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){let a=r.apply(this,arguments);return a._pc=this,a}),e.RTCRtpSender.prototype.getStats=function(){let a=this;return this._pc.getStats().then(s=>HO(s,a.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){let i=e.RTCPeerConnection.prototype.getReceivers;i&&(e.RTCPeerConnection.prototype.getReceivers=function(){let r=i.apply(this,[]);return r.forEach(a=>a._pc=this),r}),Vc(e,"track",r=>(r.receiver._pc=r.srcElement,r)),e.RTCRtpReceiver.prototype.getStats=function(){let r=this;return this._pc.getStats().then(a=>HO(a,r.track,!1))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;let t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){let i=arguments[0],r,a,s;return this.getSenders().forEach(c=>{c.track===i&&(r?s=!0:r=c)}),this.getReceivers().forEach(c=>(c.track===i&&(a?s=!0:a=c),c.track===i)),s||r&&a?ae.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):r?r.getStats():a?a.getStats():ae.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function p2(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(s=>this._shimmedLocalStreams[s][0])};let t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(s,c){if(!c)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};let l=t.apply(this,arguments);return this._shimmedLocalStreams[c.id]?this._shimmedLocalStreams[c.id].indexOf(l)===-1&&this._shimmedLocalStreams[c.id].push(l):this._shimmedLocalStreams[c.id]=[c,l],l};let i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(s){this._shimmedLocalStreams=this._shimmedLocalStreams||{},s.getTracks().forEach(u=>{if(this.getSenders().find(h=>h.track===u))throw new DOMException("Track already exists.","InvalidAccessError")});let c=this.getSenders();i.apply(this,arguments);let l=this.getSenders().filter(u=>c.indexOf(u)===-1);this._shimmedLocalStreams[s.id]=[s].concat(l)};let r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(s){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[s.id],r.apply(this,arguments)};let a=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(s){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},s&&Object.keys(this._shimmedLocalStreams).forEach(c=>{let l=this._shimmedLocalStreams[c].indexOf(s);l!==-1&&this._shimmedLocalStreams[c].splice(l,1),this._shimmedLocalStreams[c].length===1&&delete this._shimmedLocalStreams[c]}),a.apply(this,arguments)}}function f2(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return p2(e);let i=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){let u=i.apply(this);return this._reverseStreams=this._reverseStreams||{},u.map(h=>this._reverseStreams[h.id])};let r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(u){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},u.getTracks().forEach(h=>{if(this.getSenders().find(p=>p.track===h))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[u.id]){let h=new e.MediaStream(u.getTracks());this._streams[u.id]=h,this._reverseStreams[h.id]=u,u=h}r.apply(this,[u])};let a=e.RTCPeerConnection.prototype.removeStream;function s(u,h){let p=h.sdp;return Object.keys(u._reverseStreams||[]).forEach(_=>{let m=u._reverseStreams[_],S=u._streams[m.id];p=p.replace(new RegExp(S.id,"g"),m.id)}),new RTCSessionDescription({type:h.type,sdp:p})}e.RTCPeerConnection.prototype.removeStream=function(u){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},a.apply(this,[this._streams[u.id]||u]),delete this._reverseStreams[this._streams[u.id]?this._streams[u.id].id:u.id],delete this._streams[u.id]},e.RTCPeerConnection.prototype.addTrack=function(u,h){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");let p=[].slice.call(arguments,1);if(p.length!==1||!p[0].getTracks().find(m=>m===u))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(m=>m.track===u))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};let _=this._streams[h.id];if(_)_.addTrack(u),ae.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{let m=new e.MediaStream([u]);this._streams[h.id]=m,this._reverseStreams[m.id]=h,this.addStream(m)}return this.getSenders().find(m=>m.track===u)},["createOffer","createAnswer"].forEach(function(u){let h=e.RTCPeerConnection.prototype[u],p={[u](){let _=arguments;return arguments.length&&typeof arguments[0]=="function"?h.apply(this,[m=>{let S=s(this,m);_[0].apply(null,[S])},m=>{_[1]&&_[1].apply(null,m)},arguments[2]]):h.apply(this,arguments).then(m=>s(this,m))}};e.RTCPeerConnection.prototype[u]=p[u]});let c=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(u,h){let p=h.sdp;return Object.keys(u._reverseStreams||[]).forEach(_=>{let m=u._reverseStreams[_],S=u._streams[m.id];p=p.replace(new RegExp(m.id,"g"),S.id)}),new RTCSessionDescription({type:h.type,sdp:p})}(this,arguments[0]),c.apply(this,arguments)):c.apply(this,arguments)};let l=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){let u=l.get.apply(this);return u.type===""?u:s(this,u)}}),e.RTCPeerConnection.prototype.removeTrack=function(u){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!u._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(u._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let h;this._streams=this._streams||{},Object.keys(this._streams).forEach(p=>{this._streams[p].getTracks().find(_=>u.track===_)&&(h=this._streams[p])}),h&&(h.getTracks().length===1?this.removeStream(this._reverseStreams[h.id]):h.removeTrack(u.track),this.dispatchEvent(new Event("negotiationneeded")))}}function lv(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(i){let r=e.RTCPeerConnection.prototype[i],a={[i](){return arguments[0]=new(i==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}};e.RTCPeerConnection.prototype[i]=a[i]})}function _2(e,t){Vc(e,"negotiationneeded",i=>{let r=i.target;if(!(t.version<72||r.getConfiguration&&r.getConfiguration().sdpSemantics==="plan-b")||r.signalingState==="stable")return i})}var zw=Object.freeze({__proto__:null,fixNegotiationNeeded:_2,shimAddTrackRemoveTrack:f2,shimAddTrackRemoveTrackWithNative:p2,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(typeof t=="function"?e.navigator.mediaDevices.getDisplayMedia=function(i){return t(i).then(r=>{let a=i.video&&i.video.width,s=i.video&&i.video.height,c=i.video&&i.video.frameRate;return i.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:r,maxFrameRate:c||3}},a&&(i.video.mandatory.maxWidth=a),s&&(i.video.mandatory.maxHeight=s),e.navigator.mediaDevices.getUserMedia(i)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:d2,shimGetStats:u2,shimGetUserMedia:o2,shimMediaStream:c2,shimOnTrack:l2,shimPeerConnection:lv,shimSenderReceiverGetStats:h2});function E2(e,t){let i=e&&e.navigator,r=e&&e.MediaStreamTrack;if(i.getUserMedia=function(a,s,c){Ey("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),i.mediaDevices.getUserMedia(a).then(s,c)},!(t.version>55&&"autoGainControl"in i.mediaDevices.getSupportedConstraints())){let a=function(c,l,u){l in c&&!(u in c)&&(c[u]=c[l],delete c[l])},s=i.mediaDevices.getUserMedia.bind(i.mediaDevices);if(i.mediaDevices.getUserMedia=function(c){return typeof c=="object"&&typeof c.audio=="object"&&(c=JSON.parse(JSON.stringify(c)),a(c.audio,"autoGainControl","mozAutoGainControl"),a(c.audio,"noiseSuppression","mozNoiseSuppression")),s(c)},r&&r.prototype.getSettings){let c=r.prototype.getSettings;r.prototype.getSettings=function(){let l=c.apply(this,arguments);return a(l,"mozAutoGainControl","autoGainControl"),a(l,"mozNoiseSuppression","noiseSuppression"),l}}if(r&&r.prototype.applyConstraints){let c=r.prototype.applyConstraints;r.prototype.applyConstraints=function(l){return this.kind==="audio"&&typeof l=="object"&&(l=JSON.parse(JSON.stringify(l)),a(l,"autoGainControl","mozAutoGainControl"),a(l,"noiseSuppression","mozNoiseSuppression")),c.apply(this,[l])}}}}function m2(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function dv(e,t){if(typeof e!="object"||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(a){let s=e.RTCPeerConnection.prototype[a],c={[a](){return arguments[0]=new(a==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),s.apply(this,arguments)}};e.RTCPeerConnection.prototype[a]=c[a]});let i={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){let[a,s,c]=arguments;return r.apply(this,[a||null]).then(l=>{if(t.version<53&&!s)try{l.forEach(u=>{u.type=i[u.type]||u.type})}catch(u){if(u.name!=="TypeError")throw u;l.forEach((h,p)=>{l.set(p,Object.assign({},h,{type:i[h.type]||h.type}))})}return l}).then(s,c)}}function g2(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;let t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){let r=t.apply(this,[]);return r.forEach(a=>a._pc=this),r});let i=e.RTCPeerConnection.prototype.addTrack;i&&(e.RTCPeerConnection.prototype.addTrack=function(){let r=i.apply(this,arguments);return r._pc=this,r}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):ae.resolve(new Map)}}function S2(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;let t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){let i=t.apply(this,[]);return i.forEach(r=>r._pc=this),i}),Vc(e,"track",i=>(i.receiver._pc=i.srcElement,i)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function T2(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(t){Ey("removeStream","removeTrack"),this.getSenders().forEach(i=>{var r;i.track&&oe(r=t.getTracks()).call(r,i.track)&&this.removeTrack(i)})})}function R2(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function v2(e){if(typeof e!="object"||!e.RTCPeerConnection)return;let t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let i=arguments[1]&&arguments[1].sendEncodings;i===void 0&&(i=[]),i=[...i];let r=i.length>0;r&&i.forEach(s=>{if("rid"in s&&!/^[a-z0-9]{0,16}$/i.test(s.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in s&&!(parseFloat(s.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in s&&!(parseFloat(s.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});let a=t.apply(this,arguments);if(r){let{sender:s}=a,c=s.getParameters();(!("encodings"in c)||c.encodings.length===1&&Object.keys(c.encodings[0]).length===0)&&(c.encodings=i,s.sendEncodings=i,this.setParametersPromises.push(s.setParameters(c).then(()=>{delete s.sendEncodings}).catch(()=>{delete s.sendEncodings})))}return a})}function y2(e){if(typeof e!="object"||!e.RTCRtpSender)return;let t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){let i=t.apply(this,arguments);return"encodings"in i||(i.encodings=[].concat(this.sendEncodings||[{}])),i})}function C2(e){if(typeof e!="object"||!e.RTCPeerConnection)return;let t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?ae.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function b2(e){if(typeof e!="object"||!e.RTCPeerConnection)return;let t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?ae.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}var Yw=Object.freeze({__proto__:null,shimAddTransceiver:v2,shimCreateAnswer:b2,shimCreateOffer:C2,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(i){if(!i||!i.video){let r=new DOMException("getDisplayMedia without video constraints is undefined");return r.name="NotFoundError",r.code=8,ae.reject(r)}return i.video===!0?i.video={mediaSource:t}:i.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(i)})},shimGetParameters:y2,shimGetUserMedia:E2,shimOnTrack:m2,shimPeerConnection:dv,shimRTCDataChannel:R2,shimReceiverGetStats:S2,shimRemoveStream:T2,shimSenderGetStats:g2});function A2(e){if(typeof e=="object"&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){let t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(i){var r;this._localStreams||(this._localStreams=[]),oe(r=this._localStreams).call(r,i)||this._localStreams.push(i),i.getAudioTracks().forEach(a=>t.call(this,a,i)),i.getVideoTracks().forEach(a=>t.call(this,a,i))},e.RTCPeerConnection.prototype.addTrack=function(i){for(var r=arguments.length,a=new Array(r>1?r-1:0),s=1;s<r;s++)a[s-1]=arguments[s];return a&&a.forEach(c=>{var l;this._localStreams?oe(l=this._localStreams).call(l,c)||this._localStreams.push(c):this._localStreams=[c]}),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(t){this._localStreams||(this._localStreams=[]);let i=this._localStreams.indexOf(t);if(i===-1)return;this._localStreams.splice(i,1);let r=t.getTracks();this.getSenders().forEach(a=>{oe(r).call(r,a.track)&&this.removeTrack(a)})})}}function I2(e){if(typeof e=="object"&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(i){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=i),this.addEventListener("track",this._onaddstreampoly=r=>{r.streams.forEach(a=>{var s;if(this._remoteStreams||(this._remoteStreams=[]),oe(s=this._remoteStreams).call(s,a))return;this._remoteStreams.push(a);let c=new Event("addstream");c.stream=a,this.dispatchEvent(c)})})}});let t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){let i=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(r){r.streams.forEach(a=>{if(i._remoteStreams||(i._remoteStreams=[]),i._remoteStreams.indexOf(a)>=0)return;i._remoteStreams.push(a);let s=new Event("addstream");s.stream=a,i.dispatchEvent(s)})}),t.apply(i,arguments)}}}function O2(e){if(typeof e!="object"||!e.RTCPeerConnection)return;let t=e.RTCPeerConnection.prototype,i=t.createOffer,r=t.createAnswer,a=t.setLocalDescription,s=t.setRemoteDescription,c=t.addIceCandidate;t.createOffer=function(u,h){let p=arguments.length>=2?arguments[2]:arguments[0],_=i.apply(this,[p]);return h?(_.then(u,h),ae.resolve()):_},t.createAnswer=function(u,h){let p=arguments.length>=2?arguments[2]:arguments[0],_=r.apply(this,[p]);return h?(_.then(u,h),ae.resolve()):_};let l=function(u,h,p){let _=a.apply(this,[u]);return p?(_.then(h,p),ae.resolve()):_};t.setLocalDescription=l,l=function(u,h,p){let _=s.apply(this,[u]);return p?(_.then(h,p),ae.resolve()):_},t.setRemoteDescription=l,l=function(u,h,p){let _=c.apply(this,[u]);return p?(_.then(h,p),ae.resolve()):_},t.addIceCandidate=l}function w2(e){let t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){let i=t.mediaDevices,r=i.getUserMedia.bind(i);t.mediaDevices.getUserMedia=a=>r(N2(a))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=(function(i,r,a){t.mediaDevices.getUserMedia(i).then(r,a)}).bind(t))}function N2(e){return e&&e.video!==void 0?Object.assign({},e,{video:_U(e.video)}):e}function D2(e){if(!e.RTCPeerConnection)return;let t=e.RTCPeerConnection;e.RTCPeerConnection=function(i,r){if(i&&i.iceServers){let a=[];for(let s=0;s<i.iceServers.length;s++){let c=i.iceServers[s];!c.hasOwnProperty("urls")&&c.hasOwnProperty("url")?(Ey("RTCIceServer.url","RTCIceServer.urls"),c=JSON.parse(JSON.stringify(c)),c.urls=c.url,delete c.url,a.push(c)):a.push(i.iceServers[s])}i.iceServers=a}return new t(i,r)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function P2(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function L2(e){let t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(i){if(i){i.offerToReceiveAudio!==void 0&&(i.offerToReceiveAudio=!!i.offerToReceiveAudio);let r=this.getTransceivers().find(s=>s.receiver.track.kind==="audio");i.offerToReceiveAudio===!1&&r?r.direction==="sendrecv"?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":r.direction==="recvonly"&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):i.offerToReceiveAudio!==!0||r||this.addTransceiver("audio",{direction:"recvonly"}),i.offerToReceiveVideo!==void 0&&(i.offerToReceiveVideo=!!i.offerToReceiveVideo);let a=this.getTransceivers().find(s=>s.receiver.track.kind==="video");i.offerToReceiveVideo===!1&&a?a.direction==="sendrecv"?a.setDirection?a.setDirection("sendonly"):a.direction="sendonly":a.direction==="recvonly"&&(a.setDirection?a.setDirection("inactive"):a.direction="inactive"):i.offerToReceiveVideo!==!0||a||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function k2(e){typeof e!="object"||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var qw=Object.freeze({__proto__:null,shimAudioContext:k2,shimCallbacksAPI:O2,shimConstraints:N2,shimCreateOfferLegacy:L2,shimGetUserMedia:w2,shimLocalStreamsAPI:A2,shimRTCIceServerUrls:D2,shimRemoteStreamsAPI:I2,shimTrackEventTransceiver:P2}),M2=`	
\v\f\r                　\u2028\u2029\uFEFF`,hK=Ad,pK=Ra,uv=M2,Xw=ii("".replace),fK=RegExp("^["+uv+"]+"),_K=RegExp("(^|[^"+uv+"])["+uv+"]+$"),EK=function(e){return function(t){var i=pK(hK(t));return 1&e&&(i=Xw(i,fK,"")),2&e&&(i=Xw(i,_K,"$1")),i}},mK={trim:EK(3)},gK=IU.PROPER,SK=si,Jw=M2,TK=mK.trim;_t({target:"String",proto:!0,forced:function(e){return SK(function(){return!!Jw[e]()||"​᠎"[e]()!=="​᠎"||gK&&Jw[e].name!==e})}("trim")},{trim:function(){return TK(this)}});var RK=en("String").trim,vK=_r,yK=RK,rT=String.prototype,CK=function(e){var t=e.trim;return typeof e=="string"||e===rT||vK(rT,e)&&t===rT.trim?yK:t},ir=zt(CK),U2={exports:{}};(function(e){let t={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};t.localCName=t.generateIdentifier(),t.splitLines=function(i){return i.trim().split(`
`).map(r=>r.trim())},t.splitSections=function(i){return i.split(`
m=`).map((r,a)=>(a>0?"m="+r:r).trim()+`\r
`)},t.getDescription=function(i){let r=t.splitSections(i);return r&&r[0]},t.getMediaSections=function(i){let r=t.splitSections(i);return r.shift(),r},t.matchPrefix=function(i,r){return t.splitLines(i).filter(a=>a.indexOf(r)===0)},t.parseCandidate=function(i){let r;r=i.indexOf("a=candidate:")===0?i.substring(12).split(" "):i.substring(10).split(" ");let a={foundation:r[0],component:{1:"rtp",2:"rtcp"}[r[1]]||r[1],protocol:r[2].toLowerCase(),priority:parseInt(r[3],10),ip:r[4],address:r[4],port:parseInt(r[5],10),type:r[7]};for(let s=8;s<r.length;s+=2)switch(r[s]){case"raddr":a.relatedAddress=r[s+1];break;case"rport":a.relatedPort=parseInt(r[s+1],10);break;case"tcptype":a.tcpType=r[s+1];break;case"ufrag":a.ufrag=r[s+1],a.usernameFragment=r[s+1];break;default:a[r[s]]===void 0&&(a[r[s]]=r[s+1])}return a},t.writeCandidate=function(i){let r=[];r.push(i.foundation);let a=i.component;a==="rtp"?r.push(1):a==="rtcp"?r.push(2):r.push(a),r.push(i.protocol.toUpperCase()),r.push(i.priority),r.push(i.address||i.ip),r.push(i.port);let s=i.type;return r.push("typ"),r.push(s),s!=="host"&&i.relatedAddress&&i.relatedPort&&(r.push("raddr"),r.push(i.relatedAddress),r.push("rport"),r.push(i.relatedPort)),i.tcpType&&i.protocol.toLowerCase()==="tcp"&&(r.push("tcptype"),r.push(i.tcpType)),(i.usernameFragment||i.ufrag)&&(r.push("ufrag"),r.push(i.usernameFragment||i.ufrag)),"candidate:"+r.join(" ")},t.parseIceOptions=function(i){return i.substring(14).split(" ")},t.parseRtpMap=function(i){let r=i.substring(9).split(" "),a={payloadType:parseInt(r.shift(),10)};return r=r[0].split("/"),a.name=r[0],a.clockRate=parseInt(r[1],10),a.channels=r.length===3?parseInt(r[2],10):1,a.numChannels=a.channels,a},t.writeRtpMap=function(i){let r=i.payloadType;i.preferredPayloadType!==void 0&&(r=i.preferredPayloadType);let a=i.channels||i.numChannels||1;return"a=rtpmap:"+r+" "+i.name+"/"+i.clockRate+(a!==1?"/"+a:"")+`\r
`},t.parseExtmap=function(i){let r=i.substring(9).split(" ");return{id:parseInt(r[0],10),direction:r[0].indexOf("/")>0?r[0].split("/")[1]:"sendrecv",uri:r[1],attributes:r.slice(2).join(" ")}},t.writeExtmap=function(i){return"a=extmap:"+(i.id||i.preferredId)+(i.direction&&i.direction!=="sendrecv"?"/"+i.direction:"")+" "+i.uri+(i.attributes?" "+i.attributes:"")+`\r
`},t.parseFmtp=function(i){let r={},a,s=i.substring(i.indexOf(" ")+1).split(";");for(let c=0;c<s.length;c++)a=s[c].trim().split("="),r[a[0].trim()]=a[1];return r},t.writeFmtp=function(i){let r="",a=i.payloadType;if(i.preferredPayloadType!==void 0&&(a=i.preferredPayloadType),i.parameters&&Object.keys(i.parameters).length){let s=[];Object.keys(i.parameters).forEach(c=>{i.parameters[c]!==void 0?s.push(c+"="+i.parameters[c]):s.push(c)}),r+="a=fmtp:"+a+" "+s.join(";")+`\r
`}return r},t.parseRtcpFb=function(i){let r=i.substring(i.indexOf(" ")+1).split(" ");return{type:r.shift(),parameter:r.join(" ")}},t.writeRtcpFb=function(i){let r="",a=i.payloadType;return i.preferredPayloadType!==void 0&&(a=i.preferredPayloadType),i.rtcpFeedback&&i.rtcpFeedback.length&&i.rtcpFeedback.forEach(s=>{r+="a=rtcp-fb:"+a+" "+s.type+(s.parameter&&s.parameter.length?" "+s.parameter:"")+`\r
`}),r},t.parseSsrcMedia=function(i){let r=i.indexOf(" "),a={ssrc:parseInt(i.substring(7,r),10)},s=i.indexOf(":",r);return s>-1?(a.attribute=i.substring(r+1,s),a.value=i.substring(s+1)):a.attribute=i.substring(r+1),a},t.parseSsrcGroup=function(i){let r=i.substring(13).split(" ");return{semantics:r.shift(),ssrcs:r.map(a=>parseInt(a,10))}},t.getMid=function(i){let r=t.matchPrefix(i,"a=mid:")[0];if(r)return r.substring(6)},t.parseFingerprint=function(i){let r=i.substring(14).split(" ");return{algorithm:r[0].toLowerCase(),value:r[1].toUpperCase()}},t.getDtlsParameters=function(i,r){return{role:"auto",fingerprints:t.matchPrefix(i+r,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(i,r){let a="a=setup:"+r+`\r
`;return i.fingerprints.forEach(s=>{a+="a=fingerprint:"+s.algorithm+" "+s.value+`\r
`}),a},t.parseCryptoLine=function(i){let r=i.substring(9).split(" ");return{tag:parseInt(r[0],10),cryptoSuite:r[1],keyParams:r[2],sessionParams:r.slice(3)}},t.writeCryptoLine=function(i){return"a=crypto:"+i.tag+" "+i.cryptoSuite+" "+(typeof i.keyParams=="object"?t.writeCryptoKeyParams(i.keyParams):i.keyParams)+(i.sessionParams?" "+i.sessionParams.join(" "):"")+`\r
`},t.parseCryptoKeyParams=function(i){if(i.indexOf("inline:")!==0)return null;let r=i.substring(7).split("|");return{keyMethod:"inline",keySalt:r[0],lifeTime:r[1],mkiValue:r[2]?r[2].split(":")[0]:void 0,mkiLength:r[2]?r[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(i){return i.keyMethod+":"+i.keySalt+(i.lifeTime?"|"+i.lifeTime:"")+(i.mkiValue&&i.mkiLength?"|"+i.mkiValue+":"+i.mkiLength:"")},t.getCryptoParameters=function(i,r){return t.matchPrefix(i+r,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(i,r){let a=t.matchPrefix(i+r,"a=ice-ufrag:")[0],s=t.matchPrefix(i+r,"a=ice-pwd:")[0];return a&&s?{usernameFragment:a.substring(12),password:s.substring(10)}:null},t.writeIceParameters=function(i){let r="a=ice-ufrag:"+i.usernameFragment+`\r
a=ice-pwd:`+i.password+`\r
`;return i.iceLite&&(r+=`a=ice-lite\r
`),r},t.parseRtpParameters=function(i){let r={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},a=t.splitLines(i)[0].split(" ");r.profile=a[2];for(let c=3;c<a.length;c++){let l=a[c],u=t.matchPrefix(i,"a=rtpmap:"+l+" ")[0];if(u){let h=t.parseRtpMap(u),p=t.matchPrefix(i,"a=fmtp:"+l+" ");switch(h.parameters=p.length?t.parseFmtp(p[0]):{},h.rtcpFeedback=t.matchPrefix(i,"a=rtcp-fb:"+l+" ").map(t.parseRtcpFb),r.codecs.push(h),h.name.toUpperCase()){case"RED":case"ULPFEC":r.fecMechanisms.push(h.name.toUpperCase())}}}t.matchPrefix(i,"a=extmap:").forEach(c=>{r.headerExtensions.push(t.parseExtmap(c))});let s=t.matchPrefix(i,"a=rtcp-fb:* ").map(t.parseRtcpFb);return r.codecs.forEach(c=>{s.forEach(l=>{c.rtcpFeedback.find(u=>u.type===l.type&&u.parameter===l.parameter)||c.rtcpFeedback.push(l)})}),r},t.writeRtpDescription=function(i,r){let a="";a+="m="+i+" ",a+=r.codecs.length>0?"9":"0",a+=" "+(r.profile||"UDP/TLS/RTP/SAVPF")+" ",a+=r.codecs.map(c=>c.preferredPayloadType!==void 0?c.preferredPayloadType:c.payloadType).join(" ")+`\r
`,a+=`c=IN IP4 0.0.0.0\r
`,a+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,r.codecs.forEach(c=>{a+=t.writeRtpMap(c),a+=t.writeFmtp(c),a+=t.writeRtcpFb(c)});let s=0;return r.codecs.forEach(c=>{c.maxptime>s&&(s=c.maxptime)}),s>0&&(a+="a=maxptime:"+s+`\r
`),r.headerExtensions&&r.headerExtensions.forEach(c=>{a+=t.writeExtmap(c)}),a},t.parseRtpEncodingParameters=function(i){let r=[],a=t.parseRtpParameters(i),s=a.fecMechanisms.indexOf("RED")!==-1,c=a.fecMechanisms.indexOf("ULPFEC")!==-1,l=t.matchPrefix(i,"a=ssrc:").map(m=>t.parseSsrcMedia(m)).filter(m=>m.attribute==="cname"),u=l.length>0&&l[0].ssrc,h,p=t.matchPrefix(i,"a=ssrc-group:FID").map(m=>m.substring(17).split(" ").map(S=>parseInt(S,10)));p.length>0&&p[0].length>1&&p[0][0]===u&&(h=p[0][1]),a.codecs.forEach(m=>{if(m.name.toUpperCase()==="RTX"&&m.parameters.apt){let S={ssrc:u,codecPayloadType:parseInt(m.parameters.apt,10)};u&&h&&(S.rtx={ssrc:h}),r.push(S),s&&(S=JSON.parse(JSON.stringify(S)),S.fec={ssrc:u,mechanism:c?"red+ulpfec":"red"},r.push(S))}}),r.length===0&&u&&r.push({ssrc:u});let _=t.matchPrefix(i,"b=");return _.length&&(_=_[0].indexOf("b=TIAS:")===0?parseInt(_[0].substring(7),10):_[0].indexOf("b=AS:")===0?1e3*parseInt(_[0].substring(5),10)*.95-16e3:void 0,r.forEach(m=>{m.maxBitrate=_})),r},t.parseRtcpParameters=function(i){let r={},a=t.matchPrefix(i,"a=ssrc:").map(l=>t.parseSsrcMedia(l)).filter(l=>l.attribute==="cname")[0];a&&(r.cname=a.value,r.ssrc=a.ssrc);let s=t.matchPrefix(i,"a=rtcp-rsize");r.reducedSize=s.length>0,r.compound=s.length===0;let c=t.matchPrefix(i,"a=rtcp-mux");return r.mux=c.length>0,r},t.writeRtcpParameters=function(i){let r="";return i.reducedSize&&(r+=`a=rtcp-rsize\r
`),i.mux&&(r+=`a=rtcp-mux\r
`),i.ssrc!==void 0&&i.cname&&(r+="a=ssrc:"+i.ssrc+" cname:"+i.cname+`\r
`),r},t.parseMsid=function(i){let r,a=t.matchPrefix(i,"a=msid:");if(a.length===1)return r=a[0].substring(7).split(" "),{stream:r[0],track:r[1]};let s=t.matchPrefix(i,"a=ssrc:").map(c=>t.parseSsrcMedia(c)).filter(c=>c.attribute==="msid");return s.length>0?(r=s[0].value.split(" "),{stream:r[0],track:r[1]}):void 0},t.parseSctpDescription=function(i){let r=t.parseMLine(i),a=t.matchPrefix(i,"a=max-message-size:"),s;a.length>0&&(s=parseInt(a[0].substring(19),10)),isNaN(s)&&(s=65536);let c=t.matchPrefix(i,"a=sctp-port:");if(c.length>0)return{port:parseInt(c[0].substring(12),10),protocol:r.fmt,maxMessageSize:s};let l=t.matchPrefix(i,"a=sctpmap:");if(l.length>0){let u=l[0].substring(10).split(" ");return{port:parseInt(u[0],10),protocol:u[1],maxMessageSize:s}}},t.writeSctpDescription=function(i,r){let a=[];return a=i.protocol!=="DTLS/SCTP"?["m="+i.kind+" 9 "+i.protocol+" "+r.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+r.port+`\r
`]:["m="+i.kind+" 9 "+i.protocol+" "+r.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+r.port+" "+r.protocol+` 65535\r
`],r.maxMessageSize!==void 0&&a.push("a=max-message-size:"+r.maxMessageSize+`\r
`),a.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(i,r,a){let s,c=r!==void 0?r:2;return s=i||t.generateSessionId(),`v=0\r
o=`+(a||"thisisadapterortc")+" "+s+" "+c+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},t.getDirection=function(i,r){let a=t.splitLines(i);for(let s=0;s<a.length;s++)switch(a[s]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return a[s].substring(2)}return r?t.getDirection(r):"sendrecv"},t.getKind=function(i){return t.splitLines(i)[0].split(" ")[0].substring(2)},t.isRejected=function(i){return i.split(" ",2)[1]==="0"},t.parseMLine=function(i){let r=t.splitLines(i)[0].substring(2).split(" ");return{kind:r[0],port:parseInt(r[1],10),protocol:r[2],fmt:r.slice(3).join(" ")}},t.parseOLine=function(i){let r=t.matchPrefix(i,"o=")[0].substring(2).split(" ");return{username:r[0],sessionId:r[1],sessionVersion:parseInt(r[2],10),netType:r[3],addressType:r[4],address:r[5]}},t.isValidSDP=function(i){if(typeof i!="string"||i.length===0)return!1;let r=t.splitLines(i);for(let a=0;a<r.length;a++)if(r[a].length<2||r[a].charAt(1)!=="=")return!1;return!0},e.exports=t})(U2);var x2=U2.exports,nd=zt(x2),bK=H3({__proto__:null,default:nd},[x2]);function w_(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;let t=e.RTCIceCandidate;e.RTCIceCandidate=function(i){if(typeof i=="object"&&i.candidate&&i.candidate.indexOf("a=")===0&&((i=JSON.parse(JSON.stringify(i))).candidate=i.candidate.substr(2)),i.candidate&&i.candidate.length){let r=new t(i),a=nd.parseCandidate(i.candidate),s=Object.assign(r,a);return s.toJSON=function(){return{candidate:s.candidate,sdpMid:s.sdpMid,sdpMLineIndex:s.sdpMLineIndex,usernameFragment:s.usernameFragment}},s}return new t(i)},e.RTCIceCandidate.prototype=t.prototype,Vc(e,"icecandidate",i=>(i.candidate&&Object.defineProperty(i,"candidate",{value:new e.RTCIceCandidate(i.candidate),writable:"false"}),i))}function hv(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||Vc(e,"icecandidate",t=>{if(t.candidate){let i=nd.parseCandidate(t.candidate.candidate);i.type==="relay"&&(t.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[i.priority>>24])}return t})}function N_(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});let i=function(l){if(!l||!l.sdp)return!1;let u=nd.splitSections(l.sdp);return u.shift(),u.some(h=>{let p=nd.parseMLine(h);return p&&p.kind==="application"&&p.protocol.indexOf("SCTP")!==-1})},r=function(l){let u=l.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(u===null||u.length<2)return-1;let h=parseInt(u[1],10);return h!=h?-1:h},a=function(l){let u=65536;return t.browser==="firefox"&&(u=t.version<57?l===-1?16384:2147483637:t.version<60?t.version===57?65535:65536:2147483637),u},s=function(l,u){let h=65536;t.browser==="firefox"&&t.version===57&&(h=65535);let p=nd.matchPrefix(l.sdp,"a=max-message-size:");return p.length>0?h=parseInt(p[0].substr(19),10):t.browser==="firefox"&&u!==-1&&(h=2147483637),h},c=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,t.browser==="chrome"&&t.version>=76){let{sdpSemantics:l}=this.getConfiguration();l==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(i(arguments[0])){let l=r(arguments[0]),u=a(l),h=s(arguments[0],l),p;p=u===0&&h===0?Number.POSITIVE_INFINITY:u===0||h===0?Math.max(u,h):Math.min(u,h);let _={};Object.defineProperty(_,"maxMessageSize",{get:()=>p}),this._sctp=_}return c.apply(this,arguments)}}function D_(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function t(r,a){let s=r.send;r.send=function(){let c=arguments[0],l=c.length||c.size||c.byteLength;if(r.readyState==="open"&&a.sctp&&l>a.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+a.sctp.maxMessageSize+" bytes)");return s.apply(r,arguments)}}let i=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){let r=i.apply(this,arguments);return t(r,this),r},Vc(e,"datachannel",r=>(t(r.channel,r.target),r))}function pv(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;let t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(i){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),i&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=i)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(i=>{let r=t[i];t[i]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=a=>{let s=a.target;if(s._lastConnectionState!==s.connectionState){s._lastConnectionState=s.connectionState;let c=new Event("connectionstatechange",a);s.dispatchEvent(c)}return a},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),r.apply(this,arguments)}})}function fv(e,t){if(!e.RTCPeerConnection||t.browser==="chrome"&&t.version>=71||t.browser==="safari"&&t.version>=605)return;let i=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(r){if(r&&r.sdp&&r.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){let a=r.sdp.split(`
`).filter(s=>ir(s).call(s)!=="a=extmap-allow-mixed").join(`
`);e.RTCSessionDescription&&r instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:r.type,sdp:a}):r.sdp=a}return i.apply(this,arguments)}}function P_(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;let i=e.RTCPeerConnection.prototype.addIceCandidate;i&&i.length!==0&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(t.browser==="chrome"&&t.version<78||t.browser==="firefox"&&t.version<68||t.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?ae.resolve():i.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),ae.resolve())})}function L_(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;let i=e.RTCPeerConnection.prototype.setLocalDescription;i&&i.length!==0&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let r=arguments[0]||{};if(typeof r!="object"||r.type&&r.sdp)return i.apply(this,arguments);if(r={type:r.type,sdp:r.sdp},!r.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":r.type="offer";break;default:r.type="answer"}return r.sdp||r.type!=="offer"&&r.type!=="answer"?i.apply(this,[r]):(r.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(a=>i.apply(this,[a]))})}var AK=Object.freeze({__proto__:null,removeExtmapAllowMixed:fv,shimAddIceCandidateNullOrEmpty:P_,shimConnectionState:pv,shimMaxMessageSize:N_,shimParameterlessSetLocalDescription:L_,shimRTCIceCandidate:w_,shimRTCIceCandidateRelayProtocol:hv,shimSendThrowTypeError:D_});(function(){let{window:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0},i=fU,r=function(s){let c={browser:null,version:null};if(s===void 0||!s.navigator)return c.browser="Not a browser.",c;let{navigator:l}=s;if(l.mozGetUserMedia)c.browser="firefox",c.version=Pf(l.userAgent,/Firefox\/(\d+)\./,1);else if(l.webkitGetUserMedia||s.isSecureContext===!1&&s.webkitRTCPeerConnection)c.browser="chrome",c.version=Pf(l.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!s.RTCPeerConnection||!l.userAgent.match(/AppleWebKit\/(\d+)\./))return c.browser="Not a supported browser.",c;c.browser="safari",c.version=Pf(l.userAgent,/AppleWebKit\/(\d+)\./,1),c.supportsUnifiedPlan=s.RTCRtpTransceiver&&"currentDirection"in s.RTCRtpTransceiver.prototype}return c}(e),a={browserDetails:r,commonShim:AK,extractVersion:Pf,disableLog:y5,disableWarnings:C5,sdp:bK};switch(r.browser){case"chrome":if(!zw||!lv||!t.shimChrome)return i("Chrome shim is not included in this adapter release."),a;if(r.version===null)return i("Chrome shim can not determine version, not shimming."),a;i("adapter.js shimming chrome."),a.browserShim=zw,P_(e,r),L_(e),o2(e,r),c2(e),lv(e,r),l2(e),f2(e,r),d2(e),u2(e),h2(e),_2(e,r),w_(e),hv(e),pv(e),N_(e,r),D_(e),fv(e,r);break;case"firefox":if(!Yw||!dv||!t.shimFirefox)return i("Firefox shim is not included in this adapter release."),a;i("adapter.js shimming firefox."),a.browserShim=Yw,P_(e,r),L_(e),E2(e,r),dv(e,r),m2(e),T2(e),g2(e),S2(e),R2(e),v2(e),y2(e),C2(e),b2(e),w_(e),pv(e),N_(e,r),D_(e);break;case"safari":if(!qw||!t.shimSafari)return i("Safari shim is not included in this adapter release."),a;i("adapter.js shimming safari."),a.browserShim=qw,P_(e,r),L_(e),D2(e),L2(e),O2(e),A2(e),I2(e),P2(e),w2(e),k2(e),w_(e),hv(e),N_(e,r),D_(e),fv(e,r);break;default:i("Unsupported browser!")}})({window:typeof window>"u"?void 0:window});var IK=en("Array").keys,OK=Jn,wK=Gi,NK=_r,DK=IK,aT=Array.prototype,PK={DOMTokenList:!0,NodeList:!0},LK=function(e){var t=e.keys;return e===aT||NK(aT,e)&&t===aT.keys||wK(PK,OK(e))?DK:t},Xr=zt(LK),Qw=Od,kK=TypeError,MK=PE,UK=$a,xK=Po,HE=function(e,t,i){var r=MK(t);r in e?UK.f(e,r,xK(0,i)):e[r]=i},Zw=py,VK=Ps,BK=HE,jK=Array,FK=Math.max,Py=function(e,t,i){for(var r=VK(e),a=Zw(t,r),s=Zw(i===void 0?r:i,r),c=jK(FK(s-a,0)),l=0;a<s;a++,l++)BK(c,l,e[a]);return c.length=l,c},$w=Py,GK=Math.floor,_v=function(e,t){var i=e.length,r=GK(i/2);return i<8?HK(e,t):WK(e,_v($w(e,0,r),t),_v($w(e,r),t),t)},HK=function(e,t){for(var i,r,a=e.length,s=1;s<a;){for(r=s,i=e[s];r&&t(e[r-1],i)>0;)e[r]=e[--r];r!==s++&&(e[r]=i)}return e},WK=function(e,t,i,r){for(var a=t.length,s=i.length,c=0,l=0;c<a||l<s;)e[c+l]=c<a&&l<s?r(t[c],i[l])<=0?t[c++]:i[l++]:c<a?t[c++]:i[l++];return e},V2=_v,e0=xc.match(/firefox\/(\d+)/i),KK=!!e0&&+e0[1],zK=/MSIE|Trident/.test(xc),t0=xc.match(/AppleWebKit\/(\d+)\./),YK=!!t0&&+t0[1],qK=_t,B2=ii,XK=Za,JK=Xn,i0=Ps,QK=function(e,t){if(!delete e[t])throw kK("Cannot delete property "+Qw(t)+" of "+Qw(e))},r0=Ra,Ly=si,ZK=V2,$K=LE,a0=KK,ez=zK,n0=Pc,s0=YK,go=[],o0=B2(go.sort),tz=B2(go.push),iz=Ly(function(){go.sort(void 0)}),rz=Ly(function(){go.sort(null)}),az=$K("sort"),c0=!Ly(function(){if(n0)return n0<70;if(!(a0&&a0>3)){if(ez)return!0;if(s0)return s0<603;var e,t,i,r,a="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:i=3;break;case 68:case 71:i=4;break;default:i=2}for(r=0;r<47;r++)go.push({k:t+r,v:i})}for(go.sort(function(s,c){return c.v-s.v}),r=0;r<go.length;r++)t=go[r].k.charAt(0),a.charAt(a.length-1)!==t&&(a+=t);return a!=="DGBEFHACIJK"}});qK({target:"Array",proto:!0,forced:iz||!rz||!az||!c0},{sort:function(e){e!==void 0&&XK(e);var t=JK(this);if(c0)return e===void 0?o0(t):o0(t,e);var i,r,a=[],s=i0(t);for(r=0;r<s;r++)r in t&&tz(a,t[r]);for(ZK(a,function(c){return function(l,u){return u===void 0?-1:l===void 0?1:c!==void 0?+c(l,u)||0:r0(l)>r0(u)?1:-1}}(e)),i=i0(a),r=0;r<i;)t[r]=a[r++];for(;r<s;)QK(t,r++);return t}});var nT,sT,nz=en("Array").sort,sz=_r,oz=nz,oT=Array.prototype,cz=function(e){var t=e.sort;return e===oT||sz(oT,e)&&t===oT.sort?oz:t},cp=zt(cz),Ev={exports:{}};nT=Ev,sT=Ev.exports,function(e,t){var i="function",r="undefined",a="object",s="string",c="major",l="model",u="name",h="type",p="vendor",_="version",m="architecture",S="console",C="mobile",v="tablet",y="smarttv",I="wearable",O="embedded",P="Amazon",U="Apple",x="ASUS",G="BlackBerry",Z="Browser",J="Chrome",q="Firefox",ie="Google",Ie="Huawei",Ve="LG",He="Microsoft",ut="Motorola",st="Opera",ge="Samsung",j="Sharp",K="Sony",te="Xiaomi",L="Zebra",g="Facebook",w="Chromium OS",D="Mac OS",F=function(vt){for(var yt={},dt=0;dt<vt.length;dt++)yt[vt[dt].toUpperCase()]=vt[dt];return yt},pe=function(vt,yt){return typeof vt===s&&Re(yt).indexOf(Re(vt))!==-1},Re=function(vt){return vt.toLowerCase()},rt=function(vt,yt){if(typeof vt===s)return vt=vt.replace(/^\s\s*/,""),typeof yt===r?vt:vt.substring(0,350)},Xe=function(vt,yt){for(var dt,Hi,Fr,It,Be,rr,yn=0;yn<yt.length&&!Be;){var Ci=yt[yn],_p=yt[yn+1];for(dt=Hi=0;dt<Ci.length&&!Be&&Ci[dt];)if(Be=Ci[dt++].exec(vt))for(Fr=0;Fr<_p.length;Fr++)rr=Be[++Hi],typeof(It=_p[Fr])===a&&It.length>0?It.length===2?typeof It[1]==i?this[It[0]]=It[1].call(this,rr):this[It[0]]=It[1]:It.length===3?typeof It[1]!==i||It[1].exec&&It[1].test?this[It[0]]=rr?rr.replace(It[1],It[2]):t:this[It[0]]=rr?It[1].call(this,rr,It[2]):t:It.length===4&&(this[It[0]]=rr?It[3].call(this,rr.replace(It[1],It[2])):t):this[It]=rr||t;yn+=2}},Ft=function(vt,yt){for(var dt in yt)if(typeof yt[dt]===a&&yt[dt].length>0){for(var Hi=0;Hi<yt[dt].length;Hi++)if(pe(yt[dt][Hi],vt))return dt==="?"?t:dt}else if(pe(yt[dt],vt))return dt==="?"?t:dt;return vt},Yt={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},Dr={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[_,[u,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[_,[u,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[u,_],[/opios[\/ ]+([\w\.]+)/i],[_,[u,st+" Mini"]],[/\bopr\/([\w\.]+)/i],[_,[u,st]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[u,_],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[_,[u,"UC"+Z]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[_,[u,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[_,[u,"WeChat"]],[/konqueror\/([\w\.]+)/i],[_,[u,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[_,[u,"IE"]],[/yabrowser\/([\w\.]+)/i],[_,[u,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[u,/(.+)/,"$1 Secure "+Z],_],[/\bfocus\/([\w\.]+)/i],[_,[u,q+" Focus"]],[/\bopt\/([\w\.]+)/i],[_,[u,st+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[_,[u,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[_,[u,"Dolphin"]],[/coast\/([\w\.]+)/i],[_,[u,st+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[_,[u,"MIUI "+Z]],[/fxios\/([-\w\.]+)/i],[_,[u,q]],[/\bqihu|(qi?ho?o?|360)browser/i],[[u,"360 "+Z]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[u,/(.+)/,"$1 "+Z],_],[/(comodo_dragon)\/([\w\.]+)/i],[[u,/_/g," "],_],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[u,_],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[u],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[u,g],_],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[u,_],[/\bgsa\/([\w\.]+) .*safari\//i],[_,[u,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[_,[u,J+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[u,J+" WebView"],_],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[_,[u,"Android "+Z]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[u,_],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[_,[u,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[_,u],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[u,[_,Ft,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[u,_],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[u,"Netscape"],_],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[_,[u,q+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[u,_],[/(cobalt)\/([\w\.]+)/i],[u,[_,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[m,"amd64"]],[/(ia32(?=;))/i],[[m,Re]],[/((?:i[346]|x)86)[;\)]/i],[[m,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[m,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[m,"armhf"]],[/windows (ce|mobile); ppc;/i],[[m,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[m,/ower/,"",Re]],[/(sun4\w)[;\)]/i],[[m,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[m,Re]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[l,[p,ge],[h,v]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[l,[p,ge],[h,C]],[/\((ip(?:hone|od)[\w ]*);/i],[l,[p,U],[h,C]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[l,[p,U],[h,v]],[/(macintosh);/i],[l,[p,U]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[l,[p,j],[h,C]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[l,[p,Ie],[h,v]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[l,[p,Ie],[h,C]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[l,/_/g," "],[p,te],[h,C]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[l,/_/g," "],[p,te],[h,v]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[l,[p,"OPPO"],[h,C]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[l,[p,"Vivo"],[h,C]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[l,[p,"Realme"],[h,C]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[l,[p,ut],[h,C]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[l,[p,ut],[h,v]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[l,[p,Ve],[h,v]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[l,[p,Ve],[h,C]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[l,[p,"Lenovo"],[h,v]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[l,/_/g," "],[p,"Nokia"],[h,C]],[/(pixel c)\b/i],[l,[p,ie],[h,v]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[l,[p,ie],[h,C]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[l,[p,K],[h,C]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[l,"Xperia Tablet"],[p,K],[h,v]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[l,[p,"OnePlus"],[h,C]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[l,[p,P],[h,v]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[l,/(.+)/g,"Fire Phone $1"],[p,P],[h,C]],[/(playbook);[-\w\),; ]+(rim)/i],[l,p,[h,v]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[l,[p,G],[h,C]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[l,[p,x],[h,v]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[l,[p,x],[h,C]],[/(nexus 9)/i],[l,[p,"HTC"],[h,v]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[p,[l,/_/g," "],[h,C]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[l,[p,"Acer"],[h,v]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[l,[p,"Meizu"],[h,C]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[p,l,[h,C]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[p,l,[h,v]],[/(surface duo)/i],[l,[p,He],[h,v]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[l,[p,"Fairphone"],[h,C]],[/(u304aa)/i],[l,[p,"AT&T"],[h,C]],[/\bsie-(\w*)/i],[l,[p,"Siemens"],[h,C]],[/\b(rct\w+) b/i],[l,[p,"RCA"],[h,v]],[/\b(venue[\d ]{2,7}) b/i],[l,[p,"Dell"],[h,v]],[/\b(q(?:mv|ta)\w+) b/i],[l,[p,"Verizon"],[h,v]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[l,[p,"Barnes & Noble"],[h,v]],[/\b(tm\d{3}\w+) b/i],[l,[p,"NuVision"],[h,v]],[/\b(k88) b/i],[l,[p,"ZTE"],[h,v]],[/\b(nx\d{3}j) b/i],[l,[p,"ZTE"],[h,C]],[/\b(gen\d{3}) b.+49h/i],[l,[p,"Swiss"],[h,C]],[/\b(zur\d{3}) b/i],[l,[p,"Swiss"],[h,v]],[/\b((zeki)?tb.*\b) b/i],[l,[p,"Zeki"],[h,v]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[p,"Dragon Touch"],l,[h,v]],[/\b(ns-?\w{0,9}) b/i],[l,[p,"Insignia"],[h,v]],[/\b((nxa|next)-?\w{0,9}) b/i],[l,[p,"NextBook"],[h,v]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[p,"Voice"],l,[h,C]],[/\b(lvtel\-)?(v1[12]) b/i],[[p,"LvTel"],l,[h,C]],[/\b(ph-1) /i],[l,[p,"Essential"],[h,C]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[l,[p,"Envizen"],[h,v]],[/\b(trio[-\w\. ]+) b/i],[l,[p,"MachSpeed"],[h,v]],[/\btu_(1491) b/i],[l,[p,"Rotor"],[h,v]],[/(shield[\w ]+) b/i],[l,[p,"Nvidia"],[h,v]],[/(sprint) (\w+)/i],[p,l,[h,C]],[/(kin\.[onetw]{3})/i],[[l,/\./g," "],[p,He],[h,C]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[l,[p,L],[h,v]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[l,[p,L],[h,C]],[/smart-tv.+(samsung)/i],[p,[h,y]],[/hbbtv.+maple;(\d+)/i],[[l,/^/,"SmartTV"],[p,ge],[h,y]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[p,Ve],[h,y]],[/(apple) ?tv/i],[p,[l,U+" TV"],[h,y]],[/crkey/i],[[l,J+"cast"],[p,ie],[h,y]],[/droid.+aft(\w)( bui|\))/i],[l,[p,P],[h,y]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[l,[p,j],[h,y]],[/(bravia[\w ]+)( bui|\))/i],[l,[p,K],[h,y]],[/(mitv-\w{5}) bui/i],[l,[p,te],[h,y]],[/Hbbtv.*(technisat) (.*);/i],[p,l,[h,y]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[p,rt],[l,rt],[h,y]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[h,y]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[p,l,[h,S]],[/droid.+; (shield) bui/i],[l,[p,"Nvidia"],[h,S]],[/(playstation [345portablevi]+)/i],[l,[p,K],[h,S]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[l,[p,He],[h,S]],[/((pebble))app/i],[p,l,[h,I]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[l,[p,U],[h,I]],[/droid.+; (glass) \d/i],[l,[p,ie],[h,I]],[/droid.+; (wt63?0{2,3})\)/i],[l,[p,L],[h,I]],[/(quest( 2| pro)?)/i],[l,[p,g],[h,I]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[p,[h,O]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[l,[h,C]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[l,[h,v]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[h,v]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[h,C]],[/(android[-\w\. ]{0,9});.+buil/i],[l,[p,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[_,[u,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[_,[u,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[u,_],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[_,u]],os:[[/microsoft (windows) (vista|xp)/i],[u,_],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[u,[_,Ft,Yt]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[u,"Windows"],[_,Ft,Yt]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[_,/_/g,"."],[u,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[u,D],[_,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[_,u],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[u,_],[/\(bb(10);/i],[_,[u,G]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[_,[u,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[_,[u,q+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[_,[u,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[_,[u,"watchOS"]],[/crkey\/([\d\.]+)/i],[_,[u,J+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[u,w],_],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[u,_],[/(sunos) ?([\w\.\d]*)/i],[[u,"Solaris"],_],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[u,_]]},Xi=function(vt,yt){if(typeof vt===a&&(yt=vt,vt=t),!(this instanceof Xi))return new Xi(vt,yt).getResult();var dt=typeof e!==r&&e.navigator?e.navigator:t,Hi=vt||(dt&&dt.userAgent?dt.userAgent:""),Fr=dt&&dt.userAgentData?dt.userAgentData:t,It=yt?function(Be,rr){var yn={};for(var Ci in Be)rr[Ci]&&rr[Ci].length%2==0?yn[Ci]=rr[Ci].concat(Be[Ci]):yn[Ci]=Be[Ci];return yn}(Dr,yt):Dr;return this.getBrowser=function(){var Be={};return Be[u]=t,Be[_]=t,Xe.call(Be,Hi,It.browser),Be[c]=function(rr){return typeof rr===s?rr.replace(/[^\d\.]/g,"").split(".")[0]:t}(Be[_]),dt&&dt.brave&&typeof dt.brave.isBrave==i&&(Be[u]="Brave"),Be},this.getCPU=function(){var Be={};return Be[m]=t,Xe.call(Be,Hi,It.cpu),Be},this.getDevice=function(){var Be={};return Be[p]=t,Be[l]=t,Be[h]=t,Xe.call(Be,Hi,It.device),!Be[h]&&Fr&&Fr.mobile&&(Be[h]=C),Be[l]=="Macintosh"&&dt&&typeof dt.standalone!==r&&dt.maxTouchPoints&&dt.maxTouchPoints>2&&(Be[l]="iPad",Be[h]=v),Be},this.getEngine=function(){var Be={};return Be[u]=t,Be[_]=t,Xe.call(Be,Hi,It.engine),Be},this.getOS=function(){var Be={};return Be[u]=t,Be[_]=t,Xe.call(Be,Hi,It.os),!Be[u]&&Fr&&Fr.platform!="Unknown"&&(Be[u]=Fr.platform.replace(/chrome os/i,w).replace(/macos/i,D)),Be},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return Hi},this.setUA=function(Be){return Hi=typeof Be===s&&Be.length>350?rt(Be,350):Be,this},this.setUA(Hi),this};Xi.VERSION="0.7.34",Xi.BROWSER=F([u,_,c]),Xi.CPU=F([m]),Xi.DEVICE=F([l,p,h,S,C,y,v,I,O]),Xi.ENGINE=Xi.OS=F([u,_]),nT.exports&&(sT=nT.exports=Xi),sT.UAParser=Xi;var Er=typeof e!==r&&(e.jQuery||e.Zepto);if(Er&&!Er.ua){var rn=new Xi;Er.ua=rn.getResult(),Er.ua.get=function(){return rn.getUA()},Er.ua.set=function(vt){rn.setUA(vt);var yt=rn.getResult();for(var dt in yt)Er.ua[dt]=yt[dt]}}}(typeof window=="object"?window:rd);var lz=zt(Ev.exports),dz=Jn,uz=Gi,hz=bd,pz=Bc,fz=Zt("iterator"),_z=Object,Ez=function(e){if(hz(e))return!1;var t=_z(e);return t[fz]!==void 0||"@@iterator"in t||uz(pz,dz(t))},mz=zt(Ez),cT=Mi;_t({global:!0,forced:cT.globalThis!==cT},{globalThis:cT});var l0=zt(Mi);function j2(e,t){return function(){return e.apply(t,arguments)}}var{toString:gz}=Object.prototype,{getPrototypeOf:ky}=Object,aE=(lT=Object.create(null),e=>{let t=gz.call(e);return lT[t]||(lT[t]=t.slice(8,-1).toLowerCase())}),lT,Zn=e=>(e=e.toLowerCase(),t=>aE(t)===e),WE=e=>t=>typeof t===e,{isArray:Fl}=Array,ih=WE("undefined"),d0=Zn("ArrayBuffer"),Sz=WE("string"),ka=WE("function"),u0=WE("number"),Bf=e=>e!==null&&typeof e=="object",jf=e=>{if(aE(e)!=="object")return!1;let t=ky(e);return!(t!==null&&t!==Object.prototype&&Object.getPrototypeOf(t)!==null||Symbol.toStringTag in e||mz(e))},Tz=Zn("Date"),Rz=Zn("File"),vz=Zn("Blob"),yz=Zn("FileList"),Cz=Zn("URLSearchParams");function rh(e,t){let i,r,{allOwnKeys:a=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(e!=null)if(typeof e!="object"&&(e=[e]),Fl(e))for(i=0,r=e.length;i<r;i++)t.call(null,e[i],i,e);else{let s=a?Object.getOwnPropertyNames(e):Object.keys(e),c=s.length,l;for(i=0;i<c;i++)l=s[i],t.call(null,e[l],l,e)}}function h0(e,t){t=t.toLowerCase();let i=Object.keys(e),r,a=i.length;for(;a-- >0;)if(r=i[a],t===r.toLowerCase())return r;return null}var F2=l0!==void 0?l0:typeof self<"u"?self:typeof window<"u"?window:global,p0=e=>!ih(e)&&e!==F2,bz=(dT=typeof Uint8Array<"u"&&ky(Uint8Array),e=>dT&&e instanceof dT),dT,Az=Zn("HTMLFormElement"),f0=(e=>{let{hasOwnProperty:t}=e;return(i,r)=>t.call(i,r)})(Object.prototype),Iz=Zn("RegExp"),_0=(e,t)=>{let i=Object.getOwnPropertyDescriptors(e),r={};rh(i,(a,s)=>{let c;(c=t(a,s,e))!==!1&&(r[s]=c||a)}),Object.defineProperties(e,r)},uT="abcdefghijklmnopqrstuvwxyz",E0="0123456789",m0={DIGIT:E0,ALPHA:uT,ALPHA_DIGIT:uT+uT.toUpperCase()+E0},Oz=Zn("AsyncFunction"),le={isArray:Fl,isArrayBuffer:d0,isBuffer:function(e){return e!==null&&!ih(e)&&e.constructor!==null&&!ih(e.constructor)&&ka(e.constructor.isBuffer)&&e.constructor.isBuffer(e)},isFormData:e=>{let t;return e&&(typeof FormData=="function"&&e instanceof FormData||ka(e.append)&&((t=aE(e))==="formdata"||t==="object"&&ka(e.toString)&&e.toString()==="[object FormData]"))},isArrayBufferView:function(e){let t;return t=typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&d0(e.buffer),t},isString:Sz,isNumber:u0,isBoolean:e=>e===!0||e===!1,isObject:Bf,isPlainObject:jf,isUndefined:ih,isDate:Tz,isFile:Rz,isBlob:vz,isRegExp:Iz,isFunction:ka,isStream:e=>Bf(e)&&ka(e.pipe),isURLSearchParams:Cz,isTypedArray:bz,isFileList:yz,forEach:rh,merge:function e(){let{caseless:t}=p0(this)&&this||{},i={},r=(a,s)=>{let c=t&&h0(i,s)||s;jf(i[c])&&jf(a)?i[c]=e(i[c],a):jf(a)?i[c]=e({},a):Fl(a)?i[c]=a.slice():i[c]=a};for(let a=0,s=arguments.length;a<s;a++)arguments[a]&&rh(arguments[a],r);return i},extend:function(e,t,i){let{allOwnKeys:r}=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return rh(t,(a,s)=>{i&&ka(a)?e[s]=j2(a,i):e[s]=a},{allOwnKeys:r}),e},trim:e=>ir(e)?ir(e).call(e):e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),inherits:(e,t,i,r)=>{e.prototype=Object.create(t.prototype,r),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),i&&Object.assign(e.prototype,i)},toFlatObject:(e,t,i,r)=>{let a,s,c,l={};if(t=t||{},e==null)return t;do{for(a=Object.getOwnPropertyNames(e),s=a.length;s-- >0;)c=a[s],r&&!r(c,e,t)||l[c]||(t[c]=e[c],l[c]=!0);e=i!==!1&&ky(e)}while(e&&(!i||i(e,t))&&e!==Object.prototype);return t},kindOf:aE,kindOfTest:Zn,endsWith:(e,t,i)=>{e=String(e),(i===void 0||i>e.length)&&(i=e.length),i-=t.length;let r=e.indexOf(t,i);return r!==-1&&r===i},toArray:e=>{if(!e)return null;if(Fl(e))return e;let t=e.length;if(!u0(t))return null;let i=new Array(t);for(;t-- >0;)i[t]=e[t];return i},forEachEntry:(e,t)=>{let i=(e&&e[Symbol.iterator]).call(e),r;for(;(r=i.next())&&!r.done;){let a=r.value;t.call(e,a[0],a[1])}},matchAll:(e,t)=>{let i,r=[];for(;(i=e.exec(t))!==null;)r.push(i);return r},isHTMLForm:Az,hasOwnProperty:f0,hasOwnProp:f0,reduceDescriptors:_0,freezeMethods:e=>{_0(e,(t,i)=>{if(ka(e)&&["arguments","caller","callee"].indexOf(i)!==-1)return!1;let r=e[i];ka(r)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+i+"'")}))})},toObjectSet:(e,t)=>{let i={},r=a=>{a.forEach(s=>{i[s]=!0})};return Fl(e)?r(e):r(String(e).split(t)),i},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,i,r){return i.toUpperCase()+r}),noop:()=>{},toFiniteNumber:(e,t)=>(e=+e,Number.isFinite(e)?e:t),findKey:h0,global:F2,isContextDefined:p0,ALPHABET:m0,generateString:function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:m0.ALPHA_DIGIT,i="",{length:r}=t;for(;e--;)i+=t[Math.random()*r|0];return i},isSpecCompliantForm:function(e){return!!(e&&ka(e.append)&&e[Symbol.toStringTag]==="FormData"&&e[Symbol.iterator])},toJSONObject:e=>{let t=new Array(10),i=(r,a)=>{if(Bf(r)){if(t.indexOf(r)>=0)return;if(!("toJSON"in r)){t[a]=r;let s=Fl(r)?[]:{};return rh(r,(c,l)=>{let u=i(c,a+1);!ih(u)&&(s[l]=u)}),t[a]=void 0,s}}return r};return i(e,0)},isAsyncFn:Oz,isThenable:e=>e&&(Bf(e)||ka(e))&&ka(e.then)&&ka(e.catch)};function Nt(e,t,i,r,a){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",t&&(this.code=t),i&&(this.config=i),r&&(this.request=r),a&&(this.response=a)}le.inherits(Nt,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:le.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});var g0=Nt.prototype,S0={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{S0[e]={value:e}}),Object.defineProperties(Nt,S0),Object.defineProperty(g0,"isAxiosError",{value:!0}),Nt.from=(e,t,i,r,a,s)=>{let c=Object.create(g0);return le.toFlatObject(e,c,function(l){return l!==Error.prototype},l=>l!=="isAxiosError"),Nt.call(c,e.message,t,i,r,a),c.cause=e,c.name=e.name,s&&Object.assign(c,s),c};function hT(e){return le.isPlainObject(e)||le.isArray(e)}function G2(e){return le.endsWith(e,"[]")?e.slice(0,-2):e}function T0(e,t,i){return e?e.concat(t).map(function(r,a){return r=G2(r),!i&&a?"["+r+"]":r}).join(i?".":""):t}var wz=le.toFlatObject(le,{},null,function(e){return/^is[A-Z]/.test(e)});function nE(e,t,i){if(!le.isObject(e))throw new TypeError("target must be an object");t=t||new FormData;let r=(i=le.toFlatObject(i,{metaTokens:!0,dots:!1,indexes:!1},!1,function(m,S){return!le.isUndefined(S[m])})).metaTokens,a=i.visitor||h,s=i.dots,c=i.indexes,l=(i.Blob||typeof Blob<"u"&&Blob)&&le.isSpecCompliantForm(t);if(!le.isFunction(a))throw new TypeError("visitor must be a function");function u(m){if(m===null)return"";if(le.isDate(m))return m.toISOString();if(!l&&le.isBlob(m))throw new Nt("Blob is not supported. Use a Buffer instead.");return le.isArrayBuffer(m)||le.isTypedArray(m)?l&&typeof Blob=="function"?new Blob([m]):Buffer.from(m):m}function h(m,S,C){let v=m;if(m&&!C&&typeof m=="object"){if(le.endsWith(S,"{}"))S=r?S:S.slice(0,-2),m=JSON.stringify(m);else if(le.isArray(m)&&function(y){return le.isArray(y)&&!y.some(hT)}(m)||(le.isFileList(m)||le.endsWith(S,"[]"))&&(v=le.toArray(m)))return S=G2(S),v.forEach(function(y,I){!le.isUndefined(y)&&y!==null&&t.append(c===!0?T0([S],I,s):c===null?S:S+"[]",u(y))}),!1}return!!hT(m)||(t.append(T0(C,S,s),u(m)),!1)}let p=[],_=Object.assign(wz,{defaultVisitor:h,convertValue:u,isVisitable:hT});if(!le.isObject(e))throw new TypeError("data must be an object");return function m(S,C){if(!le.isUndefined(S)){if(p.indexOf(S)!==-1)throw Error("Circular reference detected in "+C.join("."));p.push(S),le.forEach(S,function(v,y){(!(le.isUndefined(v)||v===null)&&a.call(t,v,le.isString(y)?ir(y).call(y):y,C,_))===!0&&m(v,C?C.concat(y):[y])}),p.pop()}}(e),t}function R0(e){let t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(i){return t[i]})}function My(e,t){this._pairs=[],e&&nE(e,this,t)}var v0=My.prototype;function Nz(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function H2(e,t,i){if(!t)return e;let r=i&&i.encode||Nz,a=i&&i.serialize,s;if(s=a?a(t,i):le.isURLSearchParams(t)?t.toString():new My(t,i).toString(r),s){let c=e.indexOf("#");c!==-1&&(e=e.slice(0,c)),e+=(e.indexOf("?")===-1?"?":"&")+s}return e}v0.append=function(e,t){this._pairs.push([e,t])},v0.toString=function(e){let t=e?function(i){return e.call(this,i,R0)}:R0;return this._pairs.map(function(i){return t(i[0])+"="+t(i[1])},"").join("&")};var y0=class{constructor(){this.handlers=[]}use(e,t,i){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!i&&i.synchronous,runWhen:i?i.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){le.forEach(this.handlers,function(t){t!==null&&e(t)})}},W2={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},K2={exports:{}},Dz=_t,Pz=Ta,C0=$a.f;Dz({target:"Object",stat:!0,forced:Object.defineProperty!==C0,sham:!Pz},{defineProperty:C0});var z2=Tn.Object,Lz=K2.exports=function(e,t,i){return z2.defineProperty(e,t,i)};z2.defineProperty.sham&&(Lz.sham=!0);var Y2=zt(K2.exports),kz=qn,lp=Array.isArray||function(e){return kz(e)=="Array"},Mz=TypeError,b0=lp,Uz=jE,xz=ia,Vz=Zt("species"),A0=Array,Bz=function(e){var t;return b0(e)&&(t=e.constructor,(Uz(t)&&(t===A0||b0(t.prototype))||xz(t)&&(t=t[Vz])===null)&&(t=void 0)),t===void 0?A0:t},q2=function(e,t){return new(Bz(e))(t===0?0:t)},jz=si,Fz=Pc,Gz=Zt("species"),X2=function(e){return Fz>=51||!jz(function(){var t=[];return(t.constructor={})[Gz]=function(){return{foo:1}},t[e](Boolean).foo!==1})},Hz=_t,Wz=si,Kz=lp,zz=ia,Yz=Xn,qz=Ps,I0=function(e){if(e>9007199254740991)throw Mz("Maximum allowed index exceeded");return e},O0=HE,Xz=q2,Jz=X2,Qz=Pc,J2=Zt("isConcatSpreadable"),Zz=Qz>=51||!Wz(function(){var e=[];return e[J2]=!1,e.concat()[0]!==e}),$z=function(e){if(!zz(e))return!1;var t=e[J2];return t!==void 0?!!t:Kz(e)};Hz({target:"Array",proto:!0,forced:!Zz||!Jz("concat")},{concat:function(e){var t,i,r,a,s,c=Yz(this),l=Xz(c,0),u=0;for(t=-1,r=arguments.length;t<r;t++)if($z(s=t===-1?c:arguments[t]))for(a=qz(s),I0(u+a),i=0;i<a;i++,u++)i in s&&O0(l,u,s[i]);else I0(u+1),O0(l,u++,s);return l.length=u,l}});var Q2={},eY=qn,tY=Lo,w0=ME.f,iY=Py,N0=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];Q2.f=function(e){return N0&&eY(e)=="Window"?function(t){try{return w0(t)}catch{return iY(N0)}}(e):w0(tY(e))};var Dd={},rY=Zt;Dd.f=rY;var D0=Tn,aY=Gi,nY=Dd,sY=$a.f,Di=function(e){var t=D0.Symbol||(D0.Symbol={});aY(t,e)||sY(t,e,{value:nY.f(e)})},oY=xi,cY=jr,lY=Zt,dY=Uo,Z2=function(){var e=cY("Symbol"),t=e&&e.prototype,i=t&&t.valueOf,r=lY("toPrimitive");t&&!t[r]&&dY(t,r,function(a){return oY(i,this)},{})},uY=ko,hY=NE,pY=Xn,fY=Ps,_Y=q2,P0=ii([].push),EY=function(e){var t=e==1,i=e==2,r=e==3,a=e==4,s=e==6,c=e==7,l=e==5||s;return function(u,h,p,_){for(var m,S,C=pY(u),v=hY(C),y=uY(h,p),I=fY(v),O=0,P=_||_Y,U=t?P(u,I):i||c?P(u,0):void 0;I>O;O++)if((l||O in v)&&(S=y(m=v[O],O,C),e))if(t)U[O]=S;else if(S)switch(e){case 3:return!0;case 5:return m;case 6:return O;case 2:P0(U,m)}else switch(e){case 4:return!1;case 7:P0(U,m)}return s?-1:r||a?a:U}},$2={forEach:EY(0)},Ff=_t,Uy=Mi,xy=xi,mY=ii,sd=Ta,Il=Id,gY=si,hr=Gi,SY=_r,mv=Nr,KE=Lo,Vy=PE,TY=Ra,gv=Po,Nh=ap,ex=xE,RY=ME,tx=Q2,vY=rp,ix=$h,rx=$a,yY=Sy,ax=wE,L0=Uo,CY=BE,By=wd,nx=UE,k0=dy,bY=Zt,AY=Dd,IY=Di,OY=Z2,wY=xo,sx=jc,zE=$2.forEach,Jr=kE("hidden"),sE="Symbol",Dh="prototype",NY=sx.set,M0=sx.getterFor(sE),mn=Object[Dh],ql=Uy.Symbol,k_=ql&&ql[Dh],DY=Uy.TypeError,pT=Uy.QObject,ox=ix.f,Ec=rx.f,cx=tx.f,PY=ax.f,lx=mY([].push),Ds=By("symbols"),dp=By("op-symbols"),LY=By("wks"),fT=!pT||!pT[Dh]||!pT[Dh].findChild,Sv=sd&&gY(function(){return Nh(Ec({},"a",{get:function(){return Ec(this,"a",{value:7}).a}})).a!=7})?function(e,t,i){var r=ox(mn,t);r&&delete mn[t],Ec(e,t,i),r&&e!==mn&&Ec(mn,t,r)}:Ec,_T=function(e,t){var i=Ds[e]=Nh(k_);return NY(i,{type:sE,tag:e,description:t}),sd||(i.description=t),i},oE=function(e,t,i){e===mn&&oE(dp,t,i),mv(e);var r=Vy(t);return mv(i),hr(Ds,r)?(i.enumerable?(hr(e,Jr)&&e[Jr][r]&&(e[Jr][r]=!1),i=Nh(i,{enumerable:gv(0,!1)})):(hr(e,Jr)||Ec(e,Jr,gv(1,{})),e[Jr][r]=!0),Sv(e,r,i)):Ec(e,r,i)},ET=function(e,t){mv(e);var i=KE(t),r=ex(i).concat(ux(i));return zE(r,function(a){sd&&!xy(dx,i,a)||oE(e,a,i[a])}),e},dx=function(e){var t=Vy(e),i=xy(PY,this,t);return!(this===mn&&hr(Ds,t)&&!hr(dp,t))&&(!(i||!hr(this,t)||!hr(Ds,t)||hr(this,Jr)&&this[Jr][t])||i)},U0=function(e,t){var i=KE(e),r=Vy(t);if(i!==mn||!hr(Ds,r)||hr(dp,r)){var a=ox(i,r);return!a||!hr(Ds,r)||hr(i,Jr)&&i[Jr][r]||(a.enumerable=!0),a}},x0=function(e){var t=cx(KE(e)),i=[];return zE(t,function(r){hr(Ds,r)||hr(nx,r)||lx(i,r)}),i},ux=function(e){var t=e===mn,i=cx(t?dp:KE(e)),r=[];return zE(i,function(a){!hr(Ds,a)||t&&!hr(mn,a)||lx(r,Ds[a])}),r};Il||(L0(k_=(ql=function(){if(SY(k_,this))throw DY("Symbol is not a constructor");var e=arguments.length&&arguments[0]!==void 0?TY(arguments[0]):void 0,t=k0(e),i=function(r){this===mn&&xy(i,dp,r),hr(this,Jr)&&hr(this[Jr],t)&&(this[Jr][t]=!1),Sv(this,t,gv(1,r))};return sd&&fT&&Sv(mn,t,{configurable:!0,set:i}),_T(t,e)})[Dh],"toString",function(){return M0(this).tag}),L0(ql,"withoutSetter",function(e){return _T(k0(e),e)}),ax.f=dx,rx.f=oE,yY.f=ET,ix.f=U0,RY.f=tx.f=x0,vY.f=ux,AY.f=function(e){return _T(bY(e),e)},sd&&CY(k_,"description",{configurable:!0,get:function(){return M0(this).description}})),Ff({global:!0,wrap:!0,forced:!Il,sham:!Il},{Symbol:ql}),zE(ex(LY),function(e){IY(e)}),Ff({target:sE,stat:!0,forced:!Il},{useSetter:function(){fT=!0},useSimple:function(){fT=!1}}),Ff({target:"Object",stat:!0,forced:!Il,sham:!sd},{create:function(e,t){return t===void 0?Nh(e):ET(Nh(e),t)},defineProperty:oE,defineProperties:ET,getOwnPropertyDescriptor:U0}),Ff({target:"Object",stat:!0,forced:!Il},{getOwnPropertyNames:x0}),OY(),wY(ql,sE),nx[Jr]=!0;var hx=Id&&!!Symbol.for&&!!Symbol.keyFor,kY=_t,MY=jr,UY=Gi,xY=Ra,px=wd,VY=hx,mT=px("string-to-symbol-registry"),BY=px("symbol-to-string-registry");kY({target:"Symbol",stat:!0,forced:!VY},{for:function(e){var t=xY(e);if(UY(mT,t))return mT[t];var i=MY("Symbol")(t);return mT[t]=i,BY[i]=t,i}});var jY=_t,FY=Gi,GY=ep,HY=Od,WY=hx,V0=wd("symbol-to-string-registry");jY({target:"Symbol",stat:!0,forced:!WY},{keyFor:function(e){if(!GY(e))throw TypeError(HY(e)+" is not a symbol");if(FY(V0,e))return V0[e]}});var B0=lp,KY=Ui,j0=qn,zY=Ra,F0=ii([].push),YY=_t,fx=jr,_x=cy,qY=xi,up=ii,Ex=si,G0=Ui,H0=ep,mx=Ay,XY=function(e){if(KY(e))return e;if(B0(e)){for(var t=e.length,i=[],r=0;r<t;r++){var a=e[r];typeof a=="string"?F0(i,a):typeof a!="number"&&j0(a)!="Number"&&j0(a)!="String"||F0(i,zY(a))}var s=i.length,c=!0;return function(l,u){if(c)return c=!1,u;if(B0(this))return u;for(var h=0;h<s;h++)if(i[h]===l)return u}}},JY=Id,QY=String,yo=fx("JSON","stringify"),Gf=up(/./.exec),W0=up("".charAt),ZY=up("".charCodeAt),$Y=up("".replace),eq=up(1 .toString),tq=/[\uD800-\uDFFF]/g,K0=/^[\uD800-\uDBFF]$/,z0=/^[\uDC00-\uDFFF]$/,Y0=!JY||Ex(function(){var e=fx("Symbol")();return yo([e])!="[null]"||yo({a:e})!="{}"||yo(Object(e))!="{}"}),q0=Ex(function(){return yo("\uDF06\uD834")!=='"\\udf06\\ud834"'||yo("\uDEAD")!=='"\\udead"'}),iq=function(e,t){var i=mx(arguments),r=XY(t);if(G0(r)||e!==void 0&&!H0(e))return i[1]=function(a,s){if(G0(r)&&(s=qY(r,this,QY(a),s)),!H0(s))return s},_x(yo,null,i)},rq=function(e,t,i){var r=W0(i,t-1),a=W0(i,t+1);return Gf(K0,e)&&!Gf(z0,a)||Gf(z0,e)&&!Gf(K0,r)?"\\u"+eq(ZY(e,0),16):e};yo&&YY({target:"JSON",stat:!0,forced:Y0||q0},{stringify:function(e,t,i){var r=mx(arguments),a=_x(Y0?iq:yo,null,r);return q0&&typeof a=="string"?$Y(a,tq,rq):a}});var X0=rp,aq=Xn;_t({target:"Object",stat:!0,forced:!Id||si(function(){X0.f(1)})},{getOwnPropertySymbols:function(e){var t=X0.f;return t?t(aq(e)):[]}}),Di("asyncIterator"),Di("hasInstance"),Di("isConcatSpreadable"),Di("iterator"),Di("match"),Di("matchAll"),Di("replace"),Di("search"),Di("species"),Di("split");var nq=Z2;Di("toPrimitive"),nq();var sq=jr,oq=xo;Di("toStringTag"),oq(sq("Symbol"),"Symbol"),Di("unscopables"),xo(Mi.JSON,"JSON",!0);var cq=Tn.Symbol,lq=Zt,dq=$a.f,J0=lq("metadata"),Q0=Function.prototype;Q0[J0]===void 0&&dq(Q0,J0,{value:null}),Di("dispose"),Di("metadata");var uq=cq;Di("asyncDispose");var hq=ii,jy=jr("Symbol"),pq=jy.keyFor,fq=hq(jy.prototype.valueOf),gx=jy.isRegisteredSymbol||function(e){try{return pq(fq(e))!==void 0}catch{return!1}};_t({target:"Symbol",stat:!0},{isRegisteredSymbol:gx});for(Z0=wd,ST=jr,$0=ii,eN=ep,tN=Zt,Gu=ST("Symbol"),Tv=Gu.isWellKnownSymbol,Rv=ST("Object","getOwnPropertyNames"),Sx=$0(Gu.prototype.valueOf),vv=Z0("wks"),Hf=0,TT=Rv(Gu),iN=TT.length;Hf<iN;Hf++)try{gT=TT[Hf],eN(Gu[gT])&&tN(gT)}catch{}var gT,Z0,ST,$0,eN,tN,Gu,Tv,Rv,Sx,vv,Hf,TT,iN,rN=function(e){if(Tv&&Tv(e))return!0;try{for(var t=Sx(e),i=0,r=Rv(vv),a=r.length;i<a;i++)if(vv[r[i]]==t)return!0}catch{}return!1};_t({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:rN}),Di("matcher"),Di("observable"),_t({target:"Symbol",stat:!0},{isRegistered:gx}),_t({target:"Symbol",stat:!0,forced:!0},{isWellKnown:rN}),Di("metadataKey"),Di("patternMatch"),Di("replaceAll");var Xl=zt(uq),Tx=zt(Dd.f("iterator"));function gh(e){return gh=typeof Xl=="function"&&typeof Tx=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Xl=="function"&&t.constructor===Xl&&t!==Xl.prototype?"symbol":typeof t},gh(e)}var _q=zt(Dd.f("toPrimitive"));function Eq(e){var t=function(i,r){if(gh(i)!=="object"||i===null)return i;var a=i[_q];if(a!==void 0){var s=a.call(i,r);if(gh(s)!=="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(i)}(e,"string");return gh(t)==="symbol"?t:String(t)}function b(e,t,i){return(t=Eq(t))in e?Y2(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var mq=si,gq=Zt("iterator"),Fy=!mq(function(){var e=new URL("b?a=1&b=2&c=3","http://a"),t=e.searchParams,i=new URLSearchParams("a=1&a=2"),r="";return e.pathname="c%20d",t.forEach(function(a,s){t.delete("b"),r+=s+a}),i.delete("a",2),!e.toJSON||!i.has("a",1)||i.has("a",2)||!t.size&&!0||!t.sort||e.href!=="http://a/c%20d?a=1&c=3"||t.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!t[gq]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("http://тест").host!=="xn--e1aybc"||new URL("http://a#б").hash!=="#%D0%B1"||r!=="a1c3"||new URL("http://x",void 0).host!=="x"}),Sq=Uo,RT=_t,fd=Mi,Wf=xi,zn=ii,Jl=Ta,aN=Fy,nN=Uo,Tq=BE,Rq=function(e,t,i){for(var r in t)i&&i.unsafe&&e[r]?e[r]=t[r]:Sq(e,r,t[r],i);return e},vq=xo,yq=Ry,Gy=jc,Rx=yy,vT=Ui,Cq=Gi,bq=ko,Aq=Jn,Iq=Nr,vx=ia,Ur=Ra,Oq=ap,sN=Po,yv=Ty,wq=VE,Ol=FE,Nq=V2,Dq=Zt("iterator"),Ph="URLSearchParams",yx=Ph+"Iterator",Cx=Gy.set,Wa=Gy.getterFor(Ph),Pq=Gy.getterFor(yx),Lq=Object.getOwnPropertyDescriptor,Hy=function(e){if(!Jl)return fd[e];var t=Lq(fd,e);return t&&t.value},oN=Hy("fetch"),cE=Hy("Request"),Sh=Hy("Headers"),yT=cE&&cE.prototype,cN=Sh&&Sh.prototype,kq=fd.RegExp,Mq=fd.TypeError,bx=fd.decodeURIComponent,Uq=fd.encodeURIComponent,xq=zn("".charAt),lN=zn([].join),Tc=zn([].push),Cv=zn("".replace),Vq=zn([].shift),dN=zn([].splice),uN=zn("".split),Bq=zn("".slice),jq=/\+/g,hN=Array(4),Fq=function(e){return hN[e-1]||(hN[e-1]=kq("((?:%[\\da-f]{2}){"+e+"})","gi"))},Gq=function(e){try{return bx(e)}catch{return e}},pN=function(e){var t=Cv(e,jq," "),i=4;try{return bx(t)}catch{for(;i;)t=Cv(t,Fq(i--),Gq);return t}},Hq=/[!'()~]|%20/g,Wq={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},Kq=function(e){return Wq[e]},fN=function(e){return Cv(Uq(e),Hq,Kq)},CT=yq(function(e,t){Cx(this,{type:yx,iterator:yv(Wa(e).entries),kind:t})},"Iterator",function(){var e=Pq(this),t=e.kind,i=e.iterator.next(),r=i.value;return i.done||(i.value=t==="keys"?r.key:t==="values"?r.value:[r.key,r.value]),i},!0),Ax=function(e){this.entries=[],this.url=null,e!==void 0&&(vx(e)?this.parseObject(e):this.parseQuery(typeof e=="string"?xq(e,0)==="?"?Bq(e,1):e:Ur(e)))};Ax.prototype={type:Ph,bindURL:function(e){this.url=e,this.update()},parseObject:function(e){var t,i,r,a,s,c,l,u=wq(e);if(u)for(i=(t=yv(e,u)).next;!(r=Wf(i,t)).done;){if(s=(a=yv(Iq(r.value))).next,(c=Wf(s,a)).done||(l=Wf(s,a)).done||!Wf(s,a).done)throw Mq("Expected sequence with length 2");Tc(this.entries,{key:Ur(c.value),value:Ur(l.value)})}else for(var h in e)Cq(e,h)&&Tc(this.entries,{key:h,value:Ur(e[h])})},parseQuery:function(e){if(e)for(var t,i,r=uN(e,"&"),a=0;a<r.length;)(t=r[a++]).length&&(i=uN(t,"="),Tc(this.entries,{key:pN(Vq(i)),value:pN(lN(i,"="))}))},serialize:function(){for(var e,t=this.entries,i=[],r=0;r<t.length;)e=t[r++],Tc(i,fN(e.key)+"="+fN(e.value));return lN(i,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var lE=function(){Rx(this,Gl);var e=Cx(this,new Ax(arguments.length>0?arguments[0]:void 0));Jl||(this.size=e.entries.length)},Gl=lE.prototype;Rq(Gl,{append:function(e,t){var i=Wa(this);Ol(arguments.length,2),Tc(i.entries,{key:Ur(e),value:Ur(t)}),Jl||this.length++,i.updateURL()},delete:function(e){for(var t=Wa(this),i=Ol(arguments.length,1),r=t.entries,a=Ur(e),s=i<2?void 0:arguments[1],c=s===void 0?s:Ur(s),l=0;l<r.length;){var u=r[l];if(u.key!==a||c!==void 0&&u.value!==c)l++;else if(dN(r,l,1),c!==void 0)break}Jl||(this.size=r.length),t.updateURL()},get:function(e){var t=Wa(this).entries;Ol(arguments.length,1);for(var i=Ur(e),r=0;r<t.length;r++)if(t[r].key===i)return t[r].value;return null},getAll:function(e){var t=Wa(this).entries;Ol(arguments.length,1);for(var i=Ur(e),r=[],a=0;a<t.length;a++)t[a].key===i&&Tc(r,t[a].value);return r},has:function(e){for(var t=Wa(this).entries,i=Ol(arguments.length,1),r=Ur(e),a=i<2?void 0:arguments[1],s=a===void 0?a:Ur(a),c=0;c<t.length;){var l=t[c++];if(l.key===r&&(s===void 0||l.value===s))return!0}return!1},set:function(e,t){var i=Wa(this);Ol(arguments.length,1);for(var r,a=i.entries,s=!1,c=Ur(e),l=Ur(t),u=0;u<a.length;u++)(r=a[u]).key===c&&(s?dN(a,u--,1):(s=!0,r.value=l));s||Tc(a,{key:c,value:l}),Jl||(this.size=a.length),i.updateURL()},sort:function(){var e=Wa(this);Nq(e.entries,function(t,i){return t.key>i.key?1:-1}),e.updateURL()},forEach:function(e){for(var t,i=Wa(this).entries,r=bq(e,arguments.length>1?arguments[1]:void 0),a=0;a<i.length;)r((t=i[a++]).value,t.key,this)},keys:function(){return new CT(this,"keys")},values:function(){return new CT(this,"values")},entries:function(){return new CT(this,"entries")}},{enumerable:!0}),nN(Gl,Dq,Gl.entries,{}),nN(Gl,"toString",function(){return Wa(this).serialize()},{enumerable:!0}),Jl&&Tq(Gl,"size",{get:function(){return Wa(this).entries.length},configurable:!0,enumerable:!0}),vq(lE,Ph),RT({global:!0,forced:!aN},{URLSearchParams:lE}),!aN&&vT(Sh)&&(_N=zn(cN.has),EN=zn(cN.set),bT=function(e){if(vx(e)){var t,i=e.body;if(Aq(i)===Ph)return t=e.headers?new Sh(e.headers):new Sh,_N(t,"content-type")||EN(t,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),Oq(e,{body:sN(0,Ur(i)),headers:sN(0,t)})}return e},vT(oN)&&RT({global:!0,dontCallGetSet:!0,forced:!0},{fetch:function(e){return oN(e,arguments.length>1?bT(arguments[1]):{})}}),vT(cE)&&(Kf=function(e){return Rx(this,yT),new cE(e,arguments.length>1?bT(arguments[1]):{})},yT.constructor=Kf,Kf.prototype=yT,RT({global:!0,dontCallGetSet:!0,forced:!0},{Request:Kf})));var _N,EN,bT,Kf,zq={URLSearchParams:lE,getState:Wa},mN=zt(Tn.URLSearchParams),Yq={isBrowser:!0,classes:{URLSearchParams:mN!==void 0?mN:My,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]},Ix=typeof window<"u"&&typeof document<"u",qq=(gN=typeof navigator<"u"&&navigator.product,Ix&&["ReactNative","NativeScript","NS"].indexOf(gN)<0),gN,Xq=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function";function SN(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),i.push.apply(i,r)}return i}function TN(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?SN(Object(i),!0).forEach(function(r){b(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):SN(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}var Fn=TN(TN({},Object.freeze({__proto__:null,hasBrowserEnv:Ix,hasStandardBrowserEnv:qq,hasStandardBrowserWebWorkerEnv:Xq})),Yq),Jq=Nr,Qq=xi,Zq=Gi,$q=_r,e7=function(){var e=Jq(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t},RN=RegExp.prototype,Ox=function(e){var t=e.flags;return t!==void 0||"flags"in RN||Zq(e,"flags")||!$q(RN,e)?t:Qq(e7,e)},t7=Dy.charAt,vN=xi,i7=Nr,r7=Ui,a7=qn,n7=/./.exec,s7=TypeError,o7=_t,yN=xi,wx=Oh,c7=Ry,zf=vy,CN=Ad,Nx=cU,Lh=Ra,l7=Nr,d7=bd,u7=qn,h7=lU,Dx=Ox,p7=DE,f7=si,_7=by,E7=function(e,t,i){return t+(i?t7(e,t).length:1)},m7=function(e,t){var i=e.exec;if(r7(i)){var r=vN(i,e,t);return r!==null&&i7(r),r}if(a7(e)==="RegExp")return vN(n7,e,t);throw s7("RegExp#exec called on incompatible receiver")},Px=jc,g7=Zt("matchAll"),Lx="RegExp String",kx=Lx+" Iterator",S7=Px.set,T7=Px.getterFor(kx),R7=TypeError,bv=wx("".indexOf),dE=wx("".matchAll),AT=!!dE&&!f7(function(){dE("a",/./)}),v7=c7(function(e,t,i,r){S7(this,{type:kx,regexp:e,string:t,global:i,unicode:r,done:!1})},Lx,function(){var e=T7(this);if(e.done)return zf(void 0,!0);var t=e.regexp,i=e.string,r=m7(t,i);return r===null?(e.done=!0,zf(void 0,!0)):e.global?(Lh(r[0])===""&&(t.lastIndex=E7(i,Nx(t.lastIndex),e.unicode)),zf(r,!1)):(e.done=!0,zf(r,!1))}),bN=function(e){var t,i,r,a=l7(this),s=Lh(e),c=_7(a,RegExp),l=Lh(Dx(a));return t=new c(c===RegExp?a.source:a,l),i=!!~bv(l,"g"),r=!!~bv(l,"u"),t.lastIndex=Nx(a.lastIndex),new v7(t,s,i,r)};o7({target:"String",proto:!0,forced:AT},{matchAll:function(e){var t,i,r,a,s=CN(this);if(d7(e)){if(AT)return dE(s,e)}else{if(h7(e)&&(t=Lh(CN(Dx(e))),!~bv(t,"g")))throw R7("`.matchAll` does not allow non-global regexes");if(AT)return dE(s,e);if((r=p7(e,g7))===void 0&&u7(e)=="RegExp"&&(r=bN),r)return yN(r,e,s)}return i=Lh(s),a=new RegExp(e,"g"),yN(bN,a,i)}});var y7=en("String").matchAll,C7=_r,b7=y7,IT=String.prototype,A7=function(e){var t=e.matchAll;return typeof e=="string"||e===IT||C7(IT,e)&&t===IT.matchAll?b7:t},I7=zt(A7);function Mx(e){function t(i,r,a,s){let c=i[s++];if(c==="__proto__")return!0;let l=Number.isFinite(+c),u=s>=i.length;return c=!c&&le.isArray(a)?a.length:c,u?(le.hasOwnProp(a,c)?a[c]=[a[c],r]:a[c]=r,!l):(a[c]&&le.isObject(a[c])||(a[c]=[]),t(i,r,a[c],s)&&le.isArray(a[c])&&(a[c]=function(h){let p={},_=Object.keys(h),m,S=_.length,C;for(m=0;m<S;m++)C=_[m],p[C]=h[C];return p}(a[c])),!l)}if(le.isFormData(e)&&le.isFunction(e.entries)){let i={};return le.forEachEntry(e,(r,a)=>{t(function(s){return I7(le).call(le,/\w+|\[(\w*)]/g,s).map(c=>c[0]==="[]"?"":c[1]||c[0])}(r),a,i,0)}),i}return null}var Wy={transitional:W2,adapter:["xhr","http"],transformRequest:[function(e,t){let i=t.getContentType()||"",r=i.indexOf("application/json")>-1,a=le.isObject(e);if(a&&le.isHTMLForm(e)&&(e=new FormData(e)),le.isFormData(e))return r?JSON.stringify(Mx(e)):e;if(le.isArrayBuffer(e)||le.isBuffer(e)||le.isStream(e)||le.isFile(e)||le.isBlob(e))return e;if(le.isArrayBufferView(e))return e.buffer;if(le.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let s;if(a){if(i.indexOf("application/x-www-form-urlencoded")>-1)return function(c,l){return nE(c,new Fn.classes.URLSearchParams,Object.assign({visitor:function(u,h,p,_){return Fn.isNode&&le.isBuffer(u)?(this.append(h,u.toString("base64")),!1):_.defaultVisitor.apply(this,arguments)}},l))}(e,this.formSerializer).toString();if((s=le.isFileList(e))||i.indexOf("multipart/form-data")>-1){let c=this.env&&this.env.FormData;return nE(s?{"files[]":e}:e,c&&new c,this.formSerializer)}}return a||r?(t.setContentType("application/json",!1),function(c,l,u){if(le.isString(c))try{return(l||JSON.parse)(c),ir(le).call(le,c)}catch(h){if(h.name!=="SyntaxError")throw h}return(0,JSON.stringify)(c)}(e)):e}],transformResponse:[function(e){let t=this.transitional||Wy.transitional,i=t&&t.forcedJSONParsing,r=this.responseType==="json";if(e&&le.isString(e)&&(i&&!this.responseType||r)){let a=!(t&&t.silentJSONParsing)&&r;try{return JSON.parse(e)}catch(s){if(a)throw s.name==="SyntaxError"?Nt.from(s,Nt.ERR_BAD_RESPONSE,this,null,this.response):s}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Fn.classes.FormData,Blob:Fn.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};le.forEach(["delete","get","head","post","put","patch"],e=>{Wy.headers[e]={}});var Ky=Wy,O7=le.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),AN=Symbol("internals");function Hu(e){var t;return e&&ir(t=String(e)).call(t).toLowerCase()}function M_(e){return e===!1||e==null?e:le.isArray(e)?e.map(M_):String(e)}function OT(e,t,i,r,a){return le.isFunction(r)?r.call(this,t,i):(a&&(t=i),le.isString(t)?le.isString(r)?t.indexOf(r)!==-1:le.isRegExp(r)?r.test(t):void 0:void 0)}var U_=class{constructor(e){e&&this.set(e)}set(e,t,i){let r=this;function a(l,u,h){let p=Hu(u);if(!p)throw new Error("header name must be a non-empty string");let _=le.findKey(r,p);(!_||r[_]===void 0||h===!0||h===void 0&&r[_]!==!1)&&(r[_||u]=M_(l))}let s=(l,u)=>le.forEach(l,(h,p)=>a(h,p,u));var c;return le.isPlainObject(e)||e instanceof this.constructor?s(e,t):le.isString(e)&&(e=ir(e).call(e))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(ir(c=e).call(c))?s((l=>{let u={},h,p,_;return l&&l.split(`
`).forEach(function(m){var S,C;_=m.indexOf(":"),h=ir(S=m.substring(0,_)).call(S).toLowerCase(),p=ir(C=m.substring(_+1)).call(C),!h||u[h]&&O7[h]||(h==="set-cookie"?u[h]?u[h].push(p):u[h]=[p]:u[h]=u[h]?u[h]+", "+p:p)}),u})(e),t):e!=null&&a(t,e,i),this}get(e,t){if(e=Hu(e)){let i=le.findKey(this,e);if(i){let r=this[i];if(!t)return r;if(t===!0)return function(a){let s=Object.create(null),c=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g,l;for(;l=c.exec(a);)s[l[1]]=l[2];return s}(r);if(le.isFunction(t))return t.call(this,r,i);if(le.isRegExp(t))return t.exec(r);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=Hu(e)){let i=le.findKey(this,e);return!(!i||this[i]===void 0||t&&!OT(0,this[i],i,t))}return!1}delete(e,t){let i=this,r=!1;function a(s){if(s=Hu(s)){let c=le.findKey(i,s);!c||t&&!OT(0,i[c],c,t)||(delete i[c],r=!0)}}return le.isArray(e)?e.forEach(a):a(e),r}clear(e){let t=Object.keys(this),i=t.length,r=!1;for(;i--;){let a=t[i];e&&!OT(0,this[a],a,e,!0)||(delete this[a],r=!0)}return r}normalize(e){let t=this,i={};return le.forEach(this,(r,a)=>{var s;let c=le.findKey(i,a);if(c)return t[c]=M_(r),void delete t[a];let l=e?function(u){return ir(u).call(u).toLowerCase().replace(/([a-z\d])(\w*)/g,(h,p,_)=>p.toUpperCase()+_)}(a):ir(s=String(a)).call(s);l!==a&&delete t[a],t[l]=M_(r),i[l]=!0}),this}concat(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return this.constructor.concat(this,...t)}toJSON(e){let t=Object.create(null);return le.forEach(this,(i,r)=>{i!=null&&i!==!1&&(t[r]=e&&le.isArray(i)?i.join(", "):i)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(e=>{let[t,i]=e;return t+": "+i}).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e){let t=new this(e);for(var i=arguments.length,r=new Array(i>1?i-1:0),a=1;a<i;a++)r[a-1]=arguments[a];return r.forEach(s=>t.set(s)),t}static accessor(e){let t=(this[AN]=this[AN]={accessors:{}}).accessors,i=this.prototype;function r(a){let s=Hu(a);t[s]||(function(c,l){let u=le.toCamelCase(" "+l);["get","set","has"].forEach(h=>{Object.defineProperty(c,h+u,{value:function(p,_,m){return this[h].call(this,l,p,_,m)},configurable:!0})})}(i,a),t[s]=!0)}return le.isArray(e)?e.forEach(r):r(e),this}};U_.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),le.reduceDescriptors(U_.prototype,(e,t)=>{let{value:i}=e,r=t[0].toUpperCase()+t.slice(1);return{get:()=>i,set(a){this[r]=a}}}),le.freezeMethods(U_);var ws=U_;function wT(e,t){let i=this||Ky,r=t||i,a=ws.from(r.headers),s=r.data;return le.forEach(e,function(c){s=c.call(i,s,a.normalize(),t?t.status:void 0)}),a.normalize(),s}function Ux(e){return!(!e||!e.__CANCEL__)}function hp(e,t,i){Nt.call(this,e??"canceled",Nt.ERR_CANCELED,t,i),this.name="CanceledError"}le.inherits(hp,Nt,{__CANCEL__:!0});var w7=Fn.hasStandardBrowserEnv?{write(e,t,i,r,a,s){let c=[e+"="+encodeURIComponent(t)];le.isNumber(i)&&c.push("expires="+new Date(i).toGMTString()),le.isString(r)&&c.push("path="+r),le.isString(a)&&c.push("domain="+a),s===!0&&c.push("secure"),document.cookie=c.join("; ")},read(e){let t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function xx(e,t){return e&&!function(i){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(i)}(t)?function(i,r){return r?i.replace(/\/?\/$/,"")+"/"+r.replace(/^\/+/,""):i}(e,t):t}var N7=Fn.hasStandardBrowserEnv?function(){let e=/(msie|trident)/i.test(navigator.userAgent),t=document.createElement("a"),i;function r(a){let s=a;return e&&(t.setAttribute("href",s),s=t.href),t.setAttribute("href",s),{href:t.href,protocol:t.protocol?t.protocol.replace(/:$/,""):"",host:t.host,search:t.search?t.search.replace(/^\?/,""):"",hash:t.hash?t.hash.replace(/^#/,""):"",hostname:t.hostname,port:t.port,pathname:t.pathname.charAt(0)==="/"?t.pathname:"/"+t.pathname}}return i=r(window.location.href),function(a){let s=le.isString(a)?r(a):a;return s.protocol===i.protocol&&s.host===i.host}}():function(){return!0};function IN(e,t){let i=0,r=function(a,s){a=a||10;let c=new Array(a),l=new Array(a),u,h=0,p=0;return s=s!==void 0?s:1e3,function(_){let m=Date.now(),S=l[p];u||(u=m),c[h]=_,l[h]=m;let C=p,v=0;for(;C!==h;)v+=c[C++],C%=a;if(h=(h+1)%a,h===p&&(p=(p+1)%a),m-u<s)return;let y=S&&m-S;return y?Math.round(1e3*v/y):void 0}}(50,250);return a=>{let s=a.loaded,c=a.lengthComputable?a.total:void 0,l=s-i,u=r(l);i=s;let h={loaded:s,total:c,progress:c?s/c:void 0,bytes:l,rate:u||void 0,estimated:u&&c&&s<=c?(c-s)/u:void 0,event:a};h[t?"download":"upload"]=!0,e(h)}}var D7=typeof XMLHttpRequest<"u"&&function(e){return new ae(function(t,i){let r=e.data,a=ws.from(e.headers).normalize(),s,c,{responseType:l,withXSRFToken:u}=e;function h(){e.cancelToken&&e.cancelToken.unsubscribe(s),e.signal&&e.signal.removeEventListener("abort",s)}if(le.isFormData(r)){if(Fn.hasStandardBrowserEnv||Fn.hasStandardBrowserWebWorkerEnv)a.setContentType(!1);else if((c=a.getContentType())!==!1){let[C,...v]=c?c.split(";").map(y=>ir(y).call(y)).filter(Boolean):[];a.setContentType([C||"multipart/form-data",...v].join("; "))}}let p=new XMLHttpRequest;if(e.auth){let C=e.auth.username||"",v=e.auth.password?unescape(encodeURIComponent(e.auth.password)):"";a.set("Authorization","Basic "+btoa(C+":"+v))}let _=xx(e.baseURL,e.url);function m(){if(!p)return;let C=ws.from("getAllResponseHeaders"in p&&p.getAllResponseHeaders());(function(v,y,I){let O=I.config.validateStatus;I.status&&O&&!O(I.status)?y(new Nt("Request failed with status code "+I.status,[Nt.ERR_BAD_REQUEST,Nt.ERR_BAD_RESPONSE][Math.floor(I.status/100)-4],I.config,I.request,I)):v(I)})(function(v){t(v),h()},function(v){i(v),h()},{data:l&&l!=="text"&&l!=="json"?p.response:p.responseText,status:p.status,statusText:p.statusText,headers:C,config:e,request:p}),p=null}if(p.open(e.method.toUpperCase(),H2(_,e.params,e.paramsSerializer),!0),p.timeout=e.timeout,"onloadend"in p?p.onloadend=m:p.onreadystatechange=function(){p&&p.readyState===4&&(p.status!==0||p.responseURL&&p.responseURL.indexOf("file:")===0)&&setTimeout(m)},p.onabort=function(){p&&(i(new Nt("Request aborted",Nt.ECONNABORTED,e,p)),p=null)},p.onerror=function(){i(new Nt("Network Error",Nt.ERR_NETWORK,e,p)),p=null},p.ontimeout=function(){let C=e.timeout?"timeout of "+e.timeout+"ms exceeded":"timeout exceeded",v=e.transitional||W2;e.timeoutErrorMessage&&(C=e.timeoutErrorMessage),i(new Nt(C,v.clarifyTimeoutError?Nt.ETIMEDOUT:Nt.ECONNABORTED,e,p)),p=null},Fn.hasStandardBrowserEnv&&(u&&le.isFunction(u)&&(u=u(e)),u||u!==!1&&N7(_))){let C=e.xsrfHeaderName&&e.xsrfCookieName&&w7.read(e.xsrfCookieName);C&&a.set(e.xsrfHeaderName,C)}r===void 0&&a.setContentType(null),"setRequestHeader"in p&&le.forEach(a.toJSON(),function(C,v){p.setRequestHeader(v,C)}),le.isUndefined(e.withCredentials)||(p.withCredentials=!!e.withCredentials),l&&l!=="json"&&(p.responseType=e.responseType),typeof e.onDownloadProgress=="function"&&p.addEventListener("progress",IN(e.onDownloadProgress,!0)),typeof e.onUploadProgress=="function"&&p.upload&&p.upload.addEventListener("progress",IN(e.onUploadProgress)),(e.cancelToken||e.signal)&&(s=C=>{p&&(i(!C||C.type?new hp(null,e,p):C),p.abort(),p=null)},e.cancelToken&&e.cancelToken.subscribe(s),e.signal&&(e.signal.aborted?s():e.signal.addEventListener("abort",s)));let S=function(C){let v=/^([-+\w]{1,25})(:?\/\/|:)/.exec(C);return v&&v[1]||""}(_);S&&Fn.protocols.indexOf(S)===-1?i(new Nt("Unsupported protocol "+S+":",Nt.ERR_BAD_REQUEST,e)):p.send(r||null)})},Av={http:null,xhr:D7};le.forEach(Av,(e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch{}Object.defineProperty(e,"adapterName",{value:t})}});var ON=e=>"- ".concat(e),P7=e=>le.isFunction(e)||e===null||e===!1,Vx={getAdapter:e=>{e=le.isArray(e)?e:[e];let{length:t}=e,i,r,a={};for(let s=0;s<t;s++){let c;if(i=e[s],r=i,!P7(i)&&(r=Av[(c=String(i)).toLowerCase()],r===void 0))throw new Nt("Unknown adapter '".concat(c,"'"));if(r)break;a[c||"#"+s]=r}if(!r){let s=Object.entries(a).map(c=>{let[l,u]=c;return"adapter ".concat(l," ")+(u===!1?"is not supported by the environment":"is not available in the build")});throw new Nt("There is no suitable adapter to dispatch the request "+(t?s.length>1?`since :
`+s.map(ON).join(`
`):" "+ON(s[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return r},adapters:Av};function NT(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new hp(null,e)}function wN(e){return NT(e),e.headers=ws.from(e.headers),e.data=wT.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),Vx.getAdapter(e.adapter||Ky.adapter)(e).then(function(t){return NT(e),t.data=wT.call(e,e.transformResponse,t),t.headers=ws.from(t.headers),t},function(t){return Ux(t)||(NT(e),t&&t.response&&(t.response.data=wT.call(e,e.transformResponse,t.response),t.response.headers=ws.from(t.response.headers))),ae.reject(t)})}function NN(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),i.push.apply(i,r)}return i}var DN=e=>e instanceof ws?function(t){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?NN(Object(r),!0).forEach(function(a){b(t,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):NN(Object(r)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(r,a))})}return t}({},e):e;function _d(e,t){t=t||{};let i={};function r(h,p,_){return le.isPlainObject(h)&&le.isPlainObject(p)?le.merge.call({caseless:_},h,p):le.isPlainObject(p)?le.merge({},p):le.isArray(p)?p.slice():p}function a(h,p,_){return le.isUndefined(p)?le.isUndefined(h)?void 0:r(void 0,h,_):r(h,p,_)}function s(h,p){if(!le.isUndefined(p))return r(void 0,p)}function c(h,p){return le.isUndefined(p)?le.isUndefined(h)?void 0:r(void 0,h):r(void 0,p)}function l(h,p,_){return _ in t?r(h,p):_ in e?r(void 0,h):void 0}let u={url:s,method:s,data:s,baseURL:c,transformRequest:c,transformResponse:c,paramsSerializer:c,timeout:c,timeoutMessage:c,withCredentials:c,withXSRFToken:c,adapter:c,responseType:c,xsrfCookieName:c,xsrfHeaderName:c,onUploadProgress:c,onDownloadProgress:c,decompress:c,maxContentLength:c,maxBodyLength:c,beforeRedirect:c,transport:c,httpAgent:c,httpsAgent:c,cancelToken:c,socketPath:c,responseEncoding:c,validateStatus:l,headers:(h,p)=>a(DN(h),DN(p),!0)};return le.forEach(Object.keys(Object.assign({},e,t)),function(h){let p=u[h]||a,_=p(e[h],t[h],h);le.isUndefined(_)&&p!==l||(i[h]=_)}),i}var Bx="1.6.8",zy={};["object","boolean","number","function","string","symbol"].forEach((e,t)=>{zy[e]=function(i){return typeof i===e||"a"+(t<1?"n ":" ")+e}});var PN={};zy.transitional=function(e,t,i){function r(a,s){return"[Axios v"+Bx+"] Transitional option '"+a+"'"+s+(i?". "+i:"")}return(a,s,c)=>{if(e===!1)throw new Nt(r(s," has been removed"+(t?" in "+t:"")),Nt.ERR_DEPRECATED);return t&&!PN[s]&&(PN[s]=!0,console.warn(r(s," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(a,s,c)}};var Iv={assertOptions:function(e,t,i){if(typeof e!="object")throw new Nt("options must be an object",Nt.ERR_BAD_OPTION_VALUE);let r=Object.keys(e),a=r.length;for(;a-- >0;){let s=r[a],c=t[s];if(c){let l=e[s],u=l===void 0||c(l,s,e);if(u!==!0)throw new Nt("option "+s+" must be "+u,Nt.ERR_BAD_OPTION_VALUE)}else if(i!==!0)throw new Nt("Unknown option "+s,Nt.ERR_BAD_OPTION)}},validators:zy},ro=Iv.validators,x_=class{constructor(e){this.defaults=e,this.interceptors={request:new y0,response:new y0}}async request(e,t){try{return await this._request(e,t)}catch(i){if(i instanceof Error){let r;Error.captureStackTrace?Error.captureStackTrace(r={}):r=new Error;let a=r.stack?r.stack.replace(/^.+\n/,""):"";i.stack?a&&!String(i.stack).endsWith(a.replace(/^.+\n.+\n/,""))&&(i.stack+=`
`+a):i.stack=a}throw i}}_request(e,t){typeof e=="string"?(t=t||{}).url=e:t=e||{},t=_d(this.defaults,t);let{transitional:i,paramsSerializer:r,headers:a}=t;i!==void 0&&Iv.assertOptions(i,{silentJSONParsing:ro.transitional(ro.boolean),forcedJSONParsing:ro.transitional(ro.boolean),clarifyTimeoutError:ro.transitional(ro.boolean)},!1),r!=null&&(le.isFunction(r)?t.paramsSerializer={serialize:r}:Iv.assertOptions(r,{encode:ro.function,serialize:ro.function},!0)),t.method=(t.method||this.defaults.method||"get").toLowerCase();let s=a&&le.merge(a.common,a[t.method]);a&&le.forEach(["delete","get","head","post","put","patch","common"],S=>{delete a[S]}),t.headers=ws.concat(s,a);let c=[],l=!0;this.interceptors.request.forEach(function(S){typeof S.runWhen=="function"&&S.runWhen(t)===!1||(l=l&&S.synchronous,c.unshift(S.fulfilled,S.rejected))});let u=[],h;this.interceptors.response.forEach(function(S){u.push(S.fulfilled,S.rejected)});let p,_=0;if(!l){let S=[wN.bind(this),void 0];for(S.unshift.apply(S,c),S.push.apply(S,u),p=S.length,h=ae.resolve(t);_<p;)h=h.then(S[_++],S[_++]);return h}p=c.length;let m=t;for(_=0;_<p;){let S=c[_++],C=c[_++];try{m=S(m)}catch(v){C.call(this,v);break}}try{h=wN.call(this,m)}catch(S){return ae.reject(S)}for(_=0,p=u.length;_<p;)h=h.then(u[_++],u[_++]);return h}getUri(e){return H2(xx((e=_d(this.defaults,e)).baseURL,e.url),e.params,e.paramsSerializer)}};le.forEach(["delete","get","head","options"],function(e){x_.prototype[e]=function(t,i){return this.request(_d(i||{},{method:e,url:t,data:(i||{}).data}))}}),le.forEach(["post","put","patch"],function(e){function t(i){return function(r,a,s){return this.request(_d(s||{},{method:e,headers:i?{"Content-Type":"multipart/form-data"}:{},url:r,data:a}))}}x_.prototype[e]=t(),x_.prototype[e+"Form"]=t(!0)});var V_=x_,L7=class jx{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let i;this.promise=new ae(function(a){i=a});let r=this;this.promise.then(a=>{if(!r._listeners)return;let s=r._listeners.length;for(;s-- >0;)r._listeners[s](a);r._listeners=null}),this.promise.then=a=>{let s,c=new ae(l=>{r.subscribe(l),s=l}).then(a);return c.cancel=function(){r.unsubscribe(s)},c},t(function(a,s,c){r.reason||(r.reason=new hp(a,s,c),i(r.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){this.reason?t(this.reason):this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;let i=this._listeners.indexOf(t);i!==-1&&this._listeners.splice(i,1)}static source(){let t;return{token:new jx(function(i){t=i}),cancel:t}}},k7=L7,Ov={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Ov).forEach(e=>{let[t,i]=e;Ov[i]=t});var M7=Ov,Yi=function e(t){let i=new V_(t),r=j2(V_.prototype.request,i);return le.extend(r,V_.prototype,i,{allOwnKeys:!0}),le.extend(r,i,null,{allOwnKeys:!0}),r.create=function(a){return e(_d(t,a))},r}(Ky);Yi.Axios=V_,Yi.CanceledError=hp,Yi.CancelToken=k7,Yi.isCancel=Ux,Yi.VERSION=Bx,Yi.toFormData=nE,Yi.AxiosError=Nt,Yi.Cancel=Yi.CanceledError,Yi.all=function(e){return ae.all(e)},Yi.spread=function(e){return function(t){return e.apply(null,t)}},Yi.isAxiosError=function(e){return le.isObject(e)&&e.isAxiosError===!0},Yi.mergeConfig=_d,Yi.AxiosHeaders=ws,Yi.formToJSON=e=>Mx(le.isHTMLForm(e)?new FormData(e):e),Yi.getAdapter=Vx.getAdapter,Yi.HttpStatusCode=M7,Yi.default=Yi;var yr=Yi,U7=()=>{};function kh(){let e={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:U7};return e.promise=new ae((t,i)=>{e.resolve=r=>{e.isFinished||(e.isResolved=!0,e.isFinished=!0,t(r),e.value=r)},e.reject=r=>{e.isFinished||(e.isRejected=!0,e.isFinished=!0,i(r))}}),e}var Yf=new Map,qf=new Map,wn=new Map,pi=function(e){return e.WIN_10="Windows 10",e.WIN_81="Windows 8.1",e.WIN_8="Windows 8",e.WIN_7="Windows 7",e.WIN_VISTA="Windows Vista",e.WIN_SERVER_2003="Windows Server 2003",e.WIN_XP="Windows XP",e.WIN_2000="Windows 2000",e.ANDROID="Android",e.HARMONY_OS="HarmonyOS",e.OPEN_BSD="Open BSD",e.SUN_OS="Sun OS",e.LINUX="Linux",e.IOS="iOS",e.MAC_OS="Mac OS",e.CHROMIUM_OS="Chromium OS",e.QNX="QNX",e.UNIX="UNIX",e.BEOS="BeOS",e.OS_2="OS/2",e.SEARCH_BOT="Search Bot",e}({}),Ze=function(e){return e.CHROME="Chrome",e.SAFARI="Safari",e.EDGE="Edge",e.FIREFOX="Firefox",e.OPERA="OPR",e.QQ="QQBrowser",e.WECHAT="MicroMessenger",e}({}),Fx=new lz,En=Fx.getResult(),DT=null;function Ge(e){if(!DT){En=Fx.getResult();let t=function(l){if(l.engine.name==="Blink"&&l.browser.name!=="WeChat")return Ze.CHROME;switch(l.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return Ze.CHROME;case"Safari":case"Mobile Safari":return Ze.SAFARI;case"Edge":return Ze.EDGE;case"Firefox":return Ze.FIREFOX;case"QQ":case"QQBrowser":return Ze.QQ;case"Opera":return Ze.OPERA;case"WeChat":return Ze.WECHAT;default:return l.browser.name||""}}(En),i=LN(En),r=function(l){return l.os.name==="Windows"?l.os.version?l.os.name+" "+l.os.version:l.os.name:l.os.name||""}(En),a=En.os.version,s=LN(En,!1),c=En.device.type;if(!(t&&i&&r&&a))return{name:t,version:i,os:r,osVersion:a,browserVersion:s,deviceType:c};DT={name:t,version:i,os:r,osVersion:a,browserVersion:s,deviceType:c}}return DT}function LN(e){let t,i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return t=e.engine.name==="Blink"?e.engine.version||"":e.browser.version||"",i?t.split(".")[0]:t}function YE(){return Ge().os}function kN(){let e=Ge();return"".concat(e.os," ").concat(e.osVersion)}function uE(){let e=Ge();return!!(En.engine.name==="WebKit"&&e.os===pi.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&e.name!==Ze.SAFARI||pr()&&e.name!==Ze.SAFARI)}function Co(){return Ge().name===Ze.CHROME}function Li(){return Ge().name===Ze.SAFARI}function Gx(){return Ge().name===Ze.EDGE}function Bt(){return Ge().name===Ze.FIREFOX}function pr(){return Ge().os===pi.IOS}function wv(e){let t=Ge();return!(t.name!==Ze.CHROME||!t.osVersion)&&Number(t.version)>=e}function Hx(e){let t=Ge();return!(t.name!==Ze.CHROME||!t.osVersion)&&Number(t.version)<e}function MN(e){let t=Ge();return!(t.name!==Ze.EDGE||!t.osVersion)&&Number(t.version)>=e}function Wx(e){let t=Ge();return!(t.name!==Ze.SAFARI||!t.osVersion)&&Number(t.version)>=e}function Kx(e,t,i){let r=Ge();if(r.os!==pi.IOS||!r.osVersion)return!1;let a=r.osVersion.split(".");return t&&Number(a[0])===e&&Number(a[1])<t||Number(a[0])<e}function zx(e,t,i){let r=Ge();if(r.name!==Ze.SAFARI||!r.osVersion||!r.browserVersion)return!1;let a=r.browserVersion.split(".");return t&&Number(a[0])===e&&Number(a[1])<t||Number(a[0])<e}function UN(e){let t=Ge();return!(t.name!==Ze.OPERA||!t.osVersion)&&Number(t.version)>=e}function xN(){let e=Ge();if(e.os!==pi.IOS||!e.osVersion)return!1;let t=e.osVersion.split(".");return Number(t[0])<14||Number(t[0])===14&&Number(t[1])<=6}function Ed(){let e=Ge();if(e.os!==pi.IOS||!e.osVersion)return!1;let t=e.osVersion.split(".");return Number(t[0])===15}function Nv(){let e=Ge();if(e.os!==pi.IOS||!e.osVersion)return!1;let t=e.osVersion.split(".");return Number(t[0])===16}function VN(){let e=Ge();if(e.os!==pi.IOS||!e.osVersion)return!1;let t=e.osVersion.split(".");return Number(t[0])===15&&Number(t[1])>=1}function Qa(){return Li()&&navigator.maxTouchPoints>0}function Yx(){return Ge().name===Ze.WECHAT}function qx(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function Yy(){let e=YE();return function(){let{deviceType:t}=Ge();return t==="mobile"||t==="tablet"}()||e===pi.ANDROID||e===pi.IOS||e===pi.HARMONY_OS}function No(){let e=Ge();return e.name!==Ze.EDGE&&e.name!==Ze.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function qE(){return YE()===pi.ANDROID}function Mh(){let e=Ge();return qE()&&(e.name===Ze.CHROME||e.name===Ze.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function Tt(e,t,i){return(t=function(r){var a=function(s,c){if(typeof s!="object"||!s)return s;var l=s[Symbol.toPrimitive];if(l!==void 0){var u=l.call(s,"string");if(typeof u!="object")return u;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(s)}(r);return typeof a=="symbol"?a:a+""}(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function BN(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),i.push.apply(i,r)}return i}function he(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?BN(Object(i),!0).forEach(function(r){Tt(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):BN(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}var A=function(e){return e.UNEXPECTED_ERROR="UNEXPECTED_ERROR",e.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",e.TIMEOUT="TIMEOUT",e.INVALID_PARAMS="INVALID_PARAMS",e.NOT_READABLE="NOT_READABLE",e.NOT_SUPPORTED="NOT_SUPPORTED",e.INVALID_OPERATION="INVALID_OPERATION",e.OPERATION_ABORTED="OPERATION_ABORTED",e.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",e.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",e.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",e.DATACHANNEL_FAILED="DATACHANNEL_FAILED",e.NETWORK_ERROR="NETWORK_ERROR",e.NETWORK_TIMEOUT="NETWORK_TIMEOUT",e.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",e.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",e.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",e.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",e.ELECTRON_IS_NULL="ELECTRON_IS_NULL",e.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",e.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",e.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",e.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",e.PERMISSION_DENIED="PERMISSION_DENIED",e.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",e.TRACK_IS_DISABLED="TRACK_IS_DISABLED",e.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",e.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",e.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",e.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",e.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",e.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",e.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",e.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",e.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",e.UID_CONFLICT="UID_CONFLICT",e.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",e.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",e.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",e.INVALID_TRACK="INVALID_TRACK",e.SENDER_NOT_FOUND="SENDER_NOT_FOUND",e.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",e.SET_ANSWER_FAILED="SET_ANSWER_FAILED",e.ICE_FAILED="ICE_FAILED",e.PC_CLOSED="PC_CLOSED",e.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",e.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",e.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",e.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",e.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",e.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",e.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",e.INVALID_REMOTE_USER="INVALID_REMOTE_USER",e.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",e.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",e.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",e.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",e.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",e.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",e.WS_ABORT="WS_ABORT",e.WS_DISCONNECT="WS_DISCONNECT",e.WS_ERR="WS_ERR",e.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",e.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",e.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",e.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",e.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",e.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",e.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",e.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",e.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",e.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",e.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",e.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",e.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",e.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",e.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",e.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",e.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",e.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",e.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",e.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",e.INVALID_PLUGIN="INVALID_PLUGIN",e.DISCONNECT_P2P="DISCONNECT_P2P",e.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",e.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",e.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",e.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",e.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",e.PROHIBITED_OPERATION="PROHIBITED_OPERATION",e.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",e.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",e}({}),H=class extends Error{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",i=arguments.length>2?arguments[2]:void 0;super(t),Tt(this,"code",void 0),Tt(this,"message",void 0),Tt(this,"data",void 0),Tt(this,"name","AgoraRTCException"),this.code=e,this.message="AgoraRTCError ".concat(this.code,": ").concat(t),this.data=i}toString(){return this.data?"data: ".concat(JSON.stringify(this.data),`
`).concat(this.stack):"".concat(this.stack)}print(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error",t=arguments.length>1?arguments[1]:void 0;return e==="error"&&(t||console).error(this.toString()),e==="warning"&&(t||console).warn(this.toString()),this}throw(e){throw this.print("error",e),this}};function Is(e,t){if(typeof e!="boolean")throw new H(A.INVALID_PARAMS,"Invalid ".concat(t,": The value is of the boolean type."))}function li(e,t,i){if(!oe(i).call(i,e))throw new H(A.INVALID_PARAMS,"".concat(t," can only be set as ").concat(JSON.stringify(i)))}function nt(e,t){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4;if(e<i||e>r||(!(arguments.length>4&&arguments[4]!==void 0)||arguments[4])&&!function(a){return typeof a=="number"&&a%1==0}(e))throw new H(A.INVALID_PARAMS,"invalid ".concat(t,": the value range is [").concat(i,", ").concat(r,"]. integer only"))}function PT(e,t){if(typeof e!="number"){if(!(e.min||e.max||e.ideal||e.exact))throw new H(A.INVALID_PARAMS,"".concat(t," is not a valid ConstrainLong"));e.min!==void 0&&nt(e.min,"".concat(t,".min"),0,1/0),e.max!==void 0&&nt(e.max,"".concat(t,".max"),1,1/0),e.exact!==void 0&&nt(e.exact,"".concat(t,".exact"),1,1/0),e.ideal!==void 0&&nt(e.ideal,"".concat(t,".ideal"),1,1/0)}else nt(e,t,1,1/0)}function Ti(e,t){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,a=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(e==null)throw new H(A.INVALID_PARAMS,"".concat(t||"param"," cannot be empty"));if(!Xx(e,i,r,a))throw new H(A.INVALID_PARAMS,"Invalid ".concat(t||"string param",": Length of the string: [").concat(i,",").concat(r,"].").concat(a?" ASCII characters only.":""))}function Cs(e,t){if(!Array.isArray(e))throw new H(A.INVALID_PARAMS,"".concat(t," should be an array"))}function Dt(e){return e==null}function Xx(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,r=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof e=="string"&&e.length<=i&&e.length>=t&&(!r||function(a){if(typeof a!="string")return!1;for(let s=0;s<a.length;s+=1){let c=a.charCodeAt(s);if(c<0||c>255)return!1}return!0}(e))}var ah=function(e){return e.COVERED="COVERED",e.POSITION="POSITION",e.SIZE="SIZE",e.STYLE="STYLE",e}(ah||{}),Dv=function(e){return e.UNMOUNTED="UNMOUNTED",e.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",e}(Dv||{}),Jx=new class{constructor(){Tt(this,"_clientSize",null),Tt(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),Tt(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),Tt(this,"getStyle",e=>window.getComputedStyle(e,null)),Tt(this,"checkCssVisibleProperty",e=>{var t;let i=!0,r=this.getStyle(e),{display:a,visibility:s,opacity:c,filter:l}=r;return(a==="none"||oe(t=["hidden","collapse"]).call(t,s)||Number(c)<.1)&&(i=!1),!!i&&(l&&l.split(" ").filter(u=>{var h;let p=u.split("(")[0];return oe(h=["brightness","blur","opacity"]).call(h,p)}).map(u=>{let[h,p]=u.split(/\(|\)/);return[h,Number(p.match(/^[0-9\.]+/))]}).forEach(u=>{let[h,p]=u;switch(h){case"brightness":(p<.1||p>3)&&(i=!1);break;case"blur":p>3&&(i=!1);break;case"opacity":p<.1&&(i=!1)}}),i)}),Tt(this,"checkPropertyUpToAllParentNodes",(e,t)=>{let i=!0,r=!0,a=c=>t(c),s=e;for(;s&&r;)a(s)||(i=!1,r=!1),s=s.parentElement,s||(r=!1);return i}),Tt(this,"checkActualCssVisibleIncludeInherit",e=>this.checkPropertyUpToAllParentNodes(e,this.checkCssVisibleProperty)),Tt(this,"getSizeAboutClient",e=>{let{width:t,height:i,left:r,right:a,top:s,bottom:c}=e.getBoundingClientRect(),l=this.getClientWidth(),u=this.getClientHeight();return{width:t,height:i,left:r,right:a,top:s,bottom:c,clientWidth:l,clientHeight:u,clientMin:Math.min(l,u)}}),Tt(this,"checkActualSize",()=>{let{width:e,height:t,clientMin:i}=this._clientSize;return this.checkSizeIsVisible(e,t,i)}),Tt(this,"elementFromPoint",(e,t)=>document.elementFromPoint?document.elementFromPoint(e,t):null),Tt(this,"checkCoverForAPoint",(e,t,i)=>{let r=this.elementFromPoint(e,t);return r!==null&&r!==i}),Tt(this,"getPointPositionList",()=>{let{width:e,height:t,left:i,top:r}=this._clientSize,a=e/6,s=t/6,c=[],l=10**6;for(let u=0;u<5;u++)for(let h=0;h<5;h++){let p=(i*l+(u===0?.1:u===4?(a*u*l-1e5)/l:a*u)*l)/l,_=(r*l+(h===0?.1:h===4?(s*h*l-1e5)/l:s*h)*l)/l;c.push({x:p,y:_})}return[...c]}),Tt(this,"checkElementCover",e=>this.getPointPositionList().map(t=>this.checkCoverForAPoint(t.x,t.y,e)).filter(t=>!!t).length>6),Tt(this,"checkSizeIsVisible",(e,t,i)=>(e>50||i/e<=10)&&(t>50||i/t<=10)),Tt(this,"checkSizeOfPartInClient",()=>{let{left:e,right:t,top:i,bottom:r,clientHeight:a,clientWidth:s,clientMin:c}=this._clientSize,l,u,h,p;if(e<0)l=0;else{if(!(e<s))return!1;l=e}if(t<0)return!1;if(u=t<s?t:s,i<0)h=0;else{if(!(i<a))return!1;h=i}if(r<0)return!1;p=r<a?r:a;let _=u-l,m=p-h;return this.checkSizeIsVisible(_,m,c)}),Tt(this,"returnHiddenResult",e=>(this._clientSize=null,{visible:!1,reason:e})),Tt(this,"checkOneElementVisible",e=>{if(e instanceof HTMLElement){if(this.checkElementIsMountedOnDom(e)){if(this.checkActualCssVisibleIncludeInherit(e)){if(this._clientSize=this.getSizeAboutClient(e),this.checkElementCover(e))return this.returnHiddenResult(ah.COVERED);{let t=this.checkActualSize(),i=this.checkSizeOfPartInClient();return t&&!i?this.returnHiddenResult(ah.POSITION):t?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(ah.SIZE)}}return this.returnHiddenResult(ah.STYLE)}return this.returnHiddenResult(Dv.UNMOUNTED)}return this.returnHiddenResult(Dv.INVALID_HTML_ELEMENT)}),Tt(this,"checkElementIsMountedOnDom",e=>this.checkPropertyUpToAllParentNodes(e,t=>t.nodeName.toUpperCase()!=="HTML"?t.parentElement!==null:!!document.documentElement))}};function qy(e){return new TextEncoder().encode(e)}var jN=function(e,t){let i=new Uint8Array(e.byteLength+t.byteLength);return i.set(new Uint8Array(e),0),i.set(new Uint8Array(t),e.byteLength),i},Pv=async e=>function(t,i){let r="";return new Uint8Array(t).forEach(a=>{r+=a.toString(i).padStart(2,"0")}),r}(await crypto.subtle.digest("SHA-256",qy(e)),16),Lt=class{constructor(){Tt(this,"_events",{}),Tt(this,"addListener",this.on)}getListeners(e){return this._events[e]?this._events[e].map(t=>t.listener):[]}on(e,t){this._events[e]||(this._events[e]=[]);let i=this._events[e];this._indexOfListener(i,t)===-1&&i.push({listener:t,once:!1})}once(e,t){this._events[e]||(this._events[e]=[]);let i=this._events[e];this._indexOfListener(i,t)===-1&&i.push({listener:t,once:!0})}off(e,t){if(!this._events[e])return;let i=this._events[e],r=this._indexOfListener(i,t);r!==-1&&i.splice(r,1),this._events[e].length===0&&delete this._events[e]}removeAllListeners(e){e?delete this._events[e]:this._events={}}emit(e){this._events[e]||(this._events[e]=[]);let t=this._events[e].map(s=>s);for(var i=arguments.length,r=new Array(i>1?i-1:0),a=1;a<i;a++)r[a-1]=arguments[a];for(let s=0;s<t.length;s+=1){let c=t[s];c.once&&this.off(e,c.listener),c.listener.apply(this,r||[])}}safeEmit(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];[...this._events[e]||[]].forEach(a=>{a.once&&this.off(e,a.listener);try{a.listener.apply(this,i)}catch(s){console.error("safeEmit event:".concat(e," error ").concat(s==null?void 0:s.toString()))}})}_indexOfListener(e,t){let i=e.length;for(;i--;)if(e[i].listener===t)return i;return-1}},Wu=null;function Qx(){if(Wu)return Wu;if(window.electron)return Wu=window.electron;if(!window.require)return null;try{return Wu=window.require("electron"),Wu}catch{return null}}var ni=function(e){return e.CREATE_CLIENT="createClient",e.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",e.SET_AREA="setArea",e.PRELOAD="PRELOAD",e.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",e.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",e.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",e.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",e.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",e.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",e.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",e.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",e.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",e.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",e.START_PROXY_SERVER="Client.startProxyServer",e.STOP_PROXY_SERVER="Client.stopProxyServer",e.SET_PROXY_SERVER="Client.setProxyServer",e.SET_TURN_SERVER="Client.setTurnServer",e.SET_CLIENT_ROLE="Client.setClientRole",e.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",e.ENABLE_DUAL_STREAM="Client.enableDualStream",e.DISABLE_DUAL_STREAM="Client.disableDualStream",e.JOIN="Client.join",e.LEAVE="Client.leave",e.PUBLISH="Client.publish",e.UNPUBLISH="Client.unpublish",e.SUBSCRIBE="Client.subscribe",e.MASS_SUBSCRIBE="Client.massSubscribe",e.MASS_UNSUBSCRIBE="Client.massUnsubscribe",e.UNSUBSCRIBE="Client.unsubscribe",e.RENEW_TOKEN="Client.renewToken",e.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",e.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",e.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",e.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",e.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",e.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",e.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",e.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",e.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",e.START_LIVE_STREAMING="Client.startLiveStreaming",e.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",e.STOP_LIVE_STREAMING="Client.stopLiveStreaming",e.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",e.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",e.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",e.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",e.SET_CONFIG_DISTRIBUTE="_configDistribute",e.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",e.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",e.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",e.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",e.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",e.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",e.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",e.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",e.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",e.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",e.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",e.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",e.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",e.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",e.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",e.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",e.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",e.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",e.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",e.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",e.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",e.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",e.STREAM_TYPE_CHANGE="streamTypeChange",e.CONNECTION_STATE_CHANGE="connectionStateChange",e.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",e.IMAGE_MODERATION_UPLOAD="imageModerationUpload",e}({}),Vt=function(e){return e.TRACER="tracer",e}({});function FN(e){return nt(e.timeout,"config.timeout",0,1e5),nt(e.timeoutFactor,"config.timeoutFactor",0,100,!1),nt(e.maxRetryCount,"config.maxRetryConfig",0,1/0),nt(e.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}var x7=function(e){return e[e.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",e[e.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",e[e.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",e}({}),tt=function(e){return e.LEAVE="LEAVE",e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.UID_BANNED="UID_BANNED",e.FALLBACK="FALLBACK",e.IP_BANNED="IP_BANNED",e.CHANNEL_BANNED="CHANNEL_BANNED",e.LICENSE_MISSING="LICENSE_MISSING",e.LICENSE_EXPIRED="LICENSE_EXPIRED",e.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",e.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",e.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",e.LICENSE_ILLEGAL="LICENSE_ILLEGAL",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e}({});function XE(e){if(!Array.isArray(e)||e.length<1)return!1;try{e.forEach(t=>{if(!t.urls)throw Error()})}catch{return!1}return!0}function Zx(e){return Ti(e.turnServerURL,"turnServerURL"),Ti(e.username,"username"),Ti(e.password,"password"),e.udpport&&nt(e.udpport,"udpport",1,99999,!0),e.forceturn&&Is(e.forceturn,"forceturn"),e.security&&Is(e.security,"security"),e.tcpport&&nt(e.tcpport,"tcpport",1,99999,!0),!0}function GN(e){return e.level!==void 0&&li(e.level,"level",[1,2,3]),e.delay!==void 0&&nt(e.delay,"delay",0,3e3,!0),!0}var Me=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.MEDIA_RECONNECT_START="media-reconnect-start",e.MEDIA_RECONNECT_END="media-reconnect-end",e.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",e.USER_JOINED="user-joined",e.USER_LEAVED="user-left",e.USER_PUBLISHED="user-published",e.USER_UNPUBLISHED="user-unpublished",e.USER_INFO_UPDATED="user-info-updated",e.CLIENT_BANNED="client-banned",e.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",e.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",e.VOLUME_INDICATOR="volume-indicator",e.CRYPT_ERROR="crypt-error",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGED="stream-type-changed",e.STREAM_FALLBACK="stream-fallback",e.RECEIVE_METADATA="receive-metadata",e.STREAM_MESSAGE="stream-message",e.LIVE_STREAMING_ERROR="live-streaming-error",e.LIVE_STREAMING_WARNING="live-streaming-warning",e.EXCEPTION="exception",e.ERROR="error",e.P2P_LOST="p2p_lost",e.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",e.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",e.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",e.PUBLISHED_USER_LIST="published-user-list",e.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",e.CONTENT_INSPECT_ERROR="content-inspect-error",e.CONTENT_INSPECT_RESULT="content-inspect-result",e.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",e}({}),Pi=function(e){return e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE",e.P2P_FAILED="P2P_FAILED",e.FALLBACK="FALLBACK",e}({}),xr=function(e){return e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({}),Ql=function(e){return e.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({});function ki(e,t){for(var i=arguments.length,r=new Array(i>2?i-2:0),a=2;a<i;a++)r[a-2]=arguments[a];return e.getListeners(t).length===0?ae.reject(new H(A.UNEXPECTED_ERROR,"can not emit promise")):new ae((s,c)=>{e.emit(t,...r,s,c)})}function lt(e,t){if(e.getListeners(t).length===0)return ae.resolve();for(var i=arguments.length,r=new Array(i>2?i-2:0),a=2;a<i;a++)r[a-2]=arguments[a];return ki(e,t,...r)}function ga(e,t){if(e.getListeners(t).length===0)return null;for(var i=arguments.length,r=new Array(i>2?i-2:0),a=2;a<i;a++)r[a-2]=arguments[a];return Uh(e,t,...r)}function Uh(e,t){let i=null,r=null;for(var a=arguments.length,s=new Array(a>2?a-2:0),c=2;c<a;c++)s[c-2]=arguments[c];if(e.emit(t,...s,l=>{i=l},l=>{r=l}),r!==null)throw r;if(i===null)throw new H(A.UNEXPECTED_ERROR,"handler is not sync");return i}var Qt=new class extends Lt{set networkState(e){this.emit(Ql.NETWORK_STATE_CHANGE,e,this._networkState),e===xr.ONLINE?this.emit(Ql.ONLINE):e===xr.OFFLINE&&(this.onlineWaiter=new ae(t=>{this.once(Ql.ONLINE,()=>{this.onlineWaiter=void 0,t(xr.ONLINE)})}),this.emit(Ql.OFFLINE)),this._networkState=e}get networkState(){return this._networkState}get isOnline(){return this._networkState===xr.ONLINE}constructor(){super(),Tt(this,"_moduleName","network-indicator"),Tt(this,"_networkState",xr.ONLINE),Tt(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=xr.ONLINE}),window.addEventListener("offline",()=>{this.networkState=xr.OFFLINE})}};function hE(e,t){let i=e.indexOf(t);i!==-1&&e.splice(i,1)}function Zl(e){let t=[];return e.forEach(i=>{t.indexOf(i)===-1&&t.push(i)}),t}function JE(e){ae!==void 0?ae.resolve().then(e):setTimeout(e,0)}function Xt(e){return JSON.parse(JSON.stringify(e))}function Rc(e){try{return Xt(e)}catch{return e}}var HN={};function Do(e,t){HN[t]||(HN[t]=!0,e())}function vc(e){let t=window.atob(e),i=new Uint8Array(new ArrayBuffer(t.length));for(let r=0;r<t.length;r+=1)i[r]=t.charCodeAt(r);return i}function bo(e){let t="";for(let i=0;i<e.length;i+=1)t+=String.fromCharCode(e[i]);return window.btoa(t)}function $x(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,i=new TextEncoder().encode(e);if(i.length>t)i=i.slice(0,t);else if(i.length<t){let r=new Uint8Array(t);r.set(i),i=r}return i}function WN(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];let r=Sn(t).call(t,(c,l)=>c+l.length,0),a=new Uint8Array(new ArrayBuffer(r)),s=0;return t.forEach(c=>{a.set(c,s),s+=c.length}),a}function Gn(e){return window.TextEncoder?new TextEncoder().encode(e).length:e.length}function eV(e){let t=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&e.realFormData&&(e=e.realFormData),e.forEach(i=>{t+=typeof i=="string"?Gn(i):i.size}),t+138}function V7(e){let t=new H(A.TIMEOUT,"timeout");return new ae((i,r)=>{window.setTimeout(()=>r(t),e)})}function yi(e){return new ae(t=>{window.setTimeout(t,e)})}function ft(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,t=arguments.length>1?arguments[1]:void 0,i=Math.random().toString(16).substr(2,e).toLowerCase();return i.length===e?"".concat(t).concat(i):"".concat(t).concat(i)+ft(e-i.length,"")}function $l(){return ft(32,"").toUpperCase()}var QE=()=>{},KN=new class{constructor(){Tt(this,"fnMap",new Map)}throttleByKey(e,t,i,r){for(var a=arguments.length,s=new Array(a>4?a-4:0),c=4;c<a;c++)s[c-4]=arguments[c];if(this.fnMap.has(t)){let l=this.fnMap.get(t);if(l.threshold!==i){l.fn(...l.args),clearTimeout(l.timer);let u=window.setTimeout(()=>{let h=this.fnMap.get(t);h&&h.fn(...h.args),this.fnMap.delete(t)},i);this.fnMap.set(t,{fn:e,threshold:i,timer:u,args:s,skipFn:r})}else l.skipFn&&l.skipFn(...l.args),this.fnMap.set(t,he(he({},l),{},{fn:e,args:s,skipFn:r}))}else{let l=window.setTimeout(()=>{let u=this.fnMap.get(t);u&&u.fn(...u.args),this.fnMap.delete(t)},i);this.fnMap.set(t,{fn:e,threshold:i,timer:l,args:s,skipFn:r})}}},zN=KN.throttleByKey.bind(KN);function YN(e){return typeof e=="object"&&e!==null&&!(e instanceof RegExp)}function Lv(e,t){if(!YN(e)||!YN(t)||Array.isArray(e)&&!Array.isArray(t)||!Array.isArray(e)&&Array.isArray(t))return t;if(Array.isArray(t)&&Array.isArray(e)){let i=[...e];for(let r=0;r<t.length;r++)i[r]=Lv(e[r],t[r]);return i}{let i=he({},e);for(let r in t)Object.prototype.hasOwnProperty.call(t,r)&&(Object.prototype.hasOwnProperty.call(e,r)?i[r]=Lv(e[r],t[r]):i[r]=t[r]);return i}}function qN(e,t){let i=[0];if(i=new Array(t).fill(0),e===0)return i;let r=0;for(;e>0&&(i[r]=255&e,e>>=8,r++,r!==t););return i}function LT(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function tV(e){let t="0123456789abcdef";function i(P){let U,x="";for(U=0;U<=3;U++)x+=t.charAt(P>>8*U+4&15)+t.charAt(P>>8*U&15);return x}function r(P,U){let x=(65535&P)+(65535&U);return(P>>16)+(U>>16)+(x>>16)<<16|65535&x}function a(P,U,x,G,Z,J){return r(function(q,ie){return q<<ie|q>>>32-ie}(r(r(U,P),r(G,J)),Z),x)}function s(P,U,x,G,Z,J,q){return a(U&x|~U&G,P,U,Z,J,q)}function c(P,U,x,G,Z,J,q){return a(U&G|x&~G,P,U,Z,J,q)}function l(P,U,x,G,Z,J,q){return a(U^x^G,P,U,Z,J,q)}function u(P,U,x,G,Z,J,q){return a(x^(U|~G),P,U,Z,J,q)}let h=function(P){let U,x=1+(P.length+8>>6),G=new Array(16*x);for(U=0;U<16*x;U++)G[U]=0;for(U=0;U<P.length;U++)G[U>>2]|=P.charCodeAt(U)<<U%4*8;return G[U>>2]|=128<<U%4*8,G[16*x-2]=8*P.length,G}(e),p,_,m,S,C,v=1732584193,y=-271733879,I=-1732584194,O=271733878;for(p=0;p<h.length;p+=16)_=v,m=y,S=I,C=O,v=s(v,y,I,O,h[p+0],7,-680876936),O=s(O,v,y,I,h[p+1],12,-389564586),I=s(I,O,v,y,h[p+2],17,606105819),y=s(y,I,O,v,h[p+3],22,-1044525330),v=s(v,y,I,O,h[p+4],7,-176418897),O=s(O,v,y,I,h[p+5],12,1200080426),I=s(I,O,v,y,h[p+6],17,-1473231341),y=s(y,I,O,v,h[p+7],22,-45705983),v=s(v,y,I,O,h[p+8],7,1770035416),O=s(O,v,y,I,h[p+9],12,-1958414417),I=s(I,O,v,y,h[p+10],17,-42063),y=s(y,I,O,v,h[p+11],22,-1990404162),v=s(v,y,I,O,h[p+12],7,1804603682),O=s(O,v,y,I,h[p+13],12,-40341101),I=s(I,O,v,y,h[p+14],17,-1502002290),y=s(y,I,O,v,h[p+15],22,1236535329),v=c(v,y,I,O,h[p+1],5,-165796510),O=c(O,v,y,I,h[p+6],9,-1069501632),I=c(I,O,v,y,h[p+11],14,643717713),y=c(y,I,O,v,h[p+0],20,-373897302),v=c(v,y,I,O,h[p+5],5,-701558691),O=c(O,v,y,I,h[p+10],9,38016083),I=c(I,O,v,y,h[p+15],14,-660478335),y=c(y,I,O,v,h[p+4],20,-405537848),v=c(v,y,I,O,h[p+9],5,568446438),O=c(O,v,y,I,h[p+14],9,-1019803690),I=c(I,O,v,y,h[p+3],14,-187363961),y=c(y,I,O,v,h[p+8],20,1163531501),v=c(v,y,I,O,h[p+13],5,-1444681467),O=c(O,v,y,I,h[p+2],9,-51403784),I=c(I,O,v,y,h[p+7],14,1735328473),y=c(y,I,O,v,h[p+12],20,-1926607734),v=l(v,y,I,O,h[p+5],4,-378558),O=l(O,v,y,I,h[p+8],11,-2022574463),I=l(I,O,v,y,h[p+11],16,1839030562),y=l(y,I,O,v,h[p+14],23,-35309556),v=l(v,y,I,O,h[p+1],4,-1530992060),O=l(O,v,y,I,h[p+4],11,1272893353),I=l(I,O,v,y,h[p+7],16,-155497632),y=l(y,I,O,v,h[p+10],23,-1094730640),v=l(v,y,I,O,h[p+13],4,681279174),O=l(O,v,y,I,h[p+0],11,-358537222),I=l(I,O,v,y,h[p+3],16,-722521979),y=l(y,I,O,v,h[p+6],23,76029189),v=l(v,y,I,O,h[p+9],4,-640364487),O=l(O,v,y,I,h[p+12],11,-421815835),I=l(I,O,v,y,h[p+15],16,530742520),y=l(y,I,O,v,h[p+2],23,-995338651),v=u(v,y,I,O,h[p+0],6,-198630844),O=u(O,v,y,I,h[p+7],10,1126891415),I=u(I,O,v,y,h[p+14],15,-1416354905),y=u(y,I,O,v,h[p+5],21,-57434055),v=u(v,y,I,O,h[p+12],6,1700485571),O=u(O,v,y,I,h[p+3],10,-1894986606),I=u(I,O,v,y,h[p+10],15,-1051523),y=u(y,I,O,v,h[p+1],21,-2054922799),v=u(v,y,I,O,h[p+8],6,1873313359),O=u(O,v,y,I,h[p+15],10,-30611744),I=u(I,O,v,y,h[p+6],15,-1560198380),y=u(y,I,O,v,h[p+13],21,1309151649),v=u(v,y,I,O,h[p+4],6,-145523070),O=u(O,v,y,I,h[p+11],10,-1120210379),I=u(I,O,v,y,h[p+2],15,718787259),y=u(y,I,O,v,h[p+9],21,-343485551),v=r(v,_),y=r(y,m),I=r(I,S),O=r(O,C);return i(v)+i(y)+i(I)+i(O)}var B7=1,Xf=console,Fi=class{static setLogger(e){Xf=e}constructor(e){Tt(this,"lockingPromise",ae.resolve()),Tt(this,"locks",0),Tt(this,"name",""),Tt(this,"lockId",void 0),this.lockId=B7++,e&&(this.name=e),Xf.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is created."))}get isLocked(){return this.locks>0}lock(e){let t;this.locks+=1,Xf.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is locked, current queue ").concat(this.locks,". ").concat(typeof e=="string"?e:""));let i=new ae(a=>{t=()=>{this.locks-=1,Xf.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is not locked, current queue ").concat(this.locks,". ").concat(typeof e=="string"?e:"")),a()}}),r=this.lockingPromise.then(()=>t);return this.lockingPromise=this.lockingPromise.then(()=>i),r}};function md(e,t){return function(i,r,a){let s=a.value;if(typeof s!="function")throw new Error("Cannot use mutex on object property.");return a.value=async function(){let c=this[t];if(!c)throw new Error("mutex property key ".concat(t," doesn't exist on ").concat(e));let l=await c.lock("From ".concat(e,".").concat(r));try{for(var u=arguments.length,h=new Array(u),p=0;p<u;p++)h[p]=arguments[p];return await s.apply(this,h)}finally{l()}},a}}var ti={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function Xy(e,t){let i=Math.floor(t.timeout*Math.pow(t.timeoutFactor,e));return Math.min(t.maxRetryTimeout,i)}function Rn(e,t,i,r){let a=Object.assign({},ti,r),s=a.timeout,c=async()=>{await function(h){return new ae(p=>{window.setTimeout(p,h)})}(s),s*=a.timeoutFactor,s=Math.min(a.maxRetryTimeout,s)},l=!1,u=new ae(async(h,p)=>{t=t||(()=>!1),i=i||(()=>!0);for(let _=0;_<a.maxRetryCount;_+=1){if(l)return p(new H(A.OPERATION_ABORTED));try{let m=await e();if(!t(m,_)||_+1===a.maxRetryCount)return h(m);await c()}catch(m){if(!i(m,_)||_+1===a.maxRetryCount)return p(m);await c()}}});return u.cancel=()=>l=!0,u}var iV=class{constructor(e){Tt(this,"input",[]),Tt(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}mean(){var e;return this.input.length===0?0:Sn(e=this.input).call(e,(t,i)=>t+i)/this.input.length}},Jf,Qf=0,kT=0;function kv(e,t,i,r){return new ae((a,s)=>{t.responseType=t.responseType||"json",t.data&&!i?(t.data=JSON.stringify(t.data),Qf+=Gn(t.data)):i&&(t.data.size?Qf+=t.data.size:t.data instanceof FormData?Qf+=eV(t.data):Qf+=Gn(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,yr.request(t).then(c=>{typeof c.data=="string"?kT+=Gn(c.data):c.data instanceof ArrayBuffer||c.data instanceof Uint8Array?kT+=c.data.byteLength:kT+=Gn(JSON.stringify(c.data)),a(c.data)}).catch(c=>{yr.isCancel(c)?s(new H(A.OPERATION_ABORTED,"cancel token canceled")):c.code==="ECONNABORTED"?s(new H(A.NETWORK_TIMEOUT,c.message)):c.response?s(new H(A.NETWORK_RESPONSE_ERROR,c.response.status)):s(new H(A.NETWORK_ERROR,c.message))})})}async function j7(e,t){let i=new Blob([t.data],{type:"buffer"});return await kv(e,he(he({},t),{},{data:i,headers:{"Content-Type":"application/octet-stream"}}),!0)}var XN=()=>window.isSecureContext!==void 0,Sa=function(e){if(e.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return e;let t=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-alpha\.([0-9]+)/);if(t&&t[1]&&t[2]){let r=t[1],a=t[2];return"".concat(r,".").concat(a)}let i=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-special\.([0-9]+)/);if(i&&i[1]&&i[2]){let r=i[1],a=i[2];return"".concat(r,".").concat(100*(Number(a)+1))}return"4.0.0.999"}("4.22.0"),Jy=function(){try{return JSON.parse("true")===!0}catch{return!0}}(),hc=function(e){return e.Default="default",e.Auto="auto",e.Relay="relay",e.SdRtn="sd-rtn",e}({}),Qy={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},Zy="v4.22.0-0-g8569241d-dirty(8/15/2024, 7:04:06 PM)",Wt=he(he({PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",ENABLE_EVENT_REPORT:!0,GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,UPLOAD_LOG:!1,NOT_REPORT_EVENT:[],PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",TURN_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,PRELOAD_MEDIA_COUNT:0,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,ICE_RESTART_INTERVAL:1e4,NEW_ICE_RESTART:!1,TRANSMITTER_INITIAL_RTT:30,TRANSMITTER_INITIAL_RTO:30,TRANSMITTER_MAX_BATCH_ACK_COUNT:2,TRANSMITTER_MAX_RTO:500,DATACHANNEL_COMPRESS:!1,FINGERPRINT:null,DC_JOIN_WITH_FAILBACK:5e3,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,AP_AREA:!0,ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,DATASTREAM_MAX_RETRANSMITS:10,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:Qy,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,CUSTOM_ADAPTATION_DEFAULT_MODE:"",ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,ENABLE_PRELOAD:!0},{ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,ENABLE_USER_LICENSE_CHECK:!0,USE_PUB_RTX:!0,USE_SUB_RTX:!0,DISABLE_FEC:void 0,ENABLE_NTP_REPORT:!1,ENABLE_INSTANT_VIDEO:!1,ENABLE_DATASTREAM_2:!1,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,USE_XR:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:!1,ENABLE_CC_FALLBACK:void 0,ENABLE_PREALLOC_PC:!1,SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,ENABLE_SVC:!1,ENABLE_SVC_DEFAULT_CODECS:["H264","VP8","VP9","AV1"],SVC:[],ENABLE_FULL_LINK_AV_SYNC:!1,SVC_MODE:null,PRE_SUB_NUM:2,ENABLE_PRE_SUB:!1,ENABLE_AUT_FEEDBACK:!1}),{},{USE_CANDIDATE_FROM_AP_DETAIL:!1});function at(e,t,i){var r,a,s;oe(r=Object.keys(Wt)).call(r,e)&&(!i&&oe(a=Object.keys(So)).call(a,e)||(Wt[e]=t,e==="ENABLE_VIDEO_SEI"&&t===!0&&(Wt.ENABLE_ENCODED_TRANSFORM=!0),e==="USE_NEW_NETWORK_CONFIG"&&t&&(s=!!t,Wt.USE_NEW_NETWORK_CONFIG=s,s&&(Wt.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],Wt.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],Wt.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],Wt.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],Wt.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",Wt.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",Wt.GATEWAY_DOMAINS=["edge.sd-rtn.com"])),e==="ENABLE_PRE_SUB"&&t&&(Wt.ENABLE_INSTANT_VIDEO=!0,Wt.ENABLE_PREALLOC_PC=!0),e==="ENABLE_SVC"&&t&&(Wt.ENABLE_AUT_CC=!0)))}function k(e){return Wt[e]}var So={},Pe=function(e){return e.SET_SESSION_ID="SET_SESSION_ID",e.SET_P2P_ID="SET_P2P_id",e.SET_DC_ID="SET_DC_id",e.SET_UID="SET_UID",e.SET_INT_UID="SET_INT_UID",e.SET_PUB_ID="SET_PUB_ID",e.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",e.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",e.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",e.AVOID_JOIN_START="AVOID_JOIN_START",e.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",e.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",e.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",e.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",e.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",e.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",e.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",e.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",e.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",e.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",e.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",e.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",e.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",e.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",e.RESET_KEY_METRICS="RESET_KEY_METRICS",e.SET_USE_P2P="SET_USE_P2P",e.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",e}(Pe||{}),F7=class{constructor(e,t,i,r){Tt(this,"state",void 0),this.state={codec:e,audioCodec:t,mode:i,clientId:r,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,avoidJoinStart:0,keyMetrics:{publish:[],subscribe:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useP2P:!1,p2pTransport:hc.Default}}dispatch(e){this.state=function(t,i){switch(i.type){case Pe.SET_SESSION_ID:return he(he({},t),{},{sessionId:i.sessionId});case Pe.SET_P2P_ID:return he(he({},t),{},{p2pId:i.p2pId});case Pe.SET_UID:return he(he({},t),{},{uid:i.uid});case Pe.SET_INT_UID:return he(he({},t),{},{intUid:i.intUid});case Pe.SET_PUB_ID:return he(he({},t),{},{pubId:i.pubId});case Pe.KEY_METRIC_CLIENT_CREATED:return he(he({},t),{},{keyMetrics:he(he({},t.keyMetrics),{},{clientCreated:i.metric})});case Pe.KEY_METRIC_JOIN_START:return he(he({},t),{},{keyMetrics:he(he({},t.keyMetrics),{},{joinStart:i.metric})});case Pe.AVOID_JOIN_START:return he(he({},t),{},{avoidJoinStart:i.avoidJoinStart});case Pe.KEY_METRIC_JOIN_END:return he(he({},t),{},{keyMetrics:he(he({},t.keyMetrics),{},{joinEnd:i.metric})});case Pe.KEY_METRIC_REQUEST_AP_START:return he(he({},t),{},{keyMetrics:he(he({},t.keyMetrics),{},{requestAPStart:i.metric})});case Pe.KEY_METRIC_REQUEST_AP_END:return he(he({},t),{},{keyMetrics:he(he({},t.keyMetrics),{},{requestAPEnd:i.metric})});case Pe.KEY_METRIC_JOIN_GATEWAY_START:return he(he({},t),{},{keyMetrics:he(he({},t.keyMetrics),{},{joinGatewayStart:i.metric})});case Pe.KEY_METRIC_JOIN_GATEWAY_END:return he(he({},t),{},{keyMetrics:he(he({},t.keyMetrics),{},{joinGatewayEnd:i.metric})});case Pe.KEY_METRIC_PEER_CONNECTION_START:return he(he({},t),{},{keyMetrics:he(he({},t.keyMetrics),{},{peerConnectionStart:i.metric})});case Pe.KEY_METRIC_PEER_CONNECTION_END:return he(he({},t),{},{keyMetrics:he(he({},t.keyMetrics),{},{peerConnectionEnd:i.metric})});case Pe.KEY_METRIC_DESCRIPTION_START:return he(he({},t),{},{keyMetrics:he(he({},t.keyMetrics),{},{descriptionStart:i.metric})});case Pe.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return he(he({},t),{},{keyMetrics:he(he({},t.keyMetrics),{},{signalChannelOpen:i.metric})});case Pe.KEY_METRIC_ICE_CONNECTION_END:return he(he({},t),{},{keyMetrics:he(he({},t.keyMetrics),{},{iceConnectionEnd:i.metric})});case Pe.KEY_METRIC_PUBLISH:{let r=t.keyMetrics.publish,a=r.findIndex(s=>s.trackId===i.metric.trackId);return a!==-1?(r[a]=he(he({},r[a]),i.metric),he(he({},t),{},{keyMetrics:he(he({},t.keyMetrics),{},{publish:[...r]})})):he(he({},t),{},{keyMetrics:he(he({},t.keyMetrics),{},{publish:[...t.keyMetrics.publish,i.metric]})})}case Pe.KEY_METRIC_SUBSCRIBE:{let r=t.keyMetrics.subscribe,a=r.findIndex(s=>s.userId===i.metric.userId&&s.type===i.metric.type);return a!==-1?(r[a]=he(he({},r[a]),i.metric),he(he({},t),{},{keyMetrics:he(he({},t.keyMetrics),{},{subscribe:[...r]})})):he(he({},t),{},{keyMetrics:he(he({},t.keyMetrics),{},{subscribe:[...t.keyMetrics.subscribe,i.metric]})})}case Pe.SET_CLOUD_PROXY_SERVER_MODE:return t.cloudProxyServerMode=i.mode,t;case Pe.RECORD_JOIN_CHANNEL_SERVICE:return typeof i.index!="number"?t.joinChannelServiceRecords=[...t.joinChannelServiceRecords,i.record]:(t.joinChannelServiceRecords[i.index]=he(he({},t.joinChannelServiceRecords[i.index]),i.record),t.joinChannelServiceRecords=[...t.joinChannelServiceRecords]),t;case Pe.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return t.joinChannelServiceRecords=[],t;case Pe.RESET_KEY_METRICS:return t.keyMetrics={publish:[],subscribe:[]},t;case Pe.SET_USE_P2P:return he(he({},t),{},{useP2P:i.val});case Pe.SET_TRANSPORT_TYPE:return he(he({},t),{},{p2pTransport:i.val});default:return t}}(this.state,e)}set sessionId(e){this.dispatch({type:Pe.SET_SESSION_ID,sessionId:e})}get sessionId(){return this.state.sessionId}set codec(e){this.state.codec=e}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(e){this.dispatch({type:Pe.SET_P2P_ID,p2pId:e})}get p2pId(){return this.state.p2pId}set dcId(e){this.dispatch({type:Pe.SET_DC_ID,dcId:e})}get dcId(){return this.state.dcId}set uid(e){this.dispatch({type:Pe.SET_UID,uid:e})}get uid(){return this.state.uid}set intUid(e){this.dispatch({type:Pe.SET_INT_UID,intUid:e})}get intUid(){return this.state.intUid}set pubId(e){this.dispatch({type:Pe.SET_PUB_ID,pubId:e})}get pubId(){return this.state.pubId}set cloudProxyServerMode(e){this.dispatch({type:Pe.SET_CLOUD_PROXY_SERVER_MODE,mode:e})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useP2P(e){this.dispatch({type:Pe.SET_USE_P2P,val:e})}get useP2P(){return this.state.useP2P}set p2pTransport(e){this.dispatch({type:Pe.SET_TRANSPORT_TYPE,val:e})}get p2pTransport(){return this.state.p2pTransport}clientCreated(){this.dispatch({type:Pe.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:Pe.KEY_METRIC_JOIN_START,metric:Date.now()})}joinEnd(){this.dispatch({type:Pe.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:Pe.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:Pe.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:Pe.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:Pe.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:Pe.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:Pe.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}descriptionStart(){this.dispatch({type:Pe.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:Pe.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:Pe.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(e,t,i,r){this.dispatch({type:Pe.KEY_METRIC_PUBLISH,metric:he(he({trackId:e,type:t},i&&{publishStart:i}),r&&{publishEnd:r})})}subscribe(e,t,i,r,a,s,c){this.dispatch({type:Pe.KEY_METRIC_SUBSCRIBE,metric:he(he(he(he(he({userId:e,type:t},i&&{subscribeStart:i}),r&&{subscribeEnd:r}),a&&{firstFrame:a}),s&&{streamAdded:s}),c&&{firstDecoded:c})})}massSubscribe(e,t,i,r){e.forEach(a=>{this.dispatch({type:Pe.KEY_METRIC_SUBSCRIBE,metric:he(he(he({userId:a.userId,type:a.type},t&&{subscribeStart:t}),i&&{subscribeEnd:i}),r&&{firstFrame:r})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(e,t){e.service==="gateway"&&Array.isArray(e.urls)&&(e.urls=e.urls.map(i=>i.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return typeof t!="number"?(this.dispatch({type:Pe.RECORD_JOIN_CHANNEL_SERVICE,record:he(he({},e),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(t<0||t>=this.state.joinChannelServiceRecords.length||this.dispatch({type:Pe.RECORD_JOIN_CHANNEL_SERVICE,record:e,index:t}),t)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:Pe.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:Pe.RESET_KEY_METRICS})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}get avoidJoinStart(){return this.state.avoidJoinStart}set avoidJoinStart(e){this.dispatch({type:Pe.AVOID_JOIN_START,avoidJoinStart:e})}},ZE=function(e){return e.h264="h264",e.h265="h265",e.vp8="vp8",e.vp9="vp9",e.av1="av1",e}({});(function(e){e.opus="opus",e.pcma="pcma",e.pcmu="pcmu",e.g722="g722"})({});var JN=128,G7=96,QN=1e3,wl=10,H7=0;function Ht(e,t,i){return(t=function(r){var a=function(s,c){if(typeof s!="object"||!s)return s;var l=s[Symbol.toPrimitive];if(l!==void 0){var u=l.call(s,"string");if(typeof u!="object")return u;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(s)}(r);return typeof a=="symbol"?a:a+""}(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function ZN(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),i.push.apply(i,r)}return i}function Ae(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?ZN(Object(i),!0).forEach(function(r){Ht(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):ZN(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}var rV=new class extends Lt{constructor(){super(...arguments),Ht(this,"currentUploadLogID",0)}reportLogUploadError(e){let{errorRange:t}=e;t[t.length-1]&&t[t.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=t[t.length-1],this.emit("REPORT_LOG_UPLOAD",e))}},W7=class{constructor(e){Ht(this,"logger",void 0),Ht(this,"prefixLists",[]),this.logger=e}debug(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];this.logger.debug(...this.prefixLists,...t)}info(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];this.logger.info(...this.prefixLists,...t)}warning(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];this.logger.warning(...this.prefixLists,...t)}error(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];this.logger.error(...this.prefixLists,...t)}prefix(e){return this.prefixLists.push(e),this}popPrefix(){return this.prefixLists.pop(),this}};function MT(){let e=new Date;return e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}function $N(){let e=new Date,t=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return t?(t==null?void 0:t[0])+":"+e.getUTCMilliseconds():e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}var pa={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},Zf=Date.now(),Ku=e=>{for(let t in pa)if(Object.prototype.hasOwnProperty.call(pa,t)&&pa[t]===e)return t;return"DEFAULT"},R=new class{constructor(){Ht(this,"proxyServerURL",void 0),Ht(this,"logLevel",pa.DEBUG),Ht(this,"uploadState","collecting"),Ht(this,"uploadLogWaitingList",[]),Ht(this,"uploadLogUploadingList",[]),Ht(this,"uploadErrorCount",0),Ht(this,"currentLogID",0),Ht(this,"url",void 0),Ht(this,"extLog",(e,t)=>{this.appendLogToWaitingList(e,...t)})}debug(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];let r=[pa.DEBUG].concat(t);this.log.apply(this,r)}info(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];let r=[pa.INFO].concat(t);this.log.apply(this,r)}warning(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];let r=[pa.WARNING].concat(t);this.log.apply(this,r)}warn(){this.warning(...arguments)}error(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];let r=[pa.ERROR].concat(t);this.log.apply(this,r)}upload(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];let r=[pa.DEBUG].concat(t);this.uploadLog.apply(this,r)}setLogLevel(e){e=Math.min(Math.max(0,e),4),this.logLevel=e}enableLogUpload(){at("UPLOAD_LOG",!0)}disableLogUpload(){at("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(e){this.proxyServerURL=e}prefix(e){return new W7(this).prefix(e)}log(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];if(Date.now()-Zf<100)return void setTimeout(()=>{this.log(...t)},Date.now()-Zf);let r=Math.max(0,Math.min(4,t[0]));if(t[0]=MT()+" Agora-SDK [".concat(Ku(r),"]:"),this.appendLogToWaitingList(r,...t),r<this.logLevel)return;let a=MT()+" %cAgora-SDK [".concat(Ku(r),"]:"),s=[];if(!k("USE_NEW_LOG"))switch(r){case pa.DEBUG:s=[a,"color: #64B5F6;"].concat(t.slice(1)),console.log.apply(console,s);break;case pa.INFO:s=[a,"color: #1E88E5; font-weight: bold;"].concat(t.slice(1)),console.log.apply(console,s);break;case pa.WARNING:s=[a,"color: #FB8C00; font-weight: bold;"].concat(t.slice(1)),console.warn.apply(console,s);break;case pa.ERROR:s=[a,"color: #B00020; font-weight: bold;"].concat(t.slice(1)),console.error.apply(console,s)}}uploadLog(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];if(Date.now()-Zf<100)return void setTimeout(()=>{this.uploadLog(...t)},Date.now()-Zf);let r=Math.max(0,Math.min(4,t[0]));t[0]=MT()+" Agora-SDK [".concat(Ku(r),"]:"),this.appendLogToWaitingList(r,...t)}appendLogToWaitingList(e){if(!k("UPLOAD_LOG"))return;for(var t=arguments.length,i=new Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];Array.isArray(i[0])?i[0][0]=$N()+" Agora-SDK [".concat(Ku(e),"]:"):i[0]=$N()+" Agora-SDK [".concat(Ku(e),"]:");let a="";i.forEach(s=>{typeof s=="object"&&(s=JSON.stringify(s)),a+="".concat(s," ")}),this.uploadLogWaitingList.push({payload_str:a,log_level:e,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){let e=this.uploadLogUploadingList,t={sdk_version:Sa,process_id:k("PROCESS_ID"),payload:JSON.stringify(e)};return Rn(async()=>{let i=await yr.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(k("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(k("LOG_UPLOAD_SERVER"),"/upload/v1")),t,{responseType:"text"});if(i.data!=="OK"){let r=new Error("unexpected upload log response");throw r.response=i,r}},()=>(this.uploadLogUploadingList=[],!1),i=>{let r={status:-1,message:i.message,errorRange:e.map(a=>a.log_item_id)};return i.response?(r.status=i.response.status,r.data=i.response.data,r.headers=i.response.headers):i.request&&(r.status=i.request.status),rV.reportLogUploadError(r),!0},{timeout:k("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:k("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,k("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),k("UPLOAD_LOG_INTERVAL"))}).catch(e=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),k("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),k("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}},eD;function K7(e){return Ti(e.reportId,"params.reportId",0,100,!1),Ti(e.category,"params.category",0,100,!1),Ti(e.event,"params.event",0,100,!1),Ti(e.label,"params.label",0,100,!1),nt(e.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(eD={}).FREE="free",eD.UPLOADING="uploading",function(e){e[e.MISC=0]="MISC",e[e.INTERNAL_EVENT=1]="INTERNAL_EVENT",e[e.PUBLIC_EVENT=2]="PUBLIC_EVENT",e[e.WEB_EVENT=3]="WEB_EVENT",e[e.INTERNAL_API=4]="INTERNAL_API",e[e.WEB_API=5]="WEB_API",e[e.PUBLIC_API=6]="PUBLIC_API"}({});var z7={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0},Si=function(e){return e.PUBLISH="publish",e.SUBSCRIBE="subscribe",e.WS_COMPRESSOR_INIT="ws_compressor_init",e.SESSION_INIT="session_init",e.JOIN_CHOOSE_SERVER="join_choose_server",e.REQ_USER_ACCOUNT="req_user_account",e.JOIN_GATEWAY="join_gateway",e.REJOIN_GATEWAY="rejoin_gateway",e.STREAM_SWITCH="stream_switch",e.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",e.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",e.FIRST_VIDEO_RECEIVED="first_video_received",e.FIRST_AUDIO_RECEIVED="first_audio_received",e.FIRST_VIDEO_DECODE="first_video_decode",e.FIRST_AUDIO_DECODE="first_audio_decode",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_UPDATE_STREAM="on_update_stream",e.ON_REMOVE_STREAM="on_remove_stream",e.USER_ANALYTICS="req_user_analytics",e.PC_STATS="pc_stats",e.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",e}({}),Pt=function(e){return e.SESSION="io.agora.pb.Wrtc.Session",e.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",e.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",e.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",e.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",e.PUBLISH="io.agora.pb.Wrtc.Publish",e.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",e.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",e.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",e.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",e.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",e.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",e.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",e.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",e.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",e.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",e.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",e.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",e.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",e.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",e.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",e.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",e.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",e.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",e.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",e.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",e.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",e.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",e.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",e.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",e.PC_STATS="io.agora.pb.Wrtc.PCStats",e.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",e}({});(function(e){e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"})({});var Y7=function(e){return e[e.SESSION=26]="SESSION",e[e.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",e[e.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",e[e.JOIN_GATEWAY=28]="JOIN_GATEWAY",e[e.PUBLISH=30]="PUBLISH",e[e.SUBSCRIBE=29]="SUBSCRIBE",e[e.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",e[e.STREAM_SWITCH=32]="STREAM_SWITCH",e[e.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",e[e.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",e[e.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",e[e.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",e[e.API_INVOKE=41]="API_INVOKE",e[e.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",e[e.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",e[e.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",e[e.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",e[e.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",e[e.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",e[e.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",e[e.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",e[e.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",e[e.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",e[e.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",e[e.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",e[e.USER_ANALYTICS=1e4]="USER_ANALYTICS",e[e.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED",e}({}),$y=class aV{constructor(){Ht(this,"baseInfoMap",new Map),Ht(this,"proxyServer",void 0),Ht(this,"eventUploadTimer",void 0),Ht(this,"setSessionIdTimer",void 0),Ht(this,"url",void 0),Ht(this,"backupUrl",void 0),Ht(this,"_appId",void 0),Ht(this,"keyEventUploadPendingItems",[]),Ht(this,"normalEventUploadPendingItems",[]),Ht(this,"apiInvokeUploadPendingItems",[]),Ht(this,"apiInvokeCount",0),Ht(this,"ltsList",[]),Ht(this,"lastSendNormalEventTime",Date.now()),Ht(this,"customReportCounterTimer",void 0),Ht(this,"customReportCount",0),Ht(this,"extApiInvoke",async t=>{for(let i of t){let r=Ae(Ae({},i),{},{sid:null,invokeId:++this.apiInvokeCount,tag:Vt.TRACER});this.sendApiInvoke(r)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),k("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),k("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(t){return this.baseInfoMap.get(t)}adjustSessionStartTime(t){if(!this.baseInfoMap.has(t)&&!this.baseInfoMap.get(t))return void R.error("adjust session ".concat(t," start time, sid is not exist or info is undefined"));let i=this.baseInfoMap.get(t),r=Date.now(),a=i.startTime;i.startTime=r,R.debug("rewrite session ".concat(t," startTime: ").concat(r," , ").concat(r-a,"ms")),this.baseInfoMap.set(t,i)}setAppId(t){this._appId=t}reportApiInvoke(t,i,r){i.timeout=i.timeout||6e4,i.reportResult=i.reportResult===void 0||i.reportResult;let a=Date.now();this.apiInvokeCount+=1;let s=this.apiInvokeCount,c=()=>({tag:i.tag,invokeId:s,sid:t,name:i.name,apiInvokeTime:a,options:i.options,states:i.states||null}),l=!!k("SHOW_REPORT_INVOKER_LOG");l&&R.info("".concat(i.name," start"),i.options);let u=!1;yi(i.timeout).then(()=>{u||(this.sendApiInvoke(Ae(Ae({},c()),{},{error:A.API_INVOKE_TIMEOUT,success:!1})),R.debug("".concat(i.name," timeout")))});let h=new H(A.UNEXPECTED_ERROR,"".concat(i.name,": this api invoke is end"));return{onSuccess:p=>{let _=()=>{if(u)throw h;return u=!0,this.sendApiInvoke(Ae(Ae({},c()),{},{success:!0},i.reportResult&&{result:p})),l&&R.info("".concat(i.name," onSuccess")),p};return r?zN(_,i.name+"Success",r,()=>u=!0):_()},onError:p=>{let _=()=>{if(u)throw p;u=!0,this.sendApiInvoke(Ae(Ae({},c()),{},{success:!1,error:p})),l&&R.info("".concat(i.name," onFailure"),p.toString())};return r?zN(_,i.name+"Error",r,()=>u=!0):_()}}}sessionInit(t,i){if(this.baseInfoMap.has(t))return;let r=Date.now(),a=this.createBaseInfo(t,r);a.cname=i.cname;let s=Object.assign({},{willUploadConsoleLog:k("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:Jy?"global":"oversea",areas:k("AREAS")&&k("AREAS").join(",")},i.extend),{stringUid:c,channelProfile:l,channelMode:u,isABTestSuccess:h,lsid:p,clientRole:_}=i,m=Date.now(),S=Ae(Ae({},a),{},{eventType:Si.SESSION_INIT,appid:i.appid,browser:navigator.userAgent,buildFormat:i.buildFormat,build:Zy,lts:m,elapse:m-r,extend:JSON.stringify(s),mode:i.mode,process:k("PROCESS_ID"),appType:k("APP_TYPE"),success:!0,version:Sa,stringUid:c,channelProfile:l,channelMode:u,isABTestSuccess:h,lsid:p,clientType:oe(C=window.navigator.userAgent).call(C,"AgoraWebView")?42:20,clientRole:_,serviceId:k("PROCESS_ID"),extensionID:k("PLUGIN_INFO").join(",")||""});var C;this.send({type:Pt.SESSION,data:S},!0)}joinChooseServer(t,i){let r=this.baseInfoMap.get(t);if(!r)return;let a=r.info,s=Date.now(),c=Ae(Ae({},a),{},{eventType:Si.JOIN_CHOOSE_SERVER,lts:s,eventElapse:i.elapse||s-i.lts,chooseServerAddr:i.csAddr,errorCode:i.ec,elapse:s-r.startTime,success:i.succ,chooseServerAddrList:JSON.stringify(i.serverList),uid:i.uid?parseInt(i.uid):null,cid:i.cid?parseInt(i.cid):null,chooseServerIp:i.csIp||"",opid:i.opid,unilbsServerIds:i.unilbsServerIds,extend:i.extend||void 0,isHttp3:i.isHttp3});this.send({type:Pt.JOIN_CHOOSE_SERVER,data:c},!0)}reqUserAccount(t,i){let r=this.baseInfoMap.get(t);if(!r)return;let a=r.info,s=Date.now(),c=Ae(Ae({},a),{},{eventType:Si.REQ_USER_ACCOUNT,lts:s,success:i.success,serverAddress:i.serverAddr,stringUid:i.stringUid,uid:i.uid,errorCode:i.errorCode,elapse:i.elapse||s-r.startTime,eventElapse:s-i.lts,extend:JSON.stringify(i.extend)});this.send({type:Pt.REQ_USER_ACCOUNT,data:c},!0)}joinGateway(t,i){let r=this.baseInfoMap.get(t);if(!r)return;let a=r.info;i.vid&&(a.vid=i.vid),a.uid=i.uid,a.cid=i.cid;let s=Date.now(),{firstSuccess:c,avoidJoinStartTime:l}=i,u=s-(c&&l?l:r.startTime),h=Ae(Ae({},a),{},{eventType:Si.JOIN_GATEWAY,lts:s,gatewayAddr:i.addr,success:i.succ,errorCode:i.ec,errorMsg:i.errorMsg||"",elapse:u,eventElapse:s-i.lts,firstSuccess:c,signalChannel:i.signalChannel,preload:i.preload?1:0});i.succ&&(r.lastJoinSuccessTime=s),this.send({type:Pt.JOIN_GATEWAY,data:h},!0)}joinChannelTimeout(t,i){let r=this.baseInfoMap.get(t);if(!r)return;let a=Date.now(),s=Ae(Ae({},r.info),{},{lts:a,timeout:i,elapse:a-r.startTime});this.send({type:Pt.JOIN_CHANNEL_TIMEOUT,data:s},!0)}publish(t,i){let r=this.baseInfoMap.get(t);if(!r)return;let a=r.info,s=Date.now(),c=Ae(Ae({},a),{},{eventType:Si.PUBLISH,lts:s,eventElapse:i.eventElapse,elapse:s-r.startTime,success:i.succ,errorCode:i.ec,videoName:i.videoName,audioName:i.audioName,screenName:i.screenName,screenshare:i.screenshare,audio:i.audio,video:i.video,p2pid:i.p2pid,publishRequestid:i.publishRequestid});this.send({type:Pt.PUBLISH,data:c},!0)}subscribe(t,i,r){let a=this.baseInfoMap.get(t);if(!a)return;let s=a.info,c=Date.now(),l=Ae(Ae({},s),{},{eventType:Si.SUBSCRIBE,lts:c,eventElapse:i.eventElapse,elapse:c-a.startTime,success:i.succ,errorCode:i.ec,video:i.video,audio:i.audio,subscribeRequestid:i.subscribeRequestid,p2pid:i.p2pid,preSsrc:i.preSsrc?1:0},r&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof i.peerid=="string"?l.peerSuid=i.peerid:l.peer=i.peerid,this.send({type:Pt.SUBSCRIBE,data:l},!0)}wsCompressorInit(t){var i;let r=[...Xr(i=this.baseInfoMap).call(i)],a=r.length?r[0]:"UnableToGetSid",s=this.baseInfoMap.get(a);if(!s)return;let c=s.info,l=Date.now(),u=Ae(Ae({},c),{},{eventType:Si.WS_COMPRESSOR_INIT,lts:l,eventElapse:t.eventElapse,elapse:l-s.startTime,status:t.status?1:2});this.send({type:Pt.WS_COMPRESSOR_INIT,data:u},!0)}firstRemoteVideoDecode(t,i,r,a){let s=this.baseInfoMap.get(t);if(!s)return;let c=s.info,l=Date.now(),u=Ae(Ae(Ae({},c),a),{},{elapse:l-s.startTime,eventType:i,lts:l,firstDecodeFrame:Math.max((a.firstFrame||l)-s.startTime,0),apEnd:Math.max(a.apEnd-s.startTime,0),apStart:Math.max(a.apStart-s.startTime,0),joinGwEnd:Math.max(a.joinGwEnd-s.startTime,0),joinGwStart:Math.max(a.joinGwStart-s.startTime,0),pcEnd:Math.max(a.pcEnd-s.startTime,0),pcStart:Math.max(a.pcStart-s.startTime,0),subscriberEnd:Math.max(a.subscriberEnd-s.startTime,0),subscriberStart:Math.max(a.subscriberStart-s.startTime,0),videoAddNotify:Math.max(a.videoAddNotify-s.startTime,0)});this.send({type:r,data:u},!0)}firstRemoteFrame(t,i,r,a){let s=this.baseInfoMap.get(t);if(!s)return;let c=s.info,l=Date.now(),u=Ae(Ae(Ae({},c),a),{},{elapse:l-s.startTime,eventType:i,lts:l});this.send({type:r,data:u},!0)}pcStats(t,i){let r=this.baseInfoMap.get(t);if(!r)return;let a=r.info,s=Date.now(),c=Ae(Ae(Ae({},a),i),{},{vid:a.vid===void 0?0:Number(a.vid),elapse:s-r.startTime,eventType:Si.PC_STATS,lts:s,preallocation:i.preallocation?1:0});this.send({type:Pt.PC_STATS,data:c},!0)}updateRemoteRTPCapabilities(t,i){if(t){let r=this.baseInfoMap.get(t);if(!r)return;let a=r.info,s=Date.now(),c=Ae(Ae(Ae({},a),i),{},{vid:a.vid===void 0?0:Number(a.vid),eventType:Si.UPDATE_REMOTE_RTPCAPABILITIES,lts:s});this.send({type:Pt.UPDATE_REMOTE_RTPCAPABILITIES,data:c},!0)}}onGatewayStream(t,i,r,a){let s=this.baseInfoMap.get(t);if(!s)return;let c=s.info,l=Date.now(),u=Ae(Ae(Ae({},c),a),{},{eventType:i,lts:l});this.send({type:r,data:u},!0)}streamSwitch(t,i){let r=this.baseInfoMap.get(t);if(!r)return;let a=r.info,s=Date.now(),c=Ae(Ae({},a),{},{eventType:Si.STREAM_SWITCH,lts:s,isDual:i.isdual,elapse:s-r.startTime,success:i.succ});this.send({type:Pt.STREAM_SWITCH,data:c},!0)}requestProxyAppCenter(t,i){let r=this.baseInfoMap.get(t);if(!r)return;let a=r.info,s=Date.now(),c=Ae(Ae({},a),{},{eventType:Si.REQUEST_PROXY_APPCENTER,lts:s,eventElapse:s-i.lts,elapse:s-r.startTime,APAddr:i.APAddr,workerManagerList:i.workerManagerList,response:i.response,errorCode:i.ec,success:i.succ});this.send({type:Pt.REQUEST_PROXY_APPCENTER,data:c},!0)}requestProxyWorkerManager(t,i){let r=this.baseInfoMap.get(t);if(!r)return;let a=r.info,s=Date.now(),c=Ae(Ae({},a),{},{eventType:Si.REQUEST_PROXY_WORKER_MANAGER,lts:s,eventElapse:s-i.lts,elapse:s-r.startTime,workerManagerAddr:i.workerManagerAddr,response:i.response,errorCode:i.ec,success:i.succ});this.send({type:Pt.REQUEST_PROXY_WORKER_MANAGER,data:c},!0)}setProxyServer(t){this.proxyServer=t,t?R.debug("reportProxyServerurl: ".concat(t)):R.debug("disable reportProxyServerurl: ".concat(t))}peerPublishStatus(t,i){let r=this.baseInfoMap.get(t);if(!r)return;let a=r.info,s=Date.now(),c=Ae(Ae({},a),{},{subscribeElapse:i.subscribeElapse,peer:i.peer,peerPublishDuration:Math.max(i.audioPublishDuration,i.videoPublishDuration),audiotag:i.audioPublishDuration>0?1:-1,videotag:i.videoPublishDuration>0?1:-1,lts:s,elapse:s-r.startTime,joinChannelSuccessElapse:s-(r.lastJoinSuccessTime||s),peerPublishDurationVideo:i.videoPublishDuration,peerPublishDurationAudio:i.audioPublishDuration});this.send({type:Pt.PEER_PUBLISH_STATUS,data:c},!0)}workerEvent(t,i){let r=this.baseInfoMap.get(t);if(!r)return;let a=r.info,s=Date.now();(function(c,l,u){let h=c[l];if(!h||typeof h!="string")return[c];c[l]="";let p=Gn(JSON.stringify(c)),_=0,m=[],S=0;for(let C=0;C<h.length;C++)S+=h.charCodeAt(C)<=127?1:3,S<=u-p||(m[m.length]=he(he({},c),{},{[l]:h.substring(_,C)}),_=C,S=h.charCodeAt(C)<=127?1:3);return _!==h.length-1&&(m[m.length]=he(he({},c),{},{[l]:h.substring(_)})),m})(Ae(Ae(Ae({},a),i),{},{elapse:s-r.startTime,lts:s,productType:"WebRTC"}),"payload",1300).forEach(c=>this.send({type:Pt.WORKER_EVENT,data:c},!0))}apworkerEvent(t,i){let r=this.baseInfoMap.get(t);if(!r)return;let a=r.info,s=Date.now(),c=Ae(Ae(Ae({},a),i),{},{elapse:s-r.startTime,lts:s});this.send({type:Pt.AP_WORKER_EVENT,data:c},!0)}joinWebProxyAP(t,i){let r=this.baseInfoMap.get(t);if(!r)return;let a=r.info,s=Date.now(),c=Ae(Ae(Ae({},a),i),{},{elapse:s-r.startTime,lts:s,extend:i.extend||void 0});this.send({type:Pt.JOIN_WEB_PROXY_AP,data:c},!0)}WebSocketQuit(t,i){let r=this.baseInfoMap.get(t);if(!r)return;let a=r.info,s=Date.now(),c=Ae(Ae(Ae({},a),i),{},{elapse:s-r.startTime,lts:s});this.send({type:Pt.WEBSOCKET_QUIT,data:c},!0)}async sendCustomReportMessage(t,i){if(this.customReportCount+=i.length,this.customReportCount>k("CUSTOM_REPORT_LIMIT"))throw new H(A.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));let r=Date.now(),a=i.map(s=>({type:Pt.USER_ANALYTICS,data:Ae(Ae({sid:t},s),{},{lts:r})}));try{k("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(a):await this.postDataToStatsCollector(a)}catch(s){throw R.error("send custom report message failed",s.toString()),new H(A.CUSTOM_REPORT_SEND_FAILED,s.message)}}sendApiInvoke(t){let i=k("NOT_REPORT_EVENT");if(t.tag&&oe(i)&&oe(i).call(i,t.tag))return!1;if(t.sid===null)return this.apiInvokeUploadPendingItems.push(t),!1;let r=this.baseInfoMap.get(t.sid);if(!r)return this.apiInvokeUploadPendingItems.push(t),!1;let{cname:a,uid:s,cid:c}=r.info,l;if(t.lts=t.lts||Date.now(),t.error)if(t.error instanceof H){let{code:h,message:p}=t.error;l=h||p||t.error.toString()}else l=t.error.toString();let u={invokeId:t.invokeId,sid:t.sid,cname:a,cid:c,uid:s,lts:t.lts,success:t.success,elapse:t.lts-r.startTime,execElapse:t.lts-t.apiInvokeTime,apiName:t.name,options:t.options?JSON.stringify(t.options):void 0,execStates:t.states?JSON.stringify(t.states):void 0,execResult:t.result?JSON.stringify(t.result):void 0,errorCode:t.error?l:void 0,errorMsg:t.error?JSON.stringify(t.error):void 0};return this.send({type:Pt.API_INVOKE,data:u},!1),!0}appendSessionId(){aV.__CLIENT_LIST__.forEach(t=>{if(t._sessionId){let i=this.apiInvokeUploadPendingItems.length;for(let r=0;r<i;r++){let a=this.apiInvokeUploadPendingItems.shift();a&&(a.sid=t._sessionId,this.sendApiInvoke(Object.assign({},a)))}}})}send(t,i){if(i)return this.keyEventUploadPendingItems.push(t),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(t),this.normalEventUploadPendingItems.length>k("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(t,i){let r=[],a=[];for(;t.length;){let c=t.shift();r.length<20?r.push(c):a.push(c)}t.push(...a);for(let c of[...r]){var s;this.ltsList.indexOf(c.data.lts)!==-1?(c.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(c.data.lts)):(this.ltsList.push(c.data.lts),cp(s=this.ltsList).call(s,(l,u)=>l-u))}return i||(this.lastSendNormalEventTime=Date.now()),k("ENABLE_EVENT_REPORT")&&r.length&&(k("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(r):this.postDataToStatsCollector(r)).catch((c=>l=>{k("EVENT_REPORT_RETRY")&&(i?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(c):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(c),this.normalEventUploadPendingItems.length>k("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-k("NORMAL_EVENT_QUEUE_CAPACITY")),R.warning("report: drop normal events"))))})(r)),t}async postDataToStatsCollector2(t){Qt.networkState===xr.OFFLINE&&await ae.race([Qt.onlineWaiter,yi(2*ti.maxRetryTimeout)]);let i=s=>{let c=new Uint8Array;return s.forEach(l=>{let u=qy(JSON.stringify(l.data)),h=new ArrayBuffer(5),p=(m=>{let S=0;return Object.entries(Pt).forEach(C=>{let[v,y]=C;y===m.type&&(S=Y7[v])}),S})(l),_=new DataView(h);_.setUint16(0,u.byteLength,!0),_.setUint8(2,255&p),_.setUint8(3,p>>>8&255),_.setUint8(4,p>>>16&255),c=jN(c,new Uint8Array(h)),c=jN(c,u)}),c},r="event",a=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(k("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(r):"https://".concat(k("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(r);for(let s=0;s<2;s+=1){s===1&&(a=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(k("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(r):"https://".concat(k("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(r));try{await kv(a,{timeout:1e4,data:i(t),headers:Ae(Ae({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(c){if(s===1)throw c;continue}return}}async postDataToStatsCollector(t){let i=arguments.length>1&&arguments[1]!==void 0&&arguments[1],r={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:t.map(c=>JSON.stringify(c)),vid:(c=>{let l=c&&c.data.sid&&this.baseInfoMap.get(c.data.sid);return l&&l.info.vid&&+l.info.vid||0})(t[0])};Qt.networkState===xr.OFFLINE&&await ae.race([Qt.onlineWaiter,yi(2*ti.maxRetryTimeout)]);let a=i?"/events/proto-raws":"/events/messages",s=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(k("EVENT_REPORT_DOMAIN"),"&p=").concat(k("STATS_COLLECTOR_PORT"),"&d=").concat(a):"https://".concat(k("EVENT_REPORT_DOMAIN"),":").concat(k("STATS_COLLECTOR_PORT")).concat(a));for(let c=0;c<2;c+=1){c===1&&(s=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(k("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(k("STATS_COLLECTOR_PORT"),"&d=").concat(a):"https://".concat(k("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(k("STATS_COLLECTOR_PORT")).concat(a)));try{i?await j7(s,{timeout:1e4,data:r}):await kv(s,{timeout:1e4,data:r})}catch(l){if(c===1)throw l;continue}return}}createBaseInfo(t,i){let r=Object.assign({},z7);return r.sid=t,this.baseInfoMap.set(t,{info:r,startTime:i}),r}reportResourceTiming(t,i){let r=performance.getEntriesByName(t),a=r[r.length-1];a&&this.reportApiInvoke(i,{name:"Client.resourceTiming",options:a,tag:Vt.TRACER}).onSuccess()}};function Se(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(t,i,r){let a=r.value;if(typeof a=="function"){let s=e.className||t.__className__||(t.constructor.name==="AgoraRTCClient"?"Client":t.constructor.name);r.value=function(){for(var c=arguments.length,l=new Array(c),u=0;u<c;u++)l[u]=arguments[u];let h=l;if(e.argsMap)try{h=e.argsMap(this,...l)}catch(_){R.warning(_),h=[]}try{JSON.stringify(h)}catch{R.warning("arguments for method ".concat(s,".").concat(String(i)," not serializable for apiInvoke.")),h=[]}let p=(e.report||fe).reportApiInvoke(this._sessionId||null,{name:"".concat(s,".").concat(String(i)),options:h,tag:Vt.TRACER,reportResult:e.reportResult},e.throttleTime);try{let _=a.apply(this,l);return _ instanceof ae?_.then(m=>(p.onSuccess(e.reportResult&&m),m)).catch(m=>{throw p.onError(m),m}):(p.onSuccess(e.reportResult&&_),_)}catch(_){throw p.onError(_),_}}}return r}}Ht($y,"__CLIENT_LIST__",[]);var fe=new $y;rV.on("REPORT_LOG_UPLOAD",e=>{e.networkState=Qt.networkState,fe.reportApiInvoke(null,{name:"logUploadError",options:e,tag:Vt.TRACER}).onSuccess("logUploadError")});var q7=["CHINA","GLOBAL"],Ni=function(){let e="us".concat("erna","me"),t="pa".concat("sswo","rd"),i=["t","s","t"];i.splice(1,0,"e");let r=i.join(""),a=[];for(let l=0;l<6;l++)a.push("1");let s=a.join(""),c={};return c[e]=r,c[t]=s,Object.assign(c,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=Ni,Jy||(Wt.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],Wt.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],Wt.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],Wt.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],Wt.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],Wt.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],Wt.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",Wt.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",Wt.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",Wt.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",Wt.AREAS=["NORTH_AMERICA","OVERSEA"]);var nV=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],fo=[];function oc(e,t){return!!t&&fo.some(i=>i.uid===e&&i.channelName===t)}$y.__CLIENT_LIST__=fo;var X7=$2.forEach,tD=LE("forEach")?[].forEach:function(e){return X7(this,e,arguments.length>1?arguments[1]:void 0)};_t({target:"Array",proto:!0,forced:[].forEach!=tD},{forEach:tD});var J7=en("Array").forEach,Q7=Jn,Z7=Gi,$7=_r,e9=J7,UT=Array.prototype,t9={DOMTokenList:!0,NodeList:!0},i9=function(e){var t=e.forEach;return e===UT||$7(UT,e)&&t===UT.forEach||Z7(t9,Q7(e))?e9:t},r9=zt(i9),a9=Xn,iD=xE;_t({target:"Object",stat:!0,forced:si(function(){iD(1)})},{keys:function(e){return iD(a9(e))}});var sV=zt(Tn.Object.keys),n9=zt(uU),s9=_t,o9=lp,c9=ii([].reverse),rD=[1,2];s9({target:"Array",proto:!0,forced:String(rD)===String(rD.reverse())},{reverse:function(){return o9(this)&&(this.length=this.length),c9(this)}});var l9=en("Array").reverse,d9=_r,u9=l9,xT=Array.prototype,h9=function(e){var t=e.reverse;return e===xT||d9(xT,e)&&t===xT.reverse?u9:t},oV=h9,p9=zt(oV),f9=_t,aD=lp,_9=jE,E9=ia,nD=py,m9=Ps,g9=Lo,S9=HE,T9=Zt,R9=Ay,v9=X2("slice"),y9=T9("species"),VT=Array,C9=Math.max;f9({target:"Array",proto:!0,forced:!v9},{slice:function(e,t){var i,r,a,s=g9(this),c=m9(s),l=nD(e,c),u=nD(t===void 0?c:t,c);if(aD(s)&&(i=s.constructor,(_9(i)&&(i===VT||aD(i.prototype))||E9(i)&&(i=i[y9])===null)&&(i=void 0),i===VT||i===void 0))return R9(s,l,u);for(r=new(i===void 0?VT:i)(C9(u-l,0)),a=0;l<u;l++,a++)l in s&&S9(r,a,s[l]);return r.length=a,r}});var b9=en("Array").slice,A9=_r,I9=b9,BT=Array.prototype,O9=function(e){var t=e.slice;return e===BT||A9(BT,e)&&t===BT.slice?I9:t},w9=zt(O9);function de(e,t,i,r,a){var s,c,l,u={};return r9(s=sV(r)).call(s,function(h){u[h]=r[h]}),u.enumerable=!!u.enumerable,u.configurable=!!u.configurable,("value"in u||u.initializer)&&(u.writable=!0),u=n9(c=p9(l=w9(i).call(i)).call(l)).call(c,function(h,p){return p(e,t,h)||h},u),a&&u.initializer!==void 0&&(u.value=u.initializer?u.initializer.call(a):void 0,u.initializer=void 0),u.initializer===void 0&&(Y2(e,t,u),u=null),u}var Mv=function(e){return e.L1T1="L1T1",e.L1T2="L1T2",e.L1T3="L1T3",e.L1T3_KEY="L1T3_KEY",e.L2T1_KEY="L2T1_KEY",e.L2T2_KEY="L2T2_KEY",e.L2T3_KEY="L2T3_KEY",e.L3T1_KEY="L3T1_KEY",e.L3T2_KEY="L3T2_KEY",e.L3T3_KEY="L3T3_KEY",e}({}),Kr=function(e){return e.CERTIFICATE="certificate",e.CODEC="codec",e.CANDIDATE_PAIR="candidate-pair",e.LOCAL_CANDIDATE="local-candidate",e.REMOTE_CANDIDATE="remote-candidate",e.INBOUND="inbound-rtp",e.TRACK="track",e.OUTBOUND="outbound-rtp",e.PC="peer-connection",e.REMOTE_INBOUND="remote-inbound-rtp",e.REMOTE_OUTBOUND="remote-outbound-rtp",e.TRANSPORT="transport",e.CSRC="csrc",e.DATA_CHANNEL="data-channel",e.STREAM="stream",e.SENDER="sender",e.RECEIVER="receiver",e}({}),B_=function(e){return e[e.ACCESS_POINT=101]="ACCESS_POINT",e[e.UNILBS=201]="UNILBS",e[e.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",e}({}),jT=function(e){return e[e.IIIEGAL_APPID=1]="IIIEGAL_APPID",e[e.IIIEGAL_UID=2]="IIIEGAL_UID",e[e.INTERNAL_ERROR=3]="INTERNAL_ERROR",e}({}),Ma=function(e){return e[e.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",e[e.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",e[e.INTERNAL_ERROR=8]="INTERNAL_ERROR",e[e.NO_AUTHORIZED=9]="NO_AUTHORIZED",e[e.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",e[e.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",e[e.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",e[e.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",e[e.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",e[e.USER_OVERLOAD=16]="USER_OVERLOAD",e[e.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",e[e.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",e}({}),cr=function(e){return e[e.NO_FLAG_SET=100]="NO_FLAG_SET",e[e.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",e[e.INVALID_FALG_SET=102]="INVALID_FALG_SET",e[e.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",e[e.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",e[e.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",e[e.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",e[e.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",e[e.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",e[e.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",e[e.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",e[e.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",e[e.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",e[e.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",e[e.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",e[e.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",e[e.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",e[e.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",e[e.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",e}({}),me=function(e){return e[e.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",e[e.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",e[e.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",e[e.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",e[e.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",e[e.K_TICKET_INVALID=7]="K_TICKET_INVALID",e[e.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",e[e.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",e[e.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",e[e.K_UID_BANNED=14]="K_UID_BANNED",e[e.K_IP_BANNED=15]="K_IP_BANNED",e[e.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",e[e.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",e[e.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",e[e.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",e[e.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",e[e.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",e[e.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",e[e.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",e[e.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",e[e.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",e[e.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",e[e.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",e[e.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",e[e.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",e[e.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",e[e.ERR_INVALID_UID=117]="ERR_INVALID_UID",e[e.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",e[e.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",e[e.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",e[e.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",e[e.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",e[e.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",e[e.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",e[e.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",e[e.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",e[e.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",e[e.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",e[e.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",e[e.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",e[e.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",e[e.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",e[e.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",e[e.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",e[e.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",e[e.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",e[e.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",e[e.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",e[e.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",e[e.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",e[e.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",e[e.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",e[e.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",e[e.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",e[e.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",e[e.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",e[e.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",e[e.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",e[e.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",e[e.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",e[e.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",e[e.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",e[e.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",e[e.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",e}({}),pt=function(e){return e.CONNECTING="connecting",e.CONNECTED="connected",e.RECONNECTING="reconnecting",e.CLOSED="closed",e}({}),ye=function(e){return e.WS_CONNECTED="ws_connected",e.WS_RECONNECTING="ws_reconnecting",e.WS_CLOSED="ws_closed",e.WS_RECONNECT_WAITTING_FINISH="ws_reconnect_waitting_finish",e.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",e.ON_BINARY_DATA="on_binary_data",e.REQUEST_RECOVER="request_recover",e.REQUEST_JOIN_INFO="request_join_info",e.REQUEST_REJOIN_INFO="req_rejoin_info",e.IS_P2P_DISCONNECTED="is_p2p_dis",e.DISCONNECT_P2P="dis_p2p",e.ABORT_P2P_EXECUTION="abort_p2p_execution",e.NEED_RENEW_SESSION="need-sid",e.REPORT_JOIN_GATEWAY="report_join_gateway",e.REQUEST_TIMEOUT="request_timeout",e.REQUEST_SUCCESS="request_success",e.JOIN_RESPONSE="join_response",e.PRE_CONNECT_PC="pre_connect_pc",e.P2P_CONNECTION="p2p_connection",e.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",e.P2P_SUBSCRIBE="p2p_subscribe",e.P2P_UNSUBSCRIBE="p2p_unsubscribe",e.P2P_EXCHANGE_SDP="p2p_exchange_sdp",e.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",e.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",e}({}),ve=function(e){return e.PING="ping",e.PING_BACK="ping_back",e.JOIN="join_v3",e.REJOIN="rejoin_v3",e.LEAVE="leave",e.SET_CLIENT_ROLE="set_client_role",e.PUBLISH="publish",e.PUBLISH_DATASTREAM="publish_datastream",e.UNPUBLISH="unpublish",e.UNPUBLISH_DATASTREAM="unpublish_datastream",e.SUBSCRIBE="subscribe",e.PRE_SUBSCRIBE="pre_subscribe",e.SUBSCRIBE_DATASTREAM="subscribe_datastream",e.SUBSCRIBE_STREAMS="subscribe_streams",e.UNSUBSCRIBE="unsubscribe",e.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",e.UNSUBSCRIBE_STREAMS="unsubscribe_streams",e.SUBSCRIBE_CHANGE="subscribe_change",e.TRAFFIC_STATS="traffic_stats",e.RENEW_TOKEN="renew_token",e.SWITCH_VIDEO_STREAM="switch_video_stream",e.DEFAULT_VIDEO_STREAM="default_video_stream",e.SET_FALLBACK_OPTION="set_fallback_option",e.GATEWAY_INFO="gateway_info",e.CONTROL="control",e.SEND_METADATA="send_metadata",e.DATA_STREAM="data_stream",e.PICK_SVC_LAYER="pick_svc_layer",e.RESTART_ICE="restart_ice",e.CONNECT_PC="connect_pc",e.SET_VIDEO_PROFILE="set_video_profile",e.SET_PARAMETER="set_parameter",e.SET_RTM2_FLAG="set_rtm2_flag",e}({}),xh=function(e){return e.WRTC_STATS="wrtc_stats",e.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",e.DENOISER_STATS="denoiser_stats",e.EXTENSION_USAGE_STATS="extension_usage_stats",e}({}),Le=function(e){return e.ON_USER_ONLINE="on_user_online",e.ON_USER_OFFLINE="on_user_offline",e.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",e.ON_PUBLISH_STREAM="on_publish_stream",e.ON_UPLINK_STATS="on_uplink_stats",e.ON_P2P_LOST="on_p2p_lost",e.ON_REMOVE_STREAM="on_remove_stream",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",e.ON_USER_BANNED="on_user_banned",e.ON_USER_LICENSE_BANNED="on_user_license_banned",e.ON_NOTIFICATION="on_notification",e.ON_CRYPT_ERROR="on_crypt_error",e.MUTE_AUDIO="mute_audio",e.MUTE_VIDEO="mute_video",e.UNMUTE_AUDIO="unmute_audio",e.UNMUTE_VIDEO="unmute_video",e.ON_P2P_OK="on_p2p_ok",e.RECEIVE_METADATA="receive_metadata",e.ON_DATA_STREAM="on_data_stream",e.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",e.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",e.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",e.ENABLE_LOCAL_VIDEO="enable_local_video",e.DISABLE_LOCAL_VIDEO="disable_local_video",e.ENABLE_LOCAL_AUDIO="enable_local_audio",e.DISABLE_LOCAL_AUDIO="disable_local_audio",e.ON_PUBLISHED_USER_LIST="on_published_user_list",e}({}),ur=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({}),Ce=function(e){return e.CONNECTED="websocket:connected",e.RECONNECTING="websocket:reconnecting",e.WILL_RECONNECT="websocket:will_reconnect",e.CLOSED="websocket:closed",e.FAILED="websocket:failed",e.ON_MESSAGE="websocket:on_message",e.REQUEST_NEW_URLS="websocket:request_new_urls",e.RECONNECT_WAITTING_FINISH="websocket:reconnect_waitting_finish",e.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",e}({}),B=class extends H{constructor(e){super(e,arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",arguments.length>2?arguments[2]:void 0),b(this,"name","AgoraRTCException")}print(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return super.print(e,R)}throw(){super.throw(R)}};function $E(e){if(typeof e!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(e))throw R.error("Invalid Channel Name ".concat(e)),new B(A.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function em(e){if(!function(t){return typeof t=="number"&&Math.floor(t)===t&&0<=t&&t<=4294967295}(e)&&!Xx(e,1,255))throw new B(A.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");typeof e=="string"&&R.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}var Os=function(e){return e.TRANSCODE="mix_streaming",e.RAW="raw_streaming",e}({}),N9={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},FT={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function GT(e,t){Ti(e.url,"".concat(t,".url"),1,1e3,!1),Dt(e.x)||nt(e.x,"".concat(t,".x"),0,1e4),Dt(e.y)||nt(e.y,"".concat(t,".y"),0,1e4),Dt(e.width)||nt(e.width,"".concat(t,".width"),0,1e4),Dt(e.height)||nt(e.height,"".concat(t,".height"),0,1e4),Dt(e.zOrder)||nt(e.zOrder,"".concat(t,".zOrder"),0,255),Dt(e.alpha)||nt(e.alpha,"".concat(t,".alpha"),0,1,!1)}var D9={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""},_o=function(e){return e.WARNING="@live_uap-warning",e.ERROR="@line_uap-error",e.PUBLISH_STREAM_STATUS="@live_uap-publish-status",e.WORKER_STATUS="@live_uap-worker-status",e.REQUEST_NEW_ADDRESS="@live_uap-request-address",e}({}),Uv=function(e){return e.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",e}({}),ai=function(e){return e[e.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",e[e.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",e[e.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",e[e.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",e[e.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",e[e.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",e[e.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",e[e.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",e[e.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",e[e.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",e[e.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",e[e.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",e[e.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",e[e.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",e[e.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",e[e.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",e}({});function sD(e){if(!e.channelName)throw new B(A.INVALID_PARAMS,"invalid channelName in info");if(typeof e.uid!="number")throw new B(A.INVALID_PARAMS,"invalid uid in info, uid must be a number");return e.token&&Ti(e.token,"info.token",1,2047),em(e.uid),$E(e.channelName),!0}var lr=function(e){return e[e.SetSdkProfile=0]="SetSdkProfile",e[e.SetSourceChannel=1]="SetSourceChannel",e[e.SetSourceUserId=2]="SetSourceUserId",e[e.SetDestChannel=3]="SetDestChannel",e[e.StartPacketTransfer=4]="StartPacketTransfer",e[e.StopPacketTransfer=5]="StopPacketTransfer",e[e.UpdateDestChannel=6]="UpdateDestChannel",e[e.Reconnect=7]="Reconnect",e[e.SetVideoProfile=8]="SetVideoProfile",e}({}),Ts=function(e){return e.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",e.NETWORK_CONNECTED="NETWORK_CONNECTED",e.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",e.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",e.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",e.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",e.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",e.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",e.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",e.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",e}({}),Or=function(e){return e.RELAY_STATE_IDLE="RELAY_STATE_IDLE",e.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",e.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",e.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",e}({}),Hl=function(e){return e.RELAY_OK="RELAY_OK",e.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",e.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",e.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",e}({}),Qe=function(e){return e.High="high",e.Low="low",e.Audio="audio",e.Screen="screen",e.ScreenLow="screen_low",e}({}),wi=function(e){return e.DISCONNECT="disconnect",e.CONNECTION_STATE_CHANGE="connection-state-change",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGE="stream-type-change",e.IS_P2P_DISCONNECTED="is-p2p-dis",e.DISCONNECT_P2P="dis-p2p",e.REQUEST_NEW_GATEWAY_LIST="req-gate-url",e.NEED_RENEW_SESSION="need-sid",e.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",e.JOIN_RESPONSE="join-response",e.RESET_CONNECTION_EVENTS="reset-connection-events",e.PRE_CONNECT_PC="pre-connect_pc",e}({}),j_=function(e){return e.P2P_DISCONNECTED="P2P_DISCONNECTED",e.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",e.TIMEOUT="TIMEOUT",e.UNKNOWN_REASON="UNKNOWN_REASON",e}({}),ui=function(e){return e[e.Nothing=0]="Nothing",e[e.Audio=1]="Audio",e[e.LwoVideo=2]="LwoVideo",e[e.Video=4]="Video",e[e.Data=8]="Data",e[e.DataStream0=256]="DataStream0",e[e.DataStream1=512]="DataStream1",e[e.DataStream2=1024]="DataStream2",e[e.DataStream3=2048]="DataStream3",e[e.DataStream4=4096]="DataStream4",e[e.DataStream5=8192]="DataStream5",e[e.DataStream6=16384]="DataStream6",e[e.DataStream7=32768]="DataStream7",e}({}),qe=function(e){return e.CHINA="CHINA",e.ASIA="ASIA",e.NORTH_AMERICA="NORTH_AMERICA",e.EUROPE="EUROPE",e.JAPAN="JAPAN",e.INDIA="INDIA",e.KOREA="KOREA",e.HKMC="HKMC",e.US="US",e.OCEANIA="OCEANIA",e.SOUTH_AMERICA="SOUTH_AMERICA",e.AFRICA="AFRICA",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="EXTENSIONS",e}({}),oD=[qe.AFRICA,qe.ASIA,qe.CHINA,qe.EUROPE,qe.GLOBAL,qe.INDIA,qe.JAPAN,qe.NORTH_AMERICA,qe.OCEANIA,qe.OVERSEA,qe.SOUTH_AMERICA],Bi=function(e){return e.CHINA="CN",e.ASIA="AS",e.NORTH_AMERICA="NA",e.EUROPE="EU",e.JAPAN="JP",e.INDIA="IN",e.KOREA="KR",e.HKMC="HK",e.US="US",e.OCEANIA="OC",e.SOUTH_AMERICA="SA",e.AFRICA="AF",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="GLOBAL",e}({}),tm={CHINA:{},ASIA:{CODE:Bi.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:Bi.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:Bi.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:Bi.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:Bi.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:Bi.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:Bi.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:Bi.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:Bi.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:Bi.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:Bi.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:Bi.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:Bi.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};Jy&&(tm.CHINA={CODE:Bi.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});var xv=function(e){return e.UPDATE_BITRATE_LIMIT="update_bitrate_limit",e}({}),cV=class extends Lt{constructor(e,t){super(),b(this,"onICEConnectionStateChange",void 0),b(this,"onConnectionStateChange",void 0),b(this,"onDTLSTransportStateChange",void 0),b(this,"onDTLSTransportError",void 0),b(this,"onICETransportStateChange",void 0),b(this,"onFirstAudioReceived",void 0),b(this,"onFirstVideoReceived",void 0),b(this,"onFirstAudioDecoded",void 0),b(this,"onFirstVideoDecoded",void 0),b(this,"onFirstVideoDecodedTimeout",void 0),b(this,"onSelectedLocalCandidateChanged",void 0),b(this,"onSelectedRemoteCandidateChanged",void 0),b(this,"getLocalVideoStats",void 0)}},lV=class extends cV{constructor(e,t){super(e,t),b(this,"establishPromise",void 0)}},_e=function(e){return e.VIDEO="video",e.AUDIO="audio",e}({}),Vr=function(e){return e[e.UDP=0]="UDP",e[e.TCP=1]="TCP",e[e.RELAY=2]="RELAY",e}({}),Es=function(e){return e[e.FIRST_CONNECTION=0]="FIRST_CONNECTION",e[e.TCP_RESTART=1]="TCP_RESTART",e[e.RELAY_RESTART=2]="RELAY_RESTART",e[e.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",e[e.OLD_RESTART=11]="OLD_RESTART",e[e.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",e}({}),Q=function(e){return e.LocalVideoTrack="videoTrack",e.LocalAudioTrack="audioTrack",e.LocalVideoLowTrack="videoLowTrack",e}({}),Je=function(e){return e.New="new",e.Connected="connected",e.Reconnecting="reconnecting",e.Disconnected="disconnected",e}({}),Te=function(e){return e.StateChange="stateChange",e.IceConnectionStateChange="iceConnectionStateChange",e.RequestMuteLocal="requestMuteLocal",e.RequestUnmuteLocal="requestUnmuteLocal",e.RequestRePublish="requestRePublish",e.RequestRePublishDataChannel="requestRePublishDataChannel",e.RequestReSubscribe="requestReSubscribe",e.RequestUploadStats="requestUploadStats",e.RequestUpload="requestUpload",e.MediaReconnectStart="MediaReconnectStart",e.MediaReconnectEnd="MediaReconnectEnd",e.NeedSignalRTT="NeedSignalRTT",e.RequestRestartICE="RequestRestartIce",e.PeerConnectionStateChange="PeerConnectionStateChange",e.RequestReconnect="RequestReconnect",e.RequestReconnectPC="RequestReconnectPC",e.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",e.P2PLost="P2PLost",e.UpdateVideoEncoder="UpdateVideoEncoder",e.ConnectionTypeChange="ConnectionTypeChange",e.RequestLowStreamParameter="RequestLowStreamParameter",e.QueryClientConnectionState="QueryClientConnectionState",e.LocalCandidate="LocalCandidate",e.RequestP2PMuteLocal="requestP2PMuteLocal",e.RequestP2PUnPublish="RequestP2PUnPublish",e.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",e.RequestP2PMuteRemote="RequestP2PMuteRemote",e.RequestP2PRestartICE="RequestP2PRestartICE",e}({}),Ga=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),Ua=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),_i=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),dV=function(e){return e.CONNECTED="transmitter:connected",e.RECONNECTING="transmitter:reconnecting",e.WILL_RECONNECT="transmitter:will_reconnect",e.CLOSED="transmitter:closed",e.FAILED="transmitter:failed",e.ON_MESSAGE="transmitter:on_message",e.REQUEST_NEW_URLS="transmitter:request_new_urls",e.RECONNECT_WAITTING_FINISH="transmitter:reconnect_waitting_finish",e.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",e.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",e.FAILBACK="transmitter:failback",e.PRE_CONNECT_PC="transmitter:pre_connect_pc",e}({}),Vn=function(e){return e.CAMERA_CHANGED="camera-changed",e.MICROPHONE_CHANGED="microphone-changed",e.PLAYBACK_DEVICE_CHANGED="playback-device-changed",e.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",e.AUTOPLAY_FAILED="autoplay-failed",e.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",e.SECURITY_POLICY_VIOLATION="security-policy-violation",e}({}),ha=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),pn=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),Nl=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),Gt=function(e){return e.CALL="call",e.CANDIDATE="candidate",e.PUBLISH="publish",e.UNPUBLISH="unpublish",e.CONTROL="control",e.RESTART_ICE="restart_ice",e.ACK="ack",e.RESPONSE="response",e.JOIN="join",e.CHECK="check",e}({}),Dl=function(e){return e.ABORT="abort",e}({}),To=function(e){return e.MUTE_LOCAL_AUDIO="mute_local_audio",e.MUTE_LOCAL_VIDEO="mute_local_video",e.UNMUTE_LOCAL_AUDIO="unmute_local_audio",e.UNMUTE_LOCAL_VIDEO="unmute_local_video",e}({}),P9=function(e){return e.P2P_TOKEN_TIMEOUT="p2p_token_timeout",e.P2P_TOKEN_CHANGED="p2p_token_changed",e}({}),L9={[B_.ACCESS_POINT]:{[cr.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[cr.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[cr.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[cr.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[cr.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[cr.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[cr.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[cr.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[cr.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[cr.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[cr.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[cr.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[cr.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[cr.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[cr.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[cr.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[cr.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[cr.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[B_.UNILBS]:{[Ma.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[Ma.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[Ma.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[Ma.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[Ma.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[Ma.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[Ma.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[Ma.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[Ma.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[Ma.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[Ma.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[Ma.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[B_.STRING_UID_ALLOCATOR]:{[jT.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[jT.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[jT.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function gd(e){let t=L9[Math.floor(e/1e4)];if(!t)return{desc:"unknown error",retry:!1};let i=t[e%1e4];if(!i){if(Math.floor(e/1e4)===B_.ACCESS_POINT){let r=e%1e4;if(r.toString()[0]==="1")return{desc:e.toString(),retry:!1};if(r.toString()[0]==="2")return{desc:e.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return i}var k9={[me.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[me.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[me.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[me.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[me.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[me.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[me.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[me.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[me.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[me.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[me.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[me.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[me.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[me.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[me.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[me.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[me.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[me.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[me.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[me.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[me.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[me.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[me.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[me.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[me.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[me.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[me.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[me.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[me.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[me.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[me.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[me.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[me.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[me.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[me.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[me.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[me.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[me.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[me.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[me.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[me.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[me.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[me.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[me.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[me.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[me.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[me.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[me.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[me.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[me.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[me.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[me.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[me.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[me.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[me.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[me.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[me.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[me.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[me.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[me.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[me.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[me.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[me.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function Vh(e){return k9[e]||{desc:"UNKNOWN_ERROR_".concat(e),action:"failed"}}function cD(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),i.push.apply(i,r)}return i}function HT(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?cD(Object(i),!0).forEach(function(r){b(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):cD(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}function lD(e){return e.every(t=>t.readyState===WebSocket.CLOSED||t.readyState===WebSocket.CLOSING)}function dD(e,t){if(typeof e=="string")return e;let{proxy:i,host:r,port:a}=e;if(t){let s=k("JOIN_GATEWAY_FALLBACK_PORT")||443;return s===443?"wss://".concat(r,"/ws/?p=").concat(Number(a)+150):"wss://".concat(r,":").concat(s,"/ws/?p=").concat(Number(a)+150)}return i?"wss://".concat(i,"/ws/?h=").concat(r,"&p=").concat(a):"wss://".concat(r,":").concat(a)}var M9=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,U9=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,x9=/wss:\/\/(.+):([0-9]+)\/?/,V9=/wss:\/\/(.[^\/]+)\/?/,B9=0,j9=class{constructor(e,t){b(this,"id",0),b(this,"store",void 0),b(this,"recordIndex",void 0),b(this,"websockets",[]),b(this,"try443PortDuration",2e3),b(this,"forceCloseWSDuration",5e3),b(this,"try443PortTimeout",null),b(this,"forceCloseTimeout",null),b(this,"isTry443PortFailed",!1),b(this,"isNormalPortFailed",!1),b(this,"useDoubleDomain",!1),b(this,"useProxy",!1),b(this,"startTime",Date.now()),this.id=++B9,this.try443PortDuration=k("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=e||5e3,this.store=t}closeAllWebsockets(){this.websockets.forEach(e=>{e.onopen=null,e.onclose=null,e.onmessage=null,e.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout)}logger(){var e;let t=Date.now()-this.startTime;for(var i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];R.debug("[choose-best-ws ".concat((e=this.store)===null||e===void 0?void 0:e.clientId," ").concat(this.id,"] ").concat(t,"ms:"),...r)}createWebSocket(e,t,i){this.logger("createWebSocket:",e,{isTry443Port:t,hasTimeoutDetection:i});let r=k("GATEWAY_DOMAINS"),a=Date.now(),s=[],c=r.find(h=>{var p;return oe(p=e.host).call(p,h)});c||(this.useDoubleDomain=!1);let l=[];if(this.useDoubleDomain)r.forEach(h=>{l.push(dD(HT(HT({},e),{},{host:e.host.replace(c,h)}),t))});else{let h=HT({},e);if(t&&c){let p=r.find(_=>_!==c);p&&(h.host=h.host.replace(c,p))}l.push(dD(h,t))}try{l.forEach(h=>{let p=new WebSocket(h);p.binaryType="arraybuffer",s.push(p),this.logger("ws is connecting:",p.url)})}catch(h){if(this.logger("ws create failed"),s.forEach(p=>p.close()),s.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(e,t,i);if(!t&&Number(e.port)!==443)return this.createWebSocket(e,!0,i);throw new B(A.WS_ERR,"init websocket failed! Error: ".concat(h.toString()))}let u=kh();return this.store&&this.store.recordJoinChannelService({urls:s.map(h=>h.url),service:"gateway"},this.recordIndex),s.forEach(h=>{h.onopen=()=>{this.logger("onopen: ws ".concat(h.url," open cost ").concat(Date.now()-a,"ms")),this.websockets.forEach(p=>{p!==h&&(p.onopen=null,p.onclose=null,p.onmessage=null,p.close(),this.logger("close backup websocket: ".concat(p.url)))}),this.websockets.length=0,u.resolve(h)},h.onclose=p=>{this.logger("onclose: ws ".concat(h.url," closed cost ").concat(Date.now()-a,"ms state: ").concat(h.readyState)),t?this.isTry443PortFailed=lD(s):this.isNormalPortFailed=lD(s),this.logger("443: ".concat(this.useProxy?"not try":this.isTry443PortFailed?"failed":"trying"," 47xx: ").concat(this.isNormalPortFailed?"failed":"trying")),(t&&this.isTry443PortFailed||!t&&(this.isTry443PortFailed||this.useProxy)&&this.isNormalPortFailed)&&(this.logger("onclose: all websocket is closed, ".concat(p.reason)),u.reject({code:p.code,reason:j_.A_ROUND_WS_FAILED}))},h.onmessage=p=>this.logger("".concat(h.url," onmessage: ").concat(p.data))}),this.websockets.push(...s),i||(()=>{let h=()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",u.isResolved),this.websockets.forEach(p=>p.readyState!==WebSocket.OPEN&&p.close())};if(t||this.useProxy)return this.logger("add 5s timeout at ".concat(t?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(h,this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{if(this.logger("2s timeout, isWebsocket created: ",u.isResolved),u.isResolved)return h();Ge().os===pi.MAC_OS&&Bt()&&h(),this.createWebSocket(e,!0,!0).then(p=>u.resolve(p)).catch(p=>{this.isNormalPortFailed&&u.reject(p),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(h,this.forceCloseWSDuration)},this.try443PortDuration)})(),u.promise}chooseBestWebsocket(e,t,i,r){return this.useDoubleDomain=!!t,typeof e=="string"&&(e=function(a){let s,c,l;return[,s,c,l]=a.match(M9)||[],s||([,c,l]=a.match(U9)||[]),c&&l||([,c,l]=a.match(x9)||[]),c&&l||([,c]=a.match(V9)||[]),c||R.warning("un-destructible url: ",a),{proxy:s,host:c,port:l||"443"}}(e)),this.recordIndex=r,this.useProxy=!!e.proxy,i&&this.useProxy&&(R.warn("cannot use 443 only when use proxy"),i=!1),this.createWebSocket(e,!!i,!1).finally(()=>this.clearTimeout())}};function uD(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),i.push.apply(i,r)}return i}var uV=class extends Lt{get url(){return this.websocket&&this.websocket.url||null}get reconnectMode(){return this._reconnectMode}set reconnectMode(e){var t;oe(t=["tryNext","recover"]).call(t,e)&&this.resetReconnectCount(e),this._reconnectMode=e}get state(){return this._state}set state(e){e!==this._state&&(this._state=e,this._state==="reconnecting"?this.emit(Ce.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(Ce.CONNECTED):this._state==="closed"?this.emit(Ce.CLOSED):this._state==="failed"&&this.emit(Ce.FAILED))}resetReconnectCount(e){R.debug("websocket reset reconnect count, reason: "+e),this.reconnectCount=0}constructor(e,t){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2],r=arguments.length>3&&arguments[3]!==void 0&&arguments[3],a=arguments.length>4&&arguments[4]!==void 0&&arguments[4],s=arguments.length>5?arguments[5]:void 0;super(),b(this,"connectionID",0),b(this,"currentURLIndex",0),b(this,"urls",[]),b(this,"_reconnectMode","tryNext"),b(this,"reconnectReason",void 0),b(this,"_initMutex",new Fi("websocket")),b(this,"name",void 0),b(this,"_state","closed"),b(this,"reconnectInterrupter",void 0),b(this,"websocket",void 0),b(this,"retryConfig",void 0),b(this,"reconnectCount",0),b(this,"forceCloseTimeout",5e3),b(this,"onlineReconnectListener",void 0),b(this,"useCompress",void 0),b(this,"tryDoubleDomain",!1),b(this,"use443PortOnly",!1),b(this,"wsInflateLength",0),b(this,"wsDeflateLength",0),b(this,"closeEstablishingWs",()=>{}),b(this,"store",void 0),b(this,"joinGatewayRecordIndex",void 0),this.store=s,this.name=e,this.retryConfig=function(p){for(var _=1;_<arguments.length;_++){var m=arguments[_]!=null?arguments[_]:{};_%2?uD(Object(m),!0).forEach(function(S){b(p,S,m[S])}):Object.getOwnPropertyDescriptors?Object.defineProperties(p,Object.getOwnPropertyDescriptors(m)):uD(Object(m)).forEach(function(S){Object.defineProperty(p,S,Object.getOwnPropertyDescriptor(m,S))})}return p}({},t),this.useCompress=i,this.tryDoubleDomain=r,this.use443PortOnly=a;let{timeout:c,timeoutFactor:l}=t,u=Math.max(300,Math.floor(3*c/5)),h=Math.max(1.2,Math.floor(8*l)/10);xr.ONLINE&&(this.retryConfig.timeout=u,this.retryConfig.timeoutFactor=h),Qt.on(Ql.NETWORK_STATE_CHANGE,(p,_)=>{p!==_&&(this.resetReconnectCount("network state change: ".concat(_," -> ").concat(p)),p===xr.ONLINE?(this.retryConfig.timeout=u,this.retryConfig.timeoutFactor=h):(this.retryConfig.timeout=c,this.retryConfig.timeoutFactor=l))})}getConnection(){return this.websocket||void 0}async init(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3,i=await this._initMutex.lock();this.forceCloseTimeout=t,this.urls=e,this.state="connecting";try{let r=kh(),a=this.urls[this.currentURLIndex];k("ENABLE_PREALLOC_PC")&&this.emit(dV.PRE_CONNECT_PC),this.createWebSocketConnection(a).then(r.resolve).catch(r.reject),this.once(Ce.CLOSED,()=>{r.reject(new H(A.WS_DISCONNECT))}),this.once(Ce.CONNECTED,r.resolve),await r.promise}catch{}finally{i()}}close(e,t){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;let i=this.websocket;t?setTimeout(()=>i.close(),500):i.close(),this.websocket=void 0}this.state=e?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(e,t){if(!this.websocket)return void R.warning("[".concat(this.name,"] can not reconnect, no websocket"));e!==void 0&&(this.reconnectMode=e),R.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinGatewayRecordIndex=="number"&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(t)]},this.joinGatewayRecordIndex);let i=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),i&&i.bind(this.websocket)({code:9999,reason:t})}sendMessage(e){let t=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new H(A.WS_ABORT,"websocket is not ready");try{t||(e=JSON.stringify(e)),this.websocket.send(e)}catch(i){throw new H(A.WS_ERR,"send websocket message error"+i.toString())}}setWsInflateData(e){this.wsDeflateLength=this.wsDeflateLength+e.originLength,this.wsInflateLength=this.wsInflateLength+e.compressedLength}getWsInflateData(){let e=this.wsInflateLength,t=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:e,wsDeflateLength:t}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(e){var t;let i=kh();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;let r=h=>{var p;(p=this.store)===null||p===void 0||p.signalChannelOpen(),R.debug("[".concat(this.name,"] websocket opened:"),h),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),i.resolve()},a=async h=>{var p;if(R.debug("[".concat(this.name,"] websocket close ").concat((p=this.websocket)===null||p===void 0?void 0:p.url,", code: ").concat(h.code,", reason: ").concat(h.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)i.reject(new H(A.WS_DISCONNECT,"websocket close: ".concat(h.code))),this.close();else{this.state==="connected"&&(this.reconnectReason=h.reason,this.state="reconnecting");let _=ga(this,Ce.WILL_RECONNECT,this.reconnectMode,h.reason)||this.reconnectMode,m=await this.reconnectWithAction(_);if(this.state==="closed")return void R.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!m)return i.reject(new H(A.WS_DISCONNECT,"websocket reconnect failed: ".concat(h.code))),this.close(!0);i.resolve()}},s=h=>{this.emit(Ce.ON_MESSAGE,h)},c=h=>{R.warn("[".concat(this.connectionID,"] ws open error ").concat(h))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),k("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(e=k("GATEWAY_WSS_ADDRESS")),R.debug("[".concat(this.name,"] start connect, url:"),e);let l=(t=this.store)===null||t===void 0?void 0:t.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var u;let h=await this.chooseBestWebsocketConnection(e);this.websocket=h,r&&r(this.websocket.url),this.websocket.onclose=a,this.websocket.onmessage=s,this.websocket.onerror=c,(u=this.store)===null||u===void 0||u.recordJoinChannelService({endTs:Date.now(),status:"success"},l),this.joinGatewayRecordIndex=l}catch(h){let p=this.state==="closed",_=h instanceof H,m=_&&h.code===A.WS_ABORT,S=_&&h.code===A.WS_ERR,C=_?h.message:h&&(h.reason||h.toString());R.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(C)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:m?"aborted":"error",errors:[h]},l),p||S?(i.reject(p?new H(A.WS_DISCONNECT,"websocket is closed: ".concat(C)):new H(A.WS_ERR,"init websocket failed: ".concat(C))),S&&R.error("[".concat(this.name,"] init websocket failed: ").concat(C))):a&&a(h)}return i.promise}async reconnectWithAction(e){let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||this.urls.length===0||this.state==="closed")return!1;R.warning("[choose-best-ws] action: =>",e),this.onlineReconnectListener||Qt.isOnline||!Qt.onlineWaiter||(this.onlineReconnectListener=Qt.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let i=!0;if(this.reconnectInterrupter=()=>i=!1,t){let s=Xy(this.reconnectCount,this.retryConfig);R.debug("[".concat(this.name,"] wait ").concat(s,"ms to reconnect websocket, mode: ").concat(e)),await ae.race([yi(s),this.onlineReconnectListener||new ae(()=>{})])}if(this._state==="closed"||!i)return!1;this.reconnectCount+=1;let r=async(s,c)=>{this.emit(Ce.RECONNECT_CREATE_CONNECTION,c),await this.createWebSocketConnection(s)};try{if(e==="retry")this.emit(Ce.RECONNECT_WAITTING_FINISH,e),await r(this.urls[this.currentURLIndex],e);else if(e==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);R.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),this.emit(Ce.RECONNECT_WAITTING_FINISH,e),await r(this.urls[this.currentURLIndex],e)}else e==="recover"&&(R.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.emit(Ce.RECONNECT_WAITTING_FINISH,e),this.urls=await ki(this,Ce.REQUEST_NEW_URLS),this.currentURLIndex=0,await r(this.urls[this.currentURLIndex],e))}catch(s){var a;R.error("[".concat(this.name,"] reconnect failed ").concat(s&&s.toString()));let c=s==null||(a=s.data)===null||a===void 0?void 0:a.desc;return Array.isArray(c)&&oe(c).call(c,"dynamic key expired")?(this.emit(Ce.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):this.reconnectWithAction(e,t)}return!0}},eC=class extends uV{constructor(e,t){super(e,t,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(e,t){let i=kh(),r=function(s,c){return new j9(s,c)}(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{R.debug("[choose-best-ws] close establishing websockets"),r.closeAllWebsockets(),i.reject(new H(A.WS_ABORT,"choose best websocket aborted"))};let a=k("GATEWAY_DOMAINS");return R.debug("[choose-best-ws] currentDomain: ",e,", domains: ",a,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),r.chooseBestWebsocket(e,this.tryDoubleDomain,this.use443PortOnly,t).then(i.resolve).catch(i.reject),i.promise.finally(()=>{this.closeEstablishingWs=void 0})}},Bh=class extends uV{constructor(e,t){super(e,t,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(e,t){return new ae((i,r)=>{let a=!1,s=[];this.closeEstablishingWs=()=>{R.debug("[choose-best-ws] close establishing websockets"),s.forEach(S=>{S.onclose=null,S.onopen=null,S.onmessage=null,S.close()}),r(new H(A.WS_ABORT,"choose best websocket aborted"))};let c=k("GATEWAY_DOMAINS"),l,u=e.indexOf("?h="),h=c.find(S=>u!==-1?oe(e).call(e,S,u):oe(e).call(e,S));R.debug("[choose-best-ws] currentDomain: ",h,", domains: ",c);let p=!this.tryDoubleDomain||!h;if(!p&&h){var _;let S=Date.now();try{c.forEach(C=>{let v=u===-1?e.replace(h,C):e.substr(0,u)+e.substr(u).replace(h,C),y=new WebSocket(v);y.binaryType="arraybuffer",s.push(y),R.debug("[choose-best-ws] ws is connecting:",y.url)})}catch{for(R.debug("[choose-best-ws] ws create failed, fallback to single url"),s.forEach(C=>C.close());s.length;)s.pop();p=!0}(_=this.store)===null||_===void 0||_.recordJoinChannelService({urls:s.map(C=>C.url),service:"gateway"},t),s.forEach(C=>{C.onopen=()=>{if(a)return;let v=Date.now()-S;R.debug("[choose-best-ws] ws open cost ".concat(v,"ms")),s.filter(y=>y!==C).forEach(y=>{R.debug("[choose-best-ws]close backup websocket: ".concat(y.url)),y.close()}),a=!0,i(C)},C.onclose=v=>{l=v,!a&&(s.find(y=>!(y.readyState===WebSocket.CLOSED||y.readyState===WebSocket.CLOSING))||(R.debug("[choose-best-ws] all websocket is closed"),a=!0,r(l)))},C.onmessage=v=>{R.debug("[choose-best-ws]".concat(C.url," onmessage: ").concat(v.data))}}),yi(this.forceCloseTimeout).then(()=>{s.forEach(C=>{C.readyState!==WebSocket.OPEN&&C.close()})})}if(p){var m;let S;R.debug("[choose-best-ws] use single url: ",e),(m=this.store)===null||m===void 0||m.recordJoinChannelService({urls:[e],service:"gateway"},t);try{S=new WebSocket(e),s.push(S),S.binaryType="arraybuffer"}catch(C){let v=new H(A.WS_ERR,"init websocket failed! Error: ".concat(C.toString()));return R.error("[".concat(this.name,"]").concat(v)),void r(v)}S.onopen=()=>{i(S)},S.onclose=C=>{r(C)},S.onmessage=C=>{R.debug("[choose-best-ws]".concat(S.url," onmessage: ").concat(C.data))},yi(this.forceCloseTimeout).then(()=>{S&&S.readyState!==WebSocket.OPEN&&S.close()})}}).then(i=>(this.closeEstablishingWs=void 0,i)).catch(i=>{throw this.closeEstablishingWs=void 0,i})}},F9=class extends Lt{get connectionState(){return this._connectionState}set connectionState(e){e!==this._connectionState&&(this._connectionState=e,e===pt.CONNECTED?this.emit(ye.WS_CONNECTED):e===pt.RECONNECTING?this.emit(ye.WS_RECONNECTING,this._websocketReconnectReason):e===pt.CLOSED&&this.emit(ye.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(e,t){super(),b(this,"_disconnectedReason",void 0),b(this,"_websocketReconnectReason",void 0),b(this,"_connectionState",pt.CLOSED),b(this,"reconnectToken",void 0),b(this,"websocket",void 0),b(this,"openConnectionTime",void 0),b(this,"clientId",void 0),b(this,"lastMsgTime",Date.now()),b(this,"uploadCache",[]),b(this,"uploadCacheInterval",void 0),b(this,"rttRolling",new iV(5)),b(this,"pingpongTimer",void 0),b(this,"wsInflateDataTimer",void 0),b(this,"pingpongTimeoutCount",0),b(this,"joinResponse",void 0),b(this,"multiIpOption",void 0),b(this,"initError",void 0),b(this,"spec",void 0),b(this,"store",void 0),b(this,"onWebsocketMessage",i=>{if(i.data instanceof ArrayBuffer)return void this.emit(ye.ON_BINARY_DATA,i.data);let r=JSON.parse(i.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(r,"_id")){let a="res-@".concat(r._id);this.emit(a,r._result,r._message)}else if(Object.prototype.hasOwnProperty.call(r,"_type")){if(this.emit(r._type,r._message),r._type===Le.ON_NOTIFICATION&&this.handleNotification(r._message),r._type===Le.ON_USER_BANNED)switch(r._message.error_code){case 14:this.close(tt.UID_BANNED);break;case 15:this.close(tt.IP_BANNED);break;case 16:this.close(tt.CHANNEL_BANNED)}if(r._type===Le.ON_USER_LICENSE_BANNED)switch(r._message.error_code){case me.ERR_LICENSE_MISSING:this.close(tt.LICENSE_MISSING);break;case me.ERR_LICENSE_EXPIRED:this.close(tt.LICENSE_EXPIRED);break;case me.ERR_LICENSE_MINUTES_EXCEEDED:this.close(tt.LICENSE_MINUTES_EXCEEDED);break;case me.ERR_LICENSE_PERIOD_INVALID:this.close(tt.LICENSE_PERIOD_INVALID);break;case me.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(tt.LICENSE_MULTIPLE_SDK_SERVICE);break;case me.ERR_LICENSE_ILLEGAL:this.close(tt.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=e.clientId,this.spec=e,this.store=t,this.websocket=new eC("gateway-".concat(this.clientId),this.spec.retryConfig,!0,k("JOIN_GATEWAY_USE_DUAL_DOMAIN"),k("JOIN_GATEWAY_USE_443PORT_ONLY"),t),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===pt.CONNECTED&&this.reconnect("retry",Pi.OFFLINE)})}async request(e,t,i,r){let a=ft(6,""),s={_id:a,_type:e,_message:t},c=this.websocket.connectionID,l=()=>new ae((S,C)=>{if(this.connectionState===pt.CONNECTED)return S();let v=()=>{this.off(ye.WS_CLOSED,y),S()},y=()=>{this.off(ye.WS_CONNECTED,v),C(new B(A.WS_ABORT))};this.once(ye.WS_CONNECTED,v),this.once(ye.WS_CLOSED,y),e!==ve.PUBLISH&&e!==ve.PUBLISH_DATASTREAM&&e!==ve.SUBSCRIBE&&e!==ve.SUBSCRIBE_DATASTREAM&&e!==ve.UNSUBSCRIBE&&e!==ve.UNSUBSCRIBE_DATASTREAM&&e!==ve.UNPUBLISH&&e!==ve.UNPUBLISH_DATASTREAM&&e!==ve.CONTROL&&e!==ve.RESTART_ICE||this.once(ye.DISCONNECT_P2P,()=>{C(new B(A.DISCONNECT_P2P))}),e!==ve.PUBLISH&&e!==ve.RESTART_ICE||this.once(ye.ABORT_P2P_EXECUTION,()=>{C(new B(A.DISCONNECT_P2P))})});if(this.connectionState!==pt.CONNECTING&&this.connectionState!==pt.RECONNECTING||e===ve.JOIN||e===ve.REJOIN||await l(),this.websocket.sendMessage(s,!0),r)return;let u=new ae((S,C)=>{let v=!1,y=(O,P)=>{v=!0,S({isSuccess:O==="success",message:P||{}}),this.off(ye.WS_CLOSED,I),this.off(ye.WS_RECONNECTING,I),this.emit(ye.REQUEST_SUCCESS,e,t)};this.once("res-@".concat(a),y);let I=()=>{C(new B(A.WS_ABORT,"type: ".concat(e))),this.off(ye.WS_CLOSED,I),this.off(ye.WS_RECONNECTING,I),this.off("res-@".concat(a),y)};this.once(ye.WS_CLOSED,I),this.once(ye.WS_RECONNECTING,I),yi(k("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==c||v||(R.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(e)),this.emit(ye.REQUEST_TIMEOUT,e,t))})}),h=null;try{h=await u}catch(S){if(this.connectionState===pt.CLOSED||e===ve.LEAVE)throw new B(A.WS_ABORT);return!this.spec.forceWaitGatewayResponse||i?S.throw():e===ve.JOIN||e===ve.REJOIN?null:(await l(),await this.request(e,t))}if(h.isSuccess)return h.message;let p=Number(h.message.error_code||h.message.code),_=Vh(p),m=new B(A.UNEXPECTED_RESPONSE,"".concat(_.desc,": ").concat(h.message.error_str),{code:p,data:h.message,desc:_.desc});return _.action==="success"?h.message:(R.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(e,", error_code: ").concat(p,", message: ").concat(_.desc,", action: ").concat(_.action)),p===me.ERR_TOO_MANY_BROADCASTERS?((e===ve.JOIN||e===ve.REJOIN)&&(this.initError=m,this.close()),m.throw()):_.action==="failed"?m.throw():_.action==="quit"?(this.initError=m,this.close(),m.throw()):(p===me.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=h.message.option,R.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Pi.MULTI_IP)):this.reconnect(_.action,Pi.SERVER_ERROR),e===ve.JOIN||e===ve.REJOIN?null:await this.request(e,t)))}waitMessage(e,t){return new ae(i=>{let r=a=>{(!t||t(a))&&(this.off(e,r),i(a))};this.on(e,r)})}uploadWRTCStats(e){if(!this.store.sessionId)return void R.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));let t={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:e};this.upload(xh.WRTC_STATS,t)}upload(e,t){let i={_type:e,_message:t};try{this.websocket.sendMessage(i)}catch{let r=k("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(i),this.uploadCache.length>r&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==pt.CONNECTED)return;let a=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(a._type,a._message)},k("UPLOAD_CACHE_INTERVAL")||2e3))}}send(e,t){let i={_type:e,_message:t};this.websocket.sendMessage(i)}init(e,t){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new ae((i,r)=>{this.once(ye.WS_CONNECTED,()=>i(this.joinResponse)),this.once(ye.WS_CLOSED,()=>r(this.initError||new B(A.WS_ABORT))),this.connectionState=pt.CONNECTING,this.websocket.init(e).catch(r),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(e){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=e||tt.LEAVE,this.connectionState=pt.CLOSED,R.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close()}async join(){if(!this.joinResponse){this.emit(ye.ABORT_P2P_EXECUTION);let e=await ki(this,ye.REQUEST_JOIN_INFO),t=await this.request(ve.JOIN,e);if(!t)return this.emit(ye.REPORT_JOIN_GATEWAY,j_.TIMEOUT,this.url||""),!1;this.joinResponse=t,this.emit(ye.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=pt.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new B(A.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");let e=Uh(this,ye.REQUEST_REJOIN_INFO);e.token=this.reconnectToken;let t=await this.request(ve.REJOIN,e);return!!t&&(this.connectionState=pt.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),t.peers&&t.peers.forEach(i=>{this.emit(Le.ON_USER_ONLINE,{uid:i.uid}),i.audio&&this.emit(Le.ON_ADD_AUDIO_STREAM,{uid:i.uid,uint_id:i.uint_id,audio:!0,ssrcId:i.audio_ssrc}),i.video&&this.emit(Le.ON_ADD_VIDEO_STREAM,{uid:i.uid,uint_id:i.uint_id,video:!0,ssrcId:i.video_ssrc}),i.audio_mute?this.emit(Le.MUTE_AUDIO,{uid:i.uid}):this.emit(Le.UNMUTE_AUDIO,{uid:i.uid}),i.video_mute?this.emit(Le.MUTE_VIDEO,{uid:i.uid}):this.emit(Le.UNMUTE_VIDEO,{uid:i.uid}),i.audio_enable_local?this.emit(Le.ENABLE_LOCAL_AUDIO,{uid:i.uid}):this.emit(Le.DISABLE_LOCAL_AUDIO,{uid:i.uid}),i.video_enable_local?this.emit(Le.ENABLE_LOCAL_VIDEO,{uid:i.uid}):this.emit(Le.DISABLE_LOCAL_VIDEO,{uid:i.uid}),i.audio||i.video||this.emit(Le.ON_REMOVE_STREAM,{uid:i.uid,uint_id:i.uint_id})}),!0)}reconnect(e,t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(e,t)}handleNotification(e){R.debug("[".concat(this.clientId,"] receive notification: "),e);let t=Vh(e.code);if(t.action!=="success"){if(t.action!=="failed")return t.action==="quit"?(t.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(tt.UID_BANNED),void this.close()):void this.reconnect(t.action,Pi.SERVER_ERROR);R.error("[".concat(this.clientId,"] ignore error: "),t.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;let e=k("PING_PONG_TIME_OUT"),t=Date.now();this.pingpongTimeoutCount>=e&&(R.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(t-this.lastMsgTime,"ms")),t-this.lastMsgTime>k("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Pi.TIMEOUT):this.request(ve.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;let i=Date.now()-t;this.rttRolling.add(i),k("REPORT_STATS")&&this.send(ve.PING_BACK,{pingpongElapse:i})}).catch(i=>{})}handleWsInflateData(){let{wsInflateLength:e,wsDeflateLength:t}=this.websocket.getWsInflateData();e!==0&&t!==0&&this.upload(xh.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:t,ws_inflate_length:e})}handleWebsocketEvents(){this.websocket.on(Ce.RECONNECT_WAITTING_FINISH,e=>{this.emit(ye.WS_RECONNECT_WAITTING_FINISH,e)}),this.websocket.on(Ce.RECONNECT_CREATE_CONNECTION,e=>{this.emit(ye.WS_RECONNECT_CREATE_CONNECTION,e)}),this.websocket.on(Ce.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Ce.CLOSED,()=>{this.connectionState=pt.CLOSED}),this.websocket.on(Ce.FAILED,()=>{this._disconnectedReason=tt.NETWORK_ERROR,this.connectionState=pt.CLOSED}),this.websocket.on(Ce.RECONNECTING,e=>{this._websocketReconnectReason=e,this.joinResponse=void 0,this.connectionState===pt.CONNECTED?this.connectionState=pt.RECONNECTING:this.connectionState=pt.CONNECTING}),this.websocket.on(Ce.WILL_RECONNECT,(e,t,i)=>{let r=Uh(this,ye.IS_P2P_DISCONNECTED),a=r||e!=="retry";r&&e==="retry"&&(R.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),e="tryNext",t=j_.P2P_DISCONNECTED),a&&(R.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(e)),this.emit(ye.REPORT_JOIN_GATEWAY,t||j_.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(ye.DISCONNECT_P2P)),i(e)}),this.websocket.on(Ce.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(e=>{R.warning("[".concat(this.clientId,"] rejoin failed ").concat(e)),this.reconnect("tryNext",Pi.SERVER_ERROR)}):this.join().catch(e=>{if(this.emit(ye.REPORT_JOIN_GATEWAY,e,this.url||""),e instanceof B){if(e.code===A.UNEXPECTED_RESPONSE&&e.data.code===me.ERR_NO_AUTHORIZED)return this.initError=new B(A.CAN_NOT_GET_GATEWAY_SERVER,"AgoraRTCError CAN_NOT_GET_GATEWAY_SERVER: dynamic key expired"),R.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",Pi.SERVER_ERROR);R.error("[".concat(this.clientId,"] join gateway request failed"),e.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Pi.SERVER_ERROR):(this.initError=e,this.close())}})}),this.websocket.on(Ce.REQUEST_NEW_URLS,(e,t)=>{ki(this,ye.REQUEST_RECOVER,this.multiIpOption).then(e).catch(t)}),this.websocket.on(Ce.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(Le.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(dV.PRE_CONNECT_PC,()=>{this.emit(ye.PRE_CONNECT_PC)})}},Jt=function(e){return e[e.CHOOSE_SERVER=11]="CHOOSE_SERVER",e[e.CLOUD_PROXY=18]="CLOUD_PROXY",e[e.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",e[e.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",e}({});function hD(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),i.push.apply(i,r)}return i}function $f(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?hD(Object(i),!0).forEach(function(r){b(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):hD(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}function ed(e){return e.match(/^[\.\:\d]+$/)?"".concat(e.replace(/[^\d]/g,"-"),".").concat(k("TURN_DOMAIN")):(R.info("Unidentified as ip: ".concat(e,", use as host")),e)}function tC(e,t){e.addresses||(e.addresses=[]);let i=function(l,u){if(k("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return l.map(_=>{let{ip:m,port:S}=_;return{address:"".concat(m,":").concat(S)}});let h=k("GATEWAY_DOMAINS"),p=h[1]&&oe(u).call(u,h[1])?1:0;return l.map(_=>{let{domain_prefix:m,port:S,ip:C}=_;if(m)return{address:"".concat(m,".").concat(h[p++%h.length],":").concat(S)};let v=/^[\.\:\d]+$/.test(C),y=v?"".concat(C.replace(/[^\d]/g,"-"),".").concat(h[p++%h.length],":").concat(S):"".concat(C,":").concat(S);return v||R.info("Unidentified as ip: ".concat(C,", use as host")),{ip:C,port:S,address:y}})}(e.addresses,t),r=Array.isArray(e.detail)&&e.detail[18];if(r&&typeof r=="string"){let l=r.split(";");for(let u=0;u<l.length;u++){var a;let h=ir(a=l[u]).call(a);i[u]&&h&&(i[u].ip6=h)}}let s=e.detail&&e.detail.candidate,c;if(s){let[l,u]=s.split(":");l&&u&&(c={port:Number(u),ip:l,address:"".concat(l,":").concat(u)})}return{gatewayAddrs:i,apGatewayAddress:c,uid:e.uid,cid:e.cid,cert:e.cert,vid:e.detail&&e.detail[8],uni_lbs_ip:e.detail&&e.detail[1],res:e,csIp:e.detail&&e.detail[502]}}function Br(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function pD(e){let t=e._encoderConfig;if(!t)return{};let i={resolution:t.width&&t.height?"".concat(Br(t.width),"x").concat(Br(t.height)):void 0,maxVideoBW:t.bitrateMax,minVideoBW:t.bitrateMin};return typeof t.frameRate=="number"?(i.maxFrameRate=t.frameRate,i.minFrameRate=t.frameRate):t.frameRate&&(i.maxFrameRate=t.frameRate.max||t.frameRate.ideal||t.frameRate.exact||t.frameRate.min,i.minFrameRate=t.frameRate.min||t.frameRate.ideal||t.frameRate.exact||t.frameRate.max),i}function fD(e){return e>=0&&e<.17?1:e>=.17&&e<.36?2:e>=.36&&e<.59?3:e>=.59&&e<=1?4:e>1?5:0}function jh(e,t){let i,r,a;switch(t){case Jt.CHOOSE_SERVER:r=4096,a="choose server";break;case Jt.CLOUD_PROXY:r=1048576,a="proxy";break;case Jt.CLOUD_PROXY_5:r=4194304,a="proxy5";break;case Jt.CLOUD_PROXY_FALLBACK:r=4194310,a="proxy fallback";break;default:throw new B(A.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:e.detail&&e.detail[502],retry:!1})}if(e.response_body.forEach(s=>{s.buffer&&s.buffer.flag===r&&(i={code:s.buffer.code,addresses:(s.buffer.edges_services||[]).map(c=>$f($f({},c),{},{ticket:s.buffer.cert})),server_ts:e.enter_ts,uid:s.buffer.uid,cid:s.buffer.cid,cname:s.buffer.cname,detail:$f($f({},s.buffer.detail),e.detail),flag:s.buffer.flag,opid:e.opid,cert:s.buffer.cert})}),!i)throw new B(A.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(a," from multi unilbs response"),{csIp:e.detail&&e.detail[502]});return i}async function hV(e,t){return await ae.all(e.addresses.map(async i=>({address:ed(i.ip),tcpport:i.port,udpport:i.port,username:t&&k("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?t.toString():Ni.username,password:t&&k("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await Pv(t.toString()):Ni.password})))}function Vv(e,t){let i=t.getMediaStreamTrack(!0).getSettings(),r=t.videoHeight||i.height,a=t.videoWidth||i.width;return r&&a?Math.max(Math.min(r,a)/Math.min(Br(e.height),Br(e.width)),1):(R.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function Ro(e){let{candidateType:t,relayProtocol:i,type:r,address:a,port:s,protocol:c}=e;return r==="local-candidate"?{candidateType:t,relayProtocol:i,protocol:c}:{candidateType:t,relayProtocol:i,address:a,port:s,protocol:c}}var xa,G9=zt(oV),H9=en("Array").values,W9=Jn,K9=Gi,z9=_r,Y9=H9,WT=Array.prototype,q9={DOMTokenList:!0,NodeList:!0},X9=function(e){var t=e.values;return e===WT||z9(WT,e)&&t===WT.values||K9(q9,W9(e))?Y9:t},Ns=zt(X9),_D=Ta,J9=ii,Q9=xi,Z9=si,KT=xE,$9=rp,eX=wE,tX=Xn,iX=NE,Pl=Object.assign,ED=Object.defineProperty,rX=J9([].concat),aX=!Pl||Z9(function(){if(_D&&Pl({b:1},Pl(ED({},"a",{enumerable:!0,get:function(){ED(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var e={},t={},i=Symbol(),r="abcdefghijklmnopqrst";return e[i]=7,r.split("").forEach(function(a){t[a]=a}),Pl({},e)[i]!=7||KT(Pl({},t)).join("")!=r})?function(e,t){for(var i=tX(e),r=arguments.length,a=1,s=$9.f,c=eX.f;r>a;)for(var l,u=iX(arguments[a++]),h=s?rX(KT(u),s(u)):KT(u),p=h.length,_=0;p>_;)l=h[_++],_D&&!Q9(c,u,l)||(i[l]=u[l]);return i}:Pl,nX=Nr,sX=yU,oX=ko,cX=xi,lX=Xn,dX=function(e,t,i,r){try{return r?t(nX(i)[0],i[1]):t(i)}catch(a){sX(e,"throw",a)}},uX=vU,hX=jE,pX=Ps,mD=HE,fX=Ty,_X=VE,gD=Array,Fc=ii,zT=2147483647,EX=/[^\0-\u007E]/,pV=/[.\u3002\uFF0E\uFF61]/g,SD="Overflow: input needs wider integers to process",TD=RangeError,mX=Fc(pV.exec),td=Math.floor,YT=String.fromCharCode,RD=Fc("".charCodeAt),fV=Fc([].join),ho=Fc([].push),gX=Fc("".replace),SX=Fc("".split),TX=Fc("".toLowerCase),vD=function(e){return e+22+75*(e<26)},RX=function(e,t,i){var r=0;for(e=i?td(e/700):e>>1,e+=td(e/t);e>455;)e=td(e/35),r+=36;return td(r+36*e/(e+38))},vX=function(e){var t=[];e=function(I){for(var O=[],P=0,U=I.length;P<U;){var x=RD(I,P++);if(x>=55296&&x<=56319&&P<U){var G=RD(I,P++);(64512&G)==56320?ho(O,((1023&x)<<10)+(1023&G)+65536):(ho(O,x),P--)}else ho(O,x)}return O}(e);var i,r,a=e.length,s=128,c=0,l=72;for(i=0;i<e.length;i++)(r=e[i])<128&&ho(t,YT(r));var u=t.length,h=u;for(u&&ho(t,"-");h<a;){var p=zT;for(i=0;i<e.length;i++)(r=e[i])>=s&&r<p&&(p=r);var _=h+1;if(p-s>td((zT-c)/_))throw TD(SD);for(c+=(p-s)*_,s=p,i=0;i<e.length;i++){if((r=e[i])<s&&++c>zT)throw TD(SD);if(r==s){for(var m=c,S=36;;){var C=S<=l?1:S>=l+26?26:S-l;if(m<C)break;var v=m-C,y=36-C;ho(t,YT(vD(C+v%y))),m=td(v/y),S+=36}ho(t,YT(vD(m))),l=RX(c,_,h==u),c=0,h++}}c++,s++}return fV(t,"")},yX=_t,iC=Ta,CX=Fy,rC=Mi,yD=ko,tn=ii,e_=Uo,Va=BE,bX=yy,Bv=Gi,aC=aX,Ll=function(e){var t=lX(e),i=hX(this),r=arguments.length,a=r>1?arguments[1]:void 0,s=a!==void 0;s&&(a=oX(a,r>2?arguments[2]:void 0));var c,l,u,h,p,_,m=_X(t),S=0;if(!m||this===gD&&uX(m))for(c=pX(t),l=i?new this(c):gD(c);c>S;S++)_=s?a(t[S],S):t[S],mD(l,S,_);else for(p=(h=fX(t,m)).next,l=i?new this:[];!(u=cX(p,h)).done;S++)_=s?dX(h,a,[u.value,S],!0):u.value,mD(l,S,_);return l.length=S,l},ln=Py,AX=Dy.codeAt,IX=function(e){var t,i,r=[],a=SX(gX(TX(e),pV,"."),".");for(t=0;t<a.length;t++)i=a[t],ho(r,mX(EX,i)?"xn--"+vX(i):i);return fV(r,".")},Rs=Ra,OX=xo,wX=FE,_V=zq,EV=jc,NX=EV.set,pE=EV.getterFor("URL"),DX=_V.URLSearchParams,PX=_V.getState,zu=rC.URL,jv=rC.TypeError,t_=rC.parseInt,LX=Math.floor,CD=Math.pow,za=tn("".charAt),hn=tn(/./.exec),nh=tn([].join),kX=tn(1 .toString),MX=tn([].pop),kl=tn([].push),qT=tn("".replace),UX=tn([].shift),xX=tn("".split),sh=tn("".slice),F_=tn("".toLowerCase),VX=tn([].unshift),XT="Invalid scheme",Yu="Invalid host",bD="Invalid port",mV=/[a-z]/i,BX=/[\d+-.a-z]/i,JT=/\d/,jX=/^0x/i,FX=/^[0-7]+$/,GX=/^\d+$/,AD=/^[\da-f]+$/i,HX=/[\0\t\n\r #%/:<>?@[\\\]^|]/,WX=/[\0\t\n\r #/:<>?@[\\\]^|]/,KX=/^[\u0000-\u0020]+/,zX=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,YX=/[\t\n\r]/g,qu=function(e){var t,i,r,a;if(typeof e=="number"){for(t=[],i=0;i<4;i++)VX(t,e%256),e=LX(e/256);return nh(t,".")}if(typeof e=="object"){for(t="",r=function(s){for(var c=null,l=1,u=null,h=0,p=0;p<8;p++)s[p]!==0?(h>l&&(c=u,l=h),u=null,h=0):(u===null&&(u=p),++h);return h>l&&(c=u,l=h),c}(e),i=0;i<8;i++)a&&e[i]===0||(a&&(a=!1),r===i?(t+=i?":":"::",a=!0):(t+=kX(e[i],16),i<7&&(t+=":")));return"["+t+"]"}return e},G_={},gV=aC({},G_,{" ":1,'"':1,"<":1,">":1,"`":1}),SV=aC({},gV,{"#":1,"?":1,"{":1,"}":1}),QT=aC({},SV,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),ao=function(e,t){var i=AX(e,0);return i>32&&i<127&&!Bv(t,e)?e:encodeURIComponent(e)},i_={ftp:21,file:null,http:80,https:443,ws:80,wss:443},oh=function(e,t){var i;return e.length==2&&hn(mV,za(e,0))&&((i=za(e,1))==":"||!t&&i=="|")},ID=function(e){var t;return e.length>1&&oh(sh(e,0,2))&&(e.length==2||(t=za(e,2))==="/"||t==="\\"||t==="?"||t==="#")},qX=function(e){return e==="."||F_(e)==="%2e"},ZT={},OD={},$T={},wD={},ND={},eR={},DD={},PD={},r_={},a_={},tR={},iR={},rR={},aR={},LD={},nR={},Ml={},Nn={},kD={},cc={},ms={},nC=function(e,t,i){var r,a,s,c=Rs(e);if(t){if(a=this.parse(c))throw jv(a);this.searchParams=null}else{if(i!==void 0&&(r=new nC(i,!0)),a=this.parse(c,null,r))throw jv(a);(s=PX(new DX)).bindURL(this),this.searchParams=s}};nC.prototype={type:"URL",parse:function(e,t,i){var r,a,s,c,l,u=this,h=t||ZT,p=0,_="",m=!1,S=!1,C=!1;for(e=Rs(e),t||(u.scheme="",u.username="",u.password="",u.host=null,u.port=null,u.path=[],u.query=null,u.fragment=null,u.cannotBeABaseURL=!1,e=qT(e,KX,""),e=qT(e,zX,"$1")),e=qT(e,YX,""),r=Ll(e);p<=r.length;){switch(a=r[p],h){case ZT:if(!a||!hn(mV,a)){if(t)return XT;h=$T;continue}_+=F_(a),h=OD;break;case OD:if(a&&(hn(BX,a)||a=="+"||a=="-"||a=="."))_+=F_(a);else{if(a!=":"){if(t)return XT;_="",h=$T,p=0;continue}if(t&&(u.isSpecial()!=Bv(i_,_)||_=="file"&&(u.includesCredentials()||u.port!==null)||u.scheme=="file"&&!u.host))return;if(u.scheme=_,t)return void(u.isSpecial()&&i_[u.scheme]==u.port&&(u.port=null));_="",u.scheme=="file"?h=aR:u.isSpecial()&&i&&i.scheme==u.scheme?h=wD:u.isSpecial()?h=PD:r[p+1]=="/"?(h=ND,p++):(u.cannotBeABaseURL=!0,kl(u.path,""),h=kD)}break;case $T:if(!i||i.cannotBeABaseURL&&a!="#")return XT;if(i.cannotBeABaseURL&&a=="#"){u.scheme=i.scheme,u.path=ln(i.path),u.query=i.query,u.fragment="",u.cannotBeABaseURL=!0,h=ms;break}h=i.scheme=="file"?aR:eR;continue;case wD:if(a!="/"||r[p+1]!="/"){h=eR;continue}h=r_,p++;break;case ND:if(a=="/"){h=a_;break}h=Nn;continue;case eR:if(u.scheme=i.scheme,a==xa)u.username=i.username,u.password=i.password,u.host=i.host,u.port=i.port,u.path=ln(i.path),u.query=i.query;else if(a=="/"||a=="\\"&&u.isSpecial())h=DD;else if(a=="?")u.username=i.username,u.password=i.password,u.host=i.host,u.port=i.port,u.path=ln(i.path),u.query="",h=cc;else{if(a!="#"){u.username=i.username,u.password=i.password,u.host=i.host,u.port=i.port,u.path=ln(i.path),u.path.length--,h=Nn;continue}u.username=i.username,u.password=i.password,u.host=i.host,u.port=i.port,u.path=ln(i.path),u.query=i.query,u.fragment="",h=ms}break;case DD:if(!u.isSpecial()||a!="/"&&a!="\\"){if(a!="/"){u.username=i.username,u.password=i.password,u.host=i.host,u.port=i.port,h=Nn;continue}h=a_}else h=r_;break;case PD:if(h=r_,a!="/"||za(_,p+1)!="/")continue;p++;break;case r_:if(a!="/"&&a!="\\"){h=a_;continue}break;case a_:if(a=="@"){m&&(_="%40"+_),m=!0,s=Ll(_);for(var v=0;v<s.length;v++){var y=s[v];if(y!=":"||C){var I=ao(y,QT);C?u.password+=I:u.username+=I}else C=!0}_=""}else if(a==xa||a=="/"||a=="?"||a=="#"||a=="\\"&&u.isSpecial()){if(m&&_=="")return"Invalid authority";p-=Ll(_).length+1,_="",h=tR}else _+=a;break;case tR:case iR:if(t&&u.scheme=="file"){h=nR;continue}if(a!=":"||S){if(a==xa||a=="/"||a=="?"||a=="#"||a=="\\"&&u.isSpecial()){if(u.isSpecial()&&_=="")return Yu;if(t&&_==""&&(u.includesCredentials()||u.port!==null))return;if(c=u.parseHost(_))return c;if(_="",h=Ml,t)return;continue}a=="["?S=!0:a=="]"&&(S=!1),_+=a}else{if(_=="")return Yu;if(c=u.parseHost(_))return c;if(_="",h=rR,t==iR)return}break;case rR:if(!hn(JT,a)){if(a==xa||a=="/"||a=="?"||a=="#"||a=="\\"&&u.isSpecial()||t){if(_!=""){var O=t_(_,10);if(O>65535)return bD;u.port=u.isSpecial()&&O===i_[u.scheme]?null:O,_=""}if(t)return;h=Ml;continue}return bD}_+=a;break;case aR:if(u.scheme="file",a=="/"||a=="\\")h=LD;else{if(!i||i.scheme!="file"){h=Nn;continue}if(a==xa)u.host=i.host,u.path=ln(i.path),u.query=i.query;else if(a=="?")u.host=i.host,u.path=ln(i.path),u.query="",h=cc;else{if(a!="#"){ID(nh(ln(r,p),""))||(u.host=i.host,u.path=ln(i.path),u.shortenPath()),h=Nn;continue}u.host=i.host,u.path=ln(i.path),u.query=i.query,u.fragment="",h=ms}}break;case LD:if(a=="/"||a=="\\"){h=nR;break}i&&i.scheme=="file"&&!ID(nh(ln(r,p),""))&&(oh(i.path[0],!0)?kl(u.path,i.path[0]):u.host=i.host),h=Nn;continue;case nR:if(a==xa||a=="/"||a=="\\"||a=="?"||a=="#"){if(!t&&oh(_))h=Nn;else if(_==""){if(u.host="",t)return;h=Ml}else{if(c=u.parseHost(_))return c;if(u.host=="localhost"&&(u.host=""),t)return;_="",h=Ml}continue}_+=a;break;case Ml:if(u.isSpecial()){if(h=Nn,a!="/"&&a!="\\")continue}else if(t||a!="?")if(t||a!="#"){if(a!=xa&&(h=Nn,a!="/"))continue}else u.fragment="",h=ms;else u.query="",h=cc;break;case Nn:if(a==xa||a=="/"||a=="\\"&&u.isSpecial()||!t&&(a=="?"||a=="#")){if((l=F_(l=_))===".."||l==="%2e."||l===".%2e"||l==="%2e%2e"?(u.shortenPath(),a=="/"||a=="\\"&&u.isSpecial()||kl(u.path,"")):qX(_)?a=="/"||a=="\\"&&u.isSpecial()||kl(u.path,""):(u.scheme=="file"&&!u.path.length&&oh(_)&&(u.host&&(u.host=""),_=za(_,0)+":"),kl(u.path,_)),_="",u.scheme=="file"&&(a==xa||a=="?"||a=="#"))for(;u.path.length>1&&u.path[0]==="";)UX(u.path);a=="?"?(u.query="",h=cc):a=="#"&&(u.fragment="",h=ms)}else _+=ao(a,SV);break;case kD:a=="?"?(u.query="",h=cc):a=="#"?(u.fragment="",h=ms):a!=xa&&(u.path[0]+=ao(a,G_));break;case cc:t||a!="#"?a!=xa&&(a=="'"&&u.isSpecial()?u.query+="%27":u.query+=a=="#"?"%23":ao(a,G_)):(u.fragment="",h=ms);break;case ms:a!=xa&&(u.fragment+=ao(a,gV))}p++}},parseHost:function(e){var t,i,r;if(za(e,0)=="["){if(za(e,e.length-1)!="]"||(t=function(a){var s,c,l,u,h,p,_,m=[0,0,0,0,0,0,0,0],S=0,C=null,v=0,y=function(){return za(a,v)};if(y()==":"){if(za(a,1)!=":")return;v+=2,C=++S}for(;y();){if(S==8)return;if(y()!=":"){for(s=c=0;c<4&&hn(AD,y());)s=16*s+t_(y(),16),v++,c++;if(y()=="."){if(c==0||(v-=c,S>6))return;for(l=0;y();){if(u=null,l>0){if(!(y()=="."&&l<4))return;v++}if(!hn(JT,y()))return;for(;hn(JT,y());){if(h=t_(y(),10),u===null)u=h;else{if(u==0)return;u=10*u+h}if(u>255)return;v++}m[S]=256*m[S]+u,++l!=2&&l!=4||S++}if(l!=4)return;break}if(y()==":"){if(v++,!y())return}else if(y())return;m[S++]=s}else{if(C!==null)return;v++,C=++S}}if(C!==null)for(p=S-C,S=7;S!=0&&p>0;)_=m[S],m[S--]=m[C+p-1],m[C+--p]=_;else if(S!=8)return;return m}(sh(e,1,-1)),!t))return Yu;this.host=t}else if(this.isSpecial()){if(e=IX(e),hn(HX,e)||(t=function(a){var s,c,l,u,h,p,_,m=xX(a,".");if(m.length&&m[m.length-1]==""&&m.length--,(s=m.length)>4)return a;for(c=[],l=0;l<s;l++){if((u=m[l])=="")return a;if(h=10,u.length>1&&za(u,0)=="0"&&(h=hn(jX,u)?16:8,u=sh(u,h==8?1:2)),u==="")p=0;else{if(!hn(h==10?GX:h==8?FX:AD,u))return a;p=t_(u,h)}kl(c,p)}for(l=0;l<s;l++)if(p=c[l],l==s-1){if(p>=CD(256,5-s))return null}else if(p>255)return null;for(_=MX(c),l=0;l<c.length;l++)_+=c[l]*CD(256,3-l);return _}(e),t===null))return Yu;this.host=t}else{if(hn(WX,e))return Yu;for(t="",i=Ll(e),r=0;r<i.length;r++)t+=ao(i[r],G_);this.host=t}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme=="file"},includesCredentials:function(){return this.username!=""||this.password!=""},isSpecial:function(){return Bv(i_,this.scheme)},shortenPath:function(){var e=this.path,t=e.length;!t||this.scheme=="file"&&t==1&&oh(e[0],!0)||e.length--},serialize:function(){var e=this,t=e.scheme,i=e.username,r=e.password,a=e.host,s=e.port,c=e.path,l=e.query,u=e.fragment,h=t+":";return a!==null?(h+="//",e.includesCredentials()&&(h+=i+(r?":"+r:"")+"@"),h+=qu(a),s!==null&&(h+=":"+s)):t=="file"&&(h+="//"),h+=e.cannotBeABaseURL?c[0]:c.length?"/"+nh(c,"/"):"",l!==null&&(h+="?"+l),u!==null&&(h+="#"+u),h},setHref:function(e){var t=this.parse(e);if(t)throw jv(t);this.searchParams.update()},getOrigin:function(){var e=this.scheme,t=this.port;if(e=="blob")try{return new Sd(e.path[0]).origin}catch{return"null"}return e!="file"&&this.isSpecial()?e+"://"+qu(this.host)+(t!==null?":"+t:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(e){this.parse(Rs(e)+":",ZT)},getUsername:function(){return this.username},setUsername:function(e){var t=Ll(Rs(e));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var i=0;i<t.length;i++)this.username+=ao(t[i],QT)}},getPassword:function(){return this.password},setPassword:function(e){var t=Ll(Rs(e));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var i=0;i<t.length;i++)this.password+=ao(t[i],QT)}},getHost:function(){var e=this.host,t=this.port;return e===null?"":t===null?qu(e):qu(e)+":"+t},setHost:function(e){this.cannotBeABaseURL||this.parse(e,tR)},getHostname:function(){var e=this.host;return e===null?"":qu(e)},setHostname:function(e){this.cannotBeABaseURL||this.parse(e,iR)},getPort:function(){var e=this.port;return e===null?"":Rs(e)},setPort:function(e){this.cannotHaveUsernamePasswordPort()||((e=Rs(e))==""?this.port=null:this.parse(e,rR))},getPathname:function(){var e=this.path;return this.cannotBeABaseURL?e[0]:e.length?"/"+nh(e,"/"):""},setPathname:function(e){this.cannotBeABaseURL||(this.path=[],this.parse(e,Ml))},getSearch:function(){var e=this.query;return e?"?"+e:""},setSearch:function(e){(e=Rs(e))==""?this.query=null:(za(e,0)=="?"&&(e=sh(e,1)),this.query="",this.parse(e,cc)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var e=this.fragment;return e?"#"+e:""},setHash:function(e){(e=Rs(e))!=""?(za(e,0)=="#"&&(e=sh(e,1)),this.fragment="",this.parse(e,ms)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var Sd=function(e){var t=bX(this,kr),i=wX(arguments.length,1)>1?arguments[1]:void 0,r=NX(t,new nC(e,!1,i));iC||(t.href=r.serialize(),t.origin=r.getOrigin(),t.protocol=r.getProtocol(),t.username=r.getUsername(),t.password=r.getPassword(),t.host=r.getHost(),t.hostname=r.getHostname(),t.port=r.getPort(),t.pathname=r.getPathname(),t.search=r.getSearch(),t.searchParams=r.getSearchParams(),t.hash=r.getHash())},kr=Sd.prototype,Ba=function(e,t){return{get:function(){return pE(this)[e]()},set:t&&function(i){return pE(this)[t](i)},configurable:!0,enumerable:!0}};iC&&(Va(kr,"href",Ba("serialize","setHref")),Va(kr,"origin",Ba("getOrigin")),Va(kr,"protocol",Ba("getProtocol","setProtocol")),Va(kr,"username",Ba("getUsername","setUsername")),Va(kr,"password",Ba("getPassword","setPassword")),Va(kr,"host",Ba("getHost","setHost")),Va(kr,"hostname",Ba("getHostname","setHostname")),Va(kr,"port",Ba("getPort","setPort")),Va(kr,"pathname",Ba("getPathname","setPathname")),Va(kr,"search",Ba("getSearch","setSearch")),Va(kr,"searchParams",Ba("getSearchParams")),Va(kr,"hash",Ba("getHash","setHash"))),e_(kr,"toJSON",function(){return pE(this).serialize()},{enumerable:!0}),e_(kr,"toString",function(){return pE(this).serialize()},{enumerable:!0}),zu&&(sR=zu.createObjectURL,oR=zu.revokeObjectURL,sR&&e_(Sd,"createObjectURL",yD(sR,zu)),oR&&e_(Sd,"revokeObjectURL",yD(oR,zu)));var sR,oR;OX(Sd,"URL"),yX({global:!0,forced:!CX,sham:!iC},{URL:Sd});var XX=_t,JX=si,QX=FE,MD=Ra,ZX=Fy,UD=jr("URL");XX({target:"URL",stat:!0,forced:!(ZX&&JX(function(){UD.canParse()}))},{canParse:function(e){var t=QX(arguments.length,1),i=MD(e),r=t<2||arguments[1]===void 0?void 0:MD(arguments[1]);try{return!!new UD(i,r)}catch{return!1}}});var xD=zt(Tn.URL),gi={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1};function Ke(){return gi}function TV(){return"setSinkId"in HTMLAudioElement.prototype&&(!k("RESTRICTION_SET_PLAYBACK_DEVICE")||(Co()||Gx())&&!Yy())}function VD(){return!gi.supportUnifiedPlan||k("CHROME_FORCE_PLAN_B")&&No()}var Ri=function(e){return e.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",e.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",e.IOS_INTERRUPTION_START="ios-interruption-start",e.IOS_INTERRUPTION_END="ios-interruption-end",e.STATE_CHANGE="state-change",e}({});function Ul(e,t,i){return{sampleRate:e,stereo:t,bitrate:i}}function je(e,t,i,r,a){return{width:e,height:t,frameRate:i,bitrateMin:r,bitrateMax:a}}function ja(e,t,i,r,a){return{width:{max:e},height:{max:t},frameRate:i,bitrateMin:r,bitrateMax:a}}function cR(e,t){return{numSpatialLayers:e,numTemporalLayers:t}}var $X={"90p":je(160,90),"90p_1":je(160,90),"120p":je(160,120,15,30,65),"120p_1":je(160,120,15,30,65),"120p_3":je(120,120,15,30,50),"120p_4":je(212,120),"180p":je(320,180,15,30,140),"180p_1":je(320,180,15,30,140),"180p_3":je(180,180,15,30,100),"180p_4":je(240,180,15,30,120),"240p":je(320,240,15,40,200),"240p_1":je(320,240,15,40,200),"240p_3":je(240,240,15,40,140),"240p_4":je(424,240,15,40,220),"360p":je(640,360,15,80,400),"360p_1":je(640,360,15,80,400),"360p_3":je(360,360,15,80,260),"360p_4":je(640,360,30,80,600),"360p_6":je(360,360,30,80,400),"360p_7":je(480,360,15,80,320),"360p_8":je(480,360,30,80,490),"360p_9":je(640,360,15,80,800),"360p_10":je(640,360,24,80,800),"360p_11":je(640,360,24,80,1e3),"480p":je(640,480,15,100,500),"480p_1":je(640,480,15,100,500),"480p_2":je(640,480,30,100,1e3),"480p_3":je(480,480,15,100,400),"480p_4":je(640,480,30,100,750),"480p_6":je(480,480,30,100,600),"480p_8":je(848,480,15,100,610),"480p_9":je(848,480,30,100,930),"480p_10":je(640,480,10,100,400),"720p":je(1280,720,15,120,1130),"720p_auto":je(1280,720,30,900,3e3),"720p_1":je(1280,720,15,120,1130),"720p_2":je(1280,720,30,120,2e3),"720p_3":je(1280,720,30,120,1710),"720p_5":je(960,720,15,120,910),"720p_6":je(960,720,30,120,1380),"1080p":je(1920,1080,15,120,2080),"1080p_1":je(1920,1080,15,120,2080),"1080p_2":je(1920,1080,30,120,3e3),"1080p_3":je(1920,1080,30,120,3150),"1080p_5":je(1920,1080,60,120,4780),"1440p":je(2560,1440,30,120,4850),"1440p_1":je(2560,1440,30,120,4850),"1440p_2":je(2560,1440,60,120,7350),"4k":je(3840,2160,30,120,8910),"4k_1":je(3840,2160,30,120,8910),"4k_3":je(3840,2160,60,120,13500)},eJ={"480p":ja(640,480,5),"480p_1":ja(640,480,5),"480p_2":ja(640,480,30),"480p_3":ja(640,480,15),"720p":ja(1280,720,5),"720p_auto":je(1280,720,30,900,3e3),"720p_1":ja(1280,720,5),"720p_2":ja(1280,720,30),"720p_3":ja(1280,720,15),"1080p":ja(1920,1080,5),"1080p_1":ja(1920,1080,5),"1080p_2":ja(1920,1080,30),"1080p_3":ja(1920,1080,15)},tJ={"1SL1TL":cR(1,1),"3SL3TL":cR(3,3),"2SL3TL":cR(2,3)};function Hn(e){return e||(e="480p_1"),typeof e=="string"?Object.assign({},$X[e]):e}function lR(e){return typeof e=="string"?Object.assign({},eJ[e]):e}function n_(e){return typeof e=="string"?Object.assign({},tJ[e]):e}var iJ={speech_low_quality:Ul(16e3,!1),speech_standard:Ul(32e3,!1,18),music_standard:Ul(48e3,!1),standard_stereo:Ul(48e3,!0,56),high_quality:Ul(48e3,!1,128),high_quality_stereo:Ul(48e3,!0,192)};function fE(e){return typeof e=="string"?Object.assign({},iJ[e]):e}var Wl=[];function BD(e){return li(e,"mediaSource",["screen","window","application"]),!0}var ce=function(e){return e.NEED_RENEGOTIATE="@need_renegotiate",e.NEED_REPLACE_TRACK="@need_replace_track",e.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",e.NEED_CLOSE="@need_close",e.NEED_ENABLE_TRACK="@need_enable_track",e.NEED_DISABLE_TRACK="@need_disable_track",e.NEED_SESSION_ID="@need_sid",e.SET_OPTIMIZATION_MODE="@set_optimization_mode",e.GET_STATS="@get_stats",e.GET_RTC_STATS="@get_rtc_stats",e.GET_LOW_VIDEO_TRACK="@get_low_video_track",e.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",e.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",e.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",e.NEED_MUTE_TRACK="@need_mute_track",e.NEED_UNMUTE_TRACK="@need_unmute_track",e}({}),Rt=function(e){return e.SCREEN_TRACK="screen_track",e.CUSTOM_TRACK="custome_track",e.LOW_STREAM="low_stream",e}({}),Td=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e}({}),rJ=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e}({}),aJ=function(e){return e[e.DISABLE=0]="DISABLE",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.AUDIO_ONLY=2]="AUDIO_ONLY",e}({}),wc=function(e){return e.TRANSCEIVER_UPDATED="transceiver-updated",e.SEI_TO_SEND="sei-to-send",e.SEI_RECEIVED="sei-received",e.TRACK_UPDATED="track-updated",e}({}),Pd=function(e){return e.SOURCE_STATE_CHANGE="source-state-change",e.TRACK_ENDED="track-ended",e.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.CLOSED="closed",e}({}),od=function(e){return e.FIRST_FRAME_DECODED="first-frame-decoded",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.VIDEO_STATE_CHANGED="video-state-changed",e}({}),Ld=function(e){return e.AUDIO="audio",e.VIDEO="video",e.DATA="data",e}({}),$r=function(e){return e.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",e.RECEIVE_TRACK_BUFFER="receive_track_buffer",e.ON_AUDIO_BUFFER="on_audio_buffer",e.UPDATE_SOURCE="update_source",e}({});(function(e){e.UPDATE_TRACK_SOURCE="update-track-source"})({});var Fv={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},Gv={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},RV={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receivePacketsDiscarded:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},nJ={uplinkNetworkQuality:0,downlinkNetworkQuality:0},vV={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},fr=function(e){return e.ON_TRACK="on_track",e.ON_NODE="on_node",e}({}),ta=function(e){return e.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",e.REQUEST_CONSTRAINTS="request_constraints",e}({}),Xu=function(e){return e.IDLE="IDLE",e.INITING="INITING",e.INITEND="INITEND",e}({}),yc=function(e){return e.STATE_CHANGE="state_change",e.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",e.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",e.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",e}({}),tr=function(e){return e.NONE="none",e.INIT="init",e.CANPLAY="canplay",e.PLAYING="playing",e.PAUSED="paused",e.SUSPEND="suspend",e.STALLED="stalled",e.WAITING="waiting",e.ERROR="error",e.DESTROYED="destroyed",e.ABORT="abort",e.ENDED="ended",e.EMPTIED="emptied",e.LOADEDDATA="loadeddata",e}({}),Dn=function(e){return e[e.VideoStateStopped=0]="VideoStateStopped",e[e.VideoStateStarting=1]="VideoStateStarting",e[e.VideoStateDecoding=2]="VideoStateDecoding",e[e.VideoStateFrozen=3]="VideoStateFrozen",e}({}),dR={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370},H_=function(e){return e.OPEN="open",e.MESSAGE="message",e.CLOSE="close",e.CLOSING="closing",e.ERROR="error",e}({});function Fe(e,t,i,r,a){var s,c,l={};return Object.keys(r).forEach(function(u){l[u]=r[u]}),l.enumerable=!!l.enumerable,l.configurable=!!l.configurable,("value"in l||l.initializer)&&(l.writable=!0),l=Sn(s=G9(c=i.slice()).call(c)).call(s,function(u,h){return h(e,t,u)||u},l),a&&l.initializer!==void 0&&(l.value=l.initializer?l.initializer.call(a):void 0,l.initializer=void 0),l.initializer===void 0&&(Object.defineProperty(e,t,l),l=null),l}function W(e,t,i){return(t=function(r){var a=function(s,c){if(typeof s!="object"||!s)return s;var l=s[Symbol.toPrimitive];if(l!==void 0){var u=l.call(s,"string");if(typeof u!="object")return u;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(s)}(r);return typeof a=="symbol"?a:a+""}(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function jD(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),i.push.apply(i,r)}return i}function At(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?jD(Object(i),!0).forEach(function(r){W(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):jD(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}var yV=class extends Lt{set _mediaStreamTrack(e){e!==this.mediaStreamTrack&&(this.safeEmit(wc.TRACK_UPDATED,e),this.mediaStreamTrack=e)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(e,t){super(),W(this,"trackMediaType",void 0),W(this,"_ID",void 0),W(this,"_rtpTransceiver",void 0),W(this,"_lowRtpTransceiver",void 0),W(this,"_hints",[]),W(this,"_isClosed",!1),W(this,"_originMediaStreamTrack",void 0),W(this,"mediaStreamTrack",void 0),W(this,"_external",{}),this._ID=t||ft(8,"track-"),this._originMediaStreamTrack=e,this.mediaStreamTrack=e,function(i){oe(Wl).call(Wl,i)||Wl.push(i)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(e){return e||Do(()=>{var t;fe.reportApiInvoke(null,{name:ni.GET_MEDIA_STREAM_TRACK,options:[],tag:Vt.TRACER}).onSuccess(((t=this._mediaStreamTrack)===null||t===void 0?void 0:t.label)||"")},this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(e){return e===Td.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(e){let t=Wl.indexOf(e);t!==-1&&Wl.splice(t,1)}(this),this.emit(Pd.CLOSED),this.removeAllListeners(wc.SEI_RECEIVED)}_updateRtpTransceiver(e,t){if(t===Td.LOW_STREAM){if(this._lowRtpTransceiver===e)return;this._lowRtpTransceiver=e}else{if(this._rtpTransceiver===e)return;this._rtpTransceiver=e}this.emit(wc.TRANSCEIVER_UPDATED,e,t)}},id=class extends yV{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(e,t){super(e,t),W(this,"_enabled",!0),W(this,"_muted",!1),W(this,"_isExternalTrack",!1),W(this,"_isClosed",!1),W(this,"_enabledMutex",void 0),W(this,"processor",void 0),W(this,"_processorContext",void 0),W(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new Fi("".concat(this.getTrackId())),e.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var e,t;return(e=(t=this._originMediaStreamTrack)===null||t===void 0?void 0:t.label)!==null&&e!==void 0?e:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,R.debug("[".concat(this.getTrackId(),"] close")),this.emit(ce.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(e,t){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=i,e!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),t&&this._originMediaStreamTrack.stop()),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await lt(this,ce.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){R.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Pd.TRACK_ENDED)}stateCheck(e,t){if(R.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(e,": ").concat(t,"]")),Is(t,e),this._enabled&&this._muted&&e==="enabled"&&t===!1)throw new H(A.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",R);if(!this._enabled&&!this._muted&&e==="muted"&&t===!0)throw new H(A.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",R)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():ae.resolve([])}},FD=window.AudioContext||window.webkitAudioContext,Yr=null,it=new class extends Lt{constructor(){super(...arguments),W(this,"prevState",void 0),W(this,"curState",void 0),W(this,"currentTime",void 0),W(this,"currentTimeStuckAt",void 0),W(this,"interruptDetectorTrack",void 0),W(this,"onLocalAudioTrackMute",()=>{R.info("ios15-interruption-start"),this.emit(Ri.IOS_15_16_INTERRUPTION_START)}),W(this,"onLocalAudioTrackUnmute",async()=>{R.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?R.info("ios15-interruption-end-canceled"):(Yr&&await Yr.suspend(),this.emit(Ri.IOS_15_16_INTERRUPTION_END))})}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(e){R.debug("webaudio bindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=e,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(e){R.debug("webaudio unbindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===e&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function kd(){if(!Yr){if(function(){if(!FD)return void R.error("your browser is not support web audio");R.info("create audio context");let e=At({},k("WEBAUDIO_INIT_OPTIONS"));R.debug("audio context init option:",JSON.stringify(e)),Yr=new FD(e),it.curState=Yr.state,Yr.onstatechange=()=>{it.prevState=it.curState,it.curState=Yr?Yr.state:void 0;let{prevState:t,curState:i}=it,r=i==="running",a=i==="interrupted",s=t==="running",c=t==="suspended",l=t==="interrupted",u=Ge().osVersion;(pr()||Qa())&&s&&a&&(R.info("ios".concat(u,"-interruption-start")),it.emit(Ri.IOS_INTERRUPTION_START)),(pr()||Qa())&&(c||l)&&r&&(R.info("ios".concat(u,"-interruption-end")),it.emit(Ri.IOS_INTERRUPTION_END)),t!==i&&it.emit(Ri.STATE_CHANGE,i,t)},setInterval(()=>{var t;let i=(t=Yr)===null||t===void 0?void 0:t.currentTime;it.currentTime!==i?(it.currentTimeStuckAt&&(R.debug("AudioContext current time resume at ".concat(i)),it.currentTimeStuckAt=void 0),it.currentTime=i):(i!==it.currentTimeStuckAt&&(fe.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:i},tag:Vt.TRACER}).onSuccess(),R.warning("AudioContext current time stuck at ".concat(i))),it.currentTimeStuckAt=i)},5e3),async function(t){let i=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"],r,a=!1,s=!1,c=!1;function l(v){t.state==="running"?u(!1):pr()||Qa()?t.state==="suspended"&&(u(!0),v&&t.resume().then(h,h)):t.state!=="closed"&&(u(!0),v&&t.resume().then(h,h))}function u(v){if(a!==v){a=v;for(let y=0,I=i;y<I.length;y+=1){let O=I[y];v?window.addEventListener(O,p,{capture:!0,passive:!0}):window.removeEventListener(O,p,{capture:!0,passive:!0})}}}function h(){l(!1)}function p(){l(!0)}function _(v){if(!c)if(r.paused)if(v){let y;m(!1),c=!0;try{y=r.play(),y?y.then(S,S):(r.addEventListener("playing",S),r.addEventListener("abort",S),r.addEventListener("error",S))}catch{S()}}else m(!0);else m(!1)}function m(v){if(s!==v){s=v;for(let y=0,I=i;y<I.length;y++){let O=I[y];v?window.addEventListener(O,C,{capture:!0,passive:!0}):window.removeEventListener(O,C,{capture:!0,passive:!0})}}}function S(){r.removeEventListener("playing",S),r.removeEventListener("abort",S),r.removeEventListener("error",S),c=!1,_(!1)}function C(){_(!0)}if(pr()){let v=t.createMediaStreamDestination(),y=document.createElement("div");y.innerHTML="<audio x-webkit-airplay='deny'></audio>",r=y.children.item(0),r.controls=!1,r.disableRemotePlayback=!0,r.preload="auto",r.srcObject=v.stream,_(!0)}it.on(Ri.STATE_CHANGE,function(){l(!0)}),l(!1)}(Yr)}(),!Yr)throw new H(A.NOT_SUPPORTED,"can not create audio context");return Yr}return Yr}function pc(e){if(function(){if(uR!==null)return uR;let r=kd(),a=r.createBufferSource(),s=r.createGain(),c=r.createGain();a.connect(s),a.connect(c),a.disconnect(s);let l=!1;try{a.disconnect(s)}catch{l=!0}return a.disconnect(),uR=l,l}())return;let t=e.connect,i=e.disconnect;e.connect=(r,a,s)=>{var c;return e._inputNodes||(e._inputNodes=[]),oe(c=e._inputNodes).call(c,r)||(r instanceof AudioNode?(e._inputNodes.push(r),t.call(e,r,a,s)):t.call(e,r,a)),e},e.disconnect=(r,a,s)=>{i.call(e),r?hE(e._inputNodes,r):e._inputNodes=[];for(let c of e._inputNodes)t.call(e,c)}}var uR=null;function sC(e,t){let i=!1,r=1/t;if(k("DISABLE_WEBAUDIO")){let a=window.setInterval(()=>{i?window.clearInterval(a):e(performance.now()/1e3)},1e3*r)}else{let a=kd(),s=a.createGain();s.gain.value=0,s.connect(a.destination);let c=()=>{if(i)return void(s=null);let l=a.createOscillator();l.onended=c,l.connect(s),l.start(0),l.stop(a.currentTime+r),e(a.currentTime)};c()}return()=>{i=!0}}var CV=class{constructor(){W(this,"context",void 0),W(this,"analyserNode",void 0),W(this,"sourceNode",void 0),this.context=kd(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(e){if(e!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=e,e==null||e.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||pr()||Qa()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;let e=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(e);else{let i=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(i);for(let r=0;r<e.length;++r)e[r]=i[r]/128-1}let t=Sn(e).call(e,(i,r)=>i+r*r,0)/e.length;return Math.max(10*Math.log10(t)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var e,t;(e=this.sourceNode)===null||e===void 0||e.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(t=this.sourceNode)===null||t===void 0||t.connect(this.analyserNode)}catch{R.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}},bV=class extends Lt{get processSourceNode(){return this.sourceNode}set processedNode(e){var t;if(!this.isDestroyed&&this._processedNode!==e){try{var i;(i=this.sourceNode)===null||i===void 0||i.disconnect(this.outputNode)}catch{}(t=this._processedNode)===null||t===void 0||t.disconnect(),this._processedNode=e,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),W(this,"outputNode",void 0),W(this,"outputTrack",void 0),W(this,"isPlayed",!1),W(this,"sourceNode",void 0),W(this,"context",void 0),W(this,"audioBufferNode",void 0),W(this,"destNode",void 0),W(this,"audioOutputLevel",0),W(this,"volumeLevelAnalyser",void 0),W(this,"_processedNode",void 0),W(this,"playNode",void 0),W(this,"isDestroyed",!1),W(this,"onNoAudioInput",void 0),W(this,"isNoAudioInput",!1),W(this,"_noAudioInputCount",0),this.context=kd(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),pc(this.outputNode),this.volumeLevelAnalyser=new CV}startGetAudioBuffer(e){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(e),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=t=>{this.emit($r.ON_AUDIO_BUFFER,function(i){for(let r=0;r<i.outputBuffer.numberOfChannels;r+=1){let a=i.outputBuffer.getChannelData(r);for(let s=0;s<a.length;s+=1)a[s]=0}return i.inputBuffer}(t))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!Ke().webAudioMediaStreamDest)throw new H(A.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(e){this.context.state!=="running"&&JE(()=>{it.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=e||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(e>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;pr()||Qa()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();let t=this.volumeLevelAnalyser.getAnalyserNode(),i;t.getFloatTimeDomainData?(i=new Float32Array(t.fftSize),t.getFloatTimeDomainData(i)):(i=new Uint8Array(t.fftSize),t.getByteTimeDomainData(i));let r=!1;for(let a=0;a<i.length;a++)i[a]!==0&&(r=!0);return r?(this.isNoAudioInput=!1,!0):(await yi(200),await this.checkHasAudioInput(e?e+1:1)&&r)}getAudioVolume(){return this.outputNode.gain.value}setVolume(e){this.outputNode.gain.setValueAtTime(e,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var e,t;(e=this.processedNode)===null||e===void 0||e.disconnect(),(t=this.sourceNode)===null||t===void 0||t.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var e;this.processedNode?(e=this.processedNode)===null||e===void 0||e.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}},AV=class extends bV{get isFreeze(){return!1}constructor(e,t,i){var r;if(super(),W(this,"sourceNode",void 0),W(this,"track",void 0),W(this,"clonedTrack",void 0),W(this,"audioElement",void 0),W(this,"isCurrentTrackCloned",!1),W(this,"isRemoteTrack",!1),W(this,"originVolumeLevelAnalyser",void 0),W(this,"rebuildWebAudio",async()=>{if(R.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void R.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>R.info("resume success")),R.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();let c=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?c.stop():this.isCurrentTrackCloned=!0;let l=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(l),pc(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();let u=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(u,this.context.currentTime),pc(this.outputNode),this.emit($r.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=l,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),e.kind!=="audio")throw new H(A.UNEXPECTED_ERROR);this.track=e;let a=new MediaStream([this.track]);if(this.isRemoteTrack=!!t,this.sourceNode=this.context.createMediaStreamSource(a),pc(this.sourceNode),i){let c=i.clone();c.enabled=!0,this.clonedTrack=c,R.debug("create an unmuted track ".concat(c.id," from the original track ").concat(i.id," to get the volume"));let l=this.context.createMediaStreamSource(new MediaStream([c]));pc(l),this.originVolumeLevelAnalyser=new CV,this.originVolumeLevelAnalyser.updateSource(l)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=a;let s=Ge();t&&s.os===pi.IOS&&Number((r=s.osVersion)===null||r===void 0?void 0:r.split(".")[0])<15&&(it.on(Ri.STATE_CHANGE,()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(c=>{c||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(e){this.sourceNode.disconnect(),this.track=e,this.isCurrentTrackCloned=!1;let t=new MediaStream([e]);this.sourceNode=this.context.createMediaStreamSource(t),pc(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit($r.UPDATE_SOURCE),this.audioElement.srcObject=t}destroy(){var e;this.audioElement.srcObject=null,this.audioElement.remove(),it.off("state-change",this.rebuildWebAudio),(e=this.originVolumeLevelAnalyser)===null||e===void 0||e.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(e){return this.context.createMediaStreamSource(new MediaStream([e]))}updateOriginTrack(e){let t=e.clone();t.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=t),R.debug("create an unmuted track ".concat(t.id," from the original track ").concat(e.id," to get the volume"));let i=this.context.createMediaStreamSource(new MediaStream([t]));pc(i),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(i)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}};async function IV(e,t,i){let r=(s,c)=>s?typeof s!="number"?s.max||s.exact||s.ideal||s.min||c:s:c,a={audio:!!i&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxHeight:r(t.height,1080),maxWidth:r(t.width,1920)}}};return t.frameRate&&typeof t.frameRate!="number"?(a.video.mandatory.maxFrameRate=t.frameRate.max,a.video.mandatory.minFrameRate=t.frameRate.min):typeof t.frameRate=="number"&&(a.video.mandatory.maxFrameRate=t.frameRate),await navigator.mediaDevices.getUserMedia(a)}async function sJ(e,t){let i=await OV(e.mediaSource),{sourceId:r,audio:a}=await function(s){let c=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new ae((l,u)=>{let h=document.createElement("div");h.innerText="share screen",h.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");let p=document.createElement("div");p.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");let _=document.createElement("div");_.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",_.setAttribute("style","height: 12%;");let m=document.createElement("div");m.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");let S=document.createElement("div");S.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");let C=document.createElement("button");C.innerHTML="cancel",C.setAttribute("style","width: 85px;"),C.onclick=()=>{document.body.removeChild(I);let O=new Error("NotAllowedError");O.name="NotAllowedError",u(O)};let v=c,y=document.createElement("div");if(c){let O=document.createElement("input");O.setAttribute("type","checkbox");let P=document.createElement("span");O.setAttribute("style","margin-right: 6px;"),P.innerText="Share audio",O.checked=v,O.onchange=()=>{v=O.checked},y.appendChild(O),y.appendChild(P)}S.appendChild(y),S.appendChild(C),p.appendChild(_),p.appendChild(m),p.appendChild(S);let I=document.createElement("div");I.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),I.appendChild(h),I.appendChild(p),document.body.appendChild(I),s.map(O=>{if(O.id){let P=document.createElement("div");P.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let U=O.thumbnail;try{let{width:x}=U.getSize();x>1920&&(U=U.resize({width:1920}))}catch(x){throw x&&x.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),x}P.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+U.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+O.name.replace(/[\u00A0-\u9999<>\&]/g,function(x){return"&#"+x.charCodeAt(0)+";"})+"</span>",P.onclick=()=>{document.body.removeChild(I),l({sourceId:O.id,audio:v})},m.appendChild(P)}})})}(i,t);return await IV(r,e,a)}async function OV(e){let t=["window","screen"];e!=="application"&&e!=="window"||(t=["window"]),e==="screen"&&(t=["screen"]);let i=Qx();if(!i)throw console.error("failed to fetch electron, please mount it to window"),new H(A.ELECTRON_IS_NULL);let r=null;try{var a;r=((a=i.desktopCapturer)===null||a===void 0?void 0:a.getSources({types:t}))||i.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:t})}catch{r=null}r&&r.then||(r=new ae((s,c)=>{i.desktopCapturer.getSources({types:t},(l,u)=>{l?c(l):s(u)})}));try{return await r}catch(s){throw new H(A.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,s.toString())}}var Hv=new Fi("safari"),wV=!1,NV=!1;async function Qr(e,t){let i=0,r=null;for(;i<2;)try{r=await oJ(e,t,i>0);break}catch(a){if(a instanceof H)throw R.error("[".concat(t,"] ").concat(a.toString())),a;let s=W_(a.name||a.code||a,a.message);if(s.code===A.MEDIA_OPTION_INVALID){R.debug("[".concat(t,"] detect media option invalid, retry")),i+=1,await yi(500);continue}throw R.error("[".concat(t,"] ").concat(s.toString())),s}if(!r)throw new H(A.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return r}async function oJ(e,t,i){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new H(A.NOT_SUPPORTED,"can not find getUserMedia");i&&(e.video&&(delete e.video.width,delete e.video.height),e.screen&&(delete e.screen.width,delete e.screen.height));let r=Ke(),a=new MediaStream;if(e.audioSource&&a.addTrack(e.audioSource),e.videoSource&&a.addTrack(e.videoSource),!e.audio&&!e.video&&!e.screen)return R.debug("Using Video Source/ Audio Source"),a;if(e.screen)if(Qx())e.screen.sourceId?xl(a,await IV(e.screen.sourceId,e.screen,e.screenAudio)):xl(a,await sJ(e.screen,e.screenAudio));else if(Co()&&e.screen.extensionId&&e.screen.mandatory){if(!r.getStreamFromExtension)throw new H(A.NOT_SUPPORTED,"This browser does not support screen sharing");R.debug("[".concat(t,'] Screen access on chrome stable, looking for extension"'));let m=await(c=e.screen.extensionId,l=t,new ae((S,C)=>{try{chrome.runtime.sendMessage(c,{getStream:!0},v=>{if(!v||!v.streamId)return R.error("[".concat(l,"] No response from Chrome Plugin. Plugin not installed properly"),v),void C(new H(A.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));S(v.streamId)})}catch(v){R.error("[".concat(l,"] AgoraRTC screensharing plugin is not accessible(").concat(c,")"),v.toString()),C(new H(A.CHROME_PLUGIN_NOT_INSTALL))}}));e.screen.mandatory.chromeMediaSourceId=m,xl(a,await navigator.mediaDevices.getUserMedia({video:{mandatory:e.screen.mandatory}}))}else if(r.getDisplayMedia){var s;e.screen.mediaSource&&BD(e.screen.mediaSource);let m={width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate,displaySurface:(s=e.screen.displaySurface)!==null&&s!==void 0?s:e.screen.mediaSource==="screen"?"monitor":e.screen.mediaSource},{selfBrowserSurface:S,surfaceSwitching:C,systemAudio:v}=e.screen,y={selfBrowserSurface:S,surfaceSwitching:C,systemAudio:v};!S&&delete y.selfBrowserSurface,!C&&delete y.surfaceSwitching,!v&&delete y.systemAudio,R.debug("[".concat(t,"] getDisplayMedia:"),JSON.stringify({video:m,audio:!!e.screenAudio,controls:y})),xl(a,await navigator.mediaDevices.getDisplayMedia(At({video:m,audio:!!e.screenAudio},y)))}else{if(!Bt())throw R.error("[".concat(t,"] This browser does not support screenSharing")),new H(A.NOT_SUPPORTED,"This browser does not support screen sharing");{e.screen.mediaSource&&BD(e.screen.mediaSource);let m={video:{mediaSource:e.screen.mediaSource,width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate}};R.debug("[".concat(t,"] getUserMedia: ").concat(JSON.stringify(m))),xl(a,await navigator.mediaDevices.getUserMedia(m))}}var c,l;if(!e.video&&!e.audio)return a;let u={video:e.video,audio:e.audio},h=k("MEDIA_DEVICE_CONSTRAINTS");if(h)try{typeof h=="string"&&(h=JSON.parse(h)),u=Lv(u,h)}catch{}R.debug("[".concat(t,"] GetUserMedia"),JSON.stringify(u)),Ge();let p,_=null;(Li()||pr()||uE())&&(_=await Hv.lock());try{p=await navigator.mediaDevices.getUserMedia(u)}catch(m){throw _&&_(),m}return u.audio&&(wV=!0),u.video&&(NV=!0),xl(a,p),_&&_(),a}function W_(e,t){switch(e){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new H(A.MEDIA_OPTION_INVALID,"".concat(e,": ").concat(t));case"NotFoundError":case"DevicesNotFoundError":return new H(A.DEVICE_NOT_FOUND,"".concat(e,": ").concat(t));case"NotSupportedError":return new H(A.NOT_SUPPORTED,"".concat(e,": ").concat(t));case"NotReadableError":return new H(A.NOT_READABLE,"".concat(e,": ").concat(t));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new H(A.PERMISSION_DENIED,"".concat(e,": ").concat(t));case"ConstraintNotSatisfiedError":return new H(A.CONSTRAINT_NOT_SATISFIED,"".concat(e,": ").concat(t));default:return R.error("getUserMedia unexpected error",e),new H(A.UNEXPECTED_ERROR,"".concat(e,": ").concat(t))}}function xl(e,t){let i=e.getVideoTracks()[0],r=e.getAudioTracks()[0],a=t.getVideoTracks()[0],s=t.getAudioTracks()[0];s&&(r&&e.removeTrack(r),e.addTrack(s)),a&&(i&&e.removeTrack(i),e.addTrack(a))}var ea=new class extends Lt{get state(){return this._state}set state(e){e!==this._state&&(this.emit(yc.STATE_CHANGE,e),this._state=e)}constructor(){super(),W(this,"_state",Xu.IDLE),W(this,"isAccessMicrophonePermission",!1),W(this,"isAccessCameraPermission",!1),W(this,"lastAccessMicrophonePermission",!1),W(this,"lastAccessCameraPermission",!1),W(this,"checkdeviceMatched",!1),W(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(k("ENUMERATE_DEVICES_INTERVAL")||(qE()||YE()===pi.HARMONY_OS)&&No())&&this.updateDevicesInfo()},k("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(e=>R.error(e.toString()))}async enumerateDevices(e,t){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new H(A.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();let r=await navigator.mediaDevices.enumerateDevices(),a=this.checkMediaDeviceInfoIsOk(r),s=!this.isAccessMicrophonePermission&&e,c=!this.isAccessCameraPermission&&t;a.audio&&(s=!1),a.video&&(c=!1);let l=null,u=null,h=null;if(!i&&(s||c)){if(Hv.isLocked&&(R.debug("[device manager] wait GUM lock"),(await Hv.lock())(),R.debug("[device manager] GUM unlock")),wV&&(s=!1,this.isAccessMicrophonePermission=!0),NV&&(c=!1,this.isAccessCameraPermission=!0),R.debug("[device manager] check media device permissions",e,t,s,c),s&&c){try{h=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(p){let _=W_(p.name||p.code||p,p.message);if(_.code===A.PERMISSION_DENIED)throw _;R.warning("getUserMedia failed in getDevices",_)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(s){try{l=await navigator.mediaDevices.getUserMedia({audio:e})}catch(p){let _=W_(p.name||p.code||p,p.message);if(_.code===A.PERMISSION_DENIED)throw _;R.warning("getUserMedia failed in getDevices",_)}this.isAccessMicrophonePermission=!0}else if(c){try{u=await navigator.mediaDevices.getUserMedia({video:t})}catch(p){let _=W_(p.name||p.code||p,p.message);if(_.code===A.PERMISSION_DENIED)throw _;R.warning("getUserMedia failed in getDevices",_)}this.isAccessCameraPermission=!0}R.debug("[device manager] mic permission",e,"cam permission",t)}try{let p=await navigator.mediaDevices.enumerateDevices();return l&&l.getTracks().forEach(_=>_.stop()),u&&u.getTracks().forEach(_=>_.stop()),h&&h.getTracks().forEach(_=>_.stop()),l=null,u=null,h=null,p}catch(p){return l&&l.getTracks().forEach(_=>_.stop()),u&&u.getTracks().forEach(_=>_.stop()),h&&h.getTracks().forEach(_=>_.stop()),l=null,u=null,h=null,new H(A.ENUMERATE_DEVICES_FAILED,p.toString()).throw()}}async getRecordingDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(t=>t.kind==="audioinput")}async getCamerasDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,e)).filter(t=>t.kind==="videoinput")}async getSpeakers(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(t=>t.kind==="audiooutput")}searchDeviceIdByName(e){let t=null;return this.deviceInfoMap.forEach(i=>{i.device.label===e&&(t=i.device.deviceId)}),t}async getDeviceById(e){let t=(await this.enumerateDevices(!0,!0,!0)).find(i=>i.deviceId===e);if(!t)throw new H(A.DEVICE_NOT_FOUND,"deviceId: ".concat(e));return t}async init(){this.state=Xu.INITING;try{await this.updateDevicesInfo(),this.state=Xu.INITEND}catch(e){throw R.warning("Device Detection functionality cannot start properly.",e.toString()),this.state=Xu.IDLE,(typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1")||new H(A.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),e}}async updateDevicesInfo(){let e=await this.enumerateDevices(!0,!0,!0),t=Date.now(),i=[];if(e[0]&&e[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;let a=e.find(c=>c.kind==="audioinput"&&c.deviceId==="default"),s=e.find(c=>c.kind==="audiooutput"&&c.deviceId==="default");a&&s?s.groupId===a.groupId?R.debug("[device-check] default input ".concat(a.label," and output ").concat(s.label," is the same group")):R.warning("[device-check] default input ".concat(a.label," and output ").concat(s.label," is not the same group")):R.debug("[device-check] default input or output not found")}let r=this.checkMediaDeviceInfoIsOk(e);if(e.forEach(a=>{if(!a.deviceId)return;let s=this.deviceInfoMap.get("".concat(a.kind,"_").concat(a.deviceId));if((s?s.state:"INACTIVE")!=="ACTIVE"){let c={initAt:t,updateAt:t,device:a,state:"ACTIVE"};this.deviceInfoMap.set("".concat(a.kind,"_").concat(a.deviceId),c),i.push(c)}s&&(s.updateAt=t)}),this.deviceInfoMap.forEach((a,s)=>{a.state==="ACTIVE"&&a.updateAt!==t&&(a.state="INACTIVE",i.push(a))}),this.state!==Xu.INITEND)return r.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(r.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));i.forEach(a=>{switch(a.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(yc.RECORDING_DEVICE_CHANGED,a);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(yc.CAMERA_DEVICE_CHANGED,a);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(yc.PLAYOUT_DEVICE_CHANGED,a)}}),r.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),r.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(e){let t=e.filter(a=>a.kind==="audioinput"),i=e.filter(a=>a.kind==="videoinput"),r={audio:!1,video:!1};for(let a of t)if(a.label&&a.deviceId){r.audio=!0;break}for(let a of i)if(a.label&&a.deviceId){r.video=!0;break}return r}},hR=!1,qr=new class extends Lt{constructor(){super(...arguments),W(this,"onAutoplayFailed",void 0),W(this,"onAudioAutoplayFailed",void 0)}};function DV(){if(Ge(),!hR){let e=t=>{t.preventDefault(),hR=!1,Mh()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};hR=!0,Mh()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),R.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),qr.onAutoplayFailed?qr.onAutoplayFailed():qr.onAudioAutoplayFailed?R.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):R.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),qr.emit("autoplay-failed")}}function PV(e,t,i,r){if(!e)return;let a=fe.getBaseInfoBySessionId(e);if(!a)return;let s=a.info,c=Date.now(),l=At(At({},s),{},{vid:s.vid===void 0?0:Number(s.vid),lts:c,elapse:c-a.startTime,cbRegistered:qr.onAutoplayFailed||qr.onAudioAutoplayFailed?1:-1,errorMsg:i,mediaType:t,trackId:r,extend:void 0});fe.send({type:Pt.AUTOPLAY_FAILED,data:l},!0)}var cJ=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],vr=new class{constructor(){W(this,"onAutoplayFailed",void 0),W(this,"elementMap",new Map),W(this,"elementStateMap",new Map),W(this,"elementsNeedToResume",[]),W(this,"sinkIdMap",new Map),W(this,"autoResumeAfterInterruption",e=>{Array.from(this.elementMap.entries()).forEach(t=>{let[i,r]=t,a=this.elementStateMap.get(i),s=r.srcObject.getAudioTracks()[0],c=s&&s.readyState;if(R.debug("resume after interrupted, ele: ".concat(a," audio: ").concat(c," ").concat(e)),c==="live"){if(e)return r.pause(),void r.play();if(it.curState==="running")return Ed()?(r.pause(),void r.play()):void(a&&a==="paused"&&r.play())}})}),W(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(e=>{let[t,i]=e,r=i.srcObject.getAudioTracks()[0];r&&r.readyState==="live"&&(R.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),i.pause(),i.play())})}),this.autoResumeAudioElement(),it.on(Ri.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),it.on(Ri.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),it.on(Ri.STATE_CHANGE,()=>{pr()&&it.prevState==="suspended"&&it.curState==="running"&&this.autoResumeAfterInterruption()})}async setSinkID(e,t){let i=this.elementMap.get(e);if(this.sinkIdMap.set(e,t),i)try{await i.setSinkId(t)}catch(r){throw new H(A.PERMISSION_DENIED,"can not set sink id: "+r.toString())}}play(e,t,i,r){if(this.elementMap.has(t))return;let a=document.createElement("audio");a.autoplay=!0,a.srcObject=new MediaStream([e]),this.bindAudioElementEvents(t,a),this.elementMap.set(t,a),this.elementStateMap.set(t,tr.INIT),this.setVolume(t,i);let s=this.sinkIdMap.get(t);if(s)try{a.setSinkId(s).catch(l=>{R.warning("[".concat(t,"] set sink id failed"),l.toString())})}catch(l){R.warning("[".concat(t,"] set sink id failed"),l.toString())}let c=a.play();c&&c.then&&c.catch(l=>{r&&PV(r,"audio",l.message,t),R.warning("audio element play warning",l.toString()),this.elementMap.has(t)&&l.name==="NotAllowedError"&&(R.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(a),JE(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),DV()}))})}updateTrack(e,t){let i=this.elementMap.get(e);i&&(i.srcObject=new MediaStream([t]))}isPlaying(e){return this.elementMap.has(e)&&this.elementStateMap.get(e)==="playing"}setVolume(e,t){let i=this.elementMap.get(e);i&&(t=Math.max(0,Math.min(100,t)),i.volume=t/100)}stop(e){let t=this.elementMap.get(e);if(this.sinkIdMap.delete(e),!t)return;let i=this.elementsNeedToResume.indexOf(t);this.elementsNeedToResume.splice(i,1),t.srcObject=null,t.remove(),this.elementMap.delete(e),this.elementStateMap.delete(e)}bindAudioElementEvents(e,t){cJ.forEach(i=>{t.addEventListener(i,r=>{let a=this.elementStateMap.get(e),s=r.type==="pause"?"paused":r.type;if(R.debug("[".concat(e,"] audio-element-status change ").concat(a," => ").concat(s)),r.type==="error"){let c=t==null?void 0:t.error;c&&R.error("[".concat(e,"] media error, code: ").concat(c.code,", message: ").concat(c.message))}this.elementStateMap.set(e,s)})})}getPlayerState(e){return this.elementStateMap.get(e)||"uninit"}autoResumeAudioElement(){let e=()=>{this.elementsNeedToResume.forEach(t=>{t.play().then(i=>{R.debug("Auto resume audio element success")}).catch(i=>{R.warning("Auto resume audio element failed!",i)})}),this.elementsNeedToResume=[]};new ae(t=>{document.body?t():window.addEventListener("load",()=>t())}).then(()=>{Mh()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0))})}};function Kt(){return function(e,t,i){let r=i.value;return typeof r=="function"&&(i.value=function(){this._isClosed&&new H(A.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",R);for(var a=arguments.length,s=new Array(a),c=0;c<a;c++)s[c]=arguments[c];let l=r.apply(this,s);return l instanceof ae?new ae((u,h)=>{l.then(u).catch(h)}):l}),i}}var LV=class extends Lt{constructor(e){super(),W(this,"name","VideoProcessorDestination"),W(this,"ID","0"),W(this,"_source",void 0),W(this,"videoContext",void 0),W(this,"inputTrack",void 0),this.videoContext=e}get kind(){return"video"}get enabled(){return!0}pipe(){throw new H(A.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new H(A.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(e){if(e.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);e.track&&e.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=e.track,this.emit(fr.ON_TRACK,e.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(fr.ON_TRACK,void 0)}},kV=class extends Lt{set chained(e){this._chained=e}get chained(){return this._chained}constructor(e,t){super(),W(this,"constraintsMap",new Map),W(this,"statsRegistry",[]),W(this,"usageRegistry",[]),W(this,"trackId",void 0),W(this,"direction",void 0),W(this,"_chained",!1),this.trackId=e,this.direction=t}async getConstraints(){return await ki(this,ta.REQUEST_CONSTRAINTS)}async requestApplyConstraints(e,t){var i;return R.info("processor ".concat(t.name," requestApplyConstraints for ").concat(this.trackId)),e&&this.constraintsMap.set(t,e),lt(this,ta.REQUEST_UPDATE_CONSTRAINTS,Array.from(Ns(i=this.constraintsMap).call(i)))}async requestRevertConstraints(e){var t;if(this.constraintsMap.has(e))return R.info("processor ".concat(e.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(e),lt(this,ta.REQUEST_UPDATE_CONSTRAINTS,Array.from(Ns(t=this.constraintsMap).call(t)))}registerStats(e,t,i){this.statsRegistry.find(r=>r.processorID===e.ID&&r.processorName===e.name&&r.type===t)||this.statsRegistry.push({processorName:e.name,processorID:e.ID,type:t,cb:i})}unregisterStats(e,t){let i=this.statsRegistry.findIndex(r=>r.processorID===e.ID&&r.processorName===e.name&&r.type===t);i!==-1&&this.statsRegistry.splice(i,1)}gatherStats(){let e=[];for(let{processorID:t,processorName:i,type:r,cb:a}of this.statsRegistry)try{let s=a();e.push({processorID:t,processorName:i,type:r,stats:s})}catch(s){R.error(new H(A.UNEXPECTED_ERROR,s.message))}return e}registerUsage(e,t){this.usageRegistry.find(i=>i.processorID===e.ID&&i.processorName===e.name)||this.usageRegistry.push({processorID:e.ID,processorName:e.name,cb:t})}unregisterUsage(e){let t=this.usageRegistry.findIndex(i=>i.processorID===e.ID&&i.processorName===e.name);t!==-1&&this.usageRegistry.splice(t,1)}async gatherUsage(){let e=[];if(!this.chained)return[];for(let{cb:t}of this.usageRegistry)try{let i=t();i instanceof ae&&(i=await i),e.push(At(At({},i),{},{direction:this.direction}))}catch(i){R.error("gather extension usage error",i)}return e}getDirection(){return this.direction}},MV=class extends Lt{constructor(e){super(),W(this,"name","AudioProcessorDestination"),W(this,"ID","0"),W(this,"inputTrack",void 0),W(this,"inputNode",void 0),W(this,"audioProcessorContext",void 0),W(this,"_source",void 0),this.audioProcessorContext=e}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new H(A.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new H(A.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(fr.ON_TRACK,void 0),this.emit(fr.ON_NODE,void 0)}updateInput(e){if(e.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);e.track&&this.inputTrack!==e.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=e.track,this.emit(fr.ON_TRACK,this.inputTrack)),e.node&&this.inputNode!==e.node&&(this.audioProcessorContext.chained=!0,this.inputNode=e.node,this.emit(fr.ON_NODE,this.inputNode))}},UV=class extends Lt{set chained(e){this._chained=e}get chained(){return this._chained}constructor(e,t,i){super(),W(this,"constraintsMap",new Map),W(this,"statsRegistry",[]),W(this,"audioContext",void 0),W(this,"trackId",void 0),W(this,"direction",void 0),W(this,"usageRegistry",[]),W(this,"_chained",!1),this.audioContext=e,this.trackId=t,this.direction=i}async getConstraints(){return ki(this,ta.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(e,t){var i;return R.info("processor ".concat(t.name," requestApplyConstraints for ").concat(this.trackId)),e&&this.constraintsMap.set(t,e),lt(this,ta.REQUEST_UPDATE_CONSTRAINTS,Array.from(Ns(i=this.constraintsMap).call(i)))}async requestRevertConstraints(e){var t;if(this.constraintsMap.has(e))return this.constraintsMap.delete(e),lt(this,ta.REQUEST_UPDATE_CONSTRAINTS,Array.from(Ns(t=this.constraintsMap).call(t)))}registerStats(e,t,i){this.statsRegistry.find(r=>r.processorID===e.ID&&r.processorName===e.name&&r.type===t)||this.statsRegistry.push({processorName:e.name,processorID:e.ID,type:t,cb:i})}unregisterStats(e,t){let i=this.statsRegistry.findIndex(r=>r.processorID===e.ID&&r.processorName===e.name&&r.type===t);i!==-1&&this.statsRegistry.splice(i,1)}gatherStats(){let e=[];for(let{processorID:t,processorName:i,type:r,cb:a}of this.statsRegistry)try{let s=a();e.push({processorID:t,processorName:i,type:r,stats:s})}catch(s){R.error(new H(A.UNEXPECTED_ERROR,s.message))}return e}registerUsage(e,t){this.usageRegistry.find(i=>i.processorID===e.ID&&i.processorName===e.name)||this.usageRegistry.push({processorID:e.ID,processorName:e.name,cb:t})}unregisterUsage(e){let t=this.usageRegistry.findIndex(i=>i.processorID===e.ID&&i.processorName===e.name);t!==-1&&this.usageRegistry.splice(t,1)}async gatherUsage(){let e=[];if(!this.chained)return[];for(let{cb:t}of this.usageRegistry)try{let i=t();i instanceof ae&&(i=await i),e.push(At(At({},i),{},{direction:this.direction}))}catch(i){R.error("gather extension usage error",i)}return e}getDirection(){return this.direction}},Wv=class extends Lt{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),W(this,"context",void 0),W(this,"processSourceNode",void 0),W(this,"outputTrack",void 0),W(this,"processedNode",void 0),W(this,"clonedTrack",void 0),W(this,"outputNode",void 0),this.outputNode=new lJ}setVolume(){}createOutputTrack(){throw new H(A.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}},lJ=class{disconnect(){}connect(){}};function xV(e){return new ae((t,i)=>{let r=!1,a=document.createElement("video");a.setAttribute("autoplay",""),a.setAttribute("muted",""),a.muted=!0,a.autoplay=!0,a.setAttribute("playsinline",""),a.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(a);let s=pr()?"canplay":"playing";a.addEventListener(s,()=>{let c=a.videoWidth,l=a.videoHeight;!c&&Bt()||(r=!0,a.srcObject=null,a.remove(),t([c,l]))}),a.srcObject=new MediaStream([e]),a.play().catch(QE),setTimeout(()=>{r||(a.srcObject=null,a.remove(),t([a.videoWidth,a.videoHeight]))},4e3)})}function _E(e){let t={};e.facingMode&&(t.facingMode=e.facingMode),e.cameraId&&(t.deviceId={exact:e.cameraId});let i=Hn(e.encoderConfig);return i.width!=null&&(t.width=i.width),i.height!=null&&(t.height=i.height),!qx()&&i.frameRate&&(t.frameRate=i.frameRate),Gx()&&typeof t.frameRate=="object"&&(t.frameRate.max=60),Bt()&&(t.frameRate={ideal:30,max:30}),t}function GD(e){let t={};if(qx()||(e.AGC!==void 0&&(t.autoGainControl=e.AGC),e.AEC!==void 0&&(t.echoCancellation=e.AEC),e.ANS!==void 0&&(t.noiseSuppression=e.ANS,Co()&&e.ANS&&(t.googHighpassFilter=e.ANS))),e.encoderConfig){let i=fE(e.encoderConfig);t.channelCount=i.stereo?2:1,t.sampleRate=i.sampleRate,t.sampleSize=i.sampleSize}return e.microphoneId&&(t.deviceId={exact:e.microphoneId}),qE()&&(t.sampleRate=void 0),t}var dJ=e=>{let t=e._encoderConfig;if(!t)return;let{frameRate:i,width:r,height:a}=e.getMediaStreamTrackSettings(),{frameRate:s=i,width:c=r,height:l=a}=t;if(!s||!c||!l)return;c=LT(c),l=LT(l),s=LT(s);let{max:u,min:h}=function(S,C,v){let y=200*Math.pow(v/15,.6)*Math.pow(S*C/640/360,.75);return{min:Math.floor(y),max:Math.floor(4*y)}}(c,l,s),{bitrateMax:p,bitrateMin:_}=t||{};p||R.debug("calculate bitrate: [w: ".concat(c,", h: ").concat(l,", fps: ").concat(s,"] => [brMax: ").concat(p,", brMin: ").concat(_,"]"));let{maxFramerate:m}=k("ENCODER_CONFIG_LIMIT");return m&&typeof m=="number"&&(s=Math.min(s,m)),{frameRate:s,bitrateMax:p||u,bitrateMin:_||h,scaleResolutionDownBy:1,scale:0}},VV=async(e,t,i)=>await(async(r,a,s)=>{let c=function(h){let p=[];for(let _=0;_<h.length;_+=2)p.push(parseInt(h.slice(_,_+2),16));return Uint8Array.from(p)}(tV(""+a+s)).slice(0,16),l=c.slice(0,12),u=await window.crypto.subtle.importKey("raw",c,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:l},u,r))})(e.buffer,t,i),oC=e=>{let t=document.createElement("canvas");return t.width=2,t.height=2,new ae((i,r)=>{t.toBlob(async a=>{if(t.remove(),a){let s=await BV(a);i({buffer:s,width:t.width,height:t.height})}else r(new H(A.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},e,1)})},BV=async e=>{let t=await e.arrayBuffer();return new Uint8Array(t)},HD,WD,KD,zD,YD,qD,XD,JD,QD,ZD,$D,eP,tP,iP,rP,aP,nP,sP,wt,oP,cP,lP,dP,uP,hP,Pn,pP,fP,_P,EP,mP,gP,SP,TP,RP,vP,yP,CP,bP,Oi,xt=(HD=Se({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),WD=Se({argsMap:(e,t)=>[e.getTrackId(),t]}),KD=Kt(),zD=md("LocalAudioTrack","_enabledMutex"),YD=Se({argsMap:(e,t)=>[e.getTrackId(),t]}),qD=Kt(),XD=md("LocalAudioTrack","_enabledMutex"),JD=Se({argsMap:(e,t)=>[e.getTrackId(),t]}),QD=Kt(),ZD=Kt(),$D=Kt(),eP=Se({argsMap:e=>[e.getTrackId()]}),tP=Kt(),iP=Se({argsMap:e=>[e.getTrackId()]}),rP=Kt(),aP=Se({argsMap:e=>[e.getTrackId()]}),nP=Se({argsMap:(e,t)=>[e.getTrackId(),t.name]}),sP=Se({argsMap:e=>[e.getTrackId()]}),Fe((wt=class extends id{get _source(){return this.initWebAudio()}set _source(e){this._trackSource=e}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?vr.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(e,t,i,r){super(e,i),W(this,"trackMediaType",Ld.AUDIO),W(this,"_encoderConfig",void 0),W(this,"_trackSource",void 0),W(this,"_enabled",!0),W(this,"_volume",100),W(this,"_useAudioElement",!0),W(this,"_bypassWebAudio",!1),W(this,"processor",void 0),W(this,"_processorContext",void 0),W(this,"_processorDestination",void 0),W(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=t,this._getOriginVolumeLevel=!!r,this._trackSource=new Wv,k("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),k("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),Li()&&!Yr?setTimeout(()=>this.initWebAudio()):this.initWebAudio()}setVolume(e){nt(e,"volume",0,1e3),this._volume=e,this._source.setVolume(e/100),this._useAudioElement&&vr.setVolume(this.getTrackId(),e);try{if(this._bypassWebAudio)return void R.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));let t=this._source.createOutputTrack();this._mediaStreamTrack!==t&&(this._mediaStreamTrack=t,lt(this,ce.NEED_REPLACE_TRACK,this).then(()=>{R.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(i=>{R.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),i)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(e){if(!this._useAudioElement||!TV())throw new H(A.NOT_SUPPORTED,"your browser does not support setting the audio output device");await vr.setSinkID(this.getTrackId(),e)}async setEnabled(e,t,i){return this._setEnabled(e,t,i)}async _setEnabled(e,t,i){if(!i){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(R.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){this._originMediaStreamTrack.enabled=!0;try{i||(this._enabled=!0),await lt(this,ce.NEED_ENABLE_TRACK,this),R.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(e," success"))}catch(r){throw i||(this._enabled=!1),R.error("[".concat(this.getTrackId(),"] setEnabled to true error"),r.toString()),r}}else{this._originMediaStreamTrack.enabled=!1,i||(this._enabled=!1);try{await lt(this,ce.NEED_DISABLE_TRACK,this)}catch(r){throw i||(this._enabled=!0),R.error("[".concat(this.getTrackId(),"] setEnabled to false error"),r.toString()),r}}}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,R.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await lt(this,ce.NEED_MUTE_TRACK,this):await lt(this,ce.NEED_UNMUTE_TRACK,this))}getStats(){return Do(()=>{R.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),ga(this,ce.GET_STATS)||At({},Fv)}setAudioFrameCallback(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners($r.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners($r.ON_AUDIO_BUFFER),this._source.on($r.ON_AUDIO_BUFFER,i=>e(i))}play(){R.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(R.debug("[".concat(this.getTrackId(),"] start audio playback in element")),vr.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){R.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?vr.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];R.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&vr.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(e,t){this._originMediaStreamTrack!==e&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),t&&this._originMediaStreamTrack.stop()),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:e,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await lt(this,ce.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(e))}renewMediaStreamTrack(e){return ae.resolve(void 0)}pipe(e){if(this._bypassWebAudio)throw new H(A.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===e)return e;if(e._source)throw new H(A.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(!this.processor)return;let t=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(e){e.on(fr.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(t),await lt(this,ce.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await lt(this,ce.NEED_REPLACE_TRACK,this))}),e.on(fr.ON_NODE,t=>{this._source.processedNode=t})}unbindProcessorDestinationEvents(e){e.removeAllListeners(fr.ON_TRACK),e.removeAllListeners(fr.ON_NODE)}bindProcessorContextEvents(e){e.on(ta.REQUEST_CONSTRAINTS,async t=>{t(this._originMediaStreamTrack.getSettings())})}unbindProcessorContextEvents(e){e.removeAllListeners(ta.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof Wv&&(this._trackSource=new AV(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){let e=new UV(this._source.context,this.getTrackId(),"local"),t=new MV(e);return this._processorContext=e,this._processorDestination=t,this.bindProcessorContextEvents(e),this.bindProcessorDestinationEvents(t),this._source.on($r.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:e})}),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(vr.stop(this.getTrackId()),this._source.play()),lt(this,ce.NEED_REPLACE_MIXING_TRACK,this).then(()=>{R.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))}).catch(i=>{R.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),i)})),{processorContext:e,processorDestination:t}}}).prototype,"setVolume",[HD],Object.getOwnPropertyDescriptor(wt.prototype,"setVolume"),wt.prototype),Fe(wt.prototype,"setPlaybackDevice",[WD,KD],Object.getOwnPropertyDescriptor(wt.prototype,"setPlaybackDevice"),wt.prototype),Fe(wt.prototype,"setEnabled",[zD,YD,qD],Object.getOwnPropertyDescriptor(wt.prototype,"setEnabled"),wt.prototype),Fe(wt.prototype,"setMuted",[XD,JD,QD],Object.getOwnPropertyDescriptor(wt.prototype,"setMuted"),wt.prototype),Fe(wt.prototype,"getStats",[ZD],Object.getOwnPropertyDescriptor(wt.prototype,"getStats"),wt.prototype),Fe(wt.prototype,"setAudioFrameCallback",[$D],Object.getOwnPropertyDescriptor(wt.prototype,"setAudioFrameCallback"),wt.prototype),Fe(wt.prototype,"play",[eP,tP],Object.getOwnPropertyDescriptor(wt.prototype,"play"),wt.prototype),Fe(wt.prototype,"stop",[iP,rP],Object.getOwnPropertyDescriptor(wt.prototype,"stop"),wt.prototype),Fe(wt.prototype,"close",[aP],Object.getOwnPropertyDescriptor(wt.prototype,"close"),wt.prototype),Fe(wt.prototype,"pipe",[nP],Object.getOwnPropertyDescriptor(wt.prototype,"pipe"),wt.prototype),Fe(wt.prototype,"unpipe",[sP],Object.getOwnPropertyDescriptor(wt.prototype,"unpipe"),wt.prototype),wt),EE=(oP=Se({argsMap:(e,t)=>[e.getTrackId(),t]}),cP=Kt(),lP=md("MicrophoneAudioTrack","_enabledMutex"),dP=Se({argsMap:(e,t,i)=>[e.getTrackId(),t,i]}),uP=Kt(),hP=Se({argsMap:e=>[e.getTrackId()]}),Fe((Pn=class extends xt{get __className__(){return"MicrophoneAudioTrack"}constructor(e,t,i,r){super(e,t.encoderConfig?fE(t.encoderConfig):{},r,k("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),W(this,"_config",void 0),W(this,"_deviceName","default"),W(this,"_constraints",void 0),W(this,"_originalConstraints",void 0),W(this,"_enabled",!0),this._config=t,this._constraints=i,this._originalConstraints=i,this._deviceName=e.label,typeof t.bypassWebAudio=="boolean"&&(this._bypassWebAudio=t.bypassWebAudio),(Ed()||Nv())&&it.bindInterruptDetectorTrack(this)}async setDevice(e){if(R.info("[".concat(this.getTrackId(),"] start set device to ").concat(e)),this._enabled)try{let t=await ea.getDeviceById(e),i={};i.audio=At({},this._constraints),i.audio.deviceId={exact:e},this._originMediaStreamTrack.stop();let r=null;try{r=await Qr(i,this.getTrackId())}catch(a){throw R.error("[".concat(this.getTrackId(),"] setDevice failed"),a.toString()),r=await Qr({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(r.getAudioTracks()[0],!1),a}await this._updateOriginMediaStreamTrack(r.getAudioTracks()[0],!1),this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(t){throw R.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}else try{let t=await ea.getDeviceById(e);this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(t){throw R.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}R.info("[".concat(this.getTrackId(),"] set device to ").concat(e," success"))}async setEnabled(e,t,i){if(t)return R.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(e);if(!i){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(R.info("[".concat(this.getTrackId(),"] start setEnabled"),e),k("AUTO_RESET_AUDIO_ROUTE")&&(pr()||Qa())){let c=navigator.audioSession;c&&(e||(c.type="playback"),c.type="auto")}if(!e){var r;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(r=this._source.clonedTrack)===null||r===void 0||r.stop(),i||(this._enabled=!1);try{await lt(this,ce.NEED_DISABLE_TRACK,this)}catch(c){throw R.error("[".concat(this.getTrackId(),"] setEnabled false failed"),c.toString()),c}return}let a=At({},this._constraints),s=ea.searchDeviceIdByName(this._deviceName);s&&!a.deviceId&&(a.deviceId=s);try{i||(this._enabled=!0);let c=await Qr({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(c.getAudioTracks()[0],!1),await lt(this,ce.NEED_ENABLE_TRACK,this)}catch(c){throw i||(this._enabled=!1),R.error("[".concat(this.getTrackId(),"] setEnabled true failed"),c.toString()),c}R.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(Ed()||Nv())&&it.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((pr()||Qa())&&this._enabled&&!this._isClosed&&it.duringInterruption){let e=async()=>{it.off(Ri.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(R.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};it.on(Ri.IOS_INTERRUPTION_END,e)}else R.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Pd.TRACK_ENDED)}async renewMediaStreamTrack(e){let t=e||this._constraints,i=ea.searchDeviceIdByName(this._deviceName);if(i&&!t.deviceId&&(t.deviceId=i),this._constraints=t,this._enabled){this._originMediaStreamTrack.stop();let r=await Qr({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(r.getAudioTracks()[0],!0)}}bindProcessorContextEvents(e){super.bindProcessorContextEvents(e),e.on(ta.REQUEST_UPDATE_CONSTRAINTS,async(t,i,r)=>{try{let a=Object.assign({},this._originalConstraints,...t);await this.renewMediaStreamTrack(a),i()}catch(a){r(a)}})}unbindProcessorContextEvents(e){super.unbindProcessorContextEvents(e),e.removeAllListeners(ta.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[oP,cP],Object.getOwnPropertyDescriptor(Pn.prototype,"setDevice"),Pn.prototype),Fe(Pn.prototype,"setEnabled",[lP,dP,uP],Object.getOwnPropertyDescriptor(Pn.prototype,"setEnabled"),Pn.prototype),Fe(Pn.prototype,"close",[hP],Object.getOwnPropertyDescriptor(Pn.prototype,"close"),Pn.prototype),Pn),uJ=(pP=Se({argsMap:(e,t)=>[e.getTrackId(),t,e.duration]}),fP=Kt(),_P=Se({argsMap:e=>[e.getTrackId()]}),EP=Kt(),mP=Se({argsMap:e=>[e.getTrackId()]}),gP=Kt(),SP=Se({argsMap:e=>[e.getTrackId()]}),TP=Kt(),RP=Se({argsMap:e=>[e.getTrackId()]}),vP=Kt(),yP=Se({argsMap:e=>[e.getTrackId()]}),CP=Se({argsMap:e=>[e.getTrackId()]}),bP=Kt(),Fe((Oi=class extends xt{get __className__(){return"BufferSourceAudioTrack"}constructor(e,t,i,r){super(t.createOutputTrack(),i,r),W(this,"source",void 0),W(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=e,this._bufferSource=t,this._bufferSource.on($r.AUDIO_SOURCE_STATE_CHANGE,a=>{this.safeEmit(Pd.SOURCE_STATE_CHANGE,a)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(e){e&&this._bufferSource.updateOptions(e),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(e){this._bufferSource.seekAudioBuffer(e)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(e){nt(e,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(e)}}).prototype,"startProcessAudioBuffer",[pP,fP],Object.getOwnPropertyDescriptor(Oi.prototype,"startProcessAudioBuffer"),Oi.prototype),Fe(Oi.prototype,"pauseProcessAudioBuffer",[_P,EP],Object.getOwnPropertyDescriptor(Oi.prototype,"pauseProcessAudioBuffer"),Oi.prototype),Fe(Oi.prototype,"seekAudioBuffer",[mP,gP],Object.getOwnPropertyDescriptor(Oi.prototype,"seekAudioBuffer"),Oi.prototype),Fe(Oi.prototype,"resumeProcessAudioBuffer",[SP,TP],Object.getOwnPropertyDescriptor(Oi.prototype,"resumeProcessAudioBuffer"),Oi.prototype),Fe(Oi.prototype,"stopProcessAudioBuffer",[RP,vP],Object.getOwnPropertyDescriptor(Oi.prototype,"stopProcessAudioBuffer"),Oi.prototype),Fe(Oi.prototype,"close",[yP],Object.getOwnPropertyDescriptor(Oi.prototype,"close"),Oi.prototype),Fe(Oi.prototype,"setAudioBufferPlaybackSpeed",[CP,bP],Object.getOwnPropertyDescriptor(Oi.prototype,"setAudioBufferPlaybackSpeed"),Oi.prototype),Oi),hi=class jV extends xt{get __className__(){return"MixingAudioTrack"}get isActive(){for(let t of this.trackList)if(t._enabled&&!t._isClosed&&!t.muted)return!0;return!1}constructor(){let t=kd().createMediaStreamDestination();super(t.stream.getAudioTracks()[0],void 0,ft(8,"track-mix-")),W(this,"trackList",void 0),W(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=t,this.trackList=[]}hasAudioTrack(t){return this.trackList.indexOf(t)!==-1}addAudioTrack(t){this.trackList.indexOf(t)===-1?(R.debug("add ".concat(t.getTrackId()," to mixing track")),t._source.outputNode.connect(this.destNode),this.trackList.push(t),this.updateEncoderConfig()):R.debug("track ".concat(t.getTrackId()," is already added"))}removeAudioTrack(t){if(this.trackList.indexOf(t)!==-1){R.debug("remove ".concat(t.getTrackId()," from mixing track"));try{t._source.outputNode.disconnect(this.destNode)}catch{}hE(this.trackList,t),this.updateEncoderConfig()}}updateEncoderConfig(){let t={};this.trackList.forEach(i=>{i._encoderConfig&&((i._encoderConfig.bitrate||0)>(t.bitrate||0)&&(t.bitrate=i._encoderConfig.bitrate),(i._encoderConfig.sampleRate||0)>(t.sampleRate||0)&&(t.sampleRate=i._encoderConfig.sampleRate),(i._encoderConfig.sampleSize||0)>(t.sampleSize||0)&&(t.sampleSize=i._encoderConfig.sampleSize),i._encoderConfig.stereo&&(t.stereo=!0))}),this._encoderConfig=t}_updateRtpTransceiver(t){this._rtpTransceiver!==t&&(this._rtpTransceiver=t,this.trackList.forEach(i=>{i instanceof jV?i.emit(wc.TRANSCEIVER_UPDATED,t):i._updateRtpTransceiver(t)}))}},hJ=class extends bV{set currentState(e){e!==this._currentState&&(this._currentState=e,this.safeEmit($r.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),W(this,"audioBuffer",void 0),W(this,"sourceNode",void 0),W(this,"startPlayTime",0),W(this,"startPlayOffset",0),W(this,"pausePlayTime",0),W(this,"options",void 0),W(this,"currentLoopCount",0),W(this,"currentPlaybackSpeed",100),W(this,"_currentState","stopped"),this.audioBuffer=e,this.options=t,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(e){this.currentState==="stopped"?(this.options=e,this.startPlayOffset=this.options.startPlayTime||0):R.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(e){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=e,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=e))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(e){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=e/100),this.currentPlaybackSpeed=e}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){let e=this.context.createBufferSource();return e.buffer=this.audioBuffer,e.loop=!!this.options.loop,e.connect(this.outputNode),e.playbackRate.value=this.currentPlaybackSpeed/100,e}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}},AP=new Map,cC=class{get rendFrameRate(){if(this.renderStats&&this.renderStats.curTs!==this.renderStats.lastTs){let e=this.renderStats.curTs-this.renderStats.lastTs,t=(this.renderStats.renderNum-this.renderStats.lastRenderNum)/e;return this.renderStats.lastRenderNum=this.renderStats.renderNum,this.renderStats.lastTs=this.renderStats.curTs,t}return 0}get videoElementStatus(){return this._videoElementStatus}set videoElementStatus(e){e!==this._videoElementStatus&&(R.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(e)),this._videoElementStatus=e)}get videoState(){return this._videoState}set videoState(e){var t;e!==this._videoState&&(this._videoState=e,(t=this.onVideoStateChanged)===null||t===void 0||t.call(this,this.videoState))}constructor(e){W(this,"trackId",void 0),W(this,"config",void 0),W(this,"onFirstVideoFrameDecoded",void 0),W(this,"onVideoStateChanged",void 0),W(this,"freezeTimeCounterList",[]),W(this,"renderFreezeAccTime",0),W(this,"isKeepLastFrame",!1),W(this,"timeUpdatedCount",0),W(this,"freezeTime",0),W(this,"playbackTime",0),W(this,"lastTimeUpdatedTime",0),W(this,"autoplayFailed",!1),W(this,"videoTrack",void 0),W(this,"videoElement",void 0),W(this,"cacheVideoElement",void 0),W(this,"renderStats",void 0),W(this,"_videoState",Dn.VideoStateStopped),W(this,"videoElementCheckInterval",void 0),W(this,"videoElementFreezeTimeout",void 0),W(this,"_videoElementStatus",tr.NONE),W(this,"isGettingVideoDimensions",!1),W(this,"startGetVideoDimensions",()=>{let t=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return R.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(t,500)};!this.isGettingVideoDimensions&&t()}),W(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&it.curState==="running"&&(R.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(kN())),VN()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),W(this,"handleVideoEvents",t=>{switch(t.type){case"play":case"playing":this.startGetVideoDimensions(),this.videoElementStatus=tr.PLAYING;break;case"loadeddata":if(this.videoState=Dn.VideoStateStarting,this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=tr.CANPLAY;break;case"stalled":this.videoElementStatus=tr.STALLED;break;case"suspend":this.videoElementStatus=tr.SUSPEND;break;case"pause":this.videoElementStatus=tr.PAUSED,pr()||Qa()||Li()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(R.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=tr.WAITING;break;case"abort":this.videoElementStatus=tr.ABORT;break;case"ended":this.videoElementStatus=tr.ENDED;break;case"emptied":this.videoElementStatus=tr.EMPTIED;break;case"error":{let i=this.videoElement.error;i?(this.videoElementStatus=tr.ERROR,R.error("[".concat(this.trackId,"] media error: ").concat(i.message," (").concat(i.code,")"))):R.debug("[".concat(this.trackId,"] media not been an error."));break}case"timeupdate":{let i=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=i);let r=i-this.lastTimeUpdatedTime,a=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=i,vs.lastVisibleTime<vs.lastHiddenTime||a<vs.lastHiddenTime||a<vs.lastVisibleTime)return;for(r>k("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=r),this.playbackTime+=r;this.playbackTime>=6e3;){this.playbackTime-=6e3;let s=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(s),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),W(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(R.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(kN())),VN()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=e.trackId,this.config=e,e.element instanceof HTMLVideoElement?this.videoElement=e.element:this.videoElement=document.createElement("video"),it.on(Ri.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),it.on(Ri.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var e;return(e=this.videoElement.parentElement)!==null&&e!==void 0?e:void 0}updateConfig(e){this.config=e,this.trackId=e.trackId,e.element!==this.videoElement&&(this.destroy(),this.videoElement=e.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(e){this.videoTrack!==e&&(this.videoTrack=e,this.initVideoElement())}play(e){let t=this.videoElement.play();t&&t.catch&&t.catch(r=>{e&&PV(e,"video",r.message,this.trackId),r.name==="NotAllowedError"?(R.warning("detected video element autoplay failed",r),this.autoplayFailed=!0,this.handleAutoPlayFailed()):R.warning("[".concat(this.trackId,"] play warning: "),r)});let i=Ge();if((i.name==="Safari"&&Number(i.version)===15||Ed())&&t&&t.then){let r=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};t.then(r).catch(r)}}getCurrentFrame(){let e=document.createElement("canvas");e.width=this.videoElement.videoWidth,e.height=this.videoElement.videoHeight;let t=e.getContext("2d");if(!t)return R.error("create canvas context failed!"),new ImageData(2,2);t.drawImage(this.videoElement,0,0,e.width,e.height);let i=t.getImageData(0,0,e.width,e.height);return e.remove(),i}async getCurrentFrameToUint8Array(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,i=document.createElement("canvas");i.width=this.videoElement.videoWidth,i.height=this.videoElement.videoHeight;let r=i.getContext("2d");return r?(r.drawImage(this.videoElement,0,0,i.width,i.height),new ae((a,s)=>{i.toBlob(async c=>{if(i.remove(),c){let l=await BV(c);a({buffer:l,width:i.width,height:i.height})}else s(new H(A.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},e,t<0?.1:t>1?1:t)})):await oC(e)}destroy(){this.renderStats=void 0,it.off(Ri.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),it.off(Ri.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=Dn.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=tr.INIT,!this.videoElementCheckInterval&&(IP.forEach(a=>{this.videoElement.addEventListener(a,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{(function(a){return a!==document.body&&document.body.contains(a)})(this.videoElement)||(this.videoElementStatus=tr.DESTROYED)},1e3),k("ENABLE_VIDEO_FRAME_CALLBACK"))){var e,t;let a,s=()=>{document.visibilityState==="visible"&&(document.removeEventListener("visibilitychange",s),this.videoElementFreezeTimeout=window.setTimeout(c,k("VIDEO_FREEZE_DURATION")))},c=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===Dn.VideoStateDecoding&&(document.visibilityState==="visible"?this.videoState=Dn.VideoStateFrozen:document.addEventListener("visibilitychange",s))},l=(u,h)=>{if(this.videoElementStatus===tr.PLAYING){if(this.renderStats?(this.renderStats.renderNum++,this.renderStats.curTs=h.mediaTime):this.renderStats={lastTs:h.mediaTime,curTs:h.mediaTime,lastRenderNum:0,renderNum:0},a){let m=h.presentationTime-a.presentationTime;this.videoState===Dn.VideoStateStarting&&(this.videoState=Dn.VideoStateDecoding),this.videoState===Dn.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(c,k("VIDEO_FREEZE_DURATION"))),m<k("VIDEO_FREEZE_DURATION")&&this.videoState===Dn.VideoStateFrozen&&(this.videoState=Dn.VideoStateDecoding),m>k("VIDEO_FREEZE_DURATION")&&vs.lastVisibleTime>=vs.lastHiddenTime&&a.timestamp>vs.lastVisibleTime&&a.timestamp>vs.lastHiddenTime&&(this.renderFreezeAccTime+=m)}a=At(At({},h),{},{timestamp:u})}var p,_;k("ENABLE_VIDEO_FRAME_CALLBACK")&&((p=(_=this.videoElement).requestVideoFrameCallback)===null||p===void 0||p.call(_,l))};(e=(t=this.videoElement).requestVideoFrameCallback)===null||e===void 0||e.call(t,l)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),qE()&&!k("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");let i=Ge();i.name==="Safari"&&Number(i.version)===15||Ed()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Bt()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Bt()&&this.videoElement.load());let r=this.videoElement.play();r!==void 0&&r.catch(a=>{R.debug("[".concat(this.trackId,"] playback interrupted"),a.toString())})}resetVideoElement(){IP.forEach(e=>{this.videoElement&&this.videoElement.removeEventListener(e,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=tr.NONE}handleAutoPlayFailed(){let e=t=>{t.preventDefault(),this.videoElement.play().then(()=>{R.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(i=>{R.error(i)}),this.autoplayFailed=!1,Mh()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};Mh()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),DV()}},IP=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"],FV=class extends cC{constructor(e){super(e),W(this,"container",void 0),W(this,"slot",void 0),this.slot=e.element,this.updateConfig(e)}updateConfig(e){this.config=e,this.trackId=e.trackId;let t=e.element;t!==this.slot&&(this.destroy(),this.slot=t),this.createElements()}updateVideoTrack(e){this.videoTrack!==e&&(this.videoTrack=e,this.createElements())}play(e){var t;(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)&&super.play(e)}getCurrentFrame(){var e;return(e=this.container)!==null&&e!==void 0&&e.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(e){var t;let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(e,i):await oC(e)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{this.container.remove(),this.slot.removeChild(this.container)}catch{}this.container=void 0}}createElements(){this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",k("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),this.slot.appendChild(this.container)}mountedVideoElement(){var e;!this.container||(e=this.container)!==null&&e!==void 0&&e.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var e;if((e=this.container)!==null&&e!==void 0&&e.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var e;(e=this.container)!==null&&e!==void 0&&e.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}},OP,wP,NP,DP,PP,LP,kP,MP,UP,xP,VP,BP,jP,FP,GP,HP,WP,KP,zP,YP,qP,XP,JP,QP,Ue,ZP,$P,eL,tL,iL,rL,aL,nL,zr,St=(OP=Se({argsMap:(e,t,i)=>[e.getTrackId(),typeof t=="string"?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",i]}),wP=Kt(),NP=Se({argsMap:e=>[e.getTrackId()]}),DP=md("LocalVideoTrack","_enabledMutex"),PP=Se({argsMap:(e,t)=>[e.getTrackId(),t]}),LP=Kt(),kP=md("LocalVideoTrack","_enabledMutex"),MP=Se({argsMap:(e,t)=>[e.getTrackId(),t]}),UP=Kt(),xP=Se({argsMap:(e,t)=>[e.getTrackId(),t]}),VP=Kt(),BP=Kt(),jP=Se({argsMap:(e,t,i)=>[e.getTrackId(),t,i]}),FP=Kt(),GP=Kt(),HP=Kt(),WP=Kt(),KP=Kt(),zP=Kt(),YP=Kt(),qP=Se({argsMap:(e,t)=>[e.getTrackId(),t.name]}),XP=Se({argsMap:e=>[e.getTrackId()]}),JP=Se({argsMap:e=>[e.getTrackId()]}),QP=Se({argsMap:(e,t,i)=>[e.getTrackId(),t.label,i]}),Ue=class GV extends id{get videoHeight(){if(Li()){let{height:t}=this._mediaStreamTrack.getSettings();return this._videoHeight=t,this._videoHeight}return this._videoHeight}get videoWidth(){if(Li()){let{width:t}=this._mediaStreamTrack.getSettings();return this._videoWidth=t,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==tr.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(t){this._processorContext=t}get __className__(){return"LocalVideoTrack"}constructor(t,i,r,a,s,c){if(super(t,s),W(this,"trackMediaType",Ld.VIDEO),W(this,"_player",void 0),W(this,"isUseScaleResolutionDownBy",!1),W(this,"_videoVisibleTimer",null),W(this,"_previousVideoVisibleStatus",void 0),W(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),W(this,"_encoderConfig",void 0),W(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),W(this,"_optimizationMode",void 0),W(this,"_videoHeight",void 0),W(this,"_videoWidth",void 0),W(this,"_forceBitrateLimit",void 0),W(this,"_enabled",!0),W(this,"_processorDestination",void 0),W(this,"_processorContext",void 0),Li()){let{width:l,height:u}=t.getSettings();this._videoWidth=l,this._videoHeight=u}else this.updateMediaStreamTrackResolution();if(this._encoderConfig=i,this._scalabilityMode=r,this._optimizationMode=a,this._hints=c||[],this._hints.indexOf(Rt.SCREEN_TRACK)===-1)this.updateBitrateFromProfile();else if(function(l,u,h){let p=Ge();return!(p.name!==l||!p.osVersion)&&Number(p.version)===u}(Ze.CHROME,115)&&YE().indexOf("Windows")!==-1){let l=function(u,h){if("VideoFrame"in window&&"TransformStream"in window&&Ke().supportWebRTCInsertableStream){let p=new MediaStreamTrackProcessor(u),_=new MediaStreamTrackGenerator({kind:"video"}),m,S,C=Date.now(),v=()=>{y&&(clearInterval(y),y=void 0),m&&(m.close(),m=void 0),u.stop(),S=void 0,_.removeEventListener("ended",v)},y=window.setInterval(()=>{if(S&&m&&Date.now()-C>1e3)try{_.readyState==="live"?S.enqueue(m.clone()):v()}catch{v()}},1e3),I=new TransformStream({transform:(O,P)=>{_.readyState==="live"?(S=P,C=Date.now(),m===void 0?(m=O,P.enqueue(O.clone())):(P.enqueue(m),m=O)):O.close()}});return _.addEventListener("ended",v),p.readable.pipeThrough(I).pipeTo(_.writable),_}}(t);l&&(R.info("local screen video track begin to inject frame"),this._mediaStreamTrack=l)}i&&this._hints.indexOf(Rt.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(i),this._processorContext=new kV(this.getTrackId(),"local"),this._processorDestination=new LV(this.processorContext),this.bindProcessorDestinationEvents()}play(t){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof t=="string"){let a=document.getElementById(t);a?t=a:(R.warning("[".concat(this.getTrackId(),'] can not find "#').concat(t,'" element, use document.body')),t=document.body)}R.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(i));let r=At(At(At({},this._getDefaultPlayerConfig()),i),{},{trackId:this.getTrackId(),element:t});this._player?this._player.updateConfig(r):(t instanceof HTMLVideoElement?this._player=new cC(r):this._player=new FV(r),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{let a=this.getVideoElementVisibleStatus();this.safeEmit(Pd.VIDEO_ELEMENT_VISIBLE_STATUS,a)}catch{}},k("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,R.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(t,i){if(!i){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(R.info("[".concat(this.getTrackId(),"] start setEnabled"),t),!t){this._originMediaStreamTrack.enabled=!1;try{await lt(this,ce.NEED_DISABLE_TRACK,this)}catch(r){throw R.error("[".concat(this.getTrackId(),"] setEnabled to false error"),r.toString()),r}return i||(this._enabled=!1),void R.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await lt(this,ce.NEED_ENABLE_TRACK,this)}catch(r){throw R.error("[".concat(this.getTrackId(),"] setEnabled to true error"),r.toString()),r}R.info("[".concat(this.getTrackId(),"] setEnabled to true success")),i||(this._enabled=!0)}async setMuted(t){t!==this._muted&&(this.stateCheck("muted",t),this._muted=t,this._originMediaStreamTrack.enabled=!t,R.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(t)),t?await lt(this,ce.NEED_MUTE_TRACK,this):await lt(this,ce.NEED_UNMUTE_TRACK,this))}async setEncoderConfiguration(t,i){if(!this._enabled)throw new H(A.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(t=Hn(t),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin),t.width||t.height||t.frameRate){let r=_E({encoderConfig:t});(Li()||pr()||Qa())&&(r.deviceId=void 0),R.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t),JSON.stringify(r));try{await this._originMediaStreamTrack.applyConstraints(r),this.updateMediaStreamTrackResolution()}catch(a){let s=new H(A.UNEXPECTED_ERROR,a.toString());throw R.error("[".concat(this.getTrackId(),"] applyConstraints error"),s.toString()),s}}this._encoderConfig=t,this._hints.indexOf(Rt.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await lt(this,ce.NEED_UPDATE_VIDEO_ENCODER,this)}catch(r){return r.throw(R)}}getStats(){return Do(()=>{R.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),ga(this,ce.GET_STATS)||At({},Gv)}async setBeautyEffect(t){R.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(t){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(t,i):await oC(t)}async setBitrateLimit(t){if(R.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(t))),t){this._forceBitrateLimit=t,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<t.max_bitrate?this._encoderConfig.bitrateMax:t.max_bitrate:this._encoderConfig.bitrateMax=t.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=t.min_bitrate);try{await lt(this,ce.NEED_UPDATE_VIDEO_ENCODER,this)}catch(i){return i.throw(R)}}}async setOptimizationMode(t){if(t!=="motion"&&t!=="detail"&&t!=="balanced")return void R.error(A.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");let i=this._optimizationMode;try{this._optimizationMode=t,await lt(this,ce.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(r){throw this._optimizationMode=i,R.error("[".concat(this.getTrackId(),"] set optimization mode failed"),r.toString()),r}R.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(t,")"))}setScalabiltyMode(t){if(t.numSpatialLayers===1&&t.numTemporalLayers!==1)return R.error(A.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=t,R.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(t,")"))}updateMediaStreamTrackResolution(){xV(this._originMediaStreamTrack).then(t=>{let[i,r]=t;this._videoHeight=r,this._videoWidth=i}).catch(QE)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(t){if(!this._enabled)throw new H(A.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");R.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(t)),t=Hn(t),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin),this._encoderConfig=t,this._hints.indexOf(Rt.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await lt(this,ce.NEED_UPDATE_VIDEO_ENCODER,this)}catch(i){return i.throw(R)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;let{width:t,height:i,frameRate:r}=this.getMediaStreamTrackSettings();if(!t||!i||!r)return;let{bitrateMax:a,bitrateMin:s}=this._encoderConfig;if(s==null||a==null){let{max:c,min:l}=function(u,h,p,_,m){let S=k("BITRATE_ADAPTER_TYPE");if(S==="DEFAULT_BITRATE")return{min:_,max:m};if(m===void 0){var C;let y=Math.floor(200*Math.pow(p/15,.6)*Math.pow(u*h/640/360,.75));m=S==="STANDARD_BITRATE"?4*y:2*y,_=(C=_)!==null&&C!==void 0?C:y}else{var v;_=(v=_)!==null&&v!==void 0?v:Math.floor(m/10)}return{min:_,max:m}}(t,i,r,s,a);this._encoderConfig.bitrateMin=l,this._encoderConfig.bitrateMax=c,R.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(t,", h: ").concat(i,", fps: ").concat(r,"] => [brMax: ").concat(c,", brMin: ").concat(l,"]"))}}getVideoElementVisibleStatus(){try{var t,i;let r=this==null||(t=this._player)===null||t===void 0?void 0:t.getContainerElement(),a={track:this,element:this==null||(i=this._player)===null||i===void 0?void 0:i.getVideoElement(),slot:r==null?void 0:r.parentElement},{element:s,slot:c}=a;if(this.isPlaying&&s instanceof HTMLVideoElement&&c instanceof HTMLElement){let l=Jx.checkOneElementVisible(s),u=Object.assign({},l);if(u.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=u.visible;let h=fe.reportApiInvoke(null,{tag:Vt.TRACER,name:ni.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});u.visible?h.onSuccess("Video is visible"):h.onSuccess("Invisible because of ".concat(u.reason))}return u}return}catch(r){throw new H(A.GET_VIDEO_ELEMENT_VISIBLE_ERROR,r.message)}}async renewMediaStreamTrack(t){}pipe(t){if(this.processor===t)return t;if(t._source)throw new H(A.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),t}unpipe(){if(!this.processor)return;let t=this.processor;this.processor._source=void 0,this.processor=void 0,t.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(t){let i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],r=this._encoderConfig;t&&(r=At(At({},r),Hn(t))),r=Rc(r);let a=ft(8,"track-video-cloned-"),s=new GV(i?this._mediaStreamTrack.clone():this._mediaStreamTrack,r,Rc(this._scalabilityMode),this._optimizationMode,a,Rc(this._hints));return t&&r&&s.setEncoderConfiguration(r),R.debug("clone video track from ".concat(this.getTrackId()," to ").concat(a,", clone ").concat(i)),s}async replaceTrack(t,i){if(!(t instanceof MediaStreamTrack))throw new H(A.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(t.kind!=="video")throw new H(A.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(t,i,!0),this.updateMediaStreamTrackResolution()}sendSeiData(t){if(Do(()=>{fe.reportApiInvoke(null,{name:ni.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:Vt.TRACER}).onSuccess("")},this._mediaStreamTrack.id||this.getTrackId()),!k("ENABLE_VIDEO_SEI")||!k("ENABLE_ENCODED_TRANSFORM"))return void R.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(t instanceof Uint8Array==0)return new H(A.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();let i=this.getRTCRtpTransceiver();if(!i)return void R.warning("Video track is not published, SEI can not be send");let r=i.sender.getParameters();if(r.codecs.length===0)return;let a=r.codecs[0].mimeType.toLocaleLowerCase();a==="video/h264"?this.safeEmit("sei-to-send",t):R.warning("SEI is not supported by ".concat(a))}bindProcessorDestinationEvents(){this.processorDestination.on(fr.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(),await lt(this,ce.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await lt(this,ce.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(fr.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(ta.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(ta.REQUEST_CONSTRAINTS)}},Fe(Ue.prototype,"play",[OP,wP],Object.getOwnPropertyDescriptor(Ue.prototype,"play"),Ue.prototype),Fe(Ue.prototype,"stop",[NP],Object.getOwnPropertyDescriptor(Ue.prototype,"stop"),Ue.prototype),Fe(Ue.prototype,"setEnabled",[DP,PP,LP],Object.getOwnPropertyDescriptor(Ue.prototype,"setEnabled"),Ue.prototype),Fe(Ue.prototype,"setMuted",[kP,MP,UP],Object.getOwnPropertyDescriptor(Ue.prototype,"setMuted"),Ue.prototype),Fe(Ue.prototype,"setEncoderConfiguration",[xP,VP],Object.getOwnPropertyDescriptor(Ue.prototype,"setEncoderConfiguration"),Ue.prototype),Fe(Ue.prototype,"getStats",[BP],Object.getOwnPropertyDescriptor(Ue.prototype,"getStats"),Ue.prototype),Fe(Ue.prototype,"setBeautyEffect",[jP,FP],Object.getOwnPropertyDescriptor(Ue.prototype,"setBeautyEffect"),Ue.prototype),Fe(Ue.prototype,"getCurrentFrameData",[GP],Object.getOwnPropertyDescriptor(Ue.prototype,"getCurrentFrameData"),Ue.prototype),Fe(Ue.prototype,"getCurrentFrameImage",[HP],Object.getOwnPropertyDescriptor(Ue.prototype,"getCurrentFrameImage"),Ue.prototype),Fe(Ue.prototype,"setBitrateLimit",[WP],Object.getOwnPropertyDescriptor(Ue.prototype,"setBitrateLimit"),Ue.prototype),Fe(Ue.prototype,"setOptimizationMode",[KP],Object.getOwnPropertyDescriptor(Ue.prototype,"setOptimizationMode"),Ue.prototype),Fe(Ue.prototype,"setScalabiltyMode",[zP],Object.getOwnPropertyDescriptor(Ue.prototype,"setScalabiltyMode"),Ue.prototype),Fe(Ue.prototype,"updateMediaStreamTrackResolution",[YP],Object.getOwnPropertyDescriptor(Ue.prototype,"updateMediaStreamTrackResolution"),Ue.prototype),Fe(Ue.prototype,"pipe",[qP],Object.getOwnPropertyDescriptor(Ue.prototype,"pipe"),Ue.prototype),Fe(Ue.prototype,"unpipe",[XP],Object.getOwnPropertyDescriptor(Ue.prototype,"unpipe"),Ue.prototype),Fe(Ue.prototype,"close",[JP],Object.getOwnPropertyDescriptor(Ue.prototype,"close"),Ue.prototype),Fe(Ue.prototype,"replaceTrack",[QP],Object.getOwnPropertyDescriptor(Ue.prototype,"replaceTrack"),Ue.prototype),Ue),Kv=(ZP=Se({argsMap:(e,t)=>[e.getTrackId(),t]}),$P=Kt(),eL=md("CameraVideoTrack","_enabledMutex"),tL=Se({argsMap:(e,t)=>[e.getTrackId(),t]}),iL=Kt(),rL=Se({argsMap:(e,t)=>[e.getTrackId(),t]}),aL=Kt(),nL=Se({argsMap:e=>[e.getTrackId()]}),zr=class HV extends St{get __className__(){return"CameraVideoTrack"}constructor(t,i,r,a,s,c){super(t,Hn(i.encoderConfig),a,s,c),W(this,"_config",void 0),W(this,"_originalConstraints",void 0),W(this,"_constraints",void 0),W(this,"_enabled",!0),W(this,"_deviceName","default"),W(this,"tryResumeVideoForIOS15_16WeChat",async()=>{(Ed()||Nv())&&!function(){let l=Ge();if(l.os!==pi.IOS||!l.osVersion)return!1;let u=l.osVersion.split(".");return Number(u[0])===15&&Number(u[1])>=2}()&&Yx()&&this._enabled&&!this._isClosed&&(R.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=i,this._originalConstraints=r,this._constraints=r,this._deviceName=t.label,this._encoderConfig=Hn(this._config.encoderConfig),it.on(Ri.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),it.on(Ri.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(t){return typeof t=="string"?this._setDeviceById(t):t.deviceId?this._setDeviceById(t.deviceId):t.facingMode?this._setDeviceByFacingModel(t.facingMode):void 0}async _setDeviceById(t){if(R.info("[".concat(this.getTrackId(),"] set device to ").concat(t)),this._enabled)try{let i=await ea.getDeviceById(t),r={};r.video=At({},this._constraints),r.video.deviceId={exact:t},r.video.facingMode=void 0,this._originMediaStreamTrack.stop();let a=null;try{a=await Qr(r,this.getTrackId())}catch(s){throw R.error("[".concat(this.getTrackId(),"] setDevice failed"),s.toString()),a=await Qr({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(a.getVideoTracks()[0],!1),s}await this._updateOriginMediaStreamTrack(a.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=i.label,this._config.cameraId=t,this._constraints.deviceId={exact:t}}catch(i){throw R.error("[".concat(this.getTrackId(),"] setDevice error"),i.toString()),i}else try{let i=await ea.getDeviceById(t);this._deviceName=i.label,this._config.cameraId=t,this._constraints.deviceId={exact:t}}catch(i){throw R.error("[".concat(this.getTrackId(),"] setDevice error"),i.toString()),i}R.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(t){R.info("[".concat(this.getTrackId(),"] set facingMode ").concat(t));let i={video:At(At({},this._constraints),{},{deviceId:void 0,facingMode:{exact:t}})};if(this._enabled){this._originMediaStreamTrack.stop();let r=null;try{r=await Qr(i,this.getTrackId())}catch(a){throw R.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),a.toString()),r=await Qr({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1),a}await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=t,this._config.cameraId=void 0,this._constraints=At({},i.video),R.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(t,i){if(!i){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(R.info("[".concat(this.getTrackId(),"] start setEnabled"),t),t){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{let r=await Qr({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1)}await lt(this,ce.NEED_ENABLE_TRACK,this)}catch(r){throw R.error("[".concat(this.getTrackId(),"] setEnabled true error"),r.toString()),r}this.updateMediaStreamTrackResolution(),R.info("[".concat(this.getTrackId(),"] setEnabled to true success")),i||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),i||(this._enabled=!1);try{await lt(this,ce.NEED_DISABLE_TRACK,this)}catch(r){throw R.error("[".concat(this.getTrackId(),"] setEnabled to false error"),r.toString()),r}R.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(t,i){if(!this._enabled)throw new H(A.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");t=Hn(t),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate||t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate||t.bitrateMin);let r=Xt(this._config);r.encoderConfig=t;let a=_E(r);(Li()||pr()||Qa())&&(a.deviceId=void 0),R.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t),JSON.stringify(a));try{await this._originMediaStreamTrack.applyConstraints(a),this.updateMediaStreamTrackResolution()}catch(s){let c=new H(A.UNEXPECTED_ERROR,s.toString());throw R.error("[".concat(this.getTrackId(),"] applyConstraints error"),c.toString()),c}this._config=r,this._constraints=a,this._originalConstraints=a,this._encoderConfig=t,this._hints.indexOf(Rt.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await lt(this,ce.NEED_UPDATE_VIDEO_ENCODER,this)}catch(s){return s.throw(R)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((pr()||Qa())&&this._enabled&&!this._isClosed&&it.duringInterruption){let t=async()=>{it.off(Ri.IOS_INTERRUPTION_END,t),this._enabled&&!this._isClosed&&(R.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};it.on(Ri.IOS_INTERRUPTION_END,t)}else R.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Pd.TRACK_ENDED)}async renewMediaStreamTrack(t){let i=t||this._constraints,r=ea.searchDeviceIdByName(this._deviceName);if(r&&!i.deviceId&&(i.deviceId={exact:r}),this._enabled){let a=await Qr({video:i},this.getTrackId());this._constraints=i,await this._updateOriginMediaStreamTrack(a.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),it.off(Ri.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),it.off(Ri.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(t){let i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],r=this._encoderConfig;t&&(r=At(At({},r),Hn(t))),r=Rc(r);let a=ft(8,"track-cam-cloned-"),s=new HV(i?this._mediaStreamTrack.clone():this._mediaStreamTrack,Rc(At(At({},this._config),{},{encoderConfig:r})),Rc(this._constraints),Rc(this._scalabilityMode),this._optimizationMode,a);return t&&r&&s.setEncoderConfiguration(r),R.debug("clone track from ".concat(this.getTrackId()," to ").concat(a,", clone ").concat(i)),s}bindProcessorContextEvents(){this.processorContext.on(ta.REQUEST_UPDATE_CONSTRAINTS,async(t,i,r)=>{try{let a=Object.assign({},this._originalConstraints,...t);await this.renewMediaStreamTrack(a),i()}catch(a){r(a)}}),this.processorContext.on(ta.REQUEST_CONSTRAINTS,async t=>{t(this._originMediaStreamTrack.getSettings())})}},Fe(zr.prototype,"setDevice",[ZP,$P],Object.getOwnPropertyDescriptor(zr.prototype,"setDevice"),zr.prototype),Fe(zr.prototype,"setEnabled",[eL,tL,iL],Object.getOwnPropertyDescriptor(zr.prototype,"setEnabled"),zr.prototype),Fe(zr.prototype,"setEncoderConfiguration",[rL,aL],Object.getOwnPropertyDescriptor(zr.prototype,"setEncoderConfiguration"),zr.prototype),Fe(zr.prototype,"close",[nL],Object.getOwnPropertyDescriptor(zr.prototype,"close"),zr.prototype),zr);function pR(e,t,i,r){i.optimizationMode&&(r&&r.width&&r.height?(i.encoderConfig=At(At({},r),{},{bitrateMin:r.bitrateMin,bitrateMax:r.bitrateMax}),i.optimizationMode!=="motion"&&i.optimizationMode!=="detail"||(t.contentHint=i.optimizationMode,t.contentHint===i.optimizationMode?R.debug("[".concat(e,"] set content hint to"),i.optimizationMode):R.debug("[".concat(e,"] set content hint failed")))):R.warning("[".concat(e,"] can not apply optimization mode bitrate config, no encoderConfig")))}var sL,oL,cL,lL,da,dL,uL,hL,pL,fL,_L,Zi,WV=class extends yV{getUserId(){return this._userId}constructor(e,t,i,r){super(e,"track-".concat(e.kind,"-").concat(t,"-").concat(r.clientId,"_").concat(ft(5,""))),W(this,"_userId",void 0),W(this,"_uintId",void 0),W(this,"_isDestroyed",!1),W(this,"store",void 0),W(this,"processor",void 0),W(this,"processorContext",void 0),this._userId=t,this._uintId=i,this.store=r}_updateOriginMediaStreamTrack(e){this._originMediaStreamTrack=e,this._mediaStreamTrack=e,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,R.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}},cd=(sL=Se({argsMap:(e,t,i)=>[e.getTrackId(),typeof t=="string"?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",i]}),oL=Se({argsMap:e=>[e.getTrackId()]}),cL=Se({argsMap:(e,t)=>[e.getTrackId(),t.name]}),lL=Se({argsMap:e=>[e.getTrackId()]}),Fe((da=class extends WV{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==tr.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(e,t,i,r){super(e,t,i,r),W(this,"_videoVisibleTimer",null),W(this,"_previousVideoVisibleStatus",void 0),W(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),W(this,"trackMediaType",Ld.VIDEO),W(this,"_videoWidth",void 0),W(this,"_videoHeight",void 0),W(this,"_player",void 0),W(this,"processorDestination",void 0),W(this,"processorContext",void 0),this.updateMediaStreamTrackResolution(),this.processorContext=new kV(this.getTrackId(),"remote"),this.processorDestination=new LV(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return Do(()=>{R.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),ga(this,ce.GET_STATS)||At({},vV)}play(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof e=="string"){let r=document.getElementById(e);r?e=r:(R.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}R.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(t));let i=At(At({fit:"cover"},t),{},{trackId:this.getTrackId(),element:e});this._player?this._player.updateConfig(i):(e instanceof HTMLVideoElement?this._player=new cC(i):this._player=new FV(i),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(od.FIRST_FRAME_DECODED)},this._player.onVideoStateChanged=r=>{this.safeEmit(od.VIDEO_STATE_CHANGED,r)}),this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{let r=this.getVideoElementVisibleStatus();this.safeEmit(od.VIDEO_ELEMENT_VISIBLE_STATUS,r)}catch{}},k("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,R.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){xV(this._originMediaStreamTrack).then(e=>{let[t,i]=e;this._videoHeight=i,this._videoWidth=t}).catch(QE)}_updatePlayerSource(){R.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var e,t;let i=this==null||(e=this._player)===null||e===void 0?void 0:e.getContainerElement(),r={track:this,element:this==null||(t=this._player)===null||t===void 0?void 0:t.getVideoElement(),slot:i==null?void 0:i.parentElement},{element:a,slot:s}=r;if(this.isPlaying&&a instanceof HTMLVideoElement&&s instanceof HTMLElement){let c=Jx.checkOneElementVisible(a),l=Object.assign({},c);if(l.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=l.visible;let u=fe.reportApiInvoke(null,{tag:Vt.TRACER,name:ni.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});l.visible?u.onSuccess("Video is visible"):u.onSuccess("Invisible because of ".concat(l.reason))}return l}return}catch(i){throw new H(A.GET_VIDEO_ELEMENT_VISIBLE_ERROR,i.message)}}pipe(e){if(this.processor===e)return e;if(e._source)throw new H(A.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;let e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(fr.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(fr.ON_TRACK)}_destroy(){super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(e){this.emit(wc.SEI_RECEIVED,e)}}).prototype,"play",[sL],Object.getOwnPropertyDescriptor(da.prototype,"play"),da.prototype),Fe(da.prototype,"stop",[oL],Object.getOwnPropertyDescriptor(da.prototype,"stop"),da.prototype),Fe(da.prototype,"pipe",[cL],Object.getOwnPropertyDescriptor(da.prototype,"pipe"),da.prototype),Fe(da.prototype,"unpipe",[lL],Object.getOwnPropertyDescriptor(da.prototype,"unpipe"),da.prototype),da),ld=(dL=Se({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),uL=Se({argsMap:(e,t)=>[e.getTrackId(),t]}),hL=Se({argsMap:e=>[e.getTrackId()]}),pL=Se({argsMap:e=>[e.getTrackId()]}),fL=Se({argsMap:(e,t)=>[e.getTrackId(),t.name]}),_L=Se({argsMap:e=>[e.getTrackId()]}),Fe((Zi=class extends WV{get isPlaying(){return this._useAudioElement?vr.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(e,t,i,r){super(e,t,i,r),W(this,"trackMediaType",Ld.AUDIO),W(this,"_source",void 0),W(this,"_useAudioElement",!0),W(this,"_volume",100),W(this,"processorContext",void 0),W(this,"processorDestination",void 0),W(this,"_played",!1),W(this,"_bypassWebAudio",!1),k("DISABLE_WEBAUDIO")?(this._source=new Wv,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new AV(e,!0),k("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once($r.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(od.FIRST_FRAME_DECODED)}),this.processorContext=new UV(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new MV(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on($r.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners($r.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners($r.ON_AUDIO_BUFFER),this._source.on($r.ON_AUDIO_BUFFER,i=>e(i))}setVolume(e){this._volume=e,this._useAudioElement?vr.setVolume(this.getTrackId(),e):this._source.setVolume(e/100)}async setPlaybackDevice(e){if(!this._useAudioElement||!TV())throw new H(A.NOT_SUPPORTED,"your browser does not support setting the audio output device");await vr.setSinkID(this.getTrackId(),e)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return Do(()=>{R.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),ga(this,ce.GET_STATS)||At({},RV)}play(){R.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(R.debug("[".concat(this.getTrackId(),"] use audio element to play")),vr.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){R.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?vr.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];R.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&vr.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(e){if(this._bypassWebAudio)throw new H(A.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===e)return e;if(e._source)throw new H(A.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(this._bypassWebAudio)throw new H(A.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;let t=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(fr.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on(fr.ON_NODE,e=>{this._source.processedNode=e;let t=!e;this._useAudioElement!==t&&(this._played?(this.stop(),this._useAudioElement=t,this.play()):this._useAudioElement=t)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(fr.ON_TRACK),this.processorDestination.removeAllListeners(fr.ON_NODE)}}).prototype,"setVolume",[dL],Object.getOwnPropertyDescriptor(Zi.prototype,"setVolume"),Zi.prototype),Fe(Zi.prototype,"setPlaybackDevice",[uL],Object.getOwnPropertyDescriptor(Zi.prototype,"setPlaybackDevice"),Zi.prototype),Fe(Zi.prototype,"play",[hL],Object.getOwnPropertyDescriptor(Zi.prototype,"play"),Zi.prototype),Fe(Zi.prototype,"stop",[pL],Object.getOwnPropertyDescriptor(Zi.prototype,"stop"),Zi.prototype),Fe(Zi.prototype,"pipe",[fL],Object.getOwnPropertyDescriptor(Zi.prototype,"pipe"),Zi.prototype),Fe(Zi.prototype,"unpipe",[_L],Object.getOwnPropertyDescriptor(Zi.prototype,"unpipe"),Zi.prototype),Zi),vs=new class extends Lt{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),W(this,"_lastHiddenTime",0),W(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),R.debug("document visibility went ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}},KV=class extends Lt{constructor(e,t){super(),W(this,"trackMediaType",Ld.DATA),W(this,"_version",1),W(this,"_type",3),W(this,"_config",void 0),W(this,"_originDataChannel",void 0),W(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),W(this,"_dataStreamPacketHandler",{serialize:i=>i,deserialize:i=>i}),W(this,"_datachannelEventMap",new Map),this._config=e,t&&(this._originDataChannel=t,this._bandDataChannelEvents(t)),this._initPacketHeader()}useDataStream(e){this._dataStreamPacketHandler=e}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return k("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var e,t;return(e=(t=this._originDataChannel)===null||t===void 0?void 0:t.readyState)!==null&&e!==void 0?e:"connecting"}get _originDataChannelId(){var e,t;return(e=(t=this._originDataChannel)===null||t===void 0?void 0:t.id)!==null&&e!==void 0?e:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new ae((e,t)=>{if(this._originDataChannel){this._originDataChannel.readyState==="open"&&e();let i=setTimeout(()=>{var r;t(new H(A.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat((r=this._originDataChannel)===null||r===void 0?void 0:r.id)))},1e4);this._originDataChannel.onopen=()=>{clearTimeout(i),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),e()},this._originDataChannel.onerror=()=>{throw clearTimeout(i),new H(A.DATACHANNEL_CONNECTION_TIMEOUT)}}else t(new H(A.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})}_updateOriginDataChannel(e){this._originDataChannel=e,this._bandDataChannelEvents(e)}_initPacketHeader(){let e=new DataView(this._dataStreamPacketHeader);e.setUint16(0,this._version),e.setUint8(2,this._type),e.setUint8(3,this._config.id)}_bandDataChannelEvents(e){this._unbindDataChannelEvents(e),[H_.OPEN,H_.CLOSE,H_.ERROR].forEach(t=>{let i=()=>{this.emit(t)};this._datachannelEventMap.set(t,i),e.addEventListener(t,i)})}_unbindDataChannelEvents(e){Array.from(this._datachannelEventMap.entries()).forEach(t=>{let[i,r]=t;e.removeEventListener(i,r)}),this._datachannelEventMap.clear()}},pJ=class extends KV{constructor(e){super(e),W(this,"_messageListener",void 0),this._messageListener=t=>{if(t.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);let i=t.data.slice(0,this._dataStreamPacketHeader.byteLength),r=new DataView(i).getUint8(3);if(r!==this.id)return void(k("SHOW_DATASTREAM2_LOG")&&R.debug("invalid datachannel id: ".concat(r," !== ").concat(this.id)));let a=t.data.slice(this._dataStreamPacketHeader.byteLength);a=this._dataStreamPacketHandler.deserialize(a),this.emit(H_.MESSAGE,a)}}_updateOriginDataChannel(e){super._updateOriginDataChannel(e),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}},fJ=class extends KV{send(e){if(this._originDataChannel){let t=e;t=this._dataStreamPacketHandler.serialize(e);let i=new Uint8Array(this._dataStreamPacketHeader.byteLength+t.byteLength);i.set(new Uint8Array(this._dataStreamPacketHeader),0),i.set(new Uint8Array(t),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(i.buffer)}}};function K_(){let e=new Blob([atob("ZnVuY3Rpb24gZShlLHQsbil7bGV0IHI9bmV3IFVpbnQ4QXJyYXkoZSx0LG4pLGE9W10sbz0wO2Zvcig7YS5sZW5ndGg8bjspbyszPG4mJjA9PT1yW29dJiYwPT09cltvKzFdJiYzPT09cltvKzJdJiYoMD09PXJbbyszXXx8MT09PXJbbyszXXx8Mj09PXJbbyszXXx8Mz09PXJbbyszXSk/KGEucHVzaChyW29dLHJbbysxXSxyW28rM10pLG8rPTQpOihhLnB1c2gocltvXSksbysrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkoYSl9ZnVuY3Rpb24gdChlLHQpe2NvbnN0IG49ZnVuY3Rpb24oZSl7Y29uc3QgdD1lLmxlbmd0aDtsZXQgbj1bXSxyPTA7Zm9yKDtyPHQ7KXIrMjx0JiYwPT09ZVtyXSYmMD09PWVbcisxXSYmKDA9PT1lW3IrMl18fDE9PT1lW3IrMl18fDI9PT1lW3IrMl18fDM9PT1lW3IrMl0pPyhuLnB1c2goZVtyXSxlW3IrMV0sMyxlW3IrMl0pLHIrPTMpOihuLnB1c2goZVtyXSkscisrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkobil9KHQpLHI9bi5sZW5ndGgsYT1NYXRoLmZsb29yKHIvMjU1KSxvPXIlMjU1LHM9bmV3IFVpbnQ4QXJyYXkoNithKzErcitlLmJ5dGVMZW5ndGgpO3NbMF09MCxzWzFdPTAsc1syXT0wLHNbM109MSxzWzRdPTYsc1s1XT0xMDE7bGV0IGk9MDtmb3IoO2k8YTspc1s2K2ldPTI1NSxpKys7cmV0dXJuIHNbNitpXT1vLGkrKyxzLnNldChuLDYraSkscy5zZXQobmV3IFVpbnQ4QXJyYXkoZSksNitpK3IpLHMuYnVmZmVyfW5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZigiU2FmYXJpIik+LTEmJi0xPT09bmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCJDaHJvbWUiKSYmKHNlbGYub25ydGN0cmFuc2Zvcm09bj0+e2NvbnN0IHI9bi50cmFuc2Zvcm1lcjtsZXQgYT1bXTtyLm9wdGlvbnMucG9ydC5vbm1lc3NhZ2U9ZT0+e2UuZGF0YS5zZWkmJmEucHVzaChlLmRhdGEuc2VpKX0sc2VsZi5wb3N0TWVzc2FnZSgic3RhcnRlZCIpO2NvbnN0IG89ci5yZWFkYWJsZS5nZXRSZWFkZXIoKSxzPXIud3JpdGFibGUuZ2V0V3JpdGVyKCk7InJ4Ij09PXIub3B0aW9ucy5uYW1lP2Z1bmN0aW9uIHQobil7by5yZWFkKCkudGhlbigocj0+e2lmKCFyLmRvbmUpe2lmKHIudmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkVmlkZW9GcmFtZSl7Y29uc3QgdD1mdW5jdGlvbih0KXtjb25zdCBuPW5ldyBEYXRhVmlldyh0LmRhdGEpO2xldCByPTA7Zm9yKDtyKzQ8dC5kYXRhLmJ5dGVMZW5ndGg7KXtpZigwPT09bi5nZXRVaW50OChyKzApJiYwPT09bi5nZXRVaW50OChyKzEpJiYwPT09bi5nZXRVaW50OChyKzIpJiYxPT09bi5nZXRVaW50OChyKzMpJiY2PT09bi5nZXRVaW50OChyKzQpKXtsZXQgYT1yKzYsbz0wLHM9MDtmb3IoOzI1NT09PShzPW4uZ2V0VWludDgoYSsrKSk7KW8rPTI1NTtvKz1zO2NvbnN0IGk9ZSh0LmRhdGEsYSxvKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkoaSl9cisrfXJldHVybiBudWxsfShyLnZhbHVlKTt0JiZuLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7c2VpOnR9KX1zLndyaXRlKHIudmFsdWUpLG4ub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQobil9fSkpfShyKToidHgiPT09ci5vcHRpb25zLm5hbWUmJmZ1bmN0aW9uIGUobil7by5yZWFkKCkudGhlbigocj0+e2lmKCFyLmRvbmUpe2lmKHIudmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkVmlkZW9GcmFtZSl7Y29uc3QgZT1hLnNoaWZ0KCk7ZSYmKHIudmFsdWUuZGF0YT10KHIudmFsdWUuZGF0YSxlKSl9cy53cml0ZShyLnZhbHVlKSxuLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSxlKG4pfX0pKX0ocil9LHNlbGYucG9zdE1lc3NhZ2UoInJlZ2lzdGVyZWQiKSk7Cg==")],{type:"text/javascript"});return setTimeout(()=>xD.revokeObjectURL(e),0),new Worker(xD.createObjectURL(e))}var s_=new Map,o_=new Map;function _J(e,t,i){let r=new Uint8Array(e,t,i),a=[],s=0;for(;a.length<i;)s+3<i&&r[s]===0&&r[s+1]===0&&r[s+2]===3&&(r[s+3]===0||r[s+3]===1||r[s+3]===2||r[s+3]===3)?(a.push(r[s],r[s+1],r[s+3]),s+=4):(a.push(r[s]),s++);return new Uint8Array(a)}var c_=new Map;async function EJ(e,t){if(!Ke().supportWebRTCEncodedTransform)return void R.warning("browser not support video encoded transform");if(c_.has(e)||!e.track)return;let i={track:e.track};if(Co()){if(!e.createEncodedStreams)return void R.warning("browser not support createEncodedStreams() API");let a=null;try{a=e.createEncodedStreams()}catch(l){return void R.error("create video-encoded-streams error",l&&l.message)}let s=[];t.on("sei-to-send",l=>{s.push(l)});let c=new TransformStream({transform(l,u){i.controller||(i.controller=u),e.track&&e.track.id!==i.track.id&&(R.debug("video track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",r),i.track=e.track,i.track.addEventListener("ended",r));let h=s.shift();h&&(l.data=function(p,_){let m=function(O){let P=O.length,U=[],x=0;for(;x<P;)x+2<P&&O[x]===0&&O[x+1]===0&&(O[x+2]===0||O[x+2]===1||O[x+2]===2||O[x+2]===3)?(U.push(O[x],O[x+1],3,O[x+2]),x+=3):(U.push(O[x]),x++);return new Uint8Array(U)}(_),S=m.length,C=Math.floor(S/255),v=S%255,y=new Uint8Array(6+C+1+S+p.byteLength);y[0]=0,y[1]=0,y[2]=0,y[3]=1,y[4]=6,y[5]=101;let I=0;for(;I<C;)y[6+I]=255,I++;return y[6+I]=v,I++,y.set(m,6+I),y.set(new Uint8Array(p),6+I+S),y.buffer}(l.data,h)),u.enqueue(l)}});a.readable.pipeThrough(c).pipeTo(a.writable)}else{if(!Li())return;{if(typeof RTCRtpScriptTransform>"u")return void R.warning("browser not support RTCRtpScriptTransform");let a=K_(),s=new MessageChannel;await new ae(l=>a.onmessage=u=>{u.data==="registered"&&l(void 0)});let c=new RTCRtpScriptTransform(a,{name:"tx",port:s.port2},[s.port2]);e.transform=c,await new ae(l=>a.onmessage=u=>{u.data==="started"&&l(void 0)}),t.on("sei-to-send",l=>{s.port1.postMessage({sei:l})}),s.port1.onmessage=l=>{var u;l.data.transformed&&e.track&&((u=e.track)===null||u===void 0?void 0:u.id)!==i.track.id&&(R.debug("video track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",r),i.track=e.track,i.track.addEventListener("ended",r))},i.worker=a}}function r(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",r)}let a=c_.get(e);if(a){c_.delete(e);try{var s,c;(s=a.controller)===null||s===void 0||s.terminate(),(c=a.worker)===null||c===void 0||c.terminate()}catch(l){R.warning(l&&l.message)}}}c_.set(e,i),e.track.addEventListener("ended",r)}var Ju=new Map;(function(){let e=Ge();gi.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),gi.getStreamFromExtension=e.name===Ze.CHROME&&Number(e.version)>34,gi.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;let t=new RTCPeerConnection,i=!1;try{t.addTransceiver("audio"),i=!0}catch{}return t.close(),i}(),gi.supportMinBitrate=e.name===Ze.CHROME||e.name===Ze.EDGE,gi.supportSetRtpSenderParameters=function(){let t=Ge();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!No()||!(!Li()&&!uE())||t.name===Ze.FIREFOX&&Number(t.version)>=64)}(),e.name===Ze.SAFARI&&(Number(e.version)>=14?gi.supportDualStream=!0:gi.supportDualStream=!1),gi.webAudioMediaStreamDest=function(){let t=Ge();return!(t.name===Ze.SAFARI&&Number(t.version)<12)}(),gi.supportReplaceTrack=!!window.RTCRtpSender&&typeof RTCRtpSender.prototype.replaceTrack=="function",gi.supportWebGL=typeof WebGLRenderingContext<"u",gi.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,No()||(gi.webAudioWithAEC=!0),gi.supportShareAudio=function(){let t=Ge();return(t.os===pi.WIN_10||t.os===pi.WIN_81||t.os===pi.WIN_7||t.os===pi.LINUX||t.os===pi.MAC_OS||t.os===pi.CHROMIUM_OS)&&t.name===Ze.CHROME&&Number(t.version)>=74}(),gi.supportDataChannel=!!(wv(76)||function(t){let i=Ge();return!(i.name!==Ze.FIREFOX||!i.osVersion)&&Number(i.version)>=t}(68)||Wx(14)),gi.supportPCSetConfiguration=function(){let t=window.RTCPeerConnection;return!Bt()&&!!t&&t.prototype.setConfiguration instanceof Function}(),gi.supportWebRTCEncodedTransform=function(){let t=Ge();return t.name==="Chrome"&&Number(t.version)>=86||t.name==="Safari"&&Number(t.version)>=15}(),gi.supportWebRTCInsertableStream=function(){let t=Ge();return(t.name===Ze.CHROME||t.name===Ze.EDGE)&&Number(t.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),gi.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,gi.supportWebCrypto=typeof window<"u"&&window.crypto!==void 0&&window.crypto.subtle!==void 0,JE(()=>{gi.supportDualStreamEncoding=function(){let t=Ge();return!!k("DISABLE_WEBAUDIO")||t.name==="Safari"&&Number(t.version)>=14||!!(t.name==="Chrome"&&/Windows/i.test(t.os||"")&&Number(t.version)>=100&&k("CHROME_DUAL_STREAM_USE_ENCODING"))}(),R.info("browser compatibility",JSON.stringify(gi),JSON.stringify(e))})})();var mE=class zv extends Lt{constructor(t,i){super(),b(this,"signal",void 0),b(this,"token",void 0),b(this,"tokenTimeout",void 0),b(this,"tokenInterval",void 0),b(this,"_sequence",0),b(this,"userMap",new Map),b(this,"encoder",new TextEncoder),this.signal=t,this.token=i;let r=()=>{this.signal.connectionState===pt.CONNECTED&&this.check(),this.userMap.size===0?this.tokenInterval=window.setTimeout(r,1e3):this.tokenInterval=window.setTimeout(r,3*k("P2P_TOKEN_INTERVAL"))};r()}async send(t,i,r,a,s){var c,l,u;if(this.userMap.size===0)return;let h=Array.from(Ns(c=this.userMap).call(c))[0].token;typeof i!="string"&&(i=JSON.stringify(i)),a=(l=a)!==null&&l!==void 0?l:ft(6,""),s=(u=s)!==null&&u!==void 0?u:this._sequence++;let p={_id:a,_type:t,_seq:s,_message:i,token:"".concat(this.token,"_").concat(h)};k("SHOW_P2P_LOG")&&R.debug("send message",p,"noNeedResponse : ".concat(r)),this.splitMessage(JSON.stringify(p)).forEach(m=>{this.signal.request(ve.DATA_STREAM,{payload:bo(this.encoder.encode(m))})});let _=new ae((m,S)=>{let C=window.setTimeout(()=>{this.off("res-@".concat(a,"_ack"),v),this.off("res-@".concat(a),I),this.off(Dl.ABORT,y),R.debug("[external-signal] request timeout, type: ".concat(t,", requestId: ").concat(a)),this.userMap.size===0?S(new H(A.INVALID_REMOTE_USER)):S(new H(A.TIMEOUT))},k("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),v=()=>{C&&window.clearTimeout(C),this.off(Dl.ABORT,y),r&&m()},y=()=>{C&&window.clearTimeout(C),this.off("res-@".concat(a,"_ack"),v),this.off("res-@".concat(a),I),S(new H(A.EXTERNAL_SIGNAL_ABORT,"type: ".concat(t,", requestId: ").concat(a)))};this.once(Dl.ABORT,y),this.once("res-@".concat(a,"_ack"),v);let I=(P,U)=>{O=!0,C&&window.clearTimeout(C),this.off("res-@".concat(a,"_ack"),v),this.off(Dl.ABORT,y),P==="success"?m(U):S(new H(A.P2P_MESSAGE_FAILED,"request ".concat(t," failed, requestId: ").concat(a)))},O=!1;r||(this.once("res-@".concat(a),I),yi(k("SIGNAL_REQUEST_TIMEOUT")).then(()=>{O||R.warning("external_signal request timeout, type: ".concat(t,", requestId: ").concat(a,", ").concat(p))}))});try{return await _}catch(m){if(m.code===A.TIMEOUT)return await this.send(t,i,r,a,s);throw m}}onMessage(t){var i;let{_uid:r}=t,a,s=this.userMap.get(r);if(s)a=s.splitMessageMap;else{if(this.userMap.size>0||!("_type"in t)||t._type!==Gt.CHECK)return;let{token:h}=t;a=new Map,s={uid:r,isStart:!0,token:h,splitMessageMap:a,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(r,s),this.signal.emit(Le.ON_USER_ONLINE,{uid:r}),this.handleUserOnline()}if("id"in t&&"total"in t){var c;let{id:h,total:p}=t,_=(c=a.get(h))!==null&&c!==void 0?c:[];if(_.push(t),a.has(h)||a.set(h,_),_.length!==p)return;{let m=cp(_).call(_,(S,C)=>S.index-C.index).map(S=>S.payload).join("");a.delete(h),(t=JSON.parse(m))._uid=r}}let{_type:l,token:u}=t;if(oe(i=[Gt.ACK,Gt.CHECK]).call(i,l))return l===Gt.CHECK&&this.handleCheckToken(s,u),void this.receiveMessage(t);u==="".concat(s.token,"_").concat(this.token)?this.handleReceivedMessage(t):R.debug('Receive unexpected message", '.concat(u,", cur_token: ").concat(s.token,"_").concat(this.token),t)}check(){let t={_id:ft(6,""),token:this.token,_type:Gt.CHECK};k("SHOW_P2P_LOG")&&R.debug("send message",t),this.signal.request(ve.DATA_STREAM,{payload:bo(this.encoder.encode(JSON.stringify(t)))})}ack(t){let i={_id:t,_type:Gt.ACK,token:this.token};k("SHOW_P2P_LOG")&&R.debug("send message",i),this.signal.request(ve.DATA_STREAM,{payload:bo(this.encoder.encode(JSON.stringify(i)))})}response(t,i,r){this.send(Gt.RESPONSE,JSON.stringify({success:!r,message:i}),!0,t)}handleReceivedMessage(t){let i=()=>{this.userMap.forEach(h=>{let{receivedMessagesMap:p,nextExpectedSequenceNumber:_}=h;for(;p.has(_);){let m=p.get(_);p.delete(_),this.receiveMessage(m),h.nextExpectedSequenceNumber++}})};if(!t)return void i();let{_uid:r,_seq:a}=t,s=this.userMap.get(r),{receivedMessagesMap:c,isStart:l,nextExpectedSequenceNumber:u}=s;if(a<u)return this.ack(t._id),void R.debug("[external-signal] receive old message, seq: ".concat(a,", ").concat(t._message));c.set(a,t),l&&a===u&&(this.receiveMessage(t),c.delete(u),s.nextExpectedSequenceNumber++,i())}receiveMessage(t){let{_id:i,_type:r,_message:a,_uid:s}=t;if(k("SHOW_P2P_LOG")&&R.debug("receive message",t),i){let c;switch(t._type!==Gt.ACK&&(a&&(c=JSON.parse(a)),this.ack(t._id)),t._type){case Gt.CANDIDATE:case Gt.CONTROL:this.signal.emit(r,c,s);break;case Gt.PUBLISH:case Gt.UNPUBLISH:case Gt.RESTART_ICE:case Gt.CALL:c.uid=s,ki(this.signal,r,c).then(l=>{this.response(t._id,l)}).catch(()=>{this.response(t._id,void 0,!0)});break;case Gt.ACK:this.getListeners("res-@".concat(i,"_ack")).length>0&&this.emit("res-@".concat(i,"_ack"));break;case Gt.RESPONSE:{let{success:l,message:u}=c;this.emit("res-@".concat(i),l?"success":"failed",u);break}}}}splitMessage(t){if(t.length<zv.MAX_MESSAGE_SIZE)return[t];let i=[],{remoteToken:r}=JSON.parse(t),a=ft(6,""),s=0,c=800,l=Math.ceil(t.length/c);for(;t.length>0;){s++;let u={id:a,index:s,total:l,payload:t.slice(0,c),token:"".concat(this.token,"_").concat(r)};JSON.stringify(u).length>zv.MAX_MESSAGE_SIZE?c-=50:(i.push(u),t=t.slice(c))}return i.map(u=>JSON.stringify(u))}handleCheckToken(t,i){return t.token!==i?(R.debug("token changed, from ".concat(t.token," to ").concat(i)),this.reset(t.uid,i),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout(()=>{R.debug("token timeout, ".concat(i)),this.reset(t.uid)},k("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){let t=await ki(this.signal,Gt.CALL,void 0),i=await this.send(Gt.CALL,t);this.signal.emit(ye.P2P_CONNECTION,i,!0)}async reset(t,i){let r=this.userMap.get(t);r&&(this.emit(Dl.ABORT),this.signal.emit(Le.ON_USER_OFFLINE,{uid:r.uid,reason:P9.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),i||(R.debug("change local token from ".concat(i," to ").concat(i)),this.token=ft(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(Dl.ABORT)}};b(mE,"MAX_SIZE",1),b(mE,"MAX_MESSAGE_SIZE",1024);var EL=class extends Lt{get connectionState(){return this._connectionState}set connectionState(e){e!==this._connectionState&&(this._connectionState=e,e===pt.CONNECTED?this.emit(ye.WS_CONNECTED):e===pt.RECONNECTING?this.emit(ye.WS_RECONNECTING,this._websocketReconnectReason):e===pt.CLOSED&&this.emit(ye.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(e,t){super(),b(this,"_disconnectedReason",void 0),b(this,"_websocketReconnectReason",void 0),b(this,"_connectionState",pt.CLOSED),b(this,"reconnectToken",void 0),b(this,"p2pToken",void 0),b(this,"websocket",void 0),b(this,"openConnectionTime",void 0),b(this,"clientId",void 0),b(this,"lastMsgTime",Date.now()),b(this,"uploadCache",[]),b(this,"uploadCacheInterval",void 0),b(this,"rttRolling",new iV(5)),b(this,"pingpongTimer",void 0),b(this,"pingpongTimeoutCount",0),b(this,"joinResponse",void 0),b(this,"multiIpOption",void 0),b(this,"initError",void 0),b(this,"spec",void 0),b(this,"store",void 0),b(this,"_external_signal",void 0),b(this,"onWebsocketMessage",i=>{if(i.data instanceof ArrayBuffer)return void this.emit(ye.ON_BINARY_DATA,i.data);let r=JSON.parse(i.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(r,"_id")){let a="res-@".concat(r._id);this.emit(a,r._result,r._message)}else if(Object.prototype.hasOwnProperty.call(r,"_type")){switch(r._type){case Le.ON_DATA_STREAM:return void this.handleDataStream(r._message);case Le.MUTE_AUDIO:case Le.MUTE_VIDEO:case Le.ON_P2P_LOST:case Le.ON_USER_ONLINE:return;case Le.ON_USER_OFFLINE:let{uid:a}=r._message;return R.debug("[".concat(this.clientId,"] user-offline uid: ").concat(a)),void this._external_signal.reset(a)}if(this.emit(r._type,r._message),r._type===Le.ON_NOTIFICATION&&this.handleNotification(r._message),r._type===Le.ON_USER_BANNED)switch(r._message.error_code){case 14:this.close(tt.UID_BANNED);break;case 15:this.close(tt.IP_BANNED);break;case 16:this.close(tt.CHANNEL_BANNED)}if(r._type===Le.ON_USER_LICENSE_BANNED)switch(r._message.error_code){case me.ERR_LICENSE_MISSING:this.close(tt.LICENSE_MISSING);break;case me.ERR_LICENSE_EXPIRED:this.close(tt.LICENSE_EXPIRED);break;case me.ERR_LICENSE_MINUTES_EXCEEDED:this.close(tt.LICENSE_MINUTES_EXCEEDED);break;case me.ERR_LICENSE_PERIOD_INVALID:this.close(tt.LICENSE_PERIOD_INVALID);break;case me.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(tt.LICENSE_MULTIPLE_SDK_SERVICE);break;case me.ERR_LICENSE_ILLEGAL:this.close(tt.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=e.clientId,this.spec=e,this.store=t,this.websocket=new eC("gateway-".concat(this.clientId),this.spec.retryConfig,!0,k("JOIN_GATEWAY_USE_DUAL_DOMAIN"),k("JOIN_GATEWAY_USE_443PORT_ONLY"),t),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===pt.CONNECTED&&this.reconnect("retry",Pi.OFFLINE)}),this.p2pToken=ft(6,""),this._external_signal=new mE(this,this.p2pToken)}async request(e,t,i,r){let a=ft(6,""),s={_id:a,_type:e,_message:t},c=this.websocket.connectionID,l=()=>new ae((S,C)=>{if(this.connectionState===pt.CONNECTED)return S();let v=()=>{this.off(ye.WS_CLOSED,y),S()},y=()=>{this.off(ye.WS_CONNECTED,v),C(new H(A.WS_ABORT))};this.once(ye.WS_CONNECTED,v),this.once(ye.WS_CLOSED,y)});if(this.connectionState!==pt.CONNECTING&&this.connectionState!==pt.RECONNECTING||e===ve.JOIN||e===ve.REJOIN||await l(),this.websocket.sendMessage(s,!0),r)return;let u=new ae((S,C)=>{let v=!1,y=(O,P)=>{v=!0,S({isSuccess:O==="success",message:P||{}}),this.off(ye.WS_CLOSED,I),this.off(ye.WS_RECONNECTING,I),this.emit(ye.REQUEST_SUCCESS,e,t)};this.once("res-@".concat(a),y);let I=()=>{C(new H(A.WS_ABORT,"type: ".concat(e))),this.off(ye.WS_CLOSED,I),this.off(ye.WS_RECONNECTING,I),this.off("res-@".concat(a),y)};this.once(ye.WS_CLOSED,I),this.once(ye.WS_RECONNECTING,I),yi(k("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==c||v||(R.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(e)),this.emit(ye.REQUEST_TIMEOUT,e,t))})}),h=null;try{h=await u}catch(S){if(this.connectionState===pt.CLOSED||e===ve.LEAVE)throw new H(A.WS_ABORT);return!this.spec.forceWaitGatewayResponse||i?S.throw():e===ve.JOIN||e===ve.REJOIN?null:(await l(),await this.request(e,t))}if(h.isSuccess)return h.message;let p=Number(h.message.error_code||h.message.code),_=Vh(p),m=new H(A.UNEXPECTED_RESPONSE,"".concat(_.desc,": ").concat(h.message.error_str),{code:p,data:h.message,desc:_.desc});return _.action==="success"?h.message:(R.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(e,", error_code: ").concat(p,", message: ").concat(_.desc,", action: ").concat(_.action)),p===me.ERR_TOO_MANY_BROADCASTERS?((e===ve.JOIN||e===ve.REJOIN)&&(this.initError=m,this.close()),m.throw()):_.action==="failed"?m.throw():_.action==="quit"?(this.initError=m,this.close(),m.throw()):(p===me.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=h.message.option,R.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Pi.MULTI_IP)):this.reconnect(_.action,Pi.SERVER_ERROR),e===ve.JOIN||e===ve.REJOIN?null:await this.request(e,t)))}waitMessage(e,t){return new ae(i=>{let r=a=>{(!t||t(a))&&(this.off(e,r),i(a))};this.on(e,r)})}uploadWRTCStats(e){if(!this.store.sessionId)return void R.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));let t={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:e};this.upload(xh.WRTC_STATS,t)}upload(e,t){let i={_type:e,_message:t};try{this.websocket.sendMessage(i)}catch{let r=k("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(i),this.uploadCache.length>r&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==pt.CONNECTED)return;let a=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(a._type,a._message)},k("UPLOAD_CACHE_INTERVAL")||2e3))}}send(e,t){let i={_type:e,_message:t};this.websocket.sendMessage(i)}async sendExtensionMessage(e,t,i){return await this._external_signal.send(e,t,i)}init(e){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new ae((t,i)=>{this.once(ye.WS_CONNECTED,()=>t(this.joinResponse)),this.once(ye.WS_CLOSED,()=>i(this.initError||new H(A.WS_ABORT))),this.connectionState=pt.CONNECTING,this.websocket.init(e).catch(i)})}close(e){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=e||tt.LEAVE,this.connectionState=pt.CLOSED,R.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),this.p2pToken=ft(6,""),this._external_signal.clear(),this._external_signal=new mE(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit(ye.ABORT_P2P_EXECUTION);let e=await ki(this,ye.REQUEST_JOIN_INFO),t=await this.request(ve.JOIN,e);if(!t)return this.emit(ye.REPORT_JOIN_GATEWAY,A.TIMEOUT,this.url||""),!1;this.joinResponse=t,this.emit(ye.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=pt.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(e,t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(e,t)}handleDataStream(e){try{var t;let i=vc(e.payload),r=new TextDecoder().decode(i),a=JSON.parse(r);"total"in a&&"id"in a||oe(t=Object.values(Gt)).call(t,a._type)?(a._uid=e.uid,this._external_signal.onMessage(a)):this.emit(Le.ON_DATA_STREAM,e)}catch{this.emit(Le.ON_DATA_STREAM,e)}}handleNotification(e){R.debug("[".concat(this.clientId,"] receive notification: "),e);let t=Vh(e.code);if(t.action!=="success"){if(t.action!=="failed")return t.action==="quit"?(t.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(tt.UID_BANNED),void this.close()):void this.reconnect(t.action,Pi.SERVER_ERROR);R.error("[".concat(this.clientId,"] ignore error: "),t.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;let e=k("PING_PONG_TIME_OUT"),t=Date.now();this.pingpongTimeoutCount>=e&&(R.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(t-this.lastMsgTime,"ms")),t-this.lastMsgTime>k("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Pi.TIMEOUT):this.request(ve.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;let i=Date.now()-t;this.rttRolling.add(i),k("REPORT_STATS")&&this.send(ve.PING_BACK,{pingpongElapse:i})}).catch(i=>{})}handleWebsocketEvents(){this.websocket.on(Ce.RECONNECT_WAITTING_FINISH,e=>{this.emit(ye.WS_RECONNECT_WAITTING_FINISH,e)}),this.websocket.on(Ce.RECONNECT_CREATE_CONNECTION,e=>{this.emit(ye.WS_RECONNECT_CREATE_CONNECTION,e)}),this.websocket.on(Ce.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Ce.CLOSED,()=>{this.connectionState=pt.CLOSED}),this.websocket.on(Ce.FAILED,()=>{this._disconnectedReason=tt.NETWORK_ERROR,this.connectionState=pt.CLOSED}),this.websocket.on(Ce.RECONNECTING,e=>{this._websocketReconnectReason=e,this.joinResponse=void 0,this.connectionState===pt.CONNECTED?this.connectionState=pt.RECONNECTING:this.connectionState=pt.CONNECTING}),this.websocket.on(Ce.WILL_RECONNECT,(e,t,i)=>{e!=="retry"?(R.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(e)),this.reconnectToken=void 0):R.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),i(e)}),this.websocket.on(Ce.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.join().catch(e=>{if(this.emit(ye.REPORT_JOIN_GATEWAY,e,this.url||""),e instanceof H&&e.code===A.UNEXPECTED_RESPONSE&&e.data.code===me.ERR_NO_AUTHORIZED)return R.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",Pi.SERVER_ERROR);R.error("[".concat(this.clientId,"] join gateway request failed"),e.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Pi.SERVER_ERROR):(this.initError=e,this.close())})}),this.websocket.on(Ce.REQUEST_NEW_URLS,(e,t)=>{ki(this,ye.REQUEST_RECOVER,this.multiIpOption).then(e).catch(t)}),this.websocket.on(Ce.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(Le.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}},zV={exports:{}};zV.exports=(()=>{var e={8:(r,a,s)=>{s.r(a),s.d(a,{Parser:()=>q,Printer:()=>ut,parse:()=>K,print:()=>te});let c=`
`,l="".concat("\r").concat(c),u=" ",h;function p(L){return L>="0"&&L<="9"}function _(L){return L>="!"&&L<="~"}function m(L){return _(L)||L>=""&&L<="ÿ"}function S(L){return L==="!"||L>="#"&&L<="'"||L>="*"&&L<="+"||L>="-"&&L<="."||L>="0"&&L<="9"||L>="A"&&L<="Z"||L>="^"&&L<="~"}function C(L){return L>="1"&&L<="9"}function v(L){return L>="A"&&L<="Z"||L>="a"&&L<="z"}function y(L){return L==="d"||L==="h"||L==="m"||L==="s"}function I(L){return L>""&&L<"	"||L>"\v"&&L<"\f"||L>""&&L<"ÿ"}function O(L){return v(L)||p(L)||L==="+"||L==="/"}function P(L){return p(L)||v(L)||L==="+"||L==="/"||L==="-"||L==="_"}function U(L){return v(L)||p(L)||L==="+"||L==="/"}function x(L,g){var w=Object.keys(L);if(Object.getOwnPropertySymbols){var D=Object.getOwnPropertySymbols(L);g&&(D=D.filter(function(F){return Object.getOwnPropertyDescriptor(L,F).enumerable})),w.push.apply(w,D)}return w}function G(L){for(var g=1;g<arguments.length;g++){var w=arguments[g]!=null?arguments[g]:{};g%2?x(Object(w),!0).forEach(function(D){Z(L,D,w[D])}):Object.getOwnPropertyDescriptors?Object.defineProperties(L,Object.getOwnPropertyDescriptors(w)):x(Object(w)).forEach(function(D){Object.defineProperty(L,D,Object.getOwnPropertyDescriptor(w,D))})}return L}function Z(L,g,w){return g in L?Object.defineProperty(L,g,{value:w,enumerable:!0,configurable:!0,writable:!0}):L[g]=w,L}(function(L){L.VERSION="v",L.ORIGIN="o",L.SESSION_NAME="s",L.INFORMATION="i",L.URI="u",L.EMAIL="e",L.PHONE="p",L.CONNECTION="c",L.BANDWIDTH="b",L.TIME="t",L.REPEAT="r",L.ZONE_ADJUSTMENTS="z",L.KEY="k",L.ATTRIBUTE="a",L.MEDIA="m"})(h||(h={}));class J{consumeText(g,w){let D=w;for(;D<g.length;){let F=g[D];if(F==="\0"||F==="\r"||F===c)break;D+=1}if(D-w==0)throw new Error("Invalid text, at ".concat(g));return D}consumeUnicastAddress(g,w,D){return this.consumeTill(g,w,u)}consumeOneOrMore(g,w,D){let F=w;for(;D(g[F]);)F++;if(F-w==0)throw new Error("Invalid rule at ".concat(w,"."));return F}consumeSpace(g,w){if(g[w]===u)return w+1;throw new Error("Invalid space at ".concat(w,"."))}consumeIP4Address(g,w){let D=w;for(let F=0;F<4;F++)if(D=this.consumeDecimalUChar(g,D),F!==3){if(g[D]!==".")throw new Error("Invalid IP4 address.");D++}return D}consumeDecimalUChar(g,w){let D=w;for(let pe=0;pe<3&&p(g[D]);pe++,D++);if(D-w==0)throw new Error("Invalid decimal uchar.");let F=parseInt(g.slice(w,D));if(F>=0&&F<=255)return D;throw new Error("Invalid decimal uchar")}consumeIP6Address(g,w){let D=this.consumeHexpart(g,w);return g[D]===":"&&(D+=1,D=this.consumeIP4Address(g,D)),D}consumeHexpart(g,w){let D=w;if(g[D]===":"&&g[D+1]===":"){D+=2;try{D=this.consumeHexseq(g,D)}catch{}return D}if(D=this.consumeHexseq(g,D),g[D]===":"&&g[D+1]===":"){D+=2;try{D=this.consumeHexseq(g,D)}catch{}return D}return D}consumeHexseq(g,w){let D=w;for(;D=this.consumeHex4(g,D),g[D]===":"&&g[D+1]!==":";)D+=1;return D}consumeHex4(g,w){let D=0;for(;D<4;D++)if(!((F=g[w+D])>="0"&&F<="9"||F>="a"&&F<="f"||F>="A"&&F<="F")){if(D===0)throw new Error("Invalid hex 4");break}var F;return w+D}consumeFQDN(g,w){let D=w;for(;p(g[D])||v(g[D])||g[D]==="-"||g[D]===".";)D+=1;if(D-w<4)throw new Error("Invalid FQDN");return D}consumeExtnAddr(g,w){return this.consumeOneOrMore(g,w,m)}consumeMulticastAddress(g,w,D){switch(D){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(g,w);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(g,w);default:try{return this.consumeFQDN(g,w)}catch{return this.consumeExtnAddr(g,w)}}}consumeIP6MulticastAddress(g,w){let D=this.consumeHexpart(g,w);return g[D]==="/"?this.consumeInteger(g,D+1):D}consumeIP4MulticastAddress(g,w){let D=w+3,F=g.slice(w,D),pe=parseInt(F);if(pe<224||pe>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let Re=0;Re<3;Re++){if(g[D]!==".")throw new Error("Invalid IP4 multicast address.");D+=1,D=this.consumeDecimalUChar(g,D)}return g[D]==="/"&&(D+=1),D=this.consumeTTL(g,D),g[D]==="/"&&(D=this.consumeInteger(g,D)),D}consumeInteger(g,w){if(!C(g[w]))throw new Error("Invalid integer.");for(w+=1;p(g[w]);)w+=1;return w}consumeTTL(g,w){if(g[w]==="0")return w+1;if(!C(g[w]))throw new Error("Invalid TTL.");w+=1;for(let D=0;D<2&&p(g[w]);D++)w+=1;return w}consumeToken(g,w){return this.consumeOneOrMore(g,w,S)}consumeTime(g,w){let D=w;if(g[D]==="0")return D+1;for(C(g[D])&&(D+=1);p(g[D]);)D++;if(D-w<10)throw new Error("Invalid time");return D}consumeAddress(g,w){return this.consumeTill(g,w,u)}consumeTypedTime(g,w){let D=w;return D=this.consumeOneOrMore(g,D,p),y(g[D])?D+1:D}consumeRepeatInterval(g,w){if(!C(g[w]))throw new Error("Invalid repeat interval");for(w+=1;p(g[w]);)w+=1;return y(g[w])&&(w+=1),w}consumePort(g,w){return this.consumeOneOrMore(g,w,p)}consume(g,w,D){for(let F=0;F<D.length;F++){if(w+F>=g.length)throw new Error("consume exceeding value length");if(g[w+F]!==D[F])throw new Error("consume ".concat(D," failed at ").concat(F))}return w+D.length}consumeTill(g,w,D){let F=w;for(;F<g.length&&(typeof D!="string"||g[F]!==D)&&(typeof D!="function"||!D(g[F]));)F++;return F}}class q extends J{constructor(){super(),Z(this,"records",[]),Z(this,"currentLine",0)}parse(g){let w=this.probeEOL(g);this.records=g.split(w).filter(yt=>!!ir(yt).call(yt)).map(this.parseLine),this.currentLine=0;let D=this.parseVersion(),F=this.parseOrigin(),pe=this.parseSessionName(),Re=this.parseInformation(),rt=this.parseUri(),Xe=this.parseEmail(),Ft=this.parsePhone(),Yt=this.parseConnection(),Dr=this.parseBandWidth(),Xi=this.parseTimeFields(),Er=this.parseKey(),rn=this.parseSessionAttribute(),vt=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:D,origin:F,sessionName:pe,information:Re,uri:rt,emails:Xe,phones:Ft,connection:Yt,bandwidths:Dr,timeFields:Xi,key:Er,attributes:rn,mediaDescriptions:vt}}getCurrentRecord(){let g=this.records[this.currentLine];if(!g)throw new Error("Record doesn't exit.");return g}probeEOL(g){for(let w=0;w<g.length;w++)if(g[w]===c)return g[w-1]==="\r"?l:c;throw new Error("Invalid newline character.")}parseLine(g,w){if(g.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");let D=g[0];if(g[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:D,value:g.slice(2),line:w,cur:0}}parseSessionAttribute(){let g=new Ie;for(;this.currentLine<this.records.length;){let w=this.getCurrentRecord();if(w.type!==h.ATTRIBUTE)break;let D={attField:this.extractOneOrMore(w,F=>S(F)&&F!==":"),_cur:0};w.value[w.cur]===":"&&(w.cur+=1,D.attValue=this.extractOneOrMore(w,I)),g.parse(D),this.currentLine++}return g.digest()}parseMediaAttributes(g){let w=new Ve(g);for(;this.currentLine<this.records.length;){let D=this.getCurrentRecord();if(D.type!==h.ATTRIBUTE)break;let F={attField:this.extractOneOrMore(D,pe=>S(pe)&&pe!==":"),_cur:0};D.value[D.cur]===":"&&(D.cur+=1,F.attValue=this.extractOneOrMore(D,I)),w.parse(F),this.currentLine++}return w.digest()}parseKey(){let g=this.getCurrentRecord();if(g.type===h.KEY){if(g.value==="prompt"||g.value==="clear:"||g.value==="base64:"||g.value==="uri:")return g.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){let g=this.getCurrentRecord();if(g.type===h.ZONE_ADJUSTMENTS){let w=[];for(;;)try{let D=this.extract(g,this.consumeTime);this.consumeSpaceForRecord(g);let F=!1;g.value[g.cur]==="-"&&(F=!0,g.cur+=1);let pe=this.extract(g,this.consumeTypedTime);w.push({time:D,typedTime:pe,back:F})}catch{break}if(w.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,w}return[]}parseRepeat(){let g=[];for(;;){let w=this.getCurrentRecord();if(w.type!==h.REPEAT)break;{let D=this.extract(w,this.consumeRepeatInterval),F=this.parseTypedTime(w);g.push({repeatInterval:D,typedTimes:F}),this.currentLine++}}return g}parseTypedTime(g){let w=[];for(;;)try{this.consumeSpaceForRecord(g),w.push(this.extract(g,this.consumeTypedTime))}catch{break}if(w.length===0)throw new Error("Invalid typed time.");return w}parseTime(){let g=this.getCurrentRecord(),w=this.extract(g,this.consumeTime);this.consumeSpaceForRecord(g);let D=this.extract(g,this.consumeTime);return this.currentLine++,{startTime:w,stopTime:D}}parseBandWidth(){let g=[];for(;this.currentLine<this.records.length;){let w=this.getCurrentRecord();if(w.type!==h.BANDWIDTH)break;{let D=this.extractOneOrMore(w,S);if(w.value[w.cur]!==":")throw new Error("Invalid bandwidth field.");w.cur++;let F=this.extractOneOrMore(w,p);g.push({bwtype:D,bandwidth:F}),this.currentLine++}}return g}parseVersion(){let g=this.getCurrentRecord();if(g.type!==h.VERSION)throw new Error("first sdp record must be version");let w=g.value.slice(0,this.consumeOneOrMore(g.value,0,p));if(w.length!==g.value.length)throw new Error('invalid proto version, "v='.concat(g.value,'"'));return this.currentLine++,w}parseOrigin(){let g=this.getCurrentRecord();if(g.type!==h.ORIGIN)throw new Error("second line of sdp must be origin");let w=this.extractOneOrMore(g,m);this.consumeSpaceForRecord(g);let D=this.extractOneOrMore(g,p);this.consumeSpaceForRecord(g);let F=this.extractOneOrMore(g,p);this.consumeSpaceForRecord(g);let pe=this.extractOneOrMore(g,S);this.consumeSpaceForRecord(g);let Re=this.extractOneOrMore(g,S);this.consumeSpaceForRecord(g);let rt=this.extract(g,this.consumeUnicastAddress);return this.currentLine++,{username:w,sessId:D,sessVersion:F,nettype:pe,addrtype:Re,unicastAddress:rt}}parseSessionName(){let g=this.getCurrentRecord();if(g.type===h.SESSION_NAME){let w=this.extract(g,this.consumeText);return this.currentLine++,w}}parseInformation(){let g=this.getCurrentRecord();if(g.type!==h.INFORMATION)return;let w=this.extract(g,this.consumeText);return this.currentLine++,w}parseUri(){let g=this.getCurrentRecord();if(g.type===h.URI)return this.currentLine++,g.value}parseEmail(){let g=[];for(;;){let w=this.getCurrentRecord();if(w.type!==h.EMAIL)break;g.push(w.value),this.currentLine++}return g}parsePhone(){let g=[];for(;;){let w=this.getCurrentRecord();if(w.type!==h.PHONE)break;g.push(w.value),this.currentLine++}return g}parseConnection(){let g=this.getCurrentRecord();if(g.type===h.CONNECTION){let w=this.extractOneOrMore(g,S);this.consumeSpaceForRecord(g);let D=this.extractOneOrMore(g,S);this.consumeSpaceForRecord(g);let F=this.extract(g,this.consumeAddress);return this.currentLine++,{nettype:w,addrtype:D,address:F}}}parseMedia(){let g=this.getCurrentRecord(),w=this.extract(g,this.consumeToken);this.consumeSpaceForRecord(g);let D=this.extract(g,this.consumePort);g.value[g.cur]==="/"&&(g.cur+=1,D+=this.extract(g,this.consumeInteger)),this.consumeSpaceForRecord(g);let F=[];for(F.push(this.extract(g,this.consumeToken));g.value[g.cur]==="/";)g.cur+=1,F.push(this.extract(g,this.consumeToken));if(F.length===0)throw new Error("Invalid proto");let pe=this.parseFmt(g);return this.currentLine++,{mediaType:w,port:D,protos:F,fmts:pe}}parseTimeFields(){let g=[];for(;this.getCurrentRecord().type===h.TIME;){let w=this.parseTime(),D=this.parseRepeat(),F=this.parseZone();g.push({time:w,repeats:D,zones:F})}return g}parseMediaDescription(){let g=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===h.MEDIA;){let w=this.parseMedia(),D=this.parseInformation(),F=this.parseConnections(),pe=this.parseBandWidth(),Re=this.parseKey(),rt=this.parseMediaAttributes(w);g.push({media:w,information:D,connections:F,bandwidths:pe,key:Re,attributes:rt})}return g}parseConnections(){let g=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===h.CONNECTION;)g.push(this.parseConnection());return g}parseFmt(g){let w=[];for(;;)try{this.consumeSpaceForRecord(g),w.push(this.extract(g,this.consumeToken))}catch{break}if(w.length===0)throw new Error("Invalid fmts");return w}extract(g,w){for(var D=arguments.length,F=new Array(D>2?D-2:0),pe=2;pe<D;pe++)F[pe-2]=arguments[pe];let Re=w.call(this,g.value,g.cur,...F),rt=g.value.slice(g.cur,Re);return g.cur=Re,rt}extractOneOrMore(g,w){let D=this.consumeOneOrMore(g.value,g.cur,w),F=g.value.slice(g.cur,D);return g.cur=D,F}consumeSpaceForRecord(g){if(g.value[g.cur]!==u)throw new Error("Invalid space at ".concat(g.cur,"."));g.cur+=1}}class ie extends J{constructor(){super(...arguments),Z(this,"attributes",void 0),Z(this,"digested",!1)}extractOneOrMore(g,w,D){let F=this.consumeOneOrMore(g.attValue,g._cur,w),pe=g.attValue.slice(g._cur,F),[Re,rt]=D||[];if(typeof Re=="number"&&pe.length<Re)throw new Error("error in length, should be more or equal than ".concat(Re," characters."));if(typeof rt=="number"&&pe.length>rt)throw new Error("error in length, should be less or equal than ".concat(rt," characters."));return g._cur=F,pe}consumeAttributeSpace(g){if(g.attValue[g._cur]!==u)throw new Error("Invalid space at ".concat(g._cur,"."));g._cur+=1}extract(g,w){if(!g.attValue)throw new Error("Nothing to extract from attValue.");for(var D=arguments.length,F=new Array(D>2?D-2:0),pe=2;pe<D;pe++)F[pe-2]=arguments[pe];let Re=w.call(this,g.attValue,g._cur,...F),rt=g.attValue.slice(g._cur,Re);return g._cur=Re,rt}atEnd(g){if(!g.attValue)throw new Error;return g._cur>=g.attValue.length}peekChar(g){if(!g.attValue)throw new Error;return g.attValue[g._cur]}peek(g,w){if(!g.attValue)throw new Error;for(let D=0;D<w.length;D++)if(w[D]!==g.attValue[g._cur+D])return!1;return!0}parseIceUfrag(g){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(g,O,[4,256])}parseIcePwd(g){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(g,O,[22,256])}parseIceOptions(g){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");let w=[];for(;!this.atEnd(g);){w.push(this.extractOneOrMore(g,O));try{this.consumeAttributeSpace(g)}catch(D){if(this.atEnd(g))break;throw D}}this.attributes.iceOptions=w}parseFingerprint(g){let w=this.extract(g,this.consumeToken);this.consumeAttributeSpace(g);let D=this.extract(g,this.consumeTill);this.attributes.fingerprints.push({hashFunction:w,fingerprint:D})}parseExtmap(g){let w=this.extractOneOrMore(g,p),D;this.peekChar(g)==="/"&&(this.extract(g,this.consume,"/"),D=this.extract(g,this.consumeToken)),this.consumeAttributeSpace(g);let F=this.extract(g,this.consumeTill,u),pe=G(G({entry:parseInt(w,10)},D&&{direction:D}),{},{extensionName:F});this.peekChar(g)===u&&(this.consumeAttributeSpace(g),pe.extensionAttributes=this.extract(g,this.consumeTill)),this.attributes.extmaps.push(pe)}parseSetup(g){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");let w=this.extract(g,this.consumeTill);if(w!=="active"&&w!=="passive"&&w!=="actpass"&&w!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=w}}class Ie extends ie{constructor(){super(...arguments),Z(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(g){if(this.digested)throw new Error("already digested");try{switch(g.attField){case"group":this.parseGroup(g);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(g);break;case"ice-pwd":this.parseIcePwd(g);break;case"ice-options":this.parseIceOptions(g);break;case"fingerprint":this.parseFingerprint(g);break;case"setup":this.parseSetup(g);break;case"tls-id":this.parseTlsId(g);break;case"identity":this.parseIdentity(g);break;case"extmap":this.parseExtmap(g);break;case"msid-semantic":this.parseMsidSemantic(g);break;default:g.ignored=!0,this.attributes.unrecognized.push(g)}}catch(w){throw console.error("parsing session attribute ".concat(g.attField,' error, "a=').concat(g.attField,":").concat(g.attValue,'"')),w}if(!g.ignored&&g.attValue&&!this.atEnd(g))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(g){let w=this.extract(g,this.consumeToken),D=[];for(;!this.atEnd(g)&&this.peekChar(g)===u;)this.consumeAttributeSpace(g),D.push(this.extract(g,this.consumeToken));this.attributes.groups.push({semantic:w,identificationTag:D})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(g){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(g,P)}parseIdentity(g){let w=this.extractOneOrMore(g,U),D=[];for(;!this.atEnd(g)&&this.peekChar(g)===u;){this.consumeAttributeSpace(g);let F=this.extract(g,this.consumeToken);this.extract(g,this.consume,"=");let pe=this.extractOneOrMore(g,Re=>Re!==u&&I(Re));D.push({name:F,value:pe})}this.attributes.identities.push({assertionValue:w,extensions:D})}parseMsidSemantic(g){this.peekChar(g)===u&&this.consumeAttributeSpace(g);let w={semantic:this.extract(g,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(g)}catch{break}if(this.peekChar(g)==="*"){this.extract(g,this.consume,"*"),w.applyForAll=!0;break}{let D=this.extract(g,this.consumeTill,u);w.identifierList.push(D)}}this.attributes.msidSemantic=w}}class Ve extends ie{constructor(g){super(),Z(this,"attributes",void 0),g.protos.indexOf("RTP")!==-1||g.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(g){if(this.digested)throw new Error("already digested");try{switch(g.attField){case"extmap":this.parseExtmap(g);break;case"setup":this.parseSetup(g);break;case"ice-ufrag":this.parseIceUfrag(g);break;case"ice-pwd":this.parseIcePwd(g);break;case"ice-options":this.parseIceOptions(g);break;case"candidate":this.parseCandidate(g);break;case"remote-candidate":this.parseRemoteCandidate(g);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(g);break;case"rtpmap":this.parseRtpmap(g);break;case"ptime":this.parsePtime(g);break;case"maxptime":this.parseMaxPtime(g);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(g);break;case"ssrc":this.parseSSRC(g);break;case"fmtp":this.parseFmtp(g);break;case"rtcp-fb":this.parseRtcpFb(g);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(g);break;case"mid":this.parseMid(g);break;case"msid":this.parseMsid(g);break;case"imageattr":this.parseImageAttr(g);break;case"rid":this.parseRid(g);break;case"simulcast":this.parseSimulcast(g);break;case"sctp-port":this.parseSctpPort(g);break;case"max-message-size":this.parseMaxMessageSize(g);break;case"ssrc-group":this.parseSSRCGroup(g);break;default:g.ignored=!0,this.attributes.unrecognized.push(g)}}catch(w){throw console.error("parsing media attribute ".concat(g.attField,' error, "a=').concat(g.attField,":").concat(g.attValue,'"')),w}if(!g.ignored&&g.attValue&&!this.atEnd(g))throw new Error("attribute parsing error")}parseCandidate(g){let w=this.extractOneOrMore(g,O,[1,32]);this.consumeAttributeSpace(g);let D=this.extractOneOrMore(g,p,[1,5]);this.consumeAttributeSpace(g);let F=this.extract(g,this.consumeToken);this.consumeAttributeSpace(g);let pe=this.extractOneOrMore(g,p,[1,10]);this.consumeAttributeSpace(g);let Re=this.extract(g,this.consumeAddress);this.consumeAttributeSpace(g);let rt=this.extract(g,this.consumePort);this.consumeAttributeSpace(g),this.extract(g,this.consume,"typ"),this.consumeAttributeSpace(g);let Xe={foundation:w,componentId:D,transport:F,priority:pe,connectionAddress:Re,port:rt,type:this.extract(g,this.consumeToken),extension:{}};for(this.peek(g," raddr")&&(this.extract(g,this.consume," raddr"),this.consumeAttributeSpace(g),Xe.relAddr=this.extract(g,this.consumeAddress)),this.peek(g," rport")&&(this.extract(g,this.consume," rport"),this.consumeAttributeSpace(g),Xe.relPort=this.extract(g,this.consumePort));this.peekChar(g)===u;){this.consumeAttributeSpace(g);let Ft=this.extract(g,this.consumeToken);this.consumeAttributeSpace(g),Xe.extension[Ft]=this.extractOneOrMore(g,_)}this.attributes.candidates.push(Xe)}parseRemoteCandidate(g){let w=[];for(;;){let D=this.extractOneOrMore(g,p,[1,5]);this.consumeAttributeSpace(g);let F=this.extract(g,this.consumeAddress);this.consumeAttributeSpace(g);let pe=this.extract(g,this.consumePort);w.push({componentId:D,connectionAddress:F,port:pe});try{this.consumeAttributeSpace(g)}catch{break}}this.attributes.remoteCandidatesList.push(w)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(g){let w=this.extract(g,this.consumeToken);this.consumeAttributeSpace(g);let D=this.extract(g,this.consumeTill,"/");this.extract(g,this.consume,"/");let F={encodingName:D,clockRate:this.extractOneOrMore(g,p)};this.atEnd(g)||this.peekChar(g)!=="/"||(this.extract(g,this.consume,"/"),F.encodingParameters=parseInt(this.extract(g,this.consumeTill),10));let pe=this.attributes.payloads.find(Re=>Re.payloadType===parseInt(w,10));pe?pe.rtpMap=F:this.attributes.payloads.push({payloadType:parseInt(w,10),rtpMap:F,rtcpFeedbacks:[]})}parsePtime(g){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(g,this.consumeTill)}parseMaxPtime(g){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(g,this.consumeTill)}parseDirection(g){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=g.attField}parseSSRC(g){let w=this.extractOneOrMore(g,p);this.consumeAttributeSpace(g);let D=this.extract(g,this.consumeTill,":"),F;this.peekChar(g)===":"&&(this.extract(g,this.consume,":"),F=this.extract(g,this.consumeTill));let pe=this.attributes.ssrcs.find(Re=>Re.ssrcId===parseInt(w,10));pe?pe.attributes[D]=F:this.attributes.ssrcs.push({ssrcId:parseInt(w,10),attributes:{[D]:F}})}parseFmtp(g){let w=this.extract(g,this.consumeTill,u);this.consumeAttributeSpace(g);let D=this.extract(g,this.consumeTill),F={};D.split(";").forEach(Re=>{let[rt,Xe]=Re.split("=");rt=ir(rt).call(rt);let Ft=typeof Xe=="string"?ir(Xe).call(Xe):null;typeof rt=="string"&&rt.length>0&&(F[rt]=Ft)});let pe=this.attributes.payloads.find(Re=>Re.payloadType===parseInt(w,10));pe?pe.fmtp={parameters:F}:this.attributes.payloads.push({payloadType:parseInt(w,10),rtcpFeedbacks:[],fmtp:{parameters:F}})}parseFmtParameters(g){let w={},D=this.extract(g,this.consumeTill,"=");g._cur++;let F=this.extract(g,this.consumeTill,";");for(w[D]=F;g.attValue[g._cur]===";";){let pe=this.extract(g,this.consumeTill,"=");g._cur++;let Re=this.extract(g,this.consumeTill,";");w[pe]=Re}return w}parseRtcpFb(g){let w="";w=this.peekChar(g)==="*"?this.extract(g,this.consume,"*"):this.extract(g,this.consumeTill,u),this.consumeAttributeSpace(g);let D=this.extract(g,this.consumeTill,u),F;if(D==="trr-int")F={type:D,interval:this.extract(g,this.consumeTill)};else{let pe={type:D};this.peekChar(g)===u&&(this.consumeAttributeSpace(g),pe.parameter=this.extract(g,this.consumeToken),this.peekChar(g)===u&&(pe.additional=this.extract(g,this.consumeTill))),F=pe}if(w==="*")this.attributes.rtcpFeedbackWildcards.push(F);else{let pe=this.attributes.payloads.find(Re=>Re.payloadType===parseInt(w,10));pe?pe.rtcpFeedbacks.push(F):this.attributes.payloads.push({payloadType:parseInt(w,10),rtcpFeedbacks:[F]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(g){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");let w={port:this.extract(g,this.consumePort)};this.peekChar(g)===u&&(this.consumeAttributeSpace(g),w.netType=this.extractOneOrMore(g,S),this.consumeAttributeSpace(g),w.addressType=this.extractOneOrMore(g,S),this.consumeAttributeSpace(g),w.address=this.extract(g,this.consumeAddress)),this.attributes.rtcp=w}parseMsid(g){let w={id:this.extractOneOrMore(g,S,[1,64])};this.peekChar(g)===u&&(this.consumeAttributeSpace(g),w.appdata=this.extractOneOrMore(g,S,[1,64])),this.attributes.msids.push(w)}parseImageAttr(g){this.attributes.imageattr.push(g.attValue)}parseRid(g){let w=this.extractOneOrMore(g,F=>v(F)||p(F)||F==="_"||F==="-");this.consumeAttributeSpace(g);let D={id:w,direction:this.extract(g,this.consumeToken),params:[]};if(this.peekChar(g)===u){if(this.consumeAttributeSpace(g),this.peek(g,"pt=")){this.extract(g,this.consume,"pt=");let F=[];for(;;){let pe=this.extract(g,this.consumeToken);F.push(pe);try{this.extract(g,this.consume,",")}catch{break}}D.payloads=F,this.peekChar(g)===u&&this.extract(g,this.consume,u)}for(;;){let F=this.extract(g,this.consumeToken);switch(F){case"depend":{let pe={type:F,rids:this.extract(g,this.consume,"=").split(",")};D.params.push(pe);break}default:{let pe={type:F};this.peekChar(g)==="="&&(this.extract(g,this.consume,"="),pe.val=this.extract(g,this.consumeTill,";")),D.params.push(pe)}}try{this.extract(g,this.consume,";")}catch{break}}}this.attributes.rids.push(D)}parseSimulcast(g){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=g.attValue,this.extract(g,this.consumeTill)}parseSctpPort(g){this.attributes.sctpPort=this.extractOneOrMore(g,p,[1,5])}parseMaxMessageSize(g){this.attributes.maxMessageSize=this.extractOneOrMore(g,p,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(g){this.attributes.mid=this.extract(g,this.consumeToken)}parseSSRCGroup(g){let w=this.extract(g,this.consumeToken),D=[];for(;;)try{this.consumeAttributeSpace(g);let F=this.extract(g,this.consumeInteger);D.push(parseInt(F,10))}catch{break}this.attributes.ssrcGroups.push({semantic:w,ssrcIds:D})}}function He(L,g,w){return g in L?Object.defineProperty(L,g,{value:w,enumerable:!0,configurable:!0,writable:!0}):L[g]=w,L}class ut{constructor(){He(this,"eol",l)}print(g,w){let D="";return w&&(this.eol=w),D+=this.printVersion(g.version),D+=this.printOrigin(g.origin),D+=this.printSessionName(g.sessionName),D+=this.printInformation(g.information),D+=this.printUri(g.uri),D+=this.printEmail(g.emails),D+=this.printPhone(g.phones),D+=this.printConnection(g.connection),D+=this.printBandwidth(g.bandwidths),D+=this.printTimeFields(g.timeFields),D+=this.printKey(g.key),D+=this.printSessionAttributes(g.attributes),D+=this.printMediaDescription(g.mediaDescriptions),D}printVersion(g){return"v=".concat(g).concat(this.eol)}printOrigin(g){return"o=".concat(g.username," ").concat(g.sessId," ").concat(g.sessVersion," ").concat(g.nettype," ").concat(g.addrtype," ").concat(g.unicastAddress).concat(this.eol)}printSessionName(g){return g?"s=".concat(g).concat(this.eol):""}printInformation(g){return g?"i=".concat(g).concat(this.eol):""}printUri(g){return g?"u=".concat(g).concat(this.eol):""}printEmail(g){let w="";for(let D of g)w+="e=".concat(D).concat(this.eol);return w}printPhone(g){let w="";for(let D of g)w+="e=".concat(D).concat(this.eol);return w}printConnection(g){return g?"c=".concat(g.nettype," ").concat(g.addrtype," ").concat(g.address).concat(this.eol):""}printBandwidth(g){let w="";for(let D of g)w+="b=".concat(D.bwtype,":").concat(D.bandwidth).concat(this.eol);return w}printTimeFields(g){let w="";for(let D of g){w+="t=".concat(D.time.startTime," ").concat(D.time.startTime).concat(this.eol);for(let F of D.repeats)w+="r=".concat(F.repeatInterval," ").concat(F.typedTimes.join(" ")).concat(this.eol);D.zoneAdjustments&&(w+="z=",w+="z=".concat(D.zoneAdjustments.map(F=>"".concat(F.time," ").concat(F.back?"-":""," ").concat(F.typedTime)).join(" ")).concat(this.eol),w+=this.eol)}return w}printKey(g){return g?"k=".concat(g).concat(this.eol):""}printAttributes(g){let w="";for(let D of g)w+="a=".concat(D.attField).concat(D.attValue?":".concat(D.attValue):"").concat(this.eol);return w}printMediaDescription(g){let w="";for(let D of g)w+=this.printMedia(D.media),w+=this.printInformation(D.information),w+=this.printConnections(D.connections),w+=this.printBandwidth(D.bandwidths),w+=this.printKey(D.key),w+=this.printMediaAttributes(D);return w}printConnections(g){let w="";for(let D of g)w+=this.printConnection(D);return w}printMedia(g){return"m=".concat(g.mediaType," ").concat(g.port," ").concat(g.protos.join("/")," ").concat(g.fmts.join(" ")).concat(this.eol)}printSessionAttributes(g){return new ge(this.eol).print(g)}printMediaAttributes(g){return new j(this.eol).print(g)}}class st{constructor(g){He(this,"eol",void 0),this.eol=g}printIceUfrag(g){return g===void 0?"":"a=ice-ufrag:".concat(g).concat(this.eol)}printIcePwd(g){return g===void 0?"":"a=ice-pwd:".concat(g).concat(this.eol)}printIceOptions(g){return g===void 0?"":"a=ice-options:".concat(g.join(u)).concat(this.eol)}printFingerprints(g){return g.length>0?g.map(w=>"a=fingerprint:".concat(w.hashFunction).concat(u).concat(w.fingerprint)).join(this.eol)+this.eol:""}printExtmap(g){return g.map(w=>"a=extmap:".concat(w.entry).concat(w.direction?"/".concat(w.direction):"").concat(u).concat(w.extensionName).concat(w.extensionAttributes?"".concat(u).concat(w.extensionAttributes):"").concat(this.eol)).join("")}printSetup(g){return g===void 0?"":"a=setup:".concat(g).concat(this.eol)}printUnrecognized(g){return g.map(w=>"a=".concat(w.attField).concat(w.attValue?":".concat(w.attValue):"").concat(this.eol)).join("")}}class ge extends st{print(g){let w="";return w+=this.printGroups(g.groups),w+=this.printMsidSemantic(g.msidSemantic),w+=this.printIceLite(g.iceLite),w+=this.printIceUfrag(g.iceUfrag),w+=this.printIcePwd(g.icePwd),w+=this.printIceOptions(g.iceOptions),w+=this.printFingerprints(g.fingerprints),w+=this.printSetup(g.setup),w+=this.printTlsId(g.tlsId),w+=this.printIdentity(g.identities),w+=this.printExtmap(g.extmaps),w+=this.printUnrecognized(g.unrecognized),w}printGroups(g){let w="";return g.length>0&&(w+=g.map(D=>"a=group:".concat(D.semantic).concat(D.identificationTag.map(F=>"".concat(u).concat(F)).join("")).concat(this.eol)).join("")),w}printIceLite(g){return g===void 0?"":"a=ice-lite"+this.eol}printTlsId(g){return g?"a=tls-id:".concat(g).concat(this.eol):""}printIdentity(g){return g.length===0?"":g.map(w=>"a=identity:".concat(w.assertionValue).concat(w.extensions.map(D=>"".concat(u).concat(D.name).concat(D.value?"=".concat(D.value):"")))).join(this.eol)+this.eol}printMsidSemantic(g){if(!g)return"";let w="a=msid-semantic:".concat(g.semantic);return g.applyForAll?w+="".concat(u,"*"):g.identifierList.length>0&&(w+=g.identifierList.map(D=>"".concat(u).concat(D))),w+this.eol}}class j extends st{print(g){let w=g.attributes,D="";return D+=this.printRTCP(w.rtcp),D+=this.printIceUfrag(w.iceUfrag),D+=this.printIcePwd(w.icePwd),D+=this.printIceOptions(w.iceOptions),D+=this.printCandidates(w.candidates),D+=this.printRemoteCandidatesList(w.remoteCandidatesList),D+=this.printEndOfCandidates(w.endOfCandidates),D+=this.printFingerprints(w.fingerprints),D+=this.printSetup(w.setup),D+=this.printMid(w.mid),D+=this.printExtmap(w.extmaps),D+=this.printRTPRelated(w),D+=this.printPtime(w.ptime),D+=this.printMaxPtime(w.maxPtime),D+=this.printDirection(w.direction),D+=this.printSSRCGroups(w.ssrcGroups),D+=this.printSSRC(w.ssrcs),D+=this.printRTCPMux(w.rtcpMux),D+=this.printRTCPMuxOnly(w.rtcpMuxOnly),D+=this.printRTCPRsize(w.rtcpRsize),D+=this.printMSId(w.msids),D+=this.printImageattr(w.imageattr),D+=this.printRid(w.rids),D+=this.printSimulcast(w.simulcast),D+=this.printSCTPPort(w.sctpPort),D+=this.printMaxMessageSize(w.maxMessageSize),D+=this.printUnrecognized(w.unrecognized),D}printCandidates(g){return g.map(w=>"a=candidate:".concat(w.foundation).concat(u).concat(w.componentId).concat(u).concat(w.transport).concat(u).concat(w.priority).concat(u).concat(w.connectionAddress).concat(u).concat(w.port).concat(u,"typ").concat(u).concat(w.type).concat(w.relAddr?"".concat(u,"raddr").concat(u).concat(w.relAddr):"").concat(w.relPort?"".concat(u,"rport").concat(u).concat(w.relPort):"").concat(Object.keys(w.extension).map(D=>"".concat(u).concat(D).concat(u).concat(w.extension[D])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(g){return g.map(w=>"a=remote-candidates:".concat(w.join(u)).concat(this.eol)).join("")}printEndOfCandidates(g){return g===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(g){if(!g.payloads)return"";let w=g.payloads,D="";D+=g.rtcpFeedbackWildcards.map(F=>this.printRTCPFeedback("*",F)).join("");for(let F of w)D+=this.printRtpMap(F.payloadType,F.rtpMap),D+=this.printFmtp(F.payloadType,F.fmtp),D+=F.rtcpFeedbacks.map(pe=>this.printRTCPFeedback(F.payloadType,pe)).join("");return D}printFmtp(g,w){if(!w)return"";let D=Object.keys(w.parameters);return D.length===1&&w.parameters[D[0]]===null?"a=fmtp:".concat(g).concat(u).concat(D[0]).concat(this.eol):"a=fmtp:".concat(g).concat(u).concat(Object.keys(w.parameters).map(F=>"".concat(F,"=").concat(w.parameters[F])).join(";")).concat(this.eol)}printRtpMap(g,w){return w?"a=rtpmap:".concat(g).concat(u).concat(w.encodingName,"/").concat(w.clockRate).concat(w.encodingParameters?"/".concat(w.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(g,w){let D="a=rtcp-fb:".concat(g).concat(u),F=w;return F.type==="trr-int"?D+="ttr-int".concat(u).concat(F.interval):(D+="".concat(F.type),F.parameter&&(D+="".concat(u).concat(F.parameter),F.additional&&(D+="".concat(u).concat(F.additional)))),D+this.eol}printPtime(g){return g===void 0?"":"a=ptime:".concat(g).concat(this.eol)}printMaxPtime(g){return g===void 0?"":"a=maxptime:".concat(g).concat(this.eol)}printDirection(g){return g===void 0?"":"a=".concat(g).concat(this.eol)}printSSRC(g){return g.map(w=>Object.keys(w.attributes).map(D=>"a=ssrc:".concat(w.ssrcId.toString(10)).concat(u).concat(D).concat(w.attributes[D]?":".concat(w.attributes[D]):"").concat(this.eol)).join("")).join("")}printRTCPMux(g){return g===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(g){return g===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(g){return g===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(g){if(g===void 0)return"";let w="a=rtcp:".concat(g.port);return g.netType&&(w+="".concat(u).concat(g.netType)),g.addressType&&(w+="".concat(u).concat(g.addressType)),g.address&&(w+="".concat(u).concat(g.address)),w+this.eol}printMSId(g){return g.map(w=>"a=msid:".concat(w.id).concat(w.appdata?"".concat(u).concat(w.appdata):"").concat(this.eol)).join("")}printImageattr(g){return g.map(w=>"a=imageattr:".concat(w).concat(this.eol)).join("")}printRid(g){return g.map(w=>{let D="a=rid:".concat(w.id).concat(u).concat(w.direction);return w.payloads&&(D+="".concat(u,"pt=").concat(w.payloads.join(","))),w.params.length>0&&(D+="".concat(u).concat(w.params.map(F=>F.type==="depend"?"depend=".concat(F.rids.join(",")):"".concat(F.type,"=").concat(F.val)).join(";"))),D+this.eol}).join("")}printSimulcast(g){return g===void 0?"":"a=simulcast:".concat(g).concat(this.eol)}printSCTPPort(g){return g===void 0?"":"a=sctp-port:".concat(g).concat(this.eol)}printMaxMessageSize(g){return g===void 0?"":"a=max-message-size:".concat(g).concat(this.eol)}printMid(g){return g===void 0?"":"a=mid:".concat(g).concat(this.eol)}printSSRCGroups(g){return g.map(w=>"a=ssrc-group:".concat(w.semantic).concat(w.ssrcIds.map(D=>"".concat(u).concat(D.toString(10))).join("")).concat(this.eol)).join("")}}function K(L){return new q().parse(L)}function te(L,g){return new ut().print(L,g)}}},t={};function i(r){if(t[r])return t[r].exports;var a=t[r]={exports:{}};return e[r](a,a.exports,i),a.exports}return i.d=(r,a)=>{for(var s in a)i.o(a,s)&&!i.o(r,s)&&Object.defineProperty(r,s,{enumerable:!0,get:a[s]})},i.o=(r,a)=>Object.prototype.hasOwnProperty.call(r,a),i.r=r=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(r,"__esModule",{value:!0})},i(8)})();var vi=zV.exports;function Yv(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:k("SVC_MODE");if(k("ENABLE_SVC"))return function(t){return t in Mv}(e)?e:Mv.L1T3}function mL(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),i.push.apply(i,r)}return i}function gL(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?mL(Object(i),!0).forEach(function(r){b(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):mL(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}function Fh(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},r=arguments.length>3?arguments[3]:void 0,{filterRTX:a,filterVideoFec:s,filterAudioFec:c,filterAudioCodec:l,filterVideoCodec:u}=t,{useXR:h}=i,p=[],_=[],m=[],S=[],C=!1,v=!1;if(vi.parse(e).mediaDescriptions.forEach(I=>{r&&r!==I.attributes.direction||(I.media.mediaType!=="video"||C||(_=I.attributes.payloads,S=I.attributes.extmaps,C=!0),I.media.mediaType!=="audio"||v||(p=I.attributes.payloads,m=I.attributes.extmaps,v=!0))}),!S||_.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!m||p.length===0)throw new Error("Cannot get audio capabilities from SDP.");if(_.forEach(I=>{var O;(O=I.rtpMap)!==null&&O!==void 0&&O.clockRate&&(I.rtpMap.clockRate=parseInt(I.rtpMap.clockRate)),h&&I.rtcpFeedbacks.push({type:"rrtr"})}),p.forEach(I=>{var O;(O=I.rtpMap)!==null&&O!==void 0&&O.clockRate&&(I.rtpMap.clockRate=parseInt(I.rtpMap.clockRate)),h&&I.rtcpFeedbacks.push({type:"rrtr"})}),a&&(p=p.filter(I=>{var O;return((O=I.rtpMap)===null||O===void 0?void 0:O.encodingName.toLowerCase())!=="rtx"}),_=_.filter(I=>{var O;return((O=I.rtpMap)===null||O===void 0?void 0:O.encodingName.toLowerCase())!=="rtx"})),s&&(_=_.filter(I=>{var O;return!/(red)|(ulpfec)|(flexfec)/i.test(((O=I.rtpMap)===null||O===void 0?void 0:O.encodingName)||"")})),c&&(p=p.filter(I=>{var O;return!/(red)|(ulpfec)|(flexfec)/i.test(((O=I.rtpMap)===null||O===void 0?void 0:O.encodingName)||"")})),l&&(l==null?void 0:l.length)>0&&(p=p.filter(I=>{var O;return oe(l).call(l,((O=I.rtpMap)===null||O===void 0?void 0:O.encodingName.toLowerCase())||"")})),u&&(u==null?void 0:u.length)>0){let I=_.filter(O=>{var P;return oe(u).call(u,((P=O.rtpMap)===null||P===void 0?void 0:P.encodingName.toLowerCase())||"")});_=I.concat(a?[]:uC(I,_))}let y=k("UNSUPPORTED_VIDEO_CODEC");return y&&y.length>0&&(_=_.filter(I=>!(I.rtpMap&&oe(y).call(y,I.rtpMap.encodingName.toLowerCase())))),{audioCodecs:p,videoCodecs:_,audioExtensions:m,videoExtensions:S}}function vo(e){let t=vi.parse(e),i,r;for(let a of t.mediaDescriptions){if(!i){let s=a.attributes.iceUfrag,c=a.attributes.icePwd;if(!s||!c)throw new Error("Cannot get iceUfrag or icePwd from SDP.");i={iceUfrag:s,icePwd:c}}if(!r){let s=a.attributes.fingerprints;s.length>0&&(r={fingerprints:s})}}if(!r&&t.attributes.fingerprints.length>0&&(r={fingerprints:t.attributes.fingerprints}),!r||!i)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:i,dtlsParameters:r}}function YV(e,t){let i=[],r=e.attributes.ssrcGroups.filter(c=>c.semantic==="FID"),a=e.attributes.ssrcGroups.find(c=>c.semantic==="SIM"),s=e.attributes.ssrcs;if(a)a.ssrcIds.forEach(c=>{var l;let u=(l=r.find(h=>h.ssrcIds[0]===c))===null||l===void 0?void 0:l.ssrcIds[1];i.push({ssrcId:c,rtx:t?u:void 0})});else if(r.length>0){let c=r[0].ssrcIds[0],l=r[0].ssrcIds[1];i.push({ssrcId:c,rtx:t?l:void 0})}else{if(s.length===0)throw new Error("No ssrcs found on local media description.");i.push({ssrcId:s[0].ssrcId})}return i}function SL(e,t,i){let{cname:r}=e,a;t?a=qV(t):(a=e.iceParameters.candidates.map(p=>({foundation:p.foundation,componentId:"1",transport:p.protocol,priority:p.priority.toString(),connectionAddress:p.ip,port:p.port.toString(),type:p.type,extension:{}})),R.debug("Using candidates from gateway."));let s={fingerprints:e.dtlsParameters.fingerprints.map(p=>({hashFunction:p.algorithm,fingerprint:p.fingerprint}))},c={iceUfrag:e.iceParameters.iceUfrag,icePwd:e.iceParameters.icePwd},l;switch(e.dtlsParameters.role){case"server":l="passive";break;case"client":l="active";break;case"auto":l="actpass"}let u=SE(e.rtpCapabilities),h=[];return Array.isArray(i)&&i.length>0&&i.forEach(p=>{h.push({kind:_e.VIDEO,ssrcId:p.v,rtx:p.v_rtx,mslabel:"".concat(p.v,"_").concat(p.a)},{kind:_e.AUDIO,ssrcId:p.a,mslabel:"".concat(p.v,"_").concat(p.a)})}),{dtlsParameters:s,iceParameters:c,candidates:a,rtpCapabilities:u,setup:l,cname:r,preSSRCs:h}}function qV(e){let t=[];return e.ip&&typeof e.port=="number"&&(t=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip,port:e.port.toString(),type:"host",extension:{}}],R.debug("Using remote candidate from AP ".concat(e.ip,":").concat(e.port)),e.ip6&&(t.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip6,port:e.port.toString(),type:"host",extension:{}}),R.debug("Using IPV6 remote candidate from AP ".concat(e.ip6,":").concat(e.port)))),t}function mc(e,t,i){let r=[],a=[];return e.forEach(s=>{let{ssrcId:c,rtx:l}=s,u=ft(8,"track-"),h={ssrcId:c,attributes:gL({label:u,mslabel:i=i||ft(10,""),msid:"".concat(i," ").concat(u)},t&&{cname:t})};if(r.push(h),l!==void 0){let p={ssrcId:l,attributes:gL({label:u,mslabel:i,msid:"".concat(i," ").concat(u)},t&&{cname:t})};r.push(p),a.push({semantic:"FID",ssrcIds:[c,l]})}}),e.length>1&&a.push({semantic:"SIM",ssrcIds:e.map(s=>{let{ssrcId:c}=s;return c})}),{ssrcs:r,ssrcGroups:a}}function Rd(e,t){t instanceof xt&&e.attributes.payloads.forEach(i=>{var r;let a=(r=i.rtpMap)===null||r===void 0?void 0:r.encodingName.toLowerCase();if(!a||["opus","pcmu","pcma","g722"].indexOf(a)===-1)return;i.fmtp||(i.fmtp={parameters:{}}),i.fmtp.parameters.minptime="10",i.fmtp.parameters.useinbandfec="1";let s=t._encoderConfig;s&&a!=="pcmu"&&a!=="pcma"&&a!=="g722"&&(s.bitrate&&!Bt()&&(i.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*s.bitrate))),s.sampleRate&&(i.fmtp.parameters.maxplaybackrate="".concat(s.sampleRate),i.fmtp.parameters["sprop-maxcapturerate"]="".concat(s.sampleRate)),s.stereo&&(i.fmtp.parameters.stereo="1",i.fmtp.parameters["sprop-stereo"]="1"))})}function lC(e){let t=e.attributes.unrecognized.findIndex(i=>i.attField==="x-google-flag"&&i.attValue==="conference");t!==-1&&e.attributes.unrecognized.splice(t,1)}function dC(e,t){var i;if(!(t instanceof St&&t._encoderConfig&&t._hints.indexOf(Rt.SCREEN_TRACK)===-1))return;let r=t._encoderConfig;Ke().supportMinBitrate&&r.bitrateMin&&e.attributes.payloads.forEach(a=>{var s,c;oe(s=["h264","h265","vp8","vp9","av1"]).call(s,((c=a.rtpMap)===null||c===void 0?void 0:c.encodingName.toLowerCase())||"")&&(a.fmtp||(a.fmtp={parameters:{}}),a.fmtp.parameters["x-google-min-bitrate"]="".concat(r.bitrateMin))}),Ke().supportMinBitrate&&!oe(i=t._hints).call(i,Rt.LOW_STREAM)&&r.bitrateMax&&e.attributes.payloads.forEach(a=>{var s,c;oe(s=["h264","h265","vp8","vp9","av1"]).call(s,((c=a.rtpMap)===null||c===void 0?void 0:c.encodingName.toLowerCase())||"")&&(a.fmtp||(a.fmtp={parameters:{}}),a.fmtp.parameters["x-google-start-bitrate"]="".concat(k("X_GOOGLE_START_BITRATE")||Math.floor(r.bitrateMax)))})}function XV(e){if(e.media.mediaType!=="video")return;let t=Ge();if(t.name!==Ze.SAFARI&&t.os!==pi.IOS)return;let i=e.attributes.extmaps.findIndex(r=>/video-orientation/g.test(r.extensionName));i!==-1&&e.attributes.extmaps.splice(i,1)}function gE(e,t,i){if(!t)return;let r,a;if(e.media.mediaType==="video"?(r=i.videoExtensions,a=i.videoCodecs):(r=i.audioExtensions,a=i.audioCodecs),t.twcc===!0){let s=r.find(c=>c.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01");s&&(e.attributes.extmaps.find(c=>c.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01")||e.attributes.extmaps.push({entry:s.entry,extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"}),function(c,l){return l.filter(u=>!!c.find(h=>h.payloadType===u.payloadType&&!!h.rtcpFeedbacks.find(p=>p.type==="transport-cc")))}(a,e.attributes.payloads).forEach(c=>{c.rtcpFeedbacks.find(l=>l.type==="transport-cc")||c.rtcpFeedbacks.push({type:"transport-cc"})}))}else if(t.twcc===!1){let s=e.attributes.extmaps.findIndex(c=>c.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01");s!==-1&&e.attributes.extmaps.splice(s,1),e.attributes.payloads.forEach(c=>{let l=c.rtcpFeedbacks.findIndex(u=>u.type==="transport-cc");l!==-1&&c.rtcpFeedbacks.splice(l,1)})}if(t.remb===!0){let s=r.find(c=>c.extensionName==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time");s&&(e.attributes.extmaps.find(c=>c.extensionName==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time")||e.attributes.extmaps.push({entry:s.entry,extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}),function(c,l){return l.filter(u=>!!c.find(h=>h.payloadType===u.payloadType&&!!h.rtcpFeedbacks.find(p=>p.type==="goog-remb")))}(a,e.attributes.payloads).forEach(c=>{c.rtcpFeedbacks.find(l=>l.type==="goog-remb")||c.rtcpFeedbacks.push({type:"goog-remb"})}))}else if(t.remb===!1){let s=e.attributes.extmaps.findIndex(c=>c.extensionName==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time");s!==-1&&e.attributes.extmaps.splice(s,1),e.attributes.payloads.forEach(c=>{let l=c.rtcpFeedbacks.findIndex(u=>u.type==="goog-remb");l!==-1&&c.rtcpFeedbacks.splice(l,1)})}}function JV(e,t,i){if(Bt()||e.media.mediaType!=="video"||!(t instanceof St)||i!=="vp9"&&i!=="vp8"||i==="vp8"&&!k("SIMULCAST")||i==="vp9"&&k("ENABLE_SVC")||t._scalabilityMode===void 0||t._scalabilityMode.numSpatialLayers<=1)return;let r=i==="vp8"?2:t._scalabilityMode.numSpatialLayers,a=e.attributes.ssrcs[0],s=e.attributes.ssrcGroups.find(l=>l.semantic==="FID"&&l.ssrcIds[0]===a.ssrcId),c={semantic:"SIM",ssrcIds:[a.ssrcId]};for(let l=1;l<r;l++)e.attributes.ssrcs.push({ssrcId:a.ssrcId+l,attributes:Xt(a.attributes)}),c.ssrcIds.push(a.ssrcId+l),s&&(e.attributes.ssrcs.push({ssrcId:s.ssrcIds[1]+l,attributes:Xt(a.attributes)}),e.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[a.ssrcId+l,s.ssrcIds[1]+l]}));e.attributes.ssrcGroups.unshift(c)}async function QV(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=new RTCPeerConnection;i.addTransceiver("video",{direction:"sendonly"}),i.addTransceiver("audio",{direction:"sendonly"}),i.addTransceiver("video",{direction:"recvonly"}),i.addTransceiver("audio",{direction:"recvonly"});let r=(await i.createOffer()).sdp,{send:a,recv:s,sendrecv:c}=function(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},h=arguments.length>2?arguments[2]:void 0,p=Fh(h,l,u,"sendonly"),_=Fh(h,l,u,"recvonly"),m={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},S={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},C={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Ja(p,_,"videoExtensions",m,S,C),Ja(p,_,"videoCodecs",m,S,C),Ja(p,_,"audioExtensions",m,S,C),Ja(p,_,"audioCodecs",m,S,C),k("RAISE_H264_BASELINE_PRIORITY")){let v=C.videoCodecs.findIndex(y=>{var I,O;return((I=y.rtpMap)===null||I===void 0?void 0:I.encodingName.toLocaleLowerCase())==="h264"&&((O=y.fmtp)===null||O===void 0?void 0:O.parameters["profile-level-id"])==="42001f"});if(v!==-1){let y=C.videoCodecs.findIndex(I=>{var O;return((O=I.rtpMap)===null||O===void 0?void 0:O.encodingName.toLocaleLowerCase())==="h264"});if(y<v){R.debug("raising H264 baseline profile priority");let I=C.videoCodecs[v];C.videoCodecs.splice(v,1),C.videoCodecs.splice(y,0,I)}y!==-1&&(S.videoCodecs=S.videoCodecs.filter(I=>{var O,P;return!(((O=I.rtpMap)===null||O===void 0?void 0:O.encodingName.toLocaleLowerCase())==="h264"&&((P=I.fmtp)===null||P===void 0?void 0:P.parameters["profile-level-id"])!=="42001f")})),y!==-1&&k("FILTER_SEND_H264_BASELINE")&&(m.videoCodecs=m.videoCodecs.filter(I=>{var O,P;return!(((O=I.rtpMap)===null||O===void 0?void 0:O.encodingName.toLocaleLowerCase())==="h264"&&((P=I.fmtp)===null||P===void 0?void 0:P.parameters["profile-level-id"])!=="42001f")}))}}return{send:m,recv:S,sendrecv:C}}(e,t,r);try{i.close()}catch{}return{send:a,recv:s,sendrecv:c}}function TL(){let e={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},t=Fh(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"recvonly"),i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},r={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},a={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Ja(e,t,"videoExtensions",i,r,a),Ja(e,t,"videoCodecs",i,r,a),Ja(e,t,"audioExtensions",i,r,a),Ja(e,t,"audioCodecs",i,r,a),k("RAISE_H264_BASELINE_PRIORITY")){let s=a.videoCodecs.findIndex(c=>c.rtpMap&&c.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&c.fmtp&&c.fmtp.parameters["profile-level-id"]==="42001f");if(s!==-1){let c=a.videoCodecs.findIndex(l=>l.rtpMap&&l.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(c<s){R.debug("raising H264 baseline profile priority");let l=a.videoCodecs[s];a.videoCodecs.splice(s,1),a.videoCodecs.splice(c,0,l)}c!==-1&&(r.videoCodecs=r.videoCodecs.filter(l=>!(l.rtpMap&&l.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&l.fmtp&&l.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:i,recv:r,sendrecv:a}}function Ja(e,t,i,r,a,s){if(i==="videoExtensions"||i==="audioExtensions"){let c=[];return e[i].forEach(l=>{t[i].some((u,h)=>{if(l.entry===u.entry&&l.extensionName===u.extensionName)return c.push(h),!0})?s[i].push(l):r[i].push(l)}),void t[i].forEach((l,u)=>{c.indexOf(u)===-1&&a[i].push(l)})}if(i==="videoCodecs"||i==="audioCodecs"){let c=[];return e[i].forEach(l=>{t[i].some((u,h)=>{if(l.payloadType===u.payloadType&&JSON.stringify(l)===JSON.stringify(u))return c.push(h),!0})?s[i].push(l):r[i].push(l)}),void t[i].forEach((l,u)=>{c.indexOf(u)===-1&&a[i].push(l)})}}function SE(e){let{send:t,recv:i,sendrecv:r}=e;if(!r){if(!t||!i)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:t,recv:i}}let a,s;return t?(a={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},a.audioCodecs=[...t.audioCodecs,...r.audioCodecs],a.videoCodecs=[...t.videoCodecs,...r.videoCodecs],a.audioExtensions=[...t.audioExtensions,...r.audioExtensions],a.videoExtensions=[...t.videoExtensions,...r.videoExtensions]):a=r,i?(s={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},s.audioCodecs=[...i.audioCodecs,...r.audioCodecs],s.videoCodecs=[...i.videoCodecs,...r.videoCodecs],s.audioExtensions=[...i.audioExtensions,...r.audioExtensions],s.videoExtensions=[...i.videoExtensions,...r.videoExtensions]):s=r,{send:a,recv:s}}function vd(e){e.media.mediaType==="audio"&&e.attributes.payloads.filter(t=>{var i;return((i=t.rtpMap)===null||i===void 0?void 0:i.encodingName.toLowerCase())==="opus"}).forEach(t=>{t.fmtp||(t.fmtp={parameters:{}}),t.fmtp.parameters.stereo="1",t.fmtp.parameters["sprop-stereo"]="1"})}function Th(e,t,i,r){let a=[];if(e===_e.VIDEO){if(k("H264_PROFILE_LEVEL_ID")&&r==="h264"&&(a=t.videoCodecs.filter(s=>{var c;return oe(c=s.rtpMap&&s.rtpMap.encodingName.toLowerCase()||"").call(c,r)&&s&&s.fmtp&&s.fmtp.parameters["profile-level-id"]===k("H264_PROFILE_LEVEL_ID")})),!Array.isArray(a)||a.length===0){let s=[],c=[],l=[],u=[];if(i.videoCodecs.forEach(h=>{let p=h.rtpMap&&h.rtpMap.encodingName.toLowerCase()||"";oe(p).call(p,r)?s.push(h):oe(p).call(p,"vp9")?c.push(h):oe(p).call(p,"vp8")?l.push(h):oe(p).call(p,"h264")&&u.push(h)}),s.length===0){let h="";c.length!==0?(s=c,h="vp9"):l.length!==0?(s=l,h="vp8"):u.length!==0&&(s=u,h="h264"),R.warning("codec ".concat(r," not included in rtpCapabilities, fallback to default payloads: ").concat(h))}s.length!==0&&(a=t.videoCodecs.filter(h=>s.some(p=>p.payloadType===h.payloadType)))}if(a.length===0&&(R.warning("codec ".concat(r," not included in rtpCapabilities, fallback to default payloads: ").concat(t.videoCodecs[0].rtpMap&&t.videoCodecs[0].rtpMap.encodingName)),a=t.videoCodecs),k("USE_PUB_RTX")||k("USE_SUB_RTX")){let s=uC(a,t.videoCodecs);a=[...a,...s]}}else a=t.audioCodecs.filter(s=>{var c;return oe(c=s.rtpMap&&s.rtpMap.encodingName.toLowerCase()||"").call(c,r)}),a.length===0&&(R.warning("codec ".concat(r," not included in rtpCapabilities, fallback to opus")),a=t.audioCodecs.filter(s=>{var c;return oe(c=s.rtpMap&&s.rtpMap.encodingName.toLowerCase()||"").call(c,"opus")}));return a}function uC(e,t){let i=e.map(r=>r.payloadType.toString());return t.filter(r=>r.rtpMap&&r.rtpMap.encodingName==="rtx"&&r.fmtp&&r.fmtp.parameters.apt&&oe(i).call(i,r.fmtp&&r.fmtp.parameters.apt))}async function l_(e,t,i){let r=t.toString(),a=$V(r,"offer","remote","exchangeSDP");await e.setRemoteDescription({type:"offer",sdp:r});let s=await e.createAnswer();if(!s.sdp)throw new Error("cannot get answer sdp");let c=s.sdp;c=ZV(c,i||{}),a==null||a(c||""),await e.setLocalDescription({type:"answer",sdp:c})}function ZV(e,t,i){let r=vi.parse(e),{useXR:a}=t;return r.mediaDescriptions.forEach(s=>{var c;s.attributes.mid&&(Array.isArray(i)&&!oe(i).call(i,s.attributes.mid)||(s.media.mediaType==="audio"&&vd(s),a&&oe(c=["audio","video"]).call(c,s.media.mediaType)&&s.attributes.payloads.forEach(l=>{l.rtcpFeedbacks.findIndex(u=>u.type==="rrtr")===-1&&l.rtcpFeedbacks.push({type:"rrtr"})})))}),vi.print(r)}function $V(e,t,i,r){if(k("SDP_LOGGING"))return R.upload("exchanging ".concat(i," ").concat(t," SDP during P2PConnection.").concat(r,`
`),e),t==="offer"?a=>{$V(a,"answer",i==="local"?"remote":"local",r)}:void 0}function Ln(e,t){return typeof k(e)===t?k(e):void 0}function RL(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),i.push.apply(i,r)}return i}function no(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?RL(Object(i),!0).forEach(function(r){b(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):RL(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}var fR=new Map,mJ=class extends Lt{get state(){return this._state}set state(e){if(e===this._state)return;let t=this._state;this._state=e,e==="DISCONNECTED"&&this._disconnectedReason?this.emit(wi.CONNECTION_STATE_CHANGE,e,t,this._disconnectedReason):this.emit(wi.CONNECTION_STATE_CHANGE,e,t)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(e){R.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(e)),this._joinGatewayStartTime=e}constructor(e,t){super(),b(this,"store",void 0),b(this,"joinInfo",void 0),b(this,"key",void 0),b(this,"ntpOffset",0),b(this,"signal",void 0),b(this,"role",void 0),b(this,"inChannelInfo",{joinAt:null,duration:0}),b(this,"spec",void 0),b(this,"_state","DISCONNECTED"),b(this,"_statsCollector",void 0),b(this,"_disconnectedReason",void 0),b(this,"isSignalRecover",!1),b(this,"hasChangeBGPAddress",!1),b(this,"trafficStatsInterval",void 0),b(this,"networkQualityInterval",void 0),b(this,"_joinGatewayStartTime",0),b(this,"_signalTimeout",!1),b(this,"_clientRoleOptions",void 0),b(this,"_isProactiveJoin",!1),this.store=e,this.spec=t,this.signal=this.store.useP2P?new EL(no(no({},t),{},{retryConfig:t.websocketRetryConfig}),e):new F9(no(no({},t),{},{retryConfig:t.websocketRetryConfig}),e),this._statsCollector=t.statsCollector,this.role=t.role||"audience",this._clientRoleOptions=t.clientRoleOptions,this.handleSignalEvents()}async join(e,t,i){this.store.joinGatewayStart(),e.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);let r=Date.now(),a=fR.get(e.cname);if(a||(a=new Map,fR.set(e.cname,a)),this._isProactiveJoin=!0,a.has(e.uid)){let u=new B(A.UID_CONFLICT);throw fe.joinGateway(e.sid,{lts:r,succ:!1,ec:u.code,addr:null,uid:e.uid,cid:e.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!e.proxyServer,signalChannel:"0",preload:e.preload}),this._isProactiveJoin=!1,u}a.set(e.uid,!0),this.joinInfo=e,this.key=t;let s=0;this.joinGatewayStartTime=r;let c=e.proxyServer;try{R.debug("[".concat(this.store.clientId,"] use websocket join uid ").concat(s));let u=e.gatewayAddrs.map(h=>{let{address:p}=h,[_,m]=p.split(":"),S={host:_,port:m};return e.proxyServer&&(S.proxy=e.proxyServer),S});s=(await this.signal.init(u,i)).uid,R.debug("[".concat(this.store.clientId,"] websocket join uid ").concat(s," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(u){var l;throw R.error("[".concat(this.store.clientId,"] User join failed"),u.toString()),fe.joinGateway(e.sid,{lts:r,succ:!1,ec:((l=u.data)===null||l===void 0?void 0:l.desc)||u.code,errorMsg:u.message,addr:this.signal.url,uid:e.uid,cid:e.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!c,signalChannel:"0",preload:e.preload}),this._isProactiveJoin=!1,a.delete(e.uid),this.signal.close(),u}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),R.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(u=>{R.warning("[".concat(this.store.clientId,"] get traffic stats error"),u.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(wi.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(wi.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(wi.NETWORK_QUALITY,{uplinkNetworkQuality:fD(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:fD(this._statsCollector.trafficStats.B_dnq)}):this.emit(wi.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),s}async leave(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0],t=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){t!==tt.FALLBACK&&(this.state="DISCONNECTING");try{e||this.signal.connectionState!==pt.CONNECTED||await function(i,r){return r===1/0?i:ae.race([i,V7(r)])}(this.signal.request(ve.LEAVE,void 0,!0),3e3)}catch(i){R.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),i)}this.signal.close(t),t!==tt.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(e,t,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new B(A.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));let r={state:"offer",p2p_id:this.store.p2pId,ortc:t,mode:this.spec.mode,extend:k("PUB_EXTEND"),twcc:!!k("PUBLISH_TWCC"),rtx:!!k("USE_PUB_RTX")};try{return(await this.signal.request(ve.PUBLISH,r,!0))._message}catch(a){if(i&&a.data&&a.data.code===me.ERR_PUBLISH_REQUEST_INVALID)return R.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),a.toString()),await this.tryUnpubBeforeRepub(e,t),this.publish(e,t,!1);throw a}}async publishDataChannel(e,t,i){var r;if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new B(A.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));let a={stream_id:t.streamId,ordered:t.ordered?1:0,max_retrans_times:(r=t.maxRetransmits)!==null&&r!==void 0?r:10,channel_id:t.channelId,metadata:t.metadata};try{await this.signal.request(ve.PUBLISH_DATASTREAM,a,!0)}catch(s){if(i&&s.data&&s.data.code===me.ERR_PUBLISH_REQUEST_INVALID)return R.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),s.toString()),await this.tryUnpubDataChannelBeforeRepub(e,t),this.publishDataChannel(e,t,!1);throw s}}async unpublish(e,t){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new B(A.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(ve.UNPUBLISH,{stream_id:t,ortc:e},!0)}catch(i){R.warning("[".concat(this.store.clientId,"] unpublish warning: "),i)}}async unpublishDataChannel(e){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new B(A.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await ae.all(e.map(t=>this.signal.request(ve.UNPUBLISH_DATASTREAM,{channel_id:t},!0)))}catch(t){R.warning("unpublish datachannels warning: ",t)}}async presubscribe(e,t,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new B(A.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));let r={stream_id:e,stream_type:t,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!k("SUBSCRIBE_TWCC"),rtx:!!k("USE_SUB_RTX")||void 0,extend:k("SUB_EXTEND"),svc:Array.isArray(k("SVC"))&&k("SVC").length!==0?k("SVC"):void 0};try{return await this.signal.request(ve.PRE_SUBSCRIBE,r,!0)}catch(a){if(i&&a.data&&a.data.code===me.ERR_SUBSCRIBE_REQUEST_INVALID)return R.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),a.toString()),this.presubscribe(e,t,!1);throw a}}async subscribe(e,t,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new B(A.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));let r={stream_id:e,stream_type:t.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!k("SUBSCRIBE_TWCC"),rtx:!!k("USE_SUB_RTX"),extend:k("SUB_EXTEND"),ssrcId:t.ssrcId,svc:Array.isArray(k("SVC"))&&k("SVC").length!==0?k("SVC"):void 0};try{return(await this.signal.request(ve.SUBSCRIBE,r,!0))._message}catch(a){if(i&&a.data&&a.data.code===me.ERR_SUBSCRIBE_REQUEST_INVALID)return R.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),a.toString()),await this.tryUnsubBeforeResub(e,t),await this.subscribe(e,t,!1);throw a}}async subscribeDataChannel(e,t,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new B(A.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));let r={uid:e,stream_id:t.id,channel_id:t.datachannelId};try{return void await this.signal.request(ve.SUBSCRIBE_DATASTREAM,r,!0)}catch(a){if(i&&a.data&&a.data.code===me.ERR_SUBSCRIBE_REQUEST_INVALID)return R.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),a.toString()),await this.tryUnsubDataChannelBeforeResub(e,t),await this.subscribeDataChannel(e,t,!1);throw a}}async subscribeAll(e,t){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new B(A.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));let i={p2p_id:this.store.p2pId,users:e,dtx:!1,rtx:!!k("USE_SUB_RTX"),twcc:!!k("SUBSCRIBE_TWCC"),svc:Array.isArray(k("SVC"))&&k("SVC").length!==0?k("SVC"):void 0};try{return await this.signal.request(ve.SUBSCRIBE_STREAMS,i,!0)}catch(r){if(t&&r.data&&r.data.code===me.ERR_SUBSCRIBE_REQUEST_INVALID)return R.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),r.toString()),await this.tryMassUnsubBeforeResub(e),await this.subscribeAll(e,!1);throw r}}async setVideoProfile(e){let t=function(i){if(!(i.bitrateMax&&i.bitrateMin&&i.frameRate&&i.height&&i.width))return;let r=i.frameRate,a=i.width,s=i.height,c=!0;return typeof r!="number"&&(r=r.exact||r.ideal||r.max||r.min||0,r||(c=!1)),typeof a!="number"&&(a=a.exact||a.ideal||a.max||a.min||0,a||(c=!1)),typeof s!="number"&&(s=s.exact||s.ideal||s.max||s.min||0,r||(c=!1)),c?{stream_type:0,width:a,height:s,fps:r,start_bps:1e3*i.bitrateMax,min_bps:1e3*i.bitrateMin,target_bps:1e3*i.bitrateMax}:void 0}(e);if(t)return this.signal.request(ve.SET_VIDEO_PROFILE,t);R.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(e,t){try{await this.signal.request(ve.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:e,stream_id:t},!0)}catch(i){R.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),i)}}async unsubscribeDataChannel(e,t){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new B(A.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await ae.all(e.map(i=>this.signal.request(ve.UNSUBSCRIBE_DATASTREAM,{stream_id:i,uid:t},!0)))}catch(i){R.warning("unsubscribeDataChannel warning: ",i)}}async massUnsubscribe(e){try{await this.signal.request(ve.UNSUBSCRIBE_STREAMS,e,!0)}catch(t){R.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),t)}}async reconnectPC(e){let{iceParameters:t,dtlsParameters:i,rtpCapabilities:r}=e;return{gatewayEstablishParams:await this.signal.request(ve.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:t,dtlsParameters:i,rtpCapabilities:r}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(ve.GATEWAY_INFO)}async renewToken(e){await this.signal.request(ve.RENEW_TOKEN,e),this.key=e.token}async setClientRole(e,t){if(t&&(this._clientRoleOptions=Object.assign({},t)),this.state!=="CONNECTED")return void(this.role=e);let i,r=0;e==="audience"?this._clientRoleOptions&&this._clientRoleOptions.delay?(i=this._clientRoleOptions.delay,r=1):r=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:r=0,await this.signal.request(ve.SET_CLIENT_ROLE,{role:e,level:r,delay:i,client_ts:Date.now()}),this.role=e}async setRemoteVideoStreamType(e,t){await this.signal.request(ve.SWITCH_VIDEO_STREAM,{stream_id:e,stream_type:t})}async setDefaultRemoteVideoStreamType(e){await this.signal.request(ve.DEFAULT_VIDEO_STREAM,{stream_type:e})}async setStreamFallbackOption(e,t){await this.signal.request(ve.SET_FALLBACK_OPTION,{stream_id:e,fallback_type:t})}async pickSVCLayer(e,t){await this.signal.request(ve.PICK_SVC_LAYER,{stream_id:e,spatial_layer:t.spatialLayer,temporal_layer:t.temporalLayer})}async setRTM2Flag(e){await this.signal.request(ve.SET_RTM2_FLAG,{rtm2_flag:e})}async sendExtensionMessage(e,t,i){if(this.signal instanceof EL)return this.signal.sendExtensionMessage(e,t,i)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),no({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(ve.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){let e=fR.get(this.joinInfo.cname);e&&e.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;let e=function(t){let i;return i=t.startsWith("dc")?t.match(/(dc\:\/\/)?([^:]+):(\d+)/):t.match(/(wss\:\/\/)?([^:]+):(\d+)/),i?{username:Ni.username,password:Ni.password,turnServerURL:i[2],tcpport:parseInt(i[3])+30,udpport:parseInt(i[3])+30,forceturn:!1}:null}((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],e&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(no(no({},Ni),{},{turnServerURL:e.turnServerURL,tcpport:e.tcpport,udpport:e.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;let e=await this.signal.request(ve.TRAFFIC_STATS,void 0,!0);e.timestamp=Date.now(),e.ntp_offset!=null&&(this.ntpOffset=e.ntp_offset),e.peer_delay.forEach(t=>{let i=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(r=>r.peer_uid===t.peer_uid);i&&i.B_st!==t.B_st&&JE(()=>{this.emit(wi.STREAM_TYPE_CHANGE,t.peer_uid,t.B_st)})}),this._statsCollector.updateTrafficStats(e)}getJoinMessage(e){if(!this.joinInfo||!this.key)throw new B(A.UNEXPECTED_ERROR,"can not generate join message, no join info");let t=Object.assign({},this.joinInfo.apResponse),i=k("REPORT_APP_SCENARIO");if(typeof i!="string")try{i=JSON.stringify(i)}catch{i=void 0}i&&i.length>128&&(i=void 0);let r=!(Bt()||Hx(87)||VD())&&typeof k("ENABLE_PRE_SUB")=="boolean"&&k("ENABLE_PRE_SUB"),a=!VD()&&Ln("ENABLE_PREALLOC_PC","boolean"),s=no({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:Sa,browser:navigator.userAgent,process_id:k("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:t,extend:k("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:i,attributes:{userAttributes:{enablePublishedUserList:k("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:k("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:typeof k("SUBSCRIBE_AUDIO_FILTER_TOPN")=="number"?k("SUBSCRIBE_AUDIO_FILTER_TOPN"):void 0,enablePublishAudioFilter:typeof k("ENABLE_PUBLISH_AUDIO_FILTER")=="boolean"?k("ENABLE_PUBLISH_AUDIO_FILTER"):void 0,enableUserLicenseCheck:typeof k("ENABLE_USER_LICENSE_CHECK")=="boolean"?k("ENABLE_USER_LICENSE_CHECK"):void 0,enableRTX:k("USE_PUB_RTX")===!0||k("USE_SUB_RTX")===!0||void 0,disableFEC:k("DISABLE_FEC"),enableNTPReport:!!k("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:!!k("ENABLE_INSTANT_VIDEO")||void 0,enableFulllinkAvSync:!!k("ENABLE_FULL_LINK_AV_SYNC")||void 0,enableDataStream2:Ln("ENABLE_DATASTREAM_2","boolean"),enableAutFeedback:!!k("ENABLE_AUT_FEEDBACK")||void 0,rtm2Flag:typeof this.joinInfo.rtmFlag=="number"?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!k("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:Ln("USE_XR","boolean"),enableLossbasedBwe:Ln("ENABLE_LOSSBASED_BWE","boolean"),enableAutCC:!!k("ENABLE_AUT_CC")||void 0,enableCCFallback:Ln("ENABLE_CC_FALLBACK","boolean"),enablePreallocPC:a,preSubNum:r?Ln("PRE_SUB_NUM","number"):void 0,enablePubTWCC:Ln("PUBLISH_TWCC","boolean"),enableSubTWCC:Ln("SUBSCRIBE_TWCC","boolean"),enablePubRTX:Ln("USE_PUB_RTX","boolean"),enableSubRTX:Ln("USE_SUB_RTX","boolean"),enableSubSVC:k("ENABLE_SVC")?k("ENABLE_SVC_DEFAULT_CODECS"):Array.isArray(k("SVC"))&&k("SVC").length!==0?k("SVC"):void 0}},join_ts:this.joinGatewayStartTime},e);return this.joinInfo.stringUid&&(s.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(s.aes_mode=this.joinInfo.aesmode,k("ENCRYPT_AES")?(s.aes_secret=this.joinInfo.aespassword,s.aes_encrypt=!0):s.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(s.aes_salt=this.joinInfo.aessalt)),t.addresses[this.signal.websocket.currentURLIndex]&&(s.ap_response.ticket=t.addresses[this.signal.websocket.currentURLIndex].ticket,delete t.addresses),this.joinInfo.defaultVideoStream!==void 0&&(s.default_video_stream=this.joinInfo.defaultVideoStream),s}getRejoinMessage(){if(!this.joinInfo)throw new B(A.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(ye.WS_RECONNECT_WAITTING_FINISH,e=>{var t;oe(t=["tryNext","recover"]).call(t,e)&&this.joinInfo&&fe.adjustSessionStartTime(this.joinInfo.sid)}),this.signal.on(ye.WS_RECONNECT_CREATE_CONNECTION,e=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(ye.WS_RECONNECTING,e=>{this.joinInfo&&fe.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:e||Pi.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",fe.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:this.spec.mode==="live"?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:this.role==="audience"?2:1,buildFormat:2}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(ye.WS_CLOSED,e=>{let t;switch(e){case tt.LEAVE:t=Pi.LEAVE;break;case tt.UID_BANNED:case tt.IP_BANNED:case tt.CHANNEL_BANNED:case tt.SERVER_ERROR:t=Pi.SERVER_ERROR;break;case tt.FALLBACK:t=Pi.FALLBACK;break;case tt.LICENSE_MISSING:case tt.LICENSE_EXPIRED:case tt.LICENSE_MINUTES_EXCEEDED:case tt.LICENSE_PERIOD_INVALID:case tt.LICENSE_MULTIPLE_SDK_SERVICE:case tt.LICENSE_ILLEGAL:case tt.TOKEN_EXPIRE:t=e;break;default:t=Pi.NETWORK_ERROR}R.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(t||"undefined -> "+Pi.NETWORK_ERROR)),this.joinInfo&&fe.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:e===tt.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:t}),this._disconnectedReason=e,e!==tt.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(ye.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo&&(this.role==="audience"&&this._clientRoleOptions&&(this._clientRoleOptions.level||this._clientRoleOptions.delay)&&(R.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(this._clientRoleOptions.level,", delay: ").concat(this._clientRoleOptions.delay)),this.setClientRole(this.role,this._clientRoleOptions)),fe.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1)){let e=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!e)return void R.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(e));at("EVENT_REPORT_DOMAIN",e[1]),at("EVENT_REPORT_BACKUP_DOMAIN",e[1]),at("LOG_UPLOAD_SERVER","".concat(e[1],":6444"))}}),this.signal.on(Le.ON_UPLINK_STATS,e=>{this._statsCollector.updateUplinkStats(e)}),this.signal.on(ye.REQUEST_RECOVER,(e,t,i)=>{if(!this.joinInfo)return i(new B(A.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));e&&(this.joinInfo.multiIP=e,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,ki(this,wi.REQUEST_NEW_GATEWAY_LIST).then(t).catch(i)}),this.signal.on(ye.REQUEST_JOIN_INFO,async e=>{var t;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void e(this.getJoinMessage({ortc:{}}));let{iceParameters:i,dtlsParameters:r,rtpCapabilities:a}=await ki(this,wi.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:(t=this.joinInfo)===null||t===void 0?void 0:t.turnServer});e(this.getJoinMessage({ortc:{iceParameters:i,dtlsParameters:r,rtpCapabilities:a,version:"2"}}))}),this.signal.on(ye.REQUEST_REJOIN_INFO,e=>{e(this.getRejoinMessage())}),this.signal.on(ye.REPORT_JOIN_GATEWAY,(e,t)=>{if(!this.joinInfo)return;let i,r="";var a;e instanceof B?(i=((a=e.data)===null||a===void 0?void 0:a.desc)||e.code,r=e.message):i=e,fe.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:i,errorMsg:r,addr:t,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload}),this._isProactiveJoin=!1}),this.signal.on(ye.IS_P2P_DISCONNECTED,e=>{e(Uh(this,wi.IS_P2P_DISCONNECTED))}),this.signal.on(ye.DISCONNECT_P2P,()=>{this.emit(wi.DISCONNECT_P2P)}),this.signal.on(ye.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(ye.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(ye.JOIN_RESPONSE,e=>{let t=this.getCurrentGatewayAddress();this.emit(wi.JOIN_RESPONSE,e,t)}),this.signal.on(ye.PRE_CONNECT_PC,async()=>{if(this.joinInfo){this.updateTurnConfigFromSignal();let e=this.getCurrentGatewayAddress(),t=k("FINGERPRINT")||this.joinInfo.apResponse.addresses[this.signal.currentURLIndex].fingerprint;if(e&&t){let i=qV(e);this.emit(wi.PRE_CONNECT_PC,{candidates:i,fingerprint:t})}}})}async tryUnsubBeforeResub(e,t){try{await this.signal.request(ve.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:e,ortc:[t]},!0)}catch(i){throw R.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),i),i}}async tryUnsubDataChannelBeforeResub(e,t){try{await this.signal.request(ve.UNSUBSCRIBE,{stream_id:t.id},!0)}catch(i){throw R.warning("unsubscribe datachannel warning",i),i}}async tryUnpubBeforeRepub(e,t){try{await this.signal.request(ve.UNPUBLISH,{stream_id:e,ortc:t},!0)}catch(i){throw R.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),i),i}}async tryUnpubDataChannelBeforeRepub(e,t){try{await this.signal.request(ve.UNPUBLISH_DATASTREAM,{channnel_id:t.channelId},!0)}catch(i){throw R.warning("unpublish datastream warning: ",i),i}}async tryMassUnsubBeforeResub(e){let t={users:e.map(i=>({stream_id:i.stream_id,stream_type:i.stream_type}))};try{await this.signal.request(ve.UNSUBSCRIBE_STREAMS,t,!0)}catch(i){throw R.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),i),i}}async muteLocal(e,t){let i={action:e.find(r=>r.stream_type===Qe.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:e,stream_id:t};try{await this.signal.request(ve.CONTROL,i,!0,!0)}catch(r){throw R.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),r),r}}async unmuteLocal(e,t){let i={action:e.find(r=>r.stream_type===Qe.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:e,stream_id:t};try{await this.signal.request(ve.CONTROL,i,!0,!0)}catch(r){throw R.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),r),r}}async muteRemote(e,t){let i={action:e===_e.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:t};try{await this.signal.request(ve.CONTROL,i,!0,!0)}catch(r){throw R.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),r),r}}async unmuteRemote(e,t){let i={action:e===_e.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:t};try{await this.signal.request(ve.CONTROL,i,!0,!0)}catch(r){throw R.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),r),r}}uploadWRTCStats(e){this.signal.uploadWRTCStats(e)}upload(e,t){this.signal.upload(e,t)}getSignalRTT(){return this.signal.rtt}async restartICE(e){let t={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:e};try{return await this.signal.request(ve.RESTART_ICE,t,!0)}catch(i){throw R.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),i),i}}reconnect(){this.state==="CONNECTED"&&this.signal.reconnect(void 0,Pi.P2P_FAILED)}getCurrentGatewayAddress(){var e,t;if(!k("GATEWAY_WSS_ADDRESS"))return k("USE_CANDIDATE_FROM_AP_DETAIL")&&(e=this.joinInfo)!==null&&e!==void 0&&e.apGatewayAddress?(R.debug("[".concat(this.store.clientId,"] use candidate from ap detail, ").concat(JSON.stringify(this.joinInfo.apGatewayAddress))),this.joinInfo.apGatewayAddress):(t=this.joinInfo)!==null&&t!==void 0&&t.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(e){await this.signal.request(ve.SET_PARAMETER,{enablePublishAudioFilter:e})}},d_=0,_R=0;function vn(e,t,i,r){return new ae((a,s)=>{t.timeout=t.timeout||k("HTTP_CONNECT_TIMEOUT"),t.responseType=t.responseType||"json",t.data&&!i?(t.data=JSON.stringify(t.data),d_+=Gn(t.data)):i&&(t.data.size?d_+=t.data.size:t.data instanceof FormData?d_+=eV(t.data):d_+=Gn(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,yr.request(t).then(c=>{typeof c.data=="string"?_R+=Gn(c.data):c.data instanceof ArrayBuffer||c.data instanceof Uint8Array?_R+=c.data.byteLength:_R+=Gn(JSON.stringify(c.data)),r&&a({data:c.data,headers:c.headers}),a(c.data)}).catch(c=>{yr.isCancel(c)?s(new B(A.OPERATION_ABORTED,"cancel token canceled")):c.code==="ECONNABORTED"?s(new B(A.NETWORK_TIMEOUT,c.message)):c.response?s(new B(A.NETWORK_RESPONSE_ERROR,c.response.status)):s(new B(A.NETWORK_ERROR,c.message))})})}(function(){var e;function t(j){var K=0;return function(){return K<j.length?{done:!1,value:j[K++]}:{done:!0}}}var i=typeof Object.defineProperties=="function"?Object.defineProperty:function(j,K,te){return j==Array.prototype||j==Object.prototype||(j[K]=te.value),j},r,a=function(j){j=[typeof globalThis=="object"&&globalThis,j,typeof window=="object"&&window,typeof self=="object"&&self,typeof rd=="object"&&rd];for(var K=0;K<j.length;++K){var te=j[K];if(te&&te.Math==Math)return te}throw Error("Cannot find global object")}(this);function s(j,K){if(K)e:{var te=a;j=j.split(".");for(var L=0;L<j.length-1;L++){var g=j[L];if(!(g in te))break e;te=te[g]}(K=K(L=te[j=j[j.length-1]]))!=L&&K!=null&&i(te,j,{configurable:!0,writable:!0,value:K})}}function c(j){return(j={next:j})[Symbol.iterator]=function(){return this},j}function l(j){var K=typeof Symbol<"u"&&Symbol.iterator&&j[Symbol.iterator];return K?K.call(j):{next:t(j)}}if(s("Symbol",function(j){function K(g,w){this.A=g,i(this,"description",{configurable:!0,writable:!0,value:w})}if(j)return j;K.prototype.toString=function(){return this.A};var te="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",L=0;return function g(w){if(this instanceof g)throw new TypeError("Symbol is not a constructor");return new K(te+(w||"")+"_"+L++,w)}}),s("Symbol.iterator",function(j){if(j)return j;j=Symbol("Symbol.iterator");for(var K="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),te=0;te<K.length;te++){var L=a[K[te]];typeof L=="function"&&typeof L.prototype[j]!="function"&&i(L.prototype,j,{configurable:!0,writable:!0,value:function(){return c(t(this))}})}return j}),typeof Object.setPrototypeOf=="function")r=Object.setPrototypeOf;else{var u;e:{var h={};try{h.__proto__={a:!0},u=h.a;break e}catch{}u=!1}r=u?function(j,K){if(j.__proto__=K,j.__proto__!==K)throw new TypeError(j+" is not extensible");return j}:null}var p=r;function _(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function m(j){if(j.m)throw new TypeError("Generator is already running");j.m=!0}function S(j,K){return j.h=3,{value:K}}function C(j){this.g=new _,this.G=j}function v(j,K,te,L){try{var g=K.call(j.g.j,te);if(!(g instanceof Object))throw new TypeError("Iterator result "+g+" is not an object");if(!g.done)return j.g.m=!1,g;var w=g.value}catch(D){return j.g.j=null,j.g.s(D),y(j)}return j.g.j=null,L.call(j.g,w),y(j)}function y(j){for(;j.g.h;)try{var K=j.G(j.g);if(K)return j.g.m=!1,{value:K.value,done:!1}}catch(te){j.g.v=void 0,j.g.s(te)}if(j.g.m=!1,j.g.l){if(K=j.g.l,j.g.l=null,K.F)throw K.D;return{value:K.return,done:!0}}return{value:void 0,done:!0}}function I(j){this.next=function(K){return j.o(K)},this.throw=function(K){return j.s(K)},this.return=function(K){return function(te,L){m(te.g);var g=te.g.j;return g?v(te,"return"in g?g.return:function(w){return{value:w,done:!0}},L,te.g.return):(te.g.return(L),y(te))}(j,K)},this[Symbol.iterator]=function(){return this}}function O(j,K){return K=new I(new C(K)),p&&j.prototype&&p(K,j.prototype),K}if(_.prototype.o=function(j){this.v=j},_.prototype.s=function(j){this.l={D:j,F:!0},this.h=this.C||this.u},_.prototype.return=function(j){this.l={return:j},this.h=this.u},C.prototype.o=function(j){return m(this.g),this.g.j?v(this,this.g.j.next,j,this.g.o):(this.g.o(j),y(this))},C.prototype.s=function(j){return m(this.g),this.g.j?v(this,this.g.j.throw,j,this.g.o):(this.g.s(j),y(this))},s("Array.prototype.entries",function(j){return j||function(){return function(K,te){K instanceof String&&(K+="");var L=0,g=!1,w={next:function(){if(!g&&L<K.length){var D=L++;return{value:te(D,K[D]),done:!1}}return g=!0,{done:!0,value:void 0}}};return w[Symbol.iterator]=function(){return w},w}(this,function(K,te){return[K,te]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var P=function(j,K){for(var te=0;te<j.length;te++)K(j[te])},U=function(j){return j.replace(/\r?\n|\r/g,`\r
`)},x=function(j,K,te){return K instanceof Blob?(te=te!==void 0?te+"":typeof K.name=="string"?K.name:"blob",K.name===te&&Object.prototype.toString.call(K)!=="[object Blob]"||(K=new File([K],te)),[String(j),K]):[String(j),String(K)]},G=function(j,K){if(j.length<K)throw new TypeError(K+" argument required, but only "+j.length+" present.")},Z=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,J=Z.FormData,q=Z.XMLHttpRequest&&Z.XMLHttpRequest.prototype.send,ie=Z.Request&&Z.fetch,Ie=Z.navigator&&Z.navigator.sendBeacon,Ve=Z.Element&&Z.Element.prototype,He=Z.Symbol&&Symbol.toStringTag;He&&(Blob.prototype[He]||(Blob.prototype[He]="Blob"),"File"in Z&&!File.prototype[He]&&(File.prototype[He]="File"));try{new File([],"")}catch{Z.File=function(j,K,te){return j=new Blob(j,te||{}),Object.defineProperties(j,{name:{value:K},lastModified:{value:+(te&&te.lastModified!==void 0?new Date(te.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),He&&Object.defineProperty(j,He,{value:"File"}),j}}var ut=function(j){return j.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},st=function(j){this.i=[];var K=this;j&&P(j.elements,function(te){if(te.name&&!te.disabled&&te.type!=="submit"&&te.type!=="button"&&!te.matches("form fieldset[disabled] *"))if(te.type==="file"){var L=te.files&&te.files.length?te.files:[new File([],"",{type:"application/octet-stream"})];P(L,function(g){K.append(te.name,g)})}else te.type==="select-multiple"||te.type==="select-one"?P(te.options,function(g){!g.disabled&&g.selected&&K.append(te.name,g.value)}):te.type==="checkbox"||te.type==="radio"?te.checked&&K.append(te.name,te.value):(L=te.type==="textarea"?U(te.value):te.value,K.append(te.name,L))})};if((e=st.prototype).append=function(j,K,te){G(arguments,2),this.i.push(x(j,K,te))},e.delete=function(j){G(arguments,1);var K=[];j=String(j),P(this.i,function(te){te[0]!==j&&K.push(te)}),this.i=K},e.entries=function j(){var K,te=this;return O(j,function(L){if(L.h==1&&(K=0),L.h!=3)return K<te.i.length?L=S(L,te.i[K]):(L.h=0,L=void 0),L;K++,L.h=2})},e.forEach=function(j,K){G(arguments,1);for(var te=l(this),L=te.next();!L.done;L=te.next()){var g=l(L.value);L=g.next().value,g=g.next().value,j.call(K,g,L,this)}},e.get=function(j){G(arguments,1);var K=this.i;j=String(j);for(var te=0;te<K.length;te++)if(K[te][0]===j)return K[te][1];return null},e.getAll=function(j){G(arguments,1);var K=[];return j=String(j),P(this.i,function(te){te[0]===j&&K.push(te[1])}),K},e.has=function(j){G(arguments,1),j=String(j);for(var K=0;K<this.i.length;K++)if(this.i[K][0]===j)return!0;return!1},e.keys=function j(){var K,te,L,g,w=this;return O(j,function(D){if(D.h==1&&(K=l(w),te=K.next()),D.h!=3)return te.done?void(D.h=0):(L=te.value,g=l(L),S(D,g.next().value));te=K.next(),D.h=2})},e.set=function(j,K,te){G(arguments,2),j=String(j);var L=[],g=x(j,K,te),w=!0;P(this.i,function(D){D[0]===j?w&&(w=!L.push(g)):L.push(D)}),w&&L.push(g),this.i=L},e.values=function j(){var K,te,L,g,w=this;return O(j,function(D){if(D.h==1&&(K=l(w),te=K.next()),D.h!=3)return te.done?void(D.h=0):(L=te.value,(g=l(L)).next(),S(D,g.next().value));te=K.next(),D.h=2})},st.prototype._asNative=function(){for(var j=new J,K=l(this),te=K.next();!te.done;te=K.next()){var L=l(te.value);te=L.next().value,L=L.next().value,j.append(te,L)}return j},st.prototype._blob=function(){var j="----formdata-polyfill-"+Math.random(),K=[],te="--"+j+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(L,g){return typeof L=="string"?K.push(te+ut(U(g))+`"\r
\r
`+U(L)+`\r
`):K.push(te+ut(U(g))+'"; filename="'+ut(L.name)+`"\r
Content-Type: `+(L.type||"application/octet-stream")+`\r
\r
`,L,`\r
`)}),K.push("--"+j+"--"),new Blob(K,{type:"multipart/form-data; boundary="+j})},st.prototype[Symbol.iterator]=function(){return this.entries()},st.prototype.toString=function(){return"[object FormData]"},Ve&&!Ve.matches&&(Ve.matches=Ve.matchesSelector||Ve.mozMatchesSelector||Ve.msMatchesSelector||Ve.oMatchesSelector||Ve.webkitMatchesSelector||function(j){for(var K=(j=(this.document||this.ownerDocument).querySelectorAll(j)).length;0<=--K&&j.item(K)!==this;);return-1<K}),He&&(st.prototype[He]="FormData"),q){var ge=Z.XMLHttpRequest.prototype.setRequestHeader;Z.XMLHttpRequest.prototype.setRequestHeader=function(j,K){ge.call(this,j,K),j.toLowerCase()==="content-type"&&(this.B=!0)},Z.XMLHttpRequest.prototype.send=function(j){j instanceof st?(j=j._blob(),this.B||this.setRequestHeader("Content-Type",j.type),q.call(this,j)):q.call(this,j)}}ie&&(Z.fetch=function(j,K){return K&&K.body&&K.body instanceof st&&(K.body=K.body._blob()),ie.call(this,j,K)}),Ie&&(Z.navigator.sendBeacon=function(j,K){return K instanceof st&&(K=K._asNative()),Ie.call(this,j,K)}),Z.FormData=st}})();var Gh=()=>{let e=k("AREAS");return e.length===0&&e.push(qe.GLOBAL),Sn(e).call(e,(t,i,r)=>{let a=eB(i);return a?r===0?a:"".concat(t,",").concat(a):t},"")},eB=e=>e===qe.OVERSEA?"".concat(Bi.ASIA,",").concat(Bi.EUROPE,",").concat(Bi.AFRICA,",").concat(Bi.NORTH_AMERICA,",").concat(Bi.SOUTH_AMERICA,",").concat(Bi.OCEANIA):Bi[e],gJ=e=>{let t={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return e.map(i=>{let r=tm[i],a=Object.keys(r);a&&a.map(s=>{s!=="CODE"&&(t[s]=t[s].concat(r[s]))})}),t},z_={GLOBAL:{ASIA:[qe.CHINA,qe.JAPAN,qe.INDIA,qe.KOREA,qe.HKMC],EUROPE:[],NORTH_AMERICA:[qe.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},u_=Object.keys(z_[qe.GLOBAL]),ER=[qe.CHINA,qe.NORTH_AMERICA,qe.EUROPE,qe.ASIA,qe.JAPAN,qe.INDIA,qe.OCEANIA,qe.SOUTH_AMERICA,qe.AFRICA,qe.KOREA,qe.HKMC,qe.US],SJ=function(e,t){let i=[];if(oe(e).call(e,qe.GLOBAL)){let s=[qe.GLOBAL,qe.OVERSEA],c=Object.keys(tm);if(t===qe.GLOBAL)throw new B(A.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(t===qe.CHINA)i=[qe.OVERSEA];else if(a=t,oe(u_).call(u_,a)){let l=(r=t,z_[qe.GLOBAL][r]||[]),u=[...s,t,...l];i=c.filter(h=>!oe(u).call(u,h))}else if(function(l){let u=!1;return u_.forEach(h=>{var p;oe(p=z_[qe.GLOBAL][h]).call(p,l)&&(u=!0)}),u}(t)){let l=function(h){let p;return u_.forEach(_=>{var m;oe(m=z_[qe.GLOBAL][_]).call(m,h)&&(p=_)}),p}(t),u=[...s,l,t];i=c.filter(h=>!oe(u).call(u,h))}else i=e;i=function(l){let u=[];return ER.forEach(h=>{oe(l).call(l,h)&&u.push(h)}),u.concat(l.filter(h=>!oe(ER).call(ER,h)))}(i)}else i=e;var r,a;return i};function vL(e){var t,i;if(!e&&oe(t=k("AREAS")).call(t,qe.EXTENSIONS))return R.debug("update area from ap : reset"),void hC(q7,!0);if(!oe(i=k("AREAS")).call(i,qe.GLOBAL)||!e)return;let r=tm.EXTENSIONS;r&&(r={CODE:eB(qe.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(e,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(e,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(e,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(e,".agora.io"),"cds-ap-web-2-".concat(e,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(e,".agora.io"),"sua-ap-web-2-".concat(e,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(e,".agora.io"),"uap-ap-web-2-".concat(e,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(e,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(e,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(e,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(e,".agora.io")]},R.debug("update area from ap success: ".concat(e,",config is "),r),at("AREAS",[qe.EXTENSIONS],!0),Object.keys(r).map(a=>{a==="LOG_UPLOAD_SERVER"||a==="EVENT_REPORT_DOMAIN"||a==="EVENT_REPORT_BACKUP_DOMAIN"||a==="PROXY_SERVER_TYPE3"?at(a,r[a][0]):at(a,r[a])}))}function hC(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1],i=fe.reportApiInvoke(null,{name:ni.SET_AREA,options:e,tag:Vt.TRACER});try{let r=[];if(typeof e=="string"&&(r=[e]),Array.isArray(e)&&(e.forEach(s=>{if(!oe(oD).call(oD,s))throw new B(A.INVALID_PARAMS,"invalid area code")}),r=e),Object.prototype.toString.call(e)==="[object Object]"){let{areaCode:s,excludedArea:c}=e;if(!s)throw new B(A.INVALID_PARAMS,"area code is needed");let l=s;typeof s=="string"&&(l=[s]),r=c?SJ(l,c):l}if(!t){if(So.AREAS){let s=new B(A.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return i.onError(s),void R.warning("setArea is prohibited because of config-distribute")}if(oe(r).call(r,qe.GLOBAL)&&k("AREAS")===qe.EXTENSIONS){let s=new B(A.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return i.onError(s),void R.warning("setArea is prohibited because of ap extensions")}}at("AREAS",r,t);let a=gJ(r);Object.keys(a).map(s=>{s==="LOG_UPLOAD_SERVER"||s==="EVENT_REPORT_DOMAIN"||s==="EVENT_REPORT_BACKUP_DOMAIN"||s==="PROXY_SERVER_TYPE3"?at(s,a[s][0]):at(s,a[s])}),R.debug("set area success:",r.join(","))}catch(r){throw i.onError(r),r}i.onSuccess()}function yL(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),i.push.apply(i,r)}return i}function qv(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?yL(Object(i),!0).forEach(function(r){b(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):yL(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}var mR=1;function TJ(e,t,i,r,a){mR+=1;let s={sid:i.sid,command:"convergeAllocateEdge",uid:"666",appId:i.appId,ts:Math.floor(Date.now()/1e3),seq:mR,requestId:mR,version:Sa,cname:i.cname},c={service_name:t,json_body:JSON.stringify(s)},l,u,h=e[0];return Rn(async()=>{l=Date.now();let p=await vn(h,{data:c,cancelToken:r,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(u=Date.now()-l,p.code!==0){let S=new B(A.UNEXPECTED_RESPONSE,"live streaming ap error, code"+p.code,{retry:!0,responseTime:u});throw R.error(S.toString()),S}let _=JSON.parse(p.json_body);if(_.code!==200){let S=new B(A.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(_.code,", reason: ").concat(_.reason),{code:_.code,responseTime:u});throw R.error(S.toString()),S}if(!_.servers||_.servers.length===0){let S=new B(A.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:_.code,responseTime:u});throw R.error(S.toString()),S}let m=function(S,C){return{addressList:S.servers.map(v=>"wss://".concat(v.address.replace(/\./g,"-"),".").concat(k("WORKER_DOMAIN"),":").concat(v.wss,"?serviceName=").concat(encodeURIComponent(C))),workerToken:S.workerToken,vid:S.vid}}(_,t);return k("LIVE_STREAMING_ADDRESS")&&(m.addressList=k("LIVE_STREAMING_ADDRESS")instanceof Array?k("LIVE_STREAMING_ADDRESS"):[k("LIVE_STREAMING_ADDRESS")]),qv(qv({},m),{},{responseTime:u})},(p,_)=>(fe.apworkerEvent(i.sid,{success:!0,sc:200,serviceName:t,responseDetail:JSON.stringify(p.addressList),firstSuccess:_===0,responseTime:u,serverIp:e[_%e.length]}),!1),(p,_)=>(fe.apworkerEvent(i.sid,{success:!1,sc:p.data&&p.data.code||200,serviceName:t,responseTime:u,serverIp:e[_%e.length]}),!!(p.code!==A.OPERATION_ABORTED&&p.code!==A.UNEXPECTED_RESPONSE||p.data&&p.data.retry)&&(h=e[(_+1)%e.length],!0)),a)}var gR=1;function CL(e,t,i,r){let{url:a,areaCode:s}=e,{clientId:c,sid:l}=t,u=Date.now(),h,[p,_]=fC(t,s,[Jt.CHOOSE_SERVER]),m=Qt.networkState;return Rn(async()=>{m&&Qt.networkState===xr.OFFLINE&&Qt.onlineWaiter&&await ae.race([Qt.onlineWaiter,yi(r&&r.maxRetryTimeout||ti.maxRetryTimeout)]),m=Qt.networkState;let{data:S,headers:C}=await vn(a,{data:p,cancelToken:i,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);h=C.http3==="1"?1:-1,fe.reportResourceTiming(a,l),tB(S,a,t,u,[Jt.CHOOSE_SERVER],h);let v=jh(S,Jt.CHOOSE_SERVER);return pC(v),tC(v,a)},S=>(S&&fe.joinChooseServer(l,{lts:u,succ:!0,csAddr:a,opid:_,serverList:S.gatewayAddrs.map(C=>C.address),ec:null,cid:S.cid.toString(),uid:S.uid.toString(),csIp:S.csIp,unilbsServerIds:[Jt.CHOOSE_SERVER].toString(),isHttp3:h}),!1),S=>S.code!==A.OPERATION_ABORTED&&(S.code===A.CAN_NOT_GET_GATEWAY_SERVER?S.data.retry:(fe.joinChooseServer(l,{lts:u,succ:!1,csAddr:a,serverList:null,opid:_,ec:S.code,csIp:S.data&&S.data.csIp,unilbsServerIds:[Jt.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:m}),isHttp3:h}),R.warning("[".concat(c||"sid-".concat(l.slice(0,6)),"] Choose server network error, retry"),S),!0)),r)}function bL(e,t,i,r){let a,{url:s,areaCode:c,serviceIds:l}=e,u=Date.now(),[h,p]=fC(t,c,l),_;return Rn(async()=>{_&&Qt.networkState===xr.OFFLINE&&Qt.onlineWaiter&&await ae.race([Qt.onlineWaiter,yi(r&&r.maxRetryTimeout||ti.maxRetryTimeout)]),_=Qt.networkState;let{data:m,headers:S}=await vn(s,{data:h,cancelToken:i,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);a=S.http3==="1"?1:-1,fe.reportResourceTiming(s,t.sid),tB(m,s,t,u,l,a);let C=jh(m,Jt.CHOOSE_SERVER),v=jh(m,t.cloudProxyServer==="proxy5"?Jt.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?Jt.CLOUD_PROXY:Jt.CLOUD_PROXY_FALLBACK);return pC(C),{gatewayInfo:tC(C,s),proxyInfo:v,url:s}},m=>(m.gatewayInfo&&fe.joinChooseServer(t.sid,{lts:u,succ:!0,csAddr:s,serverList:m.gatewayInfo.gatewayAddrs.map(S=>S.address),ec:null,opid:p,cid:m.gatewayInfo.cid.toString(),uid:m.gatewayInfo.uid.toString(),csIp:m.gatewayInfo.csIp,unilbsServerIds:l.toString(),isHttp3:a}),m.proxyInfo&&fe.joinWebProxyAP(t.sid,{lts:u,sucess:1,apServerAddr:s,turnServerAddrList:m.proxyInfo.addresses.map(S=>S.ip).join(","),errorCode:null,eventType:t.cloudProxyServer,unilbsServerIds:l.toString()}),!1),m=>m.code!==A.OPERATION_ABORTED&&(m.code===A.CAN_NOT_GET_GATEWAY_SERVER?m.data.retry:(fe.joinWebProxyAP(t.sid,{lts:u,sucess:0,apServerAddr:s,turnServerAddrList:null,errorCode:m.code,eventType:t.cloudProxyServer,unilbsServerIds:l.toString(),extend:JSON.stringify({networkState:_})}),R.warning("[".concat(t.clientId,"] multi unilbs network error, retry"),m),!0)),r)}var tB=(e,t,i,r,a,s)=>{let{sid:c,clientId:l,cloudProxyServer:u}=i,h=[],p=_=>{_.flag===4096?fe.joinChooseServer(c,{lts:r,succ:!1,csAddr:t,opid:e.opid,serverList:null,ec:_.error.message,csIp:_.error.data&&_.error.data.csIp,unilbsServerIds:a.toString(),isHttp3:s}):_.flag!==1048576&&_.flag!==4194304&&_.flag!==4194310||fe.joinWebProxyAP(c,{lts:r,sucess:0,apServerAddr:t,turnServerAddrList:null,errorCode:_.error.code,eventType:u,unilbsServerIds:a.toString()})};if(e.response_body.forEach(_=>{let m=_.buffer.code;if(_.uri===23&&m===0&&!_.buffer.edges_services)if(_.buffer.flag===4194310)R.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),_.buffer.edges_services=[];else{let S={error:new B(A.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:e.detail[502]}),flag:_.buffer.flag};h.push(S),p(S)}if(m!==0){let S=gd(m),C={error:new B(A.CAN_NOT_GET_GATEWAY_SERVER,S.desc,{desc:S.desc,retry:S.retry,csIp:e.detail[502]}),flag:_.buffer.flag};_.buffer.flag===4194310?R.warning(C.error.toString()):h.push(C),p(C)}}),h.length)throw R.warning("[".concat(l||"sid-".concat(c.slice(0,6)),"] multi unilbs ").concat(t," failed, ").concat(h.map(_=>"flag: ".concat(_.flag,", message: ").concat(_.error.message,", retry: ").concat(_.error.data.retry)).join(" | "))),new B(A.CAN_NOT_GET_GATEWAY_SERVER,h.map(_=>"flag: ".concat(_.flag,", message: ").concat(_.error.message)).join(" | "),{retry:!!h.find(_=>_.error.data.retry),csIp:e.detail[502],desc:[...new Set(h.map(_=>{var m;return _==null||(m=_.error)===null||m===void 0||(m=m.data)===null||m===void 0?void 0:m.desc}).filter(_=>!!_))]})},pC=e=>{var t,i,r,a;if(e.addresses&&e.addresses.length===0&&e.code===0)throw new B(A.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:e.detail&&e.detail[502]});if(k("AP_AREA")&&((r=e.detail)!==null&&r!==void 0&&r[23]&&typeof((a=e.detail)===null||a===void 0?void 0:a[23])=="string"?vL(e.detail[23].toLowerCase()):vL()),(t=e.detail)!==null&&t!==void 0&&t[19]&&typeof((i=e.detail)===null||i===void 0?void 0:i[19])=="string"){let c=e.detail[19],l=c==null?void 0:c.split(";");for(let u=0;u<l.length;u++){var s;let h=ir(s=l[u]).call(s);e.addresses[u]&&l&&(e.addresses[u].fingerprint=h)}}if(k("GATEWAY_ADDRESS")&&k("GATEWAY_ADDRESS").length>0){R.debug("assign gateway address to",k("GATEWAY_ADDRESS"));let c=k("GATEWAY_ADDRESS").map(l=>{var u,h;let p=(u=(h=e.addresses.find(_=>_.ip===l.ip&&_.port===l.port))===null||h===void 0?void 0:h.fingerprint)!==null&&u!==void 0?u:"";return{ip:l.ip,port:l.port,ticket:e.addresses[0]&&e.addresses[0].ticket,fingerprint:p}});e.addresses=c}},RJ=(e,t)=>{if(e.response_body&&e.response_body.length){let i=e.response_body[0];if(i.buffer.code!==0){let r=gd(i.buffer.code);throw new B(A.UPDATE_TICKET_FAILED,"[".concat(i.buffer.code,"]: ").concat(r.desc),{retry:r.retry})}return i.buffer.ticket}throw R.debug("update ticket request received ap response without response body:",t),new B(A.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},fC=(e,t,i)=>{let r=Math.floor(Math.random()*1e12),a={appid:e.appId,client_ts:Date.now(),opid:r,sid:e.sid,request_bodies:[{uri:22,buffer:{cname:e.cname,detail:qv({6:e.stringUid,11:t,12:k("USE_NEW_TOKEN")?"1":void 0,22:t},e.apRTM?{26:"RTM2"}:{}),key:e.token,service_ids:i,uid:e.uid||0}}]};a.request_bodies.forEach(c=>{e.multiIP&&e.multiIP.gateway_ip&&(c.buffer.detail[5]=JSON.stringify({vocs_ip:[e.multiIP.uni_lbs_ip],vos_ip:[e.multiIP.gateway_ip]}))});let s=new FormData;return s.append("request",JSON.stringify(a)),[s,r]},vJ=(e,t)=>{let i=Math.floor(Math.random()*1e12),r={appid:e.appId,client_ts:Date.now(),opid:i,sid:e.sid,request_bodies:[{uri:28,buffer:{cname:e.cname,detail:{1:"",6:e.stringUid,12:"1"},token:e.token,service_ids:t,uid:e.uid||0,edges_services:e.apResponse.addresses.map(s=>({ip:s.ip,port:s.port}))}}]},a=new FormData;return a.append("request",JSON.stringify(r)),[a,i]},dd=0;function Md(e){return ae.all(e.map(t=>t.then(i=>{throw i},i=>i))).then(t=>{throw t},t=>t)}var Hh=async e=>{let{fragementLength:t,referenceList:i,asyncMapHandler:r,allFailedhandler:a,promisesCollector:s}=e,c=0,l=t,u,h=0,p=async()=>{let _=(()=>{let m=c*l,S=m+l;return i.slice(m,S).map(r)})();s&&s.push(..._);try{u=await Md(_)}catch(m){if(h+=l,c++,!(h>=i.length))return void await p();a(m)}_.forEach(m=>m.cancel())};return await p(),u},iB=async e=>{let{referenceList:t,asyncMapHandler:i,closeFn:r}=e,a=t.length,s=0,c=async()=>{let l=i(t.shift());try{return await l}catch(u){if(s++,s>=a||r!=null&&r(u))throw u;return c()}};return c()};async function Xv(e,t,i,r){return{gatewayInfo:await async function(a,s,c,l){let u=null,h=[],p=async()=>{let m=k("WEBCS_DOMAIN").slice(0,k("AJAX_REQUEST_CONCURRENT")).map(v=>({url:a.proxyServer?"https://".concat(a.proxyServer,"/ap/?url=").concat(v+"/api/v2/transpond/webrtc?v=2"):"https://".concat(v,"/api/v2/transpond/webrtc?v=2"),areaCode:Gh()})),S=l.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:m.map(v=>v.url)}),C=await Hh({fragementLength:k("FRAGEMENT_LENGTH"),referenceList:m,asyncMapHandler:v=>(R.debug("[".concat(a.clientId,"] Connect to choose_server:"),v.url),CL(v,a,s,c)),allFailedhandler:v=>{throw l.recordJoinChannelService({endTs:Date.now(),status:"error",errors:v},S),v[0]},promisesCollector:h});return l.recordJoinChannelService({endTs:Date.now(),status:"success"},S),C},_=async()=>{if(await yi(1e3),u!==null)return u;let m=k("WEBCS_DOMAIN_BACKUP_LIST").map(v=>({url:a.proxyServer?"https://".concat(a.proxyServer,"/ap/?url=").concat(v+"/api/v2/transpond/webrtc?v=2"):"https://".concat(v,"/api/v2/transpond/webrtc?v=2"),areaCode:Gh()})),S=l.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:m.map(v=>v.url)}),C=await Hh({fragementLength:k("FRAGEMENT_LENGTH"),referenceList:m,asyncMapHandler:v=>(R.debug("[".concat(a.clientId,"] Connect to backup choose_server:"),v.url),CL(v,a,s,c)),allFailedhandler:v=>{throw l.recordJoinChannelService({endTs:Date.now(),status:"error",errors:v},S),v[0]},promisesCollector:h});return l.recordJoinChannelService({endTs:Date.now(),status:"success"},S),C};try{return u=await Md([p(),_()]),h.length&&h.forEach(m=>m.cancel&&typeof m.cancel=="function"&&m.cancel()),u}catch(m){throw m[0]}}(e,t,i,r)}}async function AL(e,t,i,r,a){let s=e.cloudProxyServer;if(s==="disabled"){if(e.useLocalAccessPoint)return await Xv(e,t,i,a);if(k("JOIN_WITH_FALLBACK_MEDIA_PROXY")){let{gatewayInfo:m,proxyInfo:S}=await OL(e,t,i,a);if(e.turnServer&&e.turnServer.mode!=="auto")return{gatewayInfo:m};let C=S.map(v=>({turnServerURL:v.address,tcpport:v.tcpport||Ni.tcpport,udpport:v.udpport||Ni.udpport,username:v.username||Ni.username,password:v.password||Ni.password,forceturn:!1,security:!0}));if(a.useP2P){var c;let v=(c=e.uid)!==null&&c!==void 0?c:m.uid,y="glb:".concat(v.toString()),I=await Pv(y),O=S.map(P=>({turnServerURL:P.address,tcpport:P.tcpport||Ni.tcpport,udpport:P.udpport||Ni.udpport,username:y,password:I,forceturn:!1,security:!0}));C.push(...O)}return e.turnServer={mode:"manual",servers:C},{gatewayInfo:m}}return await Xv(e,t,i,a)}let{proxyInfo:l,gatewayInfo:u}=await OL(e,t,i,a),h={gatewayInfo:u},p=l.map(m=>({turnServerURL:m.address,tcpport:s==="proxy3"?void 0:m.tcpport?m.tcpport:Ni.tcpport,udpport:s==="proxy4"?void 0:m.udpport?m.udpport:Ni.udpport,username:m.username||Ni.username,password:m.password||Ni.password,forceturn:s!=="proxy4",security:s==="proxy5"}));if(a.useP2P){var _;let m=(_=e.uid)!==null&&_!==void 0?_:u.uid,S="glb:".concat(m.toString()),C=await Pv(S),v=l.map(y=>({turnServerURL:y.address,tcpport:s==="proxy3"?void 0:y.tcpport||Ni.tcpport,udpport:s==="proxy4"?void 0:y.udpport||Ni.udpport,username:S,password:C,forceturn:s!=="proxy4",security:s==="proxy5"}));p.push(...v)}return e.turnServer={mode:"manual",servers:p},R.debug("[".concat(e.clientId,"] set proxy server: ").concat(e.proxyServer,", mode: ").concat(s)),h}async function rB(e,t,i,r,a){let s=k("ACCOUNT_REGISTER").slice(0,k("AJAX_REQUEST_CONCURRENT")),c=[];c=t.proxyServer?s.map(u=>"https://".concat(t.proxyServer,"/ap/?url=").concat(u+"/api/v1")):s.map(u=>"https://".concat(u,"/api/v1"));let l=a==null?void 0:a.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:c});try{let u=await async function(h,p,_,m,S){let C=Date.now(),v={sid:_.sid,opid:10,appid:_.appId,string_uid:p},y=h[0],I=await Rn(()=>vn(y+"".concat(y.indexOf("?")===-1?"?":"&","action=stringuid"),{data:v,cancelToken:m,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(O,P)=>{if(O.code===0){if(O.uid<=0||O.uid>=Math.pow(2,32))throw R.error("Invalid Uint Uid ".concat(p," => ").concat(O.uid),O),fe.reqUserAccount(v.sid,{lts:C,success:!1,serverAddr:y,stringUid:v.string_uid,uid:O.uid,errorCode:A.INVALID_UINT_UID_FROM_STRING_UID,extend:v}),new B(A.INVALID_UINT_UID_FROM_STRING_UID);return fe.reqUserAccount(v.sid,{lts:C,success:!0,serverAddr:y,stringUid:v.string_uid,uid:O.uid,errorCode:null,extend:v}),!1}let U=gd(O.code);return U.retry&&(y=h[(P+1)%h.length]),fe.reqUserAccount(v.sid,{lts:C,success:!1,serverAddr:y,stringUid:v.string_uid,uid:O.uid,errorCode:U.desc,extend:v}),U.retry},(O,P)=>O.code!==A.OPERATION_ABORTED&&(fe.reqUserAccount(v.sid,{lts:C,success:!1,serverAddr:y,stringUid:v.string_uid,uid:null,errorCode:O.code,extend:v}),y=h[(P+1)%h.length],!0),S);if(I.code!==0){let O=gd(I.code);throw new B(A.UNEXPECTED_RESPONSE,O.desc)}return I}(c,e,t,i,r);return a==null||a.recordJoinChannelService({status:"success",endTs:Date.now()},l),u.uid}catch(u){throw a==null||a.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[u]},l),u}}async function yJ(e,t,i){let r=k("ACCOUNT_REGISTER"),a=[];a=t.proxyServer?r.map(s=>"https://".concat(t.proxyServer,"/ap/?url=").concat(s+"/api/v1")):r.map(s=>"https://".concat(s,"/api/v1"));try{return await iB({referenceList:a,asyncMapHandler:s=>async function(c,l,u,h){let p=Date.now(),_={sid:u.sid,opid:10,appid:u.appId,string_uid:l};try{let m=await vn(c+"".concat(c.indexOf("?")===-1?"?":"&","action=stringuid"),{data:_,cancelToken:h,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(m.code!==0){let S=gd(m.code);throw new B(A.UNEXPECTED_RESPONSE,"preload sua error:".concat(S.desc),S)}if(m.uid<=0||m.uid>=Math.pow(2,32))throw new B(A.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:p,url:c,req:_,uid:m.uid,elapse:Date.now()-p}}catch(m){throw m}}(s,e,t,i),closeFn:s=>s.code===A.OPERATION_ABORTED||s.code===A.UNEXPECTED_RESPONSE&&!s.data.retry})}catch(s){throw s}}async function CJ(e,t,i){let r=k("CDS_AP").slice(0,k("AJAX_REQUEST_CONCURRENT")).map(u=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(u+"/api/v1"):"https://".concat(u,"/api/v1?action=config")),a=r.map(u=>function(h,p,_,m){let S=Ge(),C={flag:64,cipher_method:0,features:{device:S.name,system:S.os,system_general:navigator.userAgent,vendor:p.appId,version:Sa,cname:p.cname,sid:p.sid,session_id:p.sid,detail:"",proxyServer:p.proxyServer}};return Rn(()=>vn(h,{data:C,timeout:1e3,cancelToken:_,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,v=>v.code!==A.OPERATION_ABORTED,m)}(u,e,t,i)),s=null,c=null,l={};try{s=await Md(a)}catch(u){if(u.code===A.OPERATION_ABORTED)throw u;c=u}if(a.forEach(u=>u.cancel()),fe.reportApiInvoke(e.sid,{name:ni.REQUEST_CONFIG_DISTRIBUTE,options:{error:c,res:s}}).onSuccess(),s&&s.test_tags)try{l=function(u){if(!u.test_tags)return{};let h=u.test_tags,p=Object.keys(h),_={};return p.forEach(m=>{var S;let C=ir(S=m.slice(4)).call(S),v=JSON.parse(h[m])[1];_[C]=v}),_}(s)}catch{}return l}async function IL(e,t){let i=k("WEBCS_DOMAIN").concat(k("WEBCS_DOMAIN_BACKUP_LIST")).map(r=>({url:"https://".concat(r,"/api/v2/transpond/webrtc?v=2"),areaCode:Gh(),serviceIds:[Jt.CHOOSE_SERVER,Jt.CLOUD_PROXY_FALLBACK]}));try{return await iB({referenceList:i,asyncMapHandler:r=>async function(a,s,c){let l,{url:u,areaCode:h,serviceIds:p}=a,_=Date.now(),[m,S]=fC(s,h,p),C=Qt.networkState;try{C&&Qt.networkState===xr.OFFLINE&&Qt.onlineWaiter&&await ae.race([Qt.onlineWaiter,yi(ti.maxRetryTimeout)]),C=Qt.networkState;let{data:v,headers:y}=await vn(u,{data:m,cancelToken:c,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);l=y.http3==="1"?1:-1,(P=>{let U=[];if(P.response_body.forEach(x=>{let G=x.buffer.code;if(x.uri===23&&G===0&&!x.buffer.edges_services)if(x.buffer.flag===4194310)x.buffer.edges_services=[];else{let Z={error:new B(A.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:P.detail[502]}),flag:x.buffer.flag};U.push(Z)}if(G!==0){let Z=gd(G),J={error:new B(A.CAN_NOT_GET_GATEWAY_SERVER,Z.desc,{desc:Z.desc,retry:Z.retry,csIp:P.detail[502]}),flag:x.buffer.flag};x.buffer.flag===4194310?R.warning(J.error.toString()):U.push(J)}}),U.length)throw new B(A.CAN_NOT_GET_GATEWAY_SERVER,U.map(x=>"flag: ".concat(x.flag,", message: ").concat(x.error.message)).join(" | "),{retry:!!U.find(x=>x.error.data.retry),csIp:P.detail[502],desc:[...new Set(U.map(x=>{var G;return x==null||(G=x.error)===null||G===void 0||(G=G.data)===null||G===void 0?void 0:G.desc}).filter(x=>!!x))]})})(v);let I=jh(v,Jt.CHOOSE_SERVER),O=jh(v,Jt.CLOUD_PROXY_FALLBACK);return pC(I),{gatewayInfo:tC(I,u),proxyInfo:O,opid:S,requestTime:_,url:u,isHttp3:l,elapse:Date.now()-_}}catch(v){throw v}}(r,e,t),closeFn:r=>r.code===A.OPERATION_ABORTED||r.code===A.CAN_NOT_GET_GATEWAY_SERVER&&!r.data.retry})}catch(r){throw r}}async function OL(e,t,i,r){let a=k("PROXY_SERVER_TYPE3"),s=(S,C,v)=>{let y=v||a;return Array.isArray(y)&&(y=C%2==0?a[1]:a[0]),"https://".concat(y,"/ap/?url=").concat(S)},c=null,l=[],u=async()=>{let S=k("WEBCS_DOMAIN").slice(0,k("AJAX_REQUEST_CONCURRENT")).map((y,I)=>{let O;return O=e.cloudProxyServer==="disabled"&&e.proxyServer?s("".concat(y,"/api/v2/transpond/webrtc?v=2"),I,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(y,"/api/v2/transpond/webrtc?v=2"):s("".concat(y,"/api/v2/transpond/webrtc?v=2"),I),{url:O,areaCode:Gh(),serviceIds:[Jt.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?Jt.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?Jt.CLOUD_PROXY:Jt.CLOUD_PROXY_FALLBACK]}}),C=r.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:S.map(y=>y.url)}),v=await Hh({fragementLength:k("FRAGEMENT_LENGTH"),referenceList:S,asyncMapHandler:y=>(R.debug("[".concat(e.clientId,"] Connect to choose_server:"),y.url),bL(y,e,t,i)),allFailedhandler:y=>{throw r.recordJoinChannelService({endTs:Date.now(),status:"error",errors:y},C),y[0]},promisesCollector:l});return r.recordJoinChannelService({endTs:Date.now(),status:"success"},C),v},h=async()=>{if(await yi(1e3),c!==null)return c;let S=k("WEBCS_DOMAIN_BACKUP_LIST").map((y,I)=>{let O;return O=e.cloudProxyServer==="disabled"&&e.proxyServer?s("".concat(y,"/api/v2/transpond/webrtc?v=2"),I,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(y,"/api/v2/transpond/webrtc?v=2"):s("".concat(y,"/api/v2/transpond/webrtc?v=2"),I),{url:O,areaCode:Gh(),serviceIds:[Jt.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?Jt.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?Jt.CLOUD_PROXY:Jt.CLOUD_PROXY_FALLBACK]}}),C=r.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:S.map(y=>y.url)}),v=await Hh({fragementLength:k("FRAGEMENT_LENGTH"),referenceList:S,asyncMapHandler:y=>(R.debug("[".concat(e.clientId,"] Connect to backup choose_server:"),y.url),bL(y,e,t,i)),allFailedhandler:y=>{throw r.recordJoinChannelService({endTs:Date.now(),status:"error",errors:y},C),y[0]},promisesCollector:l});return r.recordJoinChannelService({endTs:Date.now(),status:"success"},C),v},p,_,m;try{({gatewayInfo:p,proxyInfo:_,url:m}=await Md([u(),h()]))}catch(S){throw S[0]}if(l.length&&l.forEach(S=>S.cancel&&typeof S.cancel=="function"&&S.cancel()),!p||!_)throw new B(A.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(e.apUrl=m,e.cloudProxyServer!=="disabled"&&Array.isArray(a)&&m){let S=/^https?:\/\/(.+?)(\/.*)?$/.exec(m)[1];oe(a).call(a,S)&&(e.proxyServer=S,R.setProxyServer(S),fe.setProxyServer(S))}return c={gatewayInfo:p,proxyInfo:await hV(_,p.uid)},c}async function bJ(e,t,i){let r=k("UAP_AP").slice(0,k("AJAX_REQUEST_CONCURRENT")).map(s=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(s+"/api/v1?action=uap"):"https://".concat(s,"/api/v1?action=uap")),a=r.map(s=>function(c,l,u,h){let p={command:"convergeAllocateEdge",sid:l.sid,appId:l.appId,token:l.token,ts:Date.now(),version:Sa,cname:l.cname,uid:l.uid.toString(),requestId:gR,seq:gR};gR+=1;let _={service_name:"tele_channel",json_body:JSON.stringify(p)};return Rn(async()=>{let m=await vn(c,{data:_,cancelToken:u,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(m.code!==0){let C=new B(A.UNEXPECTED_RESPONSE,"cross channel ap error, code"+m.code,{retry:!0});throw R.error(C.toString()),C}let S=JSON.parse(m.json_body);if(S.code!==200){let C=new B(A.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(S.code,", reason: ").concat(S.reason));throw R.error(C.toString()),C}if(!S.servers||S.servers.length===0){let C=new B(A.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw R.error(C.toString()),C}return{vid:S.vid,workerToken:S.workerToken,addressList:(k("CHANNEL_MEDIA_RELAY_SERVERS")||S.servers).map(C=>"wss://".concat(C.address.replace(/\./g,"-"),".").concat(k("WORKER_DOMAIN"),":").concat(C.wss))}},void 0,m=>!!(m.code!==A.OPERATION_ABORTED&&m.code!==A.UNEXPECTED_RESPONSE||m.data&&m.data.retry),h)}(s,e,t,i));try{let s=await Md(a);return a.forEach(c=>c.cancel()),s}catch(s){throw s[0]}}async function AJ(e,t,i){let r=null,a=[],s=async c=>{let l=k(c?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(u=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(u+"/api/v2/transpond/webrtc?v=2"):"https://".concat(u,"/api/v2/transpond/webrtc?v=2"));return c&&(await yi(1e3),r!==null)?r:await Hh({fragementLength:k("FRAGEMENT_LENGTH"),referenceList:l,asyncMapHandler:u=>(R.debug("[".concat(e.clientId,"] update ticket, Connect to ").concat(c?"backup":""," choose_server:"),u),function(h,p,_,m){let[S]=vJ(p,[Jt.CHOOSE_SERVER]),C=Qt.networkState;return Rn(async()=>{C&&Qt.networkState===xr.OFFLINE&&Qt.onlineWaiter&&await ae.race([Qt.onlineWaiter,yi(m&&m.maxRetryTimeout||ti.maxRetryTimeout)]),C=Qt.networkState;let v=await vn(h,{data:S,cancelToken:_,headers:{"Content-Type":"multipart/form-data;"}},!0);return RJ(v,h)},()=>!1,v=>v.code!==A.OPERATION_ABORTED&&(v.code===A.UPDATE_TICKET_FAILED?v.data.retry:(R.warning("[".concat(p.clientId,"] update ticket network error, retry"),v),!0)),m)}(u,e,t,i)),allFailedhandler:u=>{throw u[0]},promisesCollector:a})};try{return r=await Md([s(!1),s(!0)]),a.length&&a.forEach(c=>c.cancel&&typeof c.cancel=="function"&&c.cancel()),r}catch(c){throw c[0]}}function wL(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),i.push.apply(i,r)}return i}function NL(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?wL(Object(i),!0).forEach(function(r){b(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):wL(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}var IJ=class extends Lt{get isSuccess(){return!!this.configs}constructor(){super(),b(this,"configs",void 0),b(this,"joinInfo",void 0),b(this,"cancelToken",void 0),b(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),b(this,"interval",void 0),b(this,"mutex",new Fi("config-distribute")),b(this,"mutableParamsRead",!1)}startGetConfigDistribute(e,t){this.joinInfo=e,this.cancelToken=t,this.interval&&this.stopGetConfigDistribute(),k("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},k("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,fe.reportApiInvoke(null,{options:void 0,name:ni.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:Vt.TRACER}).onSuccess(JSON.stringify(So))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void R.debug("[config-distribute] get config distribute interrupted have no joininfo");let e,t=await this.mutex.lock();try{e=await CJ(this.joinInfo,this.cancelToken,this.retryConfig),R.debug("[config-distribute] get config distribute",JSON.stringify(e)),e.limit_bitrate&&this.handleBitrateLimit(e.limit_bitrate),this.cacheGlobalParameterConfig(e),this.configs=e}catch(i){let r=new B(A.NETWORK_RESPONSE_ERROR,i);R.warning("[config-distribute] ".concat(r.toString()))}finally{t()}}getBitrateLimit(){return this.configs?this.configs.limit_bitrate:void 0}handleBitrateLimit(e){var t;(t=e)&&t.uplink&&t.id&&t.uplink.max_bitrate!==void 0&&t.uplink.min_bitrate!==void 0&&(this.configs&&this.configs.limit_bitrate?this.configs&&this.configs.limit_bitrate&&this.configs.limit_bitrate.id!==e.id&&this.emit(xv.UPDATE_BITRATE_LIMIT,e):this.emit(xv.UPDATE_BITRATE_LIMIT,e))}getLowStreamConfigDistribute(){return this.configs&&this.configs.limit_bitrate&&NL({},this.configs.limit_bitrate.low_stream_uplink)}cacheGlobalParameterConfig(e){var t;let i=cp(t=Object.keys(e).filter(a=>/^webrtc_ng_global_parameter/.test(a))).call(t);for(let a=0;a<i.length;a++)for(let s=i.length-1;s>a;s--){let c=i[s];if(typeof e[c].__priority=="number"){let l=e[c].__priority,u=i[s-1];if(typeof e[u].__priority=="number"){if(!(l>e[u].__priority))continue;{let h=c;i[s]=i[s-1],i[s-1]=h}}else{let h=c;i[s]=i[s-1],i[s-1]=h}}}let r={};i.forEach(a=>{let s=e[a],c=s.__expires;Object.keys(s).forEach(l=>{l==="__priority"||l==="__expires"||Object.prototype.hasOwnProperty.call(r,l)||(r[l]=NL({value:s[l]},c&&{expires:c}))})});try{(function(c){try{let l=Date.now();Object.keys(c).forEach(u=>{switch(u){case"ENABLE_EVENT_REPORT":case"UPLOAD_LOG":case"ENABLE_AG_ADAPTATION":case"FORCE_AG_HIGH_FRAMERATE":case"FORCE_SUPPORT_AG_ADAPTATION":case"ENCODER_CONFIG_LIMIT":case"CAMERA_CAPTURE_CONFIG":case"ENABLE_PRELOAD":if(Object.prototype.hasOwnProperty.call(Wt,u)){let{value:h,expires:p}=c[u];if(p&&p<=l)return;So[u]=h,Wt[u]=h,R.debug("Update global parameters from config distribute",u,h)}}})}catch(l){R.error("Error update config immediately: ".concat(c),l.message)}})(r);let a=JSON.stringify(r),s=window.btoa(a);window.localStorage.setItem("websdk_ng_global_parameter",s),R.debug("Caching global parameters ".concat(a))}catch(a){R.error("Error caching global parameters:",a.message)}}},OJ=class extends Lt{constructor(){super(...arguments),b(this,"resultStorage",new Map)}setLocalAudioStats(e,t,i){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",e,this.checkAudioInputLevel(i,t)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",e,this.checkSendAudioBitrate(i,t))}setLocalVideoStats(e,t,i){this.record("SEND_VIDEO_BITRATE_TOO_LOW",e,this.checkSendVideoBitrate(i,t)),this.record("FRAMERATE_INPUT_TOO_LOW",e,this.checkFramerateInput(i,t)),this.record("FRAMERATE_SENT_TOO_LOW",e,this.checkFramerateSent(i))}setRemoteAudioStats(e,t){let i=e.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",i,this.checkAudioOutputLevel(t))}setRemoteVideoStats(e,t){let i=e.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",i,this.checkVideoDecode(t))}record(e,t,i){if(k("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(e)||this.resultStorage.set(e,{result:[],isPrevNormal:!0});let r=this.resultStorage.get(e);if(r&&(r.result.push(i),r.result.length>=5)){var a;let s=oe(a=r.result).call(a,!0);r.isPrevNormal&&!s&&this.emit("exception",DL[e],e,t),!r.isPrevNormal&&s&&this.emit("exception",DL[e]+2e3,e+"_RECOVER",t),r.isPrevNormal=s,r.result=[]}}checkAudioOutputLevel(e){return!(e.receiveBitrate>0&&e.receiveLevel===0)}checkAudioInputLevel(e,t){return t instanceof hi&&!t.isActive||!!t.muted||e.sendVolumeLevel!==0}checkFramerateInput(e,t){let i=null;t._encoderConfig&&t._encoderConfig.frameRate&&(i=Br(t._encoderConfig.frameRate));let r=e.captureFrameRate;return!i||!r||!(i>10&&r<5||i<10&&i>=5&&r<=1)}checkFramerateSent(e){return!(e.captureFrameRate&&e.sendFrameRate&&e.captureFrameRate>5&&e.sendFrameRate<=1)}checkSendVideoBitrate(e,t){return!!t.muted||e.sendBitrate!==0}checkSendAudioBitrate(e,t){return t instanceof hi&&!t.isActive||!!t.muted||e.sendBitrate!==0}checkVideoDecode(e){return e.receiveBitrate===0||e.decodeFrameRate!==0}},DL={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003},ji=new class{markSubscribeStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/subscribe-").concat(t))}markPublishStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/publish-").concat(t))}measureFromSubscribeStart(e,t){let i=performance.getEntriesByName("agora-web-sdk/".concat(e,"/subscribe-").concat(t));if(i.length>0){let r=i[i.length-1];return Math.round(performance.now()-r.startTime)}return 0}measureFromPublishStart(e,t){let i=performance.getEntriesByName("agora-web-sdk/".concat(e,"/publish-").concat(t));if(i.length>0){let r=i[i.length-1];return Math.round(performance.now()-r.startTime)}return 0}};function _C(e,t){this.v=e,this.k=t}function Ye(e){return new _C(e,0)}var wJ=s2,NJ=Qn;_t({target:"Promise",stat:!0,forced:!0},{withResolvers:function(){var e=NJ.f(this);return{promise:e.promise,resolve:e.resolve,reject:e.reject}}});var DJ=Qn,PJ=Nd;_t({target:"Promise",stat:!0,forced:!0},{try:function(e){var t=DJ.f(this),i=PJ(e);return(i.error?t.reject:t.resolve)(i.value),t.promise}});var Jv=zt(wJ),aB=Dd.f("asyncIterator"),LJ=zt(aB);function ch(e){var t,i;function r(s,c){try{var l=e[s](c),u=l.value,h=u instanceof _C;Jv.resolve(h?u.v:u).then(function(p){if(h){var _=s==="return"?"return":"next";if(!u.k||p.done)return r(_,p);p=e[_](p).value}a(l.done?"return":"normal",p)},function(p){r("throw",p)})}catch(p){a("throw",p)}}function a(s,c){switch(s){case"return":t.resolve({value:c,done:!0});break;case"throw":t.reject(c);break;default:t.resolve({value:c,done:!1})}(t=t.next)?r(t.key,t.arg):i=null}this._invoke=function(s,c){return new Jv(function(l,u){var h={key:s,arg:c,resolve:l,reject:u,next:null};i?i=i.next=h:(t=i=h,r(s,c))})},typeof e.return!="function"&&(this.return=void 0)}function gn(e){return function(){return new ch(e.apply(this,arguments))}}ch.prototype[typeof Xl=="function"&&LJ||"@@asyncIterator"]=function(){return this},ch.prototype.next=function(e){return this._invoke("next",e)},ch.prototype.throw=function(e){return this._invoke("throw",e)},ch.prototype.return=function(e){return this._invoke("return",e)};var PL=zt(Tn.Object.getOwnPropertySymbols),kJ=_t,MJ=fy.indexOf,UJ=LE,Qv=Oh([].indexOf),LL=!!Qv&&1/Qv([1],1,-0)<0;kJ({target:"Array",proto:!0,forced:LL||!UJ("indexOf")},{indexOf:function(e){var t=arguments.length>1?arguments[1]:void 0;return LL?Qv(this,e,t)||0:MJ(this,e,t)}});var xJ=en("Array").indexOf,VJ=_r,BJ=xJ,SR=Array.prototype,jJ=function(e){var t=e.indexOf;return e===SR||VJ(SR,e)&&t===SR.indexOf?BJ:t},kL=zt(jJ);function FJ(e,t){if(e==null)return{};var i,r,a=function(c,l){if(c==null)return{};var u,h,p={},_=sV(c);for(h=0;h<_.length;h++)u=_[h],kL(l).call(l,u)>=0||(p[u]=c[u]);return p}(e,t);if(PL){var s=PL(e);for(r=0;r<s.length;r++)i=s[r],kL(t).call(t,i)>=0||Object.prototype.propertyIsEnumerable.call(e,i)&&(a[i]=e[i])}return a}function Ya(e){if(Array.isArray(e))return e.map(i=>i);if(!ML(e))return e;let t={};for(let i in e){let r=e[i];ML(r)||Array.isArray(r)?t[i]=Ya(r):t[i]=r}return t}function ML(e){return!(typeof e!="object"||Array.isArray(e)||!e)}var TR=class{constructor(e){b(this,"input",[]),b(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}},Yn={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},Wh={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:Yn,remoteCandidate:Yn}},nB={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0},sB={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},oB={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},cB={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packetsDiscarded:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0};function UL(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),i.push.apply(i,r)}return i}function xL(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?UL(Object(i),!0).forEach(function(r){b(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):UL(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}var EC=class{constructor(e,t){b(this,"onFirstVideoReceived",void 0),b(this,"onFirstVideoDecoded",void 0),b(this,"onFirstAudioReceived",void 0),b(this,"onFirstVideoDecodedTimeout",void 0),b(this,"onFirstAudioDecoded",void 0),b(this,"onSelectedLocalCandidateChanged",void 0),b(this,"onSelectedRemoteCandidateChanged",void 0),b(this,"videoIsReady",!1),b(this,"videoIsReady2",{}),b(this,"pc",void 0),b(this,"options",void 0),b(this,"intervalTimer",void 0),b(this,"stats",Ya(Wh)),b(this,"isFirstVideoReceived",{}),b(this,"isFirstVideoDecoded",{}),b(this,"isFirstAudioReceived",{}),b(this,"isFirstAudioDecoded",{}),b(this,"isFirstVideoDecodedTimeout",{}),b(this,"lossRateWindowStats",[]),this.pc=e,this.options=t,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new ae(e=>{e({local:xL({},Yn),remote:xL({},Yn)})})}setVideoIsReady(e){this.videoIsReady=e}setVideoIsReady2(e,t){this.videoIsReady2[e]=t}getVideoIsReady(e){return this.videoIsReady2[e]||!1}setIsFirstAudioDecoded(e){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(e){this.lossRateWindowStats.push(e),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);let t=this.lossRateWindowStats.length,i=["videoSend","audioSend","videoRecv","audioRecv"],r=0,a=0,s=0,c=0;for(let l of i)e[l].forEach((u,h)=>{if(!this.lossRateWindowStats[t-1][l][h]||!this.lossRateWindowStats[0][l][h])return;let p=this.lossRateWindowStats[t-1][l][h].packets-this.lossRateWindowStats[0][l][h].packets,_=this.lossRateWindowStats[t-1][l][h].packetsLost-this.lossRateWindowStats[0][l][h].packetsLost;l==="videoSend"||l==="audioSend"?(r+=p,s+=_):(a+=p,c+=_),Number.isNaN(p)||Number.isNaN(p)?u.packetLostRate=0:u.packetLostRate=p<=0||_<=0?0:_/(p+_)});e.sendPacketLossRate=r<=0||s<=0?0:s/(r+s),e.recvPacketLossRate=a<=0||c<=0?0:c/(a+c)}};function VL(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),i.push.apply(i,r)}return i}function GJ(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?VL(Object(i),!0).forEach(function(r){b(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):VL(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}var HJ=class extends EC{constructor(){super(...arguments),b(this,"_stats",Wh),b(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){let e=await this._getStats(),t=this.statsResponsesToObjects(e);this._stats=Ya(Wh);let i=t.filter(a=>a.type==="ssrc");this.processSSRCStats(i);let r=t.find(a=>a.type==="VideoBwe");r&&this.processBandwidthStats(r),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(e){this._stats.bitrate={actualEncoded:Number(e.googActualEncBitrate),targetEncoded:Number(e.googTargetEncBitrate),retransmit:Number(e.googRetransmitBitrate),transmit:Number(e.googTransmitBitrate)},this._stats.sendBandwidth=Number(e.googAvailableSendBandwidth)}processSSRCStats(e){e.forEach(t=>{var i;let r=oe(i=t.id).call(i,"send");switch("".concat(t.mediaType,"_").concat(r?"send":"recv")){case"video_send":{let a=Ya(sB);a.codec=t.googCodecName,a.adaptionChangeReason="none",t.googCpuLimitedResolution&&(a.adaptionChangeReason="cpu"),t.googBandwidthLimitedResolution&&(a.adaptionChangeReason="bandwidth"),a.avgEncodeMs=Number(t.googAvgEncodeMs),a.inputFrame={width:Number(t.googFrameWidthInput)||Number(t.googFrameWidthSent),height:Number(t.googFrameHeightInput)||Number(t.googFrameHeightSent),frameRate:Number(t.googFrameRateInput)},a.sentFrame={width:Number(t.googFrameWidthSent),height:Number(t.googFrameHeightSent),frameRate:Number(t.googFrameRateInput)},a.firsCount=Number(t.googFirReceived),a.nacksCount=Number(t.googNacksReceived),a.plisCount=Number(t.googPlisReceived),a.frameCount=Number(t.framesEncoded),a.bytes=Number(t.bytesSent),a.packets=Number(t.packetsSent),a.packetsLost=Number(t.packetsLost),a.ssrc=Number(t.ssrc),a.rttMs=Number(t.googRtt||0),this._stats.videoSend.push(a),this._stats.rtt=a.rttMs;break}case"video_recv":{let a=Ya(nB),s=this.lastDecodeVideoReceiverStats.get(Number(t.ssrc));if(a.codec=t.googCodecName,a.targetDelayMs=Number(t.googTargetDelayMs),a.renderDelayMs=Number(t.googRenderDelayMs),a.currentDelayMs=Number(t.googCurrentDelayMs),a.minPlayoutDelayMs=Number(t.googMinPlayoutDelayMs),a.decodeMs=Number(t.googDecodeMs),a.maxDecodeMs=Number(t.googMaxDecodeMs),a.receivedFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateReceived)},a.decodedFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateDecoded)},a.decodeFrameRate=Number(t.googFrameRateDecoded),a.outputFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateOutput)},a.jitterBufferMs=Number(t.googJitterBufferMs),a.firsCount=Number(t.googFirsSent),a.nacksCount=Number(t.googNacksSent),a.plisCount=Number(t.googPlisSent),a.framesDecodeCount=Number(t.framesDecoded),a.bytes=Number(t.bytesReceived),a.packets=Number(t.packetsReceived),a.packetsLost=Number(t.packetsLost),a.ssrc=Number(t.ssrc),a.packets>0&&!this.isFirstVideoReceived[a.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(a.ssrc),this.isFirstVideoReceived[a.ssrc]=!0),a.framesDecodeCount>0&&!this.isFirstVideoDecoded[a.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(a.ssrc,a.decodedFrame.width,a.decodedFrame.height),this.isFirstVideoDecoded[a.ssrc]=!0),s){let c=s.stats,l=Date.now()-s.lts;a.framesDecodeFreezeTime=c.framesDecodeFreezeTime,a.framesDecodeInterval=c.framesDecodeInterval,a.framesDecodeCount>c.framesDecodeCount&&this.isFirstVideoDecoded[a.ssrc]?(s.lts=Date.now(),a.framesDecodeInterval=l,a.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(t.ssrc,10))?a.framesDecodeFreezeTime+=a.framesDecodeInterval:this.setVideoIsReady2(parseInt(t.ssrc,10),!0))):a.framesDecodeCount<s.stats.framesDecodeCount&&(a.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(a.ssrc,{stats:GJ({},a),lts:Date.now()}),this._stats.videoRecv.push(a);break}case"audio_recv":{let a=Ya(cB);a.codec=t.googCodecName,a.outputLevel=Math.abs(Number(t.audioOutputLevel))/32767,a.decodingCNG=Number(t.googDecodingCNG),a.decodingCTN=Number(t.googDecodingCTN),a.decodingCTSG=Number(t.googDecodingCTSG),a.decodingNormal=Number(t.googDecodingNormal),a.decodingPLC=Number(t.googDecodingPLC),a.decodingPLCCNG=Number(t.googDecodingPLCCNG),a.expandRate=Number(t.googExpandRate),a.accelerateRate=Number(t.googAccelerateRate),a.preemptiveExpandRate=Number(t.googPreemptiveExpandRate),a.secondaryDecodedRate=Number(t.googSecondaryDecodedRate),a.speechExpandRate=Number(t.googSpeechExpandRate),a.preferredJitterBufferMs=Number(t.googPreferredJitterBufferMs),a.jitterBufferMs=Number(t.googJitterBufferMs),a.jitterMs=Number(t.googJitterReceived),a.bytes=Number(t.bytesReceived),a.packets=Number(t.packetsReceived),a.packetsLost=Number(t.packetsLost),a.ssrc=Number(t.ssrc),a.receivedFrames=Number(t.googDecodingCTN)||Number(t.packetsReceived),a.droppedFrames=Number(t.googDecodingPLC)+Number(t.googDecodingPLCCNG)||Number(t.packetsLost),a.receivedFrames>0&&!this.isFirstAudioReceived[a.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(a.ssrc),this.isFirstAudioReceived[a.ssrc]=!0),a.decodingNormal>0&&!this.isFirstAudioDecoded[a.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(a.ssrc),this.isFirstAudioDecoded[a.ssrc]=!0),this._stats.audioRecv.push(a);break}case"audio_send":{let a=Ya(oB);a.codec=t.googCodecName,a.inputLevel=Math.abs(Number(t.audioInputLevel))/32767,a.aecReturnLoss=Number(t.googEchoCancellationReturnLoss||0),a.aecReturnLossEnhancement=Number(t.googEchoCancellationReturnLossEnhancement||0),a.residualEchoLikelihood=Number(t.googResidualEchoLikelihood||0),a.residualEchoLikelihoodRecentMax=Number(t.googResidualEchoLikelihoodRecentMax||0),a.bytes=Number(t.bytesSent),a.packets=Number(t.packetsSent),a.packetsLost=Number(t.packetsLost),a.ssrc=Number(t.ssrc),a.rttMs=Number(t.googRtt||0),this._stats.rtt=a.rttMs,this._stats.audioSend.push(a);break}}})}_getStats(){return new ae((e,t)=>{this.pc.getStats(e,t)})}statsResponsesToObjects(e){let t=[];return e.result().forEach(i=>{let r={id:i.id,timestamp:i.timestamp.valueOf().toString(),type:i.type};i.names().forEach(a=>{r[a]=i.stat(a)}),t.push(r)}),t}};function BL(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),i.push.apply(i,r)}return i}function lc(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?BL(Object(i),!0).forEach(function(r){b(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):BL(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}var jL=class extends EC{constructor(){super(...arguments),b(this,"_stats",Wh),b(this,"report",void 0),b(this,"lastDecodeVideoReceiverStats",new Map),b(this,"lastVideoFramesRecv",new Map),b(this,"lastVideoFramesSent",new Map),b(this,"lastVideoFramesDecode",new Map),b(this,"lastVideoFramesOutput",new Map),b(this,"lastVideoJBDelay",new Map),b(this,"lastAudioJBDelay",new Map),b(this,"mediaBytesSent",new Map),b(this,"mediaBytesRetransmit",new Map),b(this,"mediaBytesTargetEncode",new Map),b(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=Ya(Wh),this.report.forEach(e=>{switch(e.type){case Kr.OUTBOUND:case Kr.INBOUND:{let t=e.mediaType||e.kind,i=!t&&"frameWidth"in e,r=!t&&!("frameWidth"in e);e.type===Kr.OUTBOUND?t==="audio"||r?this.processAudioOutboundStats(e):(t==="video"||i)&&this.processVideoOutboundStats(e):e.type===Kr.INBOUND&&(t==="audio"||r?this.processAudioInboundStats(e):(t==="video"||i)&&this.processVideoInboundStats(e));break}case Kr.TRANSPORT:{let t=this.report.get(e.selectedCandidatePairId);t&&this.processCandidatePairStats(t);break}case Kr.CANDIDATE_PAIR:e.selected&&this.processCandidatePairStats(e)}}),this.updateSendBitrate(),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){let e=await this.pc.getStats(),t={local:lc({},Yn),remote:lc({},Yn)};return e.forEach(i=>{let r;if(i.type===Kr.TRANSPORT&&(r=e.get(i.selectedCandidatePairId)),i.type===Kr.CANDIDATE_PAIR&&i.selected&&(r=i),r){let a=(s,c)=>{s.type=c.type,s.id=c.id,c.address&&(s.address=c.address),c.candidateType&&(s.candidateType=c.candidateType),c.port&&(s.port=c.port),c.priority&&(s.priority=c.priority),c.protocol&&(s.protocol=c.protocol),c.relayProtocol&&(s.relayProtocol=c.relayProtocol)};if(r.localCandidateId){let s=e.get(r.localCandidateId);s&&a(t.local,s)}if(r.remoteCandidateId){let s=e.get(r.remoteCandidateId);s&&a(t.remote,s)}}}),t}processCandidatePairStats(e){if(this._stats.sendBandwidth=e.availableOutgoingBitrate||0,e.currentRoundTripTime&&(this._stats.rtt=1e3*e.currentRoundTripTime),this._stats.videoSend.forEach(t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)}),this._stats.audioSend.forEach(t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=e.id,e.localCandidateId){let t=this.report.get(e.localCandidateId);t&&this.processCandidateStats(t)}if(e.remoteCandidateId){let t=this.report.get(e.remoteCandidateId);t&&this.processCandidateStats(t)}}processCandidateStats(e){let t;e.type===Kr.LOCAL_CANDIDATE&&(t=this._stats.selectedCandidatePair.localCandidate),e.type===Kr.REMOTE_CANDIDATE&&(t=this._stats.selectedCandidatePair.remoteCandidate),t&&(t.type=e.type,t.id=e.id,e.address&&(t.address=e.address),e.candidateType&&(t.candidateType=e.candidateType),e.port&&(t.port=e.port),e.priority&&(t.priority=e.priority),e.protocol&&(t.protocol=e.protocol),e.relayProtocol&&(t.relayProtocol=e.relayProtocol),e.type===Kr.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==t.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(lc({},t),lc({},this.stats.selectedCandidatePair.localCandidate)),e.type===Kr.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==t.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(lc({},t),lc({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(e){let t=this._stats.audioRecv.find(i=>i.ssrc===e.ssrc);t||(t=Ya(cB),this._stats.audioRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.packetsDiscarded=e.packetsDiscarded,t.bytes=e.bytesReceived,t.jitterMs=1e3*e.jitter,this.processAudioTrackReceiverStats(e,e.trackId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),t.receivedFrames||(t.receivedFrames=e.packetsReceived),t.droppedFrames||(t.droppedFrames=e.packetsLost),t.receivedFrames>0&&!this.isFirstAudioReceived[t.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(t.ssrc),this.isFirstAudioReceived[t.ssrc]=!0),t.outputLevel&&t.outputLevel>0&&!this.isFirstAudioDecoded[t.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(t.ssrc),this.isFirstAudioDecoded[t.ssrc]=!0),typeof e.concealedSamples=="number"&&(t.concealedSamples=e.concealedSamples)}processVideoInboundStats(e){let t=this._stats.videoRecv.find(c=>c.ssrc===e.ssrc);t||(t=Ya(nB),this._stats.videoRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.bytes=e.bytesReceived,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.framesDecodeCount=e.framesDecoded,t.framesDroppedCount=e.framesDropped,t.totalInterFrameDelay=e.totalInterFrameDelay,t.totalSquaredInterFrameDelay=e.totalSquaredInterFrameDelay,t.totalFreezesDuration=e.totalFreezesDuration;let i=this.lastDecodeVideoReceiverStats.get(t.ssrc),r=this.lastVideoFramesDecode.get(t.ssrc),a=this.lastVideoFramesOutput.get(t.ssrc),s=Date.now();if(t.framesDecodeCount>0&&!this.isFirstVideoDecoded[t.ssrc]){let c=t.decodedFrame?t.decodedFrame.width:0,l=t.decodedFrame?t.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(t.ssrc,c,l),this.isFirstVideoDecoded[t.ssrc]=!0}if(i){let c=i.stats,l=s-i.lts;t.framesDecodeFreezeTime=c.framesDecodeFreezeTime,t.framesDecodeInterval=c.framesDecodeInterval,!this.isFirstVideoDecoded[t.ssrc]&&l>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[t.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(t.ssrc),this.isFirstVideoDecodedTimeout[t.ssrc]=!0),t.framesDecodeCount>c.framesDecodeCount&&this.isFirstVideoDecoded[t.ssrc]?(i.lts=Date.now(),t.framesDecodeInterval=l,t.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(e.ssrc))?t.framesDecodeFreezeTime+=t.framesDecodeInterval:this.setVideoIsReady2(parseInt(e.ssrc,10),!0))):t.framesDecodeCount<c.framesDecodeCount&&(t.framesDecodeInterval=0),e.framesDecoded&&e.qpSum&&(i.stats.framesDecodeCount>e.framesDecoded?t.qpSumPerFrame=e.qpSum/e.framesDecoded:t.qpSumPerFrame=(e.qpSum-i.qpSum)/(e.framesDecoded-i.stats.framesDecodeCount))}r&&s-r.lts>=800?(t.decodeFrameRate=Math.round((t.framesDecodeCount-r.count)/((s-r.lts)/1e3)),this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:s,rate:t.decodeFrameRate})):r?t.decodeFrameRate=r.rate:this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:s,rate:0}),t.framesDroppedCount&&e.framesReceived&&(a&&s-a.lts>=800?(t.outputFrameRate=Math.round((e.framesReceived-t.framesDroppedCount-a.count)/((s-a.lts)/1e3)),this.lastVideoFramesOutput.set(t.ssrc,{count:e.framesReceived-t.framesDroppedCount,lts:s,rate:Math.max(t.outputFrameRate,0)})):a?t.outputFrameRate=a.rate:this.lastVideoFramesOutput.set(t.ssrc,{count:e.framesReceived-t.framesDroppedCount,lts:s,rate:0})),e.totalDecodeTime&&(t.decodeMs=1e3*e.totalDecodeTime),this.processVideoTrackReceiverStats(e,e.trackId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.framerateMean&&(t.framesRateFirefox=e.framerateMean),t.packets>0&&!this.isFirstVideoReceived[t.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(t.ssrc),this.isFirstVideoReceived[t.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(t.ssrc,{stats:lc({},t),lts:i?i.lts:Date.now(),qpSum:e.qpSum})}processVideoOutboundStats(e){let t=this._stats.videoSend.find(r=>r.ssrc===e.ssrc);t||(t=Ya(sB),this._stats.videoSend.push(t));let i=this.mediaBytesSent.get(e.ssrc);if(i)i.add(e.bytesSent);else{let r=new TR(10);r.add(e.bytesSent),this.mediaBytesSent.set(e.ssrc,r)}if(e.retransmittedBytesSent!==void 0){let r=this.mediaBytesRetransmit.get(e.ssrc);if(r)r.add(e.retransmittedBytesSent);else{let a=new TR(10);a.add(e.retransmittedBytesSent),this.mediaBytesRetransmit.set(e.ssrc,a)}}if(e.totalEncodedBytesTarget){let r=this.mediaBytesTargetEncode.get(e.ssrc);if(r)r.add(e.totalEncodedBytesTarget);else{let a=new TR(10);a.add(e.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(e.ssrc,a)}}if(t.ssrc=e.ssrc,t.bytes=e.bytesSent,t.packets=e.packetsSent,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.frameCount=e.framesEncoded,t.adaptionChangeReason=e.qualityLimitationReason,t.scalabilityMode=e.scalabilityMode,e.totalEncodeTime&&e.framesEncoded){let r=this.lastEncoderMs.get(e.ssrc);if(!r||r.lastFrameCount>e.framesEncoded)t.avgEncodeMs=1e3*e.totalEncodeTime/e.framesEncoded;else{let a=e.framesEncoded-r.lastFrameCount,s=e.totalEncodeTime-r.lastEncoderTime;t.avgEncodeMs=1e3*s/a}}if(e.framesEncoded&&e.qpSum){let r=this.lastEncoderMs.get(e.ssrc);!r||r.lastFrameCount>e.framesEncoded?t.qpSumPerFrame=e.qpSum/e.framesEncoded:t.qpSumPerFrame=(e.qpSum-r.lastQpSum)/(e.framesEncoded-r.lastFrameCount)}if(this.lastEncoderMs.set(e.ssrc,{lastFrameCount:e.framesEncoded,lastEncoderTime:e.totalEncodeTime,lastQpSum:e.qpSum,lts:Date.now()}),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.mediaSourceId&&this.processVideoMediaSource(e.mediaSourceId,t),this.processVideoTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{let r=this.findRemoteStatsId(e.ssrc,Kr.REMOTE_INBOUND);r&&this.processRemoteInboundStats(r,t)}}processAudioOutboundStats(e){let t=this._stats.audioSend.find(i=>i.ssrc===e.ssrc);if(t||(t=Ya(oB),this._stats.audioSend.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsSent,t.bytes=e.bytesSent,e.mediaSourceId&&this.processAudioMediaSource(e.mediaSourceId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),this.processAudioTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{let i=this.findRemoteStatsId(e.ssrc,Kr.REMOTE_INBOUND);i&&this.processRemoteInboundStats(i,t)}}findRemoteStatsId(e,t){var i;let r=Array.from(Ns(i=this.report).call(i)).find(a=>a.type===t&&a.ssrc===e);return r?r.id:null}processVideoMediaSource(e,t){let i=this.report.get(e);i&&i.width&&i.height&&i.framesPerSecond&&(t.inputFrame={width:i.width,height:i.height,frameRate:i.framesPerSecond})}processAudioMediaSource(e,t){let i=this.report.get(e);i&&(t.inputLevel=i.audioLevel)}processVideoTrackSenderStats(e,t,i){var r,a,s,c;let l=t?this.report.get(t):void 0,u=(r=l==null?void 0:l.framesSent)!==null&&r!==void 0?r:e.framesSent;if(typeof u!="number")return;let h=(a=l==null?void 0:l.frameWidth)!==null&&a!==void 0?a:e.frameWidth,p=(s=l==null?void 0:l.frameHeight)!==null&&s!==void 0?s:e.frameHeight,_=(c=l==null?void 0:l.framesPerSecond)!==null&&c!==void 0?c:e.framesPerSecond;if(typeof h=="number"&&typeof p=="number"||(h=0,p=0),_==null){let m=Date.now(),S=this.lastVideoFramesSent.get(i.ssrc);S&&m-S.lts>=800?(_=Math.round((u-S.count)/((m-S.lts)/1e3)),this.lastVideoFramesSent.set(i.ssrc,{count:u,lts:m,rate:_})):S?_=S.rate:this.lastVideoFramesSent.set(i.ssrc,{count:u,lts:m,rate:0})}i.sentFrame={width:h,height:p,frameRate:Math.max(0,_)}}processVideoTrackReceiverStats(e,t,i){var r,a,s,c,l;let u=t?this.report.get(t):void 0,h=(r=u==null?void 0:u.framesReceived)!==null&&r!==void 0?r:e.framesReceived,p=(a=u==null?void 0:u.frameWidth)!==null&&a!==void 0?a:e.frameWidth,_=(s=u==null?void 0:u.frameHeight)!==null&&s!==void 0?s:e.frameHeight,m=(c=u==null?void 0:u.jitterBufferDelay)!==null&&c!==void 0?c:e.jitterBufferDelay,S=(l=u==null?void 0:u.jitterBufferEmittedCount)!==null&&l!==void 0?l:e.jitterBufferEmittedCount;if(typeof h=="number"){let C=this.lastVideoFramesRecv.get(i.ssrc),v=Date.now();i.framesReceivedCount=h;let y=0;C&&v-C.lts>=800?(y=Math.round((h-C.count)/((v-C.lts)/1e3)),this.lastVideoFramesRecv.set(i.ssrc,{count:h,lts:v,rate:y})):C?y=C.rate:this.lastVideoFramesRecv.set(i.ssrc,{count:h,lts:v,rate:0}),i.receivedFrame={width:p||0,height:_||0,frameRate:y||0},i.decodedFrame={width:p||0,height:_||0,frameRate:i.decodeFrameRate||0},i.outputFrame={width:p||0,height:_||0,frameRate:i.outputFrameRate||i.decodeFrameRate||0}}if(m&&S){let C=this.lastVideoJBDelay.get(i.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0},v=C.jitterBufferMs,y=S-C.jitterBufferEmittedCount;y>0&&(v=1e3*(m-C.jitterBufferDelay)/y),i.jitterBufferMs=v,i.currentDelayMs=Math.round(v),this.lastVideoJBDelay.set(i.ssrc,{jitterBufferDelay:m,jitterBufferEmittedCount:S,jitterBufferMs:i.currentDelayMs})}}processAudioTrackSenderStats(e,t,i){var r,a,s,c;let l=t?this.report.get(t):void 0,u=(r=(a=l==null?void 0:l.echoReturnLoss)!==null&&a!==void 0?a:e.echoReturnLoss)!==null&&r!==void 0?r:0,h=(s=(c=l==null?void 0:l.echoReturnLossEnhancement)!==null&&c!==void 0?c:e.echoReturnLossEnhancement)!==null&&s!==void 0?s:0;i.aecReturnLoss=u,i.aecReturnLossEnhancement=h}processAudioTrackReceiverStats(e,t,i){var r,a,s,c,l,u,h;let p=t?this.report.get(t):void 0,_=(r=p==null?void 0:p.removedSamplesForAcceleration)!==null&&r!==void 0?r:e.removedSamplesForAcceleration,m=(a=p==null?void 0:p.totalSamplesReceived)!==null&&a!==void 0?a:e.totalSamplesReceived,S=(s=p==null?void 0:p.jitterBufferDelay)!==null&&s!==void 0?s:e.jitterBufferDelay,C=(c=p==null?void 0:p.jitterBufferEmittedCount)!==null&&c!==void 0?c:e.jitterBufferEmittedCount,v=(l=p==null?void 0:p.audioLevel)!==null&&l!==void 0?l:e==null?void 0:e.audioLevel,y=(u=p==null?void 0:p.totalSamplesDuration)!==null&&u!==void 0?u:e==null?void 0:e.totalSamplesDuration,I=(h=p==null?void 0:p.concealedSamples)!==null&&h!==void 0?h:e.concealedSamples;if(_&&m&&(i.accelerateRate=_/m),S&&C){let P=this.lastAudioJBDelay.get(i.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0},U=P.jitterBufferMs,x=C-P.jitterBufferEmittedCount;x>0&&(U=1e3*(S-P.jitterBufferDelay)/x),i.jitterBufferMs=Math.round(U),this.lastAudioJBDelay.set(i.ssrc,{jitterBufferDelay:S,jitterBufferEmittedCount:C,jitterBufferMs:i.jitterBufferMs})}i.outputLevel=v;let O=1920;y&&m&&(O=m/y/50,i.receivedFrames=Math.round(m/O)),I&&(i.droppedFrames=Math.round(I/O))}processRemoteInboundStats(e,t){let i=this.report.get(e);i&&(t.packetsLost=i.packetsLost,i.roundTripTime&&(t.rttMs=1e3*i.roundTripTime),i.jitter&&(t.jitterMs=1e3*i.jitter),i.timestamp&&(t.timestamp=i.timestamp))}getCodecFromCodecStats(e){let t=this.report.get(e);if(!t)return"";let i=t.mimeType.match(/\/(.*)$/);return i&&i[1]?i[1]:""}updateSendBitrate(){let e=0,t=null,i=null;this.mediaBytesSent.forEach(a=>{e+=a.diffMean()}),this.mediaBytesRetransmit.forEach(a=>{t=t===null?a.diffMean():t+a.diffMean()}),this.mediaBytesTargetEncode.forEach(a=>{i=i===null?a.diffMean():i+a.diffMean()});let r=t!==null?e-t:e;this._stats.bitrate={actualEncoded:8*r/(this.options.updateInterval/1e3),transmit:8*e/(this.options.updateInterval/1e3)},t!==null&&(this._stats.bitrate.retransmit=8*t/(this.options.updateInterval/1e3)),i!==null&&(this._stats.bitrate.targetEncoded=8*i/(this.options.updateInterval/1e3))}},WJ=class extends EC{updateStats(){return ae.resolve()}};function mC(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,a=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4,s=function(){let c=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return c&&c[0]?Number(c[0].split("/")[1]):null}();return s?s<76?new HJ(e,{updateInterval:t,lossRateInterval:i,freezeRateLimit:r,firstVideoDecodedTimeout:a}):new jL(e,{updateInterval:t,lossRateInterval:i,freezeRateLimit:r,firstVideoDecodedTimeout:a}):function(c){if(!window.RTCStatsReport)return!1;let l=c.getStats();return!!(l instanceof ae||function(u){return!!u&&(typeof u=="object"||typeof u=="function")&&typeof u.then=="function"}(l))}(e)?new jL(e,{updateInterval:t,lossRateInterval:i,freezeRateLimit:r,firstVideoDecodedTimeout:a}):new WJ(e,{updateInterval:t,lossRateInterval:i,freezeRateLimit:r,firstVideoDecodedTimeout:a})}var FL=class{get localCapabilities(){return Xt(this._localCapabilities)}get rtpCapabilities(){return Xt(this._rtpCapabilities)}get candidates(){return Xt(this._candidates)}get iceParameters(){return Xt(this._iceParameters)}get dtlsParameters(){return Xt(this._dtlsParameters)}constructor(e){b(this,"sessionDesc",void 0),b(this,"_localCapabilities",void 0),b(this,"_rtpCapabilities",void 0),b(this,"_candidates",void 0),b(this,"_iceParameters",void 0),b(this,"_dtlsParameters",void 0),b(this,"setup",void 0),b(this,"currentMidIndex",void 0),b(this,"cname","o/i14u9pJrxRKAsu"),b(this,"firefoxSsrcMidMap",new Map),e=Xt(e);let{remoteIceParameters:t,remoteDtlsParameters:i,candidates:r,remoteRTPCapabilities:a,localCapabilities:s,direction:c,setup:l,videoCodec:u,audioCodec:h}=e,p;this.setup=l,p=c===ur.RECEIVE_ONLY?vi.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`):vi.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`),this._rtpCapabilities=a,this._candidates=r,this._iceParameters=t,this._dtlsParameters=i,this._localCapabilities=s;let _=c===ur.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,m=c===ur.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,S=c===ur.RECEIVE_ONLY?a.send.videoCodecs:Th(_e.VIDEO,_,m,u),C=c===ur.RECEIVE_ONLY?a.send.audioCodecs:Th(_e.AUDIO,_,m,h);for(let v of p.mediaDescriptions)v.attributes.iceUfrag=t.iceUfrag,v.attributes.icePwd=t.icePwd,v.attributes.fingerprints=i.fingerprints,v.attributes.candidates=r,v.attributes.setup=this.setup,v.media.mediaType==="application"&&(v.attributes.sctpPort="5000"),v.media.mediaType==="video"&&(v.media.fmts=S.map(y=>y.payloadType.toString(10)),v.attributes.payloads=S,v.attributes.extmaps=_.videoExtensions),v.media.mediaType==="audio"&&(v.media.fmts=C.map(y=>y.payloadType.toString(10)),v.attributes.payloads=C,v.attributes.extmaps=_.audioExtensions,vd(v));this.sessionDesc=p,this.currentMidIndex=p.mediaDescriptions.length-1}toString(){return vi.print(this.sessionDesc)}hasMid(e){return Array.isArray(e)?e.every(t=>this.hasMid(t)):this.sessionDesc.mediaDescriptions.some(t=>t.attributes.mid===e)}send(e,t,i,r,a){i=i.replace(/ /g,"-");let{ssrcs:s,ssrcGroups:c}=mc(t,this.cname,k("SYNC_GROUP")?i:void 0),l=this.findPreloadMediaDesc(s);if(l){if(Bt()&&this.firefoxSsrcMidMap.set(s[0].ssrcId,l.attributes.mid),a&&(a.twcc||a.remb)){let u=this.sessionDesc.mediaDescriptions.indexOf(l);return this.sessionDesc.mediaDescriptions[u]=this.mungSendMediaDesc(l,a),{mid:l.attributes.mid,needExchangeSDP:!0}}return{mid:l.attributes.mid,needExchangeSDP:!1}}{let u=this.findAvailableMediaIndex(e,s,r),h;return u===-1?(h=this.createOrRecycleSendMedia(e,s,c,"sendonly",r,a),this.updateBundleMids()):(h=Xt(this.sessionDesc.mediaDescriptions[u]),h.attributes.direction="sendonly",h.attributes.ssrcs=s,h.attributes.ssrcGroups=c,this.sessionDesc.mediaDescriptions[u]=this.mungSendMediaDesc(h,a)),Bt()&&this.firefoxSsrcMidMap.set(s[0].ssrcId,h.attributes.mid),{needExchangeSDP:!0,mid:h.attributes.mid}}}stopSending(e){let t=this.sessionDesc.mediaDescriptions.filter(i=>i.attributes.mid&&e.indexOf(i.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");t.forEach(i=>{i.attributes.ssrcs=[]}),this.updateBundleMids()}receive(e,t,i){let r=[];return e.forEach(a=>{let s=a._mediaStreamTrack.kind,c=this.findAvailableRecvMediaIndex(s),l,u=!1;c===-1?(u=!0,l=this.createOrRecycleRecvMedia(a,[],"recvonly",t,i),this.updateBundleMids()):(l=Xt(this.sessionDesc.mediaDescriptions[c]),l.attributes.direction="recvonly"),r.push({mid:l.attributes.mid,needCreateTransceiver:u})}),r}stopReceiving(e){let t=this.sessionDesc.mediaDescriptions.filter(i=>e.indexOf(i.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");t.forEach(i=>{i.media.port="0",i.attributes.direction="inactive"}),this.updateBundleMids()}addRemoteCandidate(e){let{foundation:t,protocol:i,address:r,port:a,type:s,relatedAddress:c,relatedPort:l,priority:u}=new RTCIceCandidate(e),h={foundation:t??"",componentId:"1",transport:i??"",priority:u?u+"":"",connectionAddress:r??"",port:a?a+"":"",type:s?s+"":"",relAddr:c??"",relPort:l?l+"":"",extension:{}};this.candidates.some(p=>p.priority===h.priority&&p.connectionAddress===h.connectionAddress&&p.port===h.port)||(this._candidates.push(h),this.sessionDesc.mediaDescriptions.forEach(p=>{p.attributes.candidates=this.candidates}))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(e,t,i,r,a){let s=e._mediaStreamTrack.kind,c=this.rtpCapabilities.recv,l=Th(s,c,this.localCapabilities.send,s===_e.AUDIO?a:r),u=s===_e.VIDEO?c.videoExtensions:c.audioExtensions,h="".concat(++this.currentMidIndex),p={media:{mediaType:s,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:l.map(m=>m.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:u,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:l,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:i,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(h)}};p=this.mungRecvMediaDsec(p,e);let _=this.findFirstClosedMedia(s);if(_){let m=this.sessionDesc.mediaDescriptions.indexOf(_);this.sessionDesc.mediaDescriptions[m]=p}else this.sessionDesc.mediaDescriptions.push(p);return p}muteRemote(e){let t=this.sessionDesc.mediaDescriptions.filter(i=>oe(e).call(e,i.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(i=>{i.attributes.direction="inactive"})}unmuteRemote(e){let t=this.sessionDesc.mediaDescriptions.filter(i=>oe(e).call(e,i.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(i=>{i.attributes.direction="recvonly"})}findAvailableMediaIndex(e,t,i){return this.sessionDesc.mediaDescriptions.findIndex(r=>{let a=r.media.mediaType===e&&r.media.port!=="0"&&(r.attributes.direction==="sendonly"||r.attributes.direction==="sendrecv")&&r.attributes.ssrcs.length===0;if(Bt()){if(a){let s=this.firefoxSsrcMidMap.get(t[0].ssrcId);return!(s||r.attributes.mid!=="0"&&r.attributes.mid!=="1")||!(!s||s!==r.attributes.mid)}return!1}return a&&r.attributes.mid===i})}findAvailableRecvMediaIndex(e){return this.sessionDesc.mediaDescriptions.findIndex(t=>{let i=t.media.mediaType===e&&t.media.port!=="0"&&(t.attributes.direction==="recvonly"||t.attributes.direction==="sendrecv");return t.attributes.mid!=="0"&&t.attributes.mid!=="1"&&i})}predictReceivingMids(e){let t=[];for(let i=0;i<e;i++)t.push((this.currentMidIndex+i+1).toString(10));return t}restartICE(e){e=Xt(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach(t=>{t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd})}createOrRecycleSendMedia(e,t,i,r,a,s){let c=this.rtpCapabilities.send,l=e===_e.VIDEO?c.videoCodecs:c.audioCodecs,u=e===_e.VIDEO?c.videoExtensions:c.audioExtensions;Bt()&&(a="".concat(++this.currentMidIndex));let h={media:{mediaType:e,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:l.map(_=>_.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:u,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:i,rtcpFeedbackWildcards:[],payloads:l,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:r,rtcpMux:!0,rtcpRsize:!0,mid:a}};h=this.mungSendMediaDesc(h,s);let p=this.findFirstClosedMedia(e);if(p){let _=this.sessionDesc.mediaDescriptions.indexOf(p);this.sessionDesc.mediaDescriptions[_]=h}else this.sessionDesc.mediaDescriptions.push(h);return h}mungRecvMediaDsec(e,t,i){let r=Xt(e);return lC(r),Rd(r,t),dC(r,t),XV(r),gE(r,i,this.localCapabilities.send),r}mungSendMediaDesc(e,t){let i=Xt(e);return gE(i,t,this.localCapabilities.recv),vd(i),i}updateRecvMedia(e,t){let i=this.sessionDesc.mediaDescriptions.findIndex(r=>r.attributes.mid===e);if(i!==-1){let r=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[i],t);this.sessionDesc.mediaDescriptions[i]=r}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(e=>e.media.port!=="0").map(e=>e.attributes.mid)}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find(t=>{var i;return((i=t.attributes)===null||i===void 0||(i=i.ssrcs[0])===null||i===void 0?void 0:i.ssrcId)===e[0].ssrcId})}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find(t=>Bt()?t.media.port==="0"&&t.media.mediaType===e:t.media.port==="0")}},KJ=["sdp"],mt;function GL(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),i.push.apply(i,r)}return i}function so(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?GL(Object(i),!0).forEach(function(r){b(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):GL(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}var HL=(mt=class Kl extends cV{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,i;return(t=(i=this.peerConnection.getReceivers()[0])===null||i===void 0||(i=i.transport)===null||i===void 0?void 0:i.state)!==null&&t!==void 0?t:null}get localCodecs(){return[]}set isInRestartIce(t){this._isInRestartIce=t}get isInRestartIce(){return this._isInRestartIce}constructor(t,i,r){super(t,i),b(this,"direction",void 0),b(this,"name",void 0),b(this,"store",void 0),b(this,"spec",void 0),b(this,"peerConnection",void 0),b(this,"initialOffer",void 0),b(this,"transport",void 0),b(this,"statsFilter",void 0),b(this,"localCandidateCount",0),b(this,"_isInRestartIce",!1),b(this,"mutex",new Fi("P2PConnection-mutex")),b(this,"onLocalCandidate",void 0),b(this,"remoteSDP",void 0),b(this,"pendingCandidates",[]),b(this,"localCapabilities",void 0),b(this,"isReady",!1),b(this,"restartCnt",0),b(this,"curTurnServerIndex",0),this.store=i,this.spec=t,this.peerConnection=new RTCPeerConnection(Kl.resolvePCConfiguration(t,i.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=r??ur.SEND_ONLY,this.name=this.direction===ur.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=mC(this.peerConnection,k("STATS_UPDATE_INTERVAL"),void 0,Bt()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(t){try{let i=await QV();if(this.localCapabilities=SE(i),t){let{sdp:r}=t,a=FJ(t,KJ),s=function(){let p={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},_=Fh(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"sendonly"),m={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},S={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},C={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Ja(_,p,"videoExtensions",m,S,C),Ja(_,p,"videoCodecs",m,S,C),Ja(_,p,"audioExtensions",m,S,C),Ja(_,p,"audioCodecs",m,S,C),k("RAISE_H264_BASELINE_PRIORITY")){let v=C.videoCodecs.findIndex(y=>y.rtpMap&&y.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&y.fmtp&&y.fmtp.parameters["profile-level-id"]==="42001f");if(v!==-1){let y=C.videoCodecs.findIndex(I=>I.rtpMap&&I.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(y<v){R.debug("raising H264 baseline profile priority");let I=C.videoCodecs[v];C.videoCodecs.splice(v,1),C.videoCodecs.splice(y,0,I)}y!==-1&&k("FILTER_SEND_H264_BASELINE")&&(m.videoCodecs=m.videoCodecs.filter(I=>!(I.rtpMap&&I.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&I.fmtp&&I.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:m,recv:S,sendrecv:C}}({},{},r);this.remoteSDP=new FL({remoteIceParameters:a.iceParameters,remoteDtlsParameters:a.dtlsParameters,candidates:[],remoteRTPCapabilities:s,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;let c=await this.peerConnection.createAnswer();if(!c.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");let l=vo(c.sdp);await this.peerConnection.setLocalDescription(c);let u=await TL({},{},c.sdp);this.localCapabilities=SE(u);let h=this.peerConnection.getTransceivers()[0];return h!=null&&h.receiver&&h.receiver.transport&&this.tryBindTransportEvents(h.receiver.transport),so(so({},l),{},{sdp:c.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});let r=await this.peerConnection.createOffer();if(!r.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");let a=vo(r.sdp);return this.initialOffer=r,so(so({},a),{},{sdp:r.sdp})}}catch(i){throw new H(A.GET_LOCAL_CONNECTION_PARAMS_FAILED,i.toString())}}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);let{sdp:i,iceParameters:r,dtlsParameters:a}=t,s=await TL({},{},i);this.remoteSDP=new FL({remoteIceParameters:r,remoteDtlsParameters:a,candidates:[],remoteRTPCapabilities:s,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});let c=this.peerConnection.getTransceivers()[0];c!=null&&c.sender&&c.sender.transport&&this.tryBindTransportEvents(c.sender.transport)}catch(i){throw new H(A.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(i.toString()))}}async addRemoteCandidate(t){try{t&&this.pendingCandidates.push(t),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach(i=>{this.peerConnection.addIceCandidate(i)}),this.pendingCandidates=[])}catch(i){throw new H(A.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(i.toString()))}}send(t,i,r){var a=this;return gn(function*(){let s=yield Ye(a.mutex.lock("From P2PConnection.send"));try{if(!a.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");let c=[],l=a.remoteSDP.receive(t,i,r);t.forEach((y,I)=>{if(l[I].needCreateTransceiver){let O=a.peerConnection.addTransceiver(y._mediaStreamTrack,{direction:"sendonly"});c.push(O),y._updateRtpTransceiver(O)}else{let O=a.peerConnection.getTransceivers().find(P=>P.mid===l[I].mid);if(!O)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(l[I].mid));c.push(O),y._updateRtpTransceiver(O)}}),Bt()&&k("SIMULCAST")===!0&&(yield Ye(a.applySimulcastForFirefox(c,t)));let u=l.map(y=>y.mid),h=yield Ye(a.peerConnection.createOffer()),p=a.mungSendOfferSDP(h.sdp,t,u),_=vi.parse(p),m=u.map(y=>{let I=_.mediaDescriptions.find(O=>O.attributes.mid===y);if(!I)throw new Error("Cannot extract ssrc from mediaDescription.");return YV(I,k("USE_PUB_RTX"))}),S=c.map((y,I)=>{let O=u[I];return{localSSRC:m[I],id:O}});yield Ye(a.peerConnection.setLocalDescription({type:"offer",sdp:p}));try{yield S}catch(y){let I=a.remoteSDP.toString();throw yield Ye(a.peerConnection.setLocalDescription({type:"offer",sdp:p})),yield Ye(a.peerConnection.setRemoteDescription({type:"answer",sdp:I})),yield Ye(a.stopSending(u,!0)),y}yield Ye(a.applySimulcastEncodings(c,t)),yield Ye(a.applySendEncodings(c,t));let C=a.remoteSDP.toString(),v=a.logSDPExchange(p,"offer","local","send");return v==null||v(C),yield Ye(a.setRemoteDescription({type:"answer",sdp:C})),c.map((y,I)=>{let O=u[I];return{localSSRC:m[I],id:O}})}catch(c){throw c instanceof H?c:new H(A.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(c.toString()))}finally{s()}})()}async stopSending(t,i){let r=i?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");let a=this.peerConnection.getTransceivers().filter(u=>t.indexOf(u.mid)!==-1);if(a.length!==t.length)throw new Error("Transceivers' length (".concat(a.length,") doesn't match mids' length (").concat(t.length,") when trying to call P2PConnection.stopSending."));a.map(u=>{var h;u.direction="inactive",(h=u.stop)===null||h===void 0||h.call(u)});let s=await this.peerConnection.createOffer(),c=this.logSDPExchange(s.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(s),this.remoteSDP.stopReceiving(t);let l=this.remoteSDP.toString();c==null||c(l),await this.setRemoteDescription({type:"answer",sdp:l})}catch(a){throw new H(A.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(a.toString()))}finally{r&&r()}}async receive(t,i,r,a){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));let{mid:s,needExchangeSDP:c}=this.remoteSDP.send(t,i,r,a);if(c){let u=this.remoteSDP.toString(),h=this.logSDPExchange(u,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:u});let p=await this.peerConnection.createAnswer(),_=this.mungReceiveAnswerSDP(p.sdp,s,t);h==null||h(_||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:_}),R.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP."))}else R.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," no need to exchange SDP."));let l=this.peerConnection.getTransceivers().find(u=>u.mid===s);if(!l||l.mid===null)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:l.receiver.track,mid:l.mid,transceiver:l}}catch(s){throw new H(A.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async mockReceive(t,i,r,a){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));let{mid:s,needExchangeSDP:c}=this.remoteSDP.send(t,i,r,a);if(c){let l=this.remoteSDP.toString(),u=this.logSDPExchange(l,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:l});let h=await this.peerConnection.createAnswer(),p=this.mungReceiveAnswerSDP(h.sdp,s,t);u==null||u(p||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:p}),R.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP."))}else R.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," no need to exchange SDP."))}catch(s){throw new H(A.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);let i=this.remoteSDP.toString(),r=this.logSDPExchange(i,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:i});let a=await this.peerConnection.createAnswer();r==null||r(a.sdp||""),await this.peerConnection.setLocalDescription(a)}catch(i){throw new H(A.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(i.toString()))}}async restartICE(t){try{if(this.store.p2pTransport===hc.Auto&&(this.store.p2pTransport=hc.SdRtn,Ke().supportPCSetConfiguration&&this.peerConnection.setConfiguration(Kl.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,Ke().supportPCSetConfiguration&&this.peerConnection.setConfiguration(Kl.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!t){this.restartCnt++,this.isReady=!1;let i=await this.peerConnection.createOffer({iceRestart:!0});if(!i.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");let{iceParameters:r}=vo(i.sdp);return this.store.descriptionStart(),this.direction===ur.SEND_ONLY&&await this.peerConnection.setLocalDescription(i),r}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(t),this.store.descriptionStart(),this.direction===ur.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});let i=await this.peerConnection.createAnswer();if(!i.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");let{iceParameters:r}=vo(i.sdp);return await this.peerConnection.setLocalDescription(i),r}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(i){throw new H(A.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(i.toString()))}}close(){var t;this.peerConnection.close(),this.peerConnection.onicecandidate=null,(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");let r=await this.peerConnection.createOffer(),a=this.mungSendOfferSDP(r.sdp,[i],[t]);this.remoteSDP.updateRecvMedia(t,i);let s=this.remoteSDP.toString(),c=this.logSDPExchange(a,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:a}),c==null||c(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(r){throw new H(A.EXCHANGE_SDP_FAILED,r.toString())}}async updateSendParameters(t,i){let r=this.peerConnection.getTransceivers().filter(a=>a.mid===t);r.length===1&&(this.isVP8Simulcast(i)?Bt()||await this.applySimulcastEncodings(r,[i]):await this.applySendEncodings(r,[i]))}setStatsRemoteVideoIsReady(t,i){this.statsFilter.setVideoIsReady2(t,i)}async replaceTrack(t,i){let r=this.peerConnection.getTransceivers().find(a=>a.mid===i);r&&await r.sender.replaceTrack(t._mediaStreamTrack)}async getSelectedCandidatePair(){let t=this.peerConnection.getReceivers();if(t.length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair()){let i=t[0].transport.iceTransport,{local:r,remote:a}=i.getSelectedCandidatePair();return{local:so(so({},Yn),{},{candidateType:r.type,protocol:r.protocol,address:r.address,port:r.port}),remote:so(so({},Yn),{},{candidateType:a.type,protocol:a.protocol,address:a.address,port:a.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t,i;oe(t=["connected","completed"]).call(t,this.peerConnection.iceConnectionState)&&(this.isReady=!1),(i=this.onICEConnectionStateChange)===null||i===void 0||i.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;this.peerConnection.connectionState==="connected"&&(this.restartCnt=0),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=t=>{if(t.candidate){var i;t.candidate.candidate&&((i=this.onLocalCandidate)===null||i===void 0||i.call(this,t.candidate.toJSON())),this.localCandidateCount+=1}else R.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t,i){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,a={iceServers:[]};var s;return t.iceServers?a.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(XE(t.turnServer.servers)?a.iceServers=t.turnServer.servers:(a.iceServers&&a.iceServers.push(...Kl.turnServerConfigToIceServers(t.turnServer.servers,i,r)),k("USE_TURN_SERVER_OF_GATEWAY")&&a.iceServers&&t.turnServer.serversFromGateway&&a.iceServers.push(...Kl.turnServerConfigToIceServers(t.turnServer.serversFromGateway,i,r)),oe(s=[hc.Relay,hc.SdRtn]).call(s,i)&&(a.iceTransportPolicy="relay"),k("FORCE_TURN_TCP")?a.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(c=>{c.forceturn&&(a.iceTransportPolicy="relay")}))),k("ENABLE_ENCODED_TRANSFORM")&&Ke().supportWebRTCEncodedTransform&&(a.encodedInsertableStreams=!0),R.debug("P2PConnection p2pTransport is ".concat(i)),a}static turnServerConfigToIceServers(t,i){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,a=[],s=t.filter(l=>l.tcpport);R.debug("P2PConnection turnServers is ".concat(s,", current index is ").concat(r));let c=s.length>r?s[r]:s[0];switch(i){case hc.SdRtn:let l=t.filter(h=>{var p;return oe(p=h.username).call(p,"glb:")&&h.turnServerURL==h.turnServerURL}),u=l.length>r?l[r]:l[0];u&&(a.push({username:u.username,credential:u.password,credentialType:"password",urls:"turn:".concat(ed(u.turnServerURL),":").concat(u.tcpport,"?transport=udp")}),a.push({username:u.username,credential:u.password,credentialType:"password",urls:"turns:".concat(ed(u.turnServerURL),":").concat(u.tcpport,"?transport=tcp")}));break;case hc.Relay:c&&(a.push({username:c.username,credential:c.password,credentialType:"password",urls:"turn:".concat(c.turnServerURL,":").concat(c.tcpport,"?transport=udp")}),a.push({username:c.username,credential:c.password,credentialType:"password",urls:"turns:".concat(ed(c.turnServerURL),":").concat(c.tcpport,"?transport=tcp")}));break;default:c&&(a.push({username:c.username,credential:c.password,credentialType:"password",urls:"turn:".concat(c.turnServerURL,":").concat(c.tcpport,"?transport=udp")}),a.push({username:c.username,credential:c.password,credentialType:"password",urls:"turns:".concat(ed(c.turnServerURL),":").concat(c.tcpport,"?transport=tcp")}),a.push({username:c.username,credential:c.password,credentialType:"password",urls:"stun:".concat(c.turnServerURL,":").concat(c.tcpport)}))}return a}tryBindTransportEvents(t){if(t){this.transport=t,t.onstatechange=()=>{var r;t!=null&&t.state&&((r=this.onDTLSTransportStateChange)===null||r===void 0||r.call(this,t.state))},t.onerror=r=>{var a;(a=this.onDTLSTransportError)===null||a===void 0||a.call(this,"error"in r?r.error:r)};let i=t.iceTransport;i&&(i.onstatechange=()=>{let r=t==null?void 0:t.iceTransport.state;var a;r&&((a=this.onICETransportStateChange)===null||a===void 0||a.call(this,r))},i.getSelectedCandidatePair&&(i.onselectedcandidatepairchange=()=>{if(i.getSelectedCandidatePair()){let{local:r,remote:a}=i.getSelectedCandidatePair();R.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:r.type,protocol:r.protocol}),", remote ").concat(JSON.stringify({candidateType:a.type,protocol:a.protocol,address:a.address,port:a.port})," )"))}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(t,i){var r;if(i||(i=this.peerConnection.getSenders().find(p=>p.track===t._mediaStreamTrack)),!i)return R.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(t))return R.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Ke().supportSetRtpSenderParameters)return R.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");let a={},s={};switch(t._optimizationMode){case"motion":a.degradationPreference="maintain-framerate";break;case"detail":a.degradationPreference="maintain-resolution";break;default:a.degradationPreference="balanced"}if(t._encoderConfig){var c;let{bitrateMax:p,frameRate:_,scaleResolutionDownBy:m}=t._encoderConfig;p&&(s.maxBitrate=1e3*p),oe(c=t._hints).call(c,Rt.LOW_STREAM)&&(_&&(s.maxFramerate=Br(_)),m&&m>=1&&(s.scaleResolutionDownBy=m))}if(k("DSCP_TYPE")&&No()){var l;let p=k("DSCP_TYPE");oe(l=["very-low","low","medium","high"]).call(l,p)&&(s.networkPriority=p)}let u=i.getParameters(),h=(r=u.encodings)===null||r===void 0?void 0:r[0];Bt()&&!h&&(a.encodings=[s]),h&&Object.assign(h,s),Object.assign(u,a),R.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(u.encodings))),await i.setParameters(u)}async applySendEncodings(t,i){try{if(!Ke().supportSetRtpSenderParameters||t.length!==i.length)return;for(let r=0;r<t.length;r++){let a=t[r],s=i[r];s instanceof St&&!this.isVP8Simulcast(s)&&await this.updateRtpSenderEncodings(s,a.sender)}}catch{R.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,i,r){let a=vi.parse(t);return i.forEach((s,c)=>{let l=r[c],u=a.mediaDescriptions.find(h=>h.attributes.mid===l);u&&(Rd(u,s),JV(u,s,this.store.codec))}),vi.print(a)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var i;(i=this.onFirstAudioReceived)===null||i===void 0||i.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var i;(i=this.onFirstVideoReceived)===null||i===void 0||i.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var i;(i=this.onFirstAudioDecoded)===null||i===void 0||i.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,i,r)=>{var a;(a=this.onFirstVideoDecoded)===null||a===void 0||a.call(this,t,i,r)},this.statsFilter.onSelectedLocalCandidateChanged=(t,i)=>{var r;(r=this.onSelectedLocalCandidateChanged)===null||r===void 0||r.call(this,t,i)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,i)=>{var r;(r=this.onSelectedRemoteCandidateChanged)===null||r===void 0||r.call(this,t,i)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var i;(i=this.onFirstVideoDecodedTimeout)===null||i===void 0||i.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,i){if(t.length===i.length)for(let u=0;u<t.length;u++){var r,a,s,c,l;let h=t[u],p=i[u];if(p instanceof St&&!oe(r=p._hints).call(r,Rt.LOW_STREAM)&&(a=p._encoderConfig)!==null&&a!==void 0&&a.bitrateMax&&((s=p._encoderConfig)===null||s===void 0?void 0:s.bitrateMax)>200&&(c=p._scalabilityMode)!==null&&c!==void 0&&c.numSpatialLayers&&((l=p._scalabilityMode)===null||l===void 0?void 0:l.numSpatialLayers)>1&&this.store.codec==="vp8"){let _={},m={high:1e3*(p._encoderConfig.bitrateMax-50),medium:5e4};_.encodings=[{rid:"m",active:!0,maxBitrate:m.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:m.high}];let S=h.sender.getParameters();await h.sender.setParameters(Object.assign(S,_))}}}async applySimulcastEncodings(t,i){if(!Bt()&&t.length===i.length)for(let r=0;r<t.length;r++){let a=i[r];if(a instanceof St&&this.isVP8Simulcast(a)){let s=t[r],c={},l={high:1e3*(a._encoderConfig.bitrateMax-50),medium:5e4};c.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:l.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:l.medium,scaleResolutionDownBy:4}];let u=s.sender.getParameters();await s.sender.setParameters(Object.assign(u,c))}}}isVP8Simulcast(t){var i,r,a,s,c;return!!(t instanceof St&&k("SIMULCAST")&&this.store.codec==="vp8"&&!oe(i=t._hints).call(i,Rt.LOW_STREAM)&&(r=t._encoderConfig)!==null&&r!==void 0&&r.bitrateMax&&((a=t._encoderConfig)===null||a===void 0?void 0:a.bitrateMax)>200&&(s=t._scalabilityMode)!==null&&s!==void 0&&s.numSpatialLayers&&((c=t._scalabilityMode)===null||c===void 0?void 0:c.numSpatialLayers)>1)}logSDPExchange(t,i,r,a){if(k("SDP_LOGGING"))return R.upload("[".concat(this.store.clientId,"] exchanging ").concat(r," ").concat(i," SDP during P2PConnection.").concat(a,`
`),t),i==="offer"?s=>{this.logSDPExchange(s,"answer",r==="local"?"remote":"local",a)}:void 0}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");let i=this.peerConnection.getTransceivers().filter(c=>c.mid&&t.indexOf(c.mid)!==-1);if(i.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");i.map(c=>{c.direction="inactive"});let r=await this.peerConnection.createOffer(),a=this.logSDPExchange(r.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(r),this.remoteSDP.muteRemote(t);let s=this.remoteSDP.toString();a==null||a(s),await this.setRemoteDescription({type:"answer",sdp:s})}catch(i){throw new H(A.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(i.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");let i=this.peerConnection.getTransceivers().filter(c=>c.mid&&t.indexOf(c.mid)!==-1);if(i.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");i.map(async c=>{c.direction="sendonly"});let r=await this.peerConnection.createOffer(),a=this.logSDPExchange(r.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(r),this.remoteSDP.unmuteRemote(t);let s=this.remoteSDP.toString();a==null||a(s),await this.setRemoteDescription({type:"answer",sdp:s})}catch(i){throw new H(A.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(i.toString()))}}async getRemoteSSRC(t,i){var r,a;if(i=(r=i)!==null&&r!==void 0?r:(a=this.currentRemoteDescription)===null||a===void 0?void 0:a.sdp){var s;let c=(s=vi.parse(i).mediaDescriptions.find(l=>l.attributes.mid===t))===null||s===void 0?void 0:s.attributes.ssrcs;return c==null?void 0:c[0].ssrcId}}async setRemoteDescription(t){var i;await this.peerConnection.setRemoteDescription(t),oe(i=["connected","completed"]).call(i,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(t,i,r){let a=vi.parse(t),s=a.mediaDescriptions.find(c=>c.attributes.mid===i);return s&&r===_e.AUDIO&&s.media.mediaType==="audio"&&vd(s),vi.print(a)}},de(mt.prototype,"establish",[Fa],Object.getOwnPropertyDescriptor(mt.prototype,"establish"),mt.prototype),de(mt.prototype,"connect",[Fa],Object.getOwnPropertyDescriptor(mt.prototype,"connect"),mt.prototype),de(mt.prototype,"receive",[Fa],Object.getOwnPropertyDescriptor(mt.prototype,"receive"),mt.prototype),de(mt.prototype,"mockReceive",[Fa],Object.getOwnPropertyDescriptor(mt.prototype,"mockReceive"),mt.prototype),de(mt.prototype,"stopReceiving",[Fa],Object.getOwnPropertyDescriptor(mt.prototype,"stopReceiving"),mt.prototype),de(mt.prototype,"restartICE",[Fa],Object.getOwnPropertyDescriptor(mt.prototype,"restartICE"),mt.prototype),de(mt.prototype,"close",[Fa],Object.getOwnPropertyDescriptor(mt.prototype,"close"),mt.prototype),de(mt.prototype,"updateEncoderConfig",[Fa],Object.getOwnPropertyDescriptor(mt.prototype,"updateEncoderConfig"),mt.prototype),de(mt.prototype,"updateSendParameters",[Fa],Object.getOwnPropertyDescriptor(mt.prototype,"updateSendParameters"),mt.prototype),de(mt.prototype,"replaceTrack",[Fa],Object.getOwnPropertyDescriptor(mt.prototype,"replaceTrack"),mt.prototype),de(mt.prototype,"muteLocal",[Fa],Object.getOwnPropertyDescriptor(mt.prototype,"muteLocal"),mt.prototype),de(mt.prototype,"unmuteLocal",[Fa],Object.getOwnPropertyDescriptor(mt.prototype,"unmuteLocal"),mt.prototype),mt);function Fa(e,t,i){let r=e[t];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){let a=this.mutex,s=await a.lock("From P2PConnection.".concat(t));try{for(var c=arguments.length,l=new Array(c),u=0;u<c;u++)l[u]=arguments[u];return await r.apply(this,l)}finally{s()}},i}function Zv(e,t){let i=document.createElement("video"),r=document.createElement("canvas");i.setAttribute("style","display:none"),r.setAttribute("style","display:none"),i.setAttribute("muted",""),i.muted=!0,i.setAttribute("autoplay",""),i.autoplay=!0,i.setAttribute("playsinline",""),r.width=Br(t.width),r.height=Br(t.height);let a=Br(t.framerate||15);document.body.append(i),document.body.append(r);let s=e._mediaStreamTrack;i.srcObject=new MediaStream([s]),i.play();let c=r.getContext("2d");if(!c)throw new B(A.UNEXPECTED_ERROR,"can not get canvas context");let l=Ke(),u=r.captureStream(l.supportRequestFrame?0:a).getVideoTracks()[0];u.canvas||(u.canvas=r),r.startCapture=()=>{if(!i)return r.stopCapture&&r.stopCapture();if(i.paused&&i.play(),i.videoHeight>2&&i.videoWidth>2){let p=i.videoWidth,_=i.videoHeight/p,m=r.width*_;Math.abs(m-r.height)>=2&&(R.debug("adjust low stream resolution","".concat(r.width,"x").concat(r.height," -> ").concat(r.width,"x").concat(m)),r.height=m)}c.drawImage(i,0,0,r.width,r.height),u.requestFrame&&u.requestFrame(),s!==e._mediaStreamTrack&&(s=e._mediaStreamTrack,i.srcObject=new MediaStream([s]))},r.stopCapture=sC(()=>r.startCapture&&r.startCapture(),a);let h=u.stop;return u.stop=()=>{h.call(u),i&&(i.remove(),i.srcObject=null,i=null),r&&(r.width=0,r.remove(),r.stopCapture&&r.stopCapture(),r.startCapture=void 0,r.stopCapture=void 0,r=null),R.debug("clean low stream renderer")},u}var Y_=function(e){return e[e.HEIGHT=2033]="HEIGHT",e[e.FRAME_RATE=2034]="FRAME_RATE",e[e.WIDTH=2035]="WIDTH",e}(Y_||{}),di=function(e){return e[e.FRAME_RATE=2002]="FRAME_RATE",e[e.WIDTH=2003]="WIDTH",e[e.HEIGHT=2004]="HEIGHT",e[e.PACKAGE_LOST=2005]="PACKAGE_LOST",e[e.AVG_ENCODE=2007]="AVG_ENCODE",e[e.NACKS=2009]="NACKS",e[e.PLIS=2010]="PLIS",e[e.FIRS=2011]="FIRS",e[e.BITRATE=2012]="BITRATE",e[e.PACKAGE_RATE=2031]="PACKAGE_RATE",e[e.ADAPTATION=2032]="ADAPTATION",e[e.ACTUAL_ENCODED=2060]="ACTUAL_ENCODED",e[e.BANDWIDTH=2061]="BANDWIDTH",e[e.RETRANSMIT=2062]="RETRANSMIT",e[e.TARGET_ENCODED=2064]="TARGET_ENCODED",e[e.TRANSMIT=2066]="TRANSMIT",e[e.FREEZE=2082]="FREEZE",e[e.DISABLED=2095]="DISABLED",e[e.PLAYER_STATUS=2128]="PLAYER_STATUS",e[e.QP_SUM=2143]="QP_SUM",e}(di||{}),fc=function(e){return e[e.BITRATE=2069]="BITRATE",e[e.PACKAGE_LOST=2070]="PACKAGE_LOST",e[e.PACKAGE_RATE=2071]="PACKAGE_RATE",e[e.HEIGHT=2073]="HEIGHT",e[e.FRAME_RATE=2075]="FRAME_RATE",e[e.WIDTH=2077]="WIDTH",e}(fc||{}),qi=function(e){return e[e.JITTER=-1]="JITTER",e[e.PACKAGE_LOST=2014]="PACKAGE_LOST",e[e.WIDTH=2018]="WIDTH",e[e.HEIGHT=2019]="HEIGHT",e[e.FRAME_RATE=2020]="FRAME_RATE",e[e.JITTER_BUFFER=2023]="JITTER_BUFFER",e[e.CURRENT_DELAY=2024]="CURRENT_DELAY",e[e.NACKS=2026]="NACKS",e[e.PLIS=2027]="PLIS",e[e.FIRS=2028]="FIRS",e[e.BITRATE=2029]="BITRATE",e[e.PACKAGE_RATE=2078]="PACKAGE_RATE",e[e.FREEZE=2084]="FREEZE",e[e.DISABLED=2101]="DISABLED",e[e.PLAYER_STATUS=2129]="PLAYER_STATUS",e[e.QP_SUM=2144]="QP_SUM",e[e.I_FRAME_DELAY=2149]="I_FRAME_DELAY",e}(qi||{}),_c=function(e){return e[e.FRAME_RATE_DECODE=2021]="FRAME_RATE_DECODE",e[e.FRAME_RATE_RENDER=2022]="FRAME_RATE_RENDER",e[e.FRAME_RATE_OUTPUT=2155]="FRAME_RATE_OUTPUT",e[e.FREEZE_TIME=2109]="FREEZE_TIME",e[e.FREEZE_TIME_RENDER=2147]="FREEZE_TIME_RENDER",e[e.FREEZE_DURATION=2156]="FREEZE_DURATION",e}(_c||{}),lB=function(e){return e[e.PCM_LEVEL=2104]="PCM_LEVEL",e}(lB||{}),po=function(e){return e[e.PACKAGE_LOST=-1]="PACKAGE_LOST",e[e.LEVEL=2038]="LEVEL",e[e.BITRATE=2039]="BITRATE",e[e.PACKAGE_RATE=2040]="PACKAGE_RATE",e[e.AEC_RETURN_LOSS=2041]="AEC_RETURN_LOSS",e[e.AEC_RETURN_LOSS_ENH=2042]="AEC_RETURN_LOSS_ENH",e[e.FREEZE=2081]="FREEZE",e[e.DISABLED=2096]="DISABLED",e}(po||{}),Ha=function(e){return e[e.BITRATE=2044]="BITRATE",e[e.PACKAGE_LOST=2045]="PACKAGE_LOST",e[e.PACKAGE_RATE=2046]="PACKAGE_RATE",e[e.CURRENT_DELAY=2047]="CURRENT_DELAY",e[e.JITTER_BUFFER=2054]="JITTER_BUFFER",e[e.JITTER=2055]="JITTER",e[e.FREEZE=2083]="FREEZE",e[e.DISABLED=2102]="DISABLED",e[e.PCM_LEVEL=2105]="PCM_LEVEL",e[e.PLAYER_STATUS=2130]="PLAYER_STATUS",e[e.CONCEALED_SAMPLES=2148]="CONCEALED_SAMPLES",e}(Ha||{}),dB=function(e){return e[e.FREEZE_TIME=-1]="FREEZE_TIME",e[e.LEVEL=2043]="LEVEL",e}(dB||{}),_a=function(e){return e[e.RTT=2006]="RTT",e[e.CONN_TYPE=801]="CONN_TYPE",e}(_a||{}),gs=1e3,dc=3;function Oe(e,t,i){i!=null&&Number.isFinite(i)&&(e[t]=Math.round(Math.max(0,i)))}function WL(e){let t={[_a.CONN_TYPE]:0,[_a.RTT]:e.rtt};switch(e.selectedCandidatePair.localCandidate.candidateType){case"relay":{let i=e.selectedCandidatePair.localCandidate.relayProtocol;i==="udp"&&(t[_a.CONN_TYPE]=1),i==="tcp"&&(t[_a.CONN_TYPE]=3),i==="tls"&&(t[_a.CONN_TYPE]=4);break}case"srflx":t[_a.CONN_TYPE]=2}return t}function KL(e){let t=0;switch(e){case"none":t=0;break;case"cpu":t=1;break;case"bandwidth":t=2;break;case"other":t=3}return t}var uB=class extends Lt{constructor(e){super(),b(this,"store",void 0),b(this,"uploadWRTCStatsTimer",void 0),b(this,"uploadOutboundDenoiserStatsTimer",void 0),b(this,"uploadExtStatsTimer",void 0),b(this,"uploadExtUsageStatsTimer",void 0),b(this,"uploadInboundExtStatsTimer",void 0),b(this,"requestStats",void 0),b(this,"requestTransportStats",void 0),b(this,"requestLocalMedia",void 0),b(this,"requestRemoteMedia",void 0),b(this,"requestAllTracks",void 0),b(this,"requestVideoIsReady",void 0),b(this,"requestUploadStats",void 0),b(this,"requestUpload",void 0),b(this,"uploadOutboundStarted",!1),b(this,"uploadInboundStarted",!1),b(this,"uploadTransportStarted",!1),b(this,"uploadExtensionUsageStarted",!1),b(this,"lastRecvStats",void 0),b(this,"lastSendStats",void 0),b(this,"lastFullRecvStats",void 0),b(this,"lastFullSendStats",void 0),b(this,"needUploadRenderFreezeTime",!0),this.store=e}uploadWRTCStats(e){if(!this.requestStats||!this.requestUploadStats)return;let t,i;if(this.uploadTransportStarted&&(t=this.requestStats(),this.store.useP2P&&(i=this.requestStats(!0))),!t&&this.uploadOutboundStarted&&(t=this.requestStats()),!i&&this.uploadInboundStarted&&(i=this.requestStats(!0)),t||i){let r={};if(this.uploadTransportStarted&&t){let a=this.getTransportStats(t,i,e);a&&(r.misc=[a])}if(this.uploadOutboundStarted&&t){let a=this.getOutboundStats(t,e?this.lastSendStats:this.lastFullSendStats,e);a&&(r.outbound=[a])}if(this.uploadInboundStarted&&i){let a=this.getInboundStats(i,e?this.lastRecvStats:this.lastFullRecvStats,e);a&&(r.inbound=a)}this.requestUploadStats(r)}this.lastRecvStats=i,this.lastSendStats=t,e||(this.lastFullRecvStats=i,this.lastFullSendStats=t)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;let e=1;this.uploadWRTCStatsTimer=window.setInterval(()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted)return this.stopUploadWRTCStats();this.uploadWRTCStats(e!==dc),++e===dc+1&&(e=1)},gs)}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0)}getTransportStats(e,t,i){if(!this.requestStats)return;if(i)return e.rtt==null?void 0:{addition:{[_a.RTT]:e.rtt,[_a.CONN_TYPE]:void 0}};let r=WL(e);if(this.store.useP2P){if(t){let a=WL(t);r[_a.CONN_TYPE]+=a[_a.CONN_TYPE]<<3}r[_a.CONN_TYPE]+=110}else r[_a.CONN_TYPE]+=100;return{addition:r}}getOutboundStats(e,t,i){if(!this.requestUploadStats||!this.requestLocalMedia)return;let r=this.requestLocalMedia();if(!r||r.length===0)return;let a,s,c;return r.forEach(l=>{let[u,{track:h,ssrcs:p}]=l;switch(u){case Q.LocalVideoLowTrack:case Q.LocalVideoTrack:if(u===Q.LocalVideoTrack){let _=function(C,v,y,I,O){let P=v.videoSend.find(q=>q.ssrc===C);if(!P)return;let U={},{sentFrame:x,inputFrame:G}=P;if(G&&x){let q=G.frameRate,ie=x.frameRate;U[di.FREEZE]=function(Ie,Ve){let He=!0;return He=!(Ie<=5)&&(Ie<=10?Ve<3:Ie<=20?Ve<4:Ve<5),He}(q,ie)?1:0}if(Oe(U,di.QP_SUM,P.qpSumPerFrame),O)return U;switch(x&&(Oe(U,di.HEIGHT,x.height),Oe(U,di.WIDTH,x.width),Oe(U,di.FRAME_RATE,x.frameRate)),U[di.DISABLED]=I._originMediaStreamTrack&&!I._originMediaStreamTrack.enabled||I._mediaStreamTrack&&!I._mediaStreamTrack.enabled?1:0,P.adaptionChangeReason){case"none":U[di.ADAPTATION]=0;break;case"cpu":U[di.ADAPTATION]=1;break;case"bandwidth":U[di.ADAPTATION]=2;break;case"other":U[di.ADAPTATION]=3}let Z=0;P.adaptionChangeReason&&(Z+=KL(P.adaptionChangeReason)),v.qualityLimitationReason&&(Z+=KL(v.qualityLimitationReason)<<3),U[di.ADAPTATION]=Z,U[di.PLAYER_STATUS]=dR[I._player?I._player.videoElementStatus:"uninit"],Oe(U,di.NACKS,P.nacksCount),Oe(U,di.PLIS,P.plisCount),Oe(U,di.FIRS,P.firsCount),Oe(U,di.AVG_ENCODE,P.avgEncodeMs);let J=y&&y.videoSend.find(q=>q.ssrc===C);if(J){let q=O?gs:gs*dc;J.timestamp&&P.timestamp&&(q=P.timestamp-J.timestamp),J.packets!=null&&P.packets!=null&&Oe(U,di.PACKAGE_RATE,1e3*(P.packets-J.packets)/q),P.packetsLost!=null&&J.packetsLost!=null&&Oe(U,di.PACKAGE_LOST,P.packetsLost-J.packetsLost),J.bytes!=null&&P.bytes!=null&&Oe(U,di.BITRATE,8*(P.bytes-J.bytes)/q)}return U}(p[0].ssrcId,e,t,h,i),m=i?null:function(C,v,y){let I=v.videoSend.find(Z=>Z.ssrc===C);if(!I)return null;let O={},P=I.inputFrame,U=P&&P.height||y&&y.videoHeight||0,x=P&&P.width||y&&y.videoWidth||0,G=P&&P.frameRate||0;return Oe(O,Y_.HEIGHT,U),Oe(O,Y_.WIDTH,x),Oe(O,Y_.FRAME_RATE,G),O}(p[0].ssrcId,e,h),S=i?null:function(C){let v={};return Oe(v,di.RETRANSMIT,C.bitrate.retransmit),Oe(v,di.TARGET_ENCODED,C.bitrate.targetEncoded),Oe(v,di.ACTUAL_ENCODED,C.bitrate.actualEncoded),Oe(v,di.TRANSMIT,C.bitrate.transmit),Oe(v,di.BANDWIDTH,C.sendBandwidth),v}(e);s=Object.assign({},_,m,S)}else c=i?void 0:function(_,m,S){let C=m.videoSend.find(I=>I.ssrc===_);if(!C)return;let v={},y=C.sentFrame;if(y&&(Oe(v,fc.HEIGHT,y.height),Oe(v,fc.WIDTH,y.width),Oe(v,fc.FRAME_RATE,y.frameRate)),S){let I=S.videoSend.find(O=>O.ssrc===_);if(I){let O=gs*dc;I.timestamp&&C.timestamp&&(O=C.timestamp-I.timestamp),I.packets!=null&&C.packets!=null&&Oe(v,fc.PACKAGE_RATE,1e3*(C.packets-I.packets)/O),C.packetsLost!=null&&I.packetsLost!=null&&Oe(v,fc.PACKAGE_LOST,C.packetsLost-I.packetsLost),I.bytes!=null&&C.bytes!=null&&Oe(v,fc.BITRATE,8*(C.bytes-I.bytes)/O)}}return v}(p[0].ssrcId,e,t);break;case Q.LocalAudioTrack:a=i?void 0:function(_,m,S,C){let v=m.audioSend.find(U=>U.ssrc===_);if(!v)return;let y={};y[po.DISABLED]=C._originMediaStreamTrack&&!C._originMediaStreamTrack.enabled||C._mediaStreamTrack&&!C._mediaStreamTrack.enabled?1:0;let I=100*C._source.getAccurateVolumeLevel(),O=v.inputLevel;if(O!=null){let U=Math.ceil(50*Math.log10(100*O+1));Oe(y,po.LEVEL,U)}Oe(y,lB.PCM_LEVEL,I),Oe(y,po.AEC_RETURN_LOSS,v.aecReturnLoss),Oe(y,po.AEC_RETURN_LOSS_ENH,v.aecReturnLossEnhancement),y[po.FREEZE]=0;let P=S&&S.audioSend.find(U=>U.ssrc===_);if(P){let U=gs*dc;P.timestamp&&v.timestamp&&(U=v.timestamp-P.timestamp),P.bytes!=null&&v.bytes!=null&&Oe(y,po.BITRATE,8*(v.bytes-P.bytes)/U),P.packets!=null&&v.packets!=null&&Oe(y,po.PACKAGE_RATE,1e3*(v.packets-P.packets)/U)}return y}(p[0].ssrcId,e,t,h)}}),{high:s,low:c,audio:a}}getInboundStats(e,t,i){if(!this.requestRemoteMedia)return;let r=this.requestRemoteMedia()||[],a=[];return r.forEach(s=>{let[c,l]=s,u={peer:c.uid};if(l.has(_e.VIDEO)&&c.videoTrack){let h=c._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(c._videoSSRC)||!1,p=c.videoTrack?function(_,m,S,C,v,y,I){var O;let P=m.videoRecv.find(ie=>ie.ssrc===_);if(!P)return;let U={},{receivedFrame:x,outputFrame:G,decodeFrameRate:Z}=P,J=S&&S.videoRecv.find(ie=>ie.ssrc===_);if(U[qi.FREEZE]=v&&hB.isRemoteVideoFreeze(C,P,J)?1:0,Oe(U,_c.FRAME_RATE_DECODE,Z),Oe(U,qi.QP_SUM,P.qpSumPerFrame),P.framesRateFirefox&&Oe(U,qi.FRAME_RATE,P.framesRateFirefox),x&&Oe(U,qi.FRAME_RATE,x.frameRate),J){let ie=m.timestamp-S.timestamp||(I?gs:dc*gs);P.packetsLost!=null&&J.packetsLost!=null&&Oe(U,qi.PACKAGE_LOST,P.packetsLost-J.packetsLost),J.bytes!=null&&P.bytes!=null&&Oe(U,qi.BITRATE,8*(P.bytes-J.bytes)/ie),J.packets!=null&&P.packets!=null&&Oe(U,qi.PACKAGE_RATE,1e3*(P.packets-J.packets)/ie)}if(I)return U;x?(Oe(U,qi.HEIGHT,x.height),Oe(U,qi.WIDTH,x.width)):C&&(Oe(U,qi.HEIGHT,C._videoHeight||0),Oe(U,qi.WIDTH,C._videoWidth||0)),G&&Oe(U,_c.FRAME_RATE_OUTPUT,G.frameRate);let q=(O=C._player)===null||O===void 0?void 0:O.rendFrameRate.toFixed(0);if(q&&Oe(U,_c.FRAME_RATE_RENDER,+q),Oe(U,qi.JITTER_BUFFER,P.jitterBufferMs),Oe(U,qi.CURRENT_DELAY,P.currentDelayMs),Oe(U,qi.FIRS,P.firsCount),Oe(U,qi.NACKS,P.nacksCount),Oe(U,qi.PLIS,P.plisCount),C){U[qi.DISABLED]=C._originMediaStreamTrack.enabled&&C._mediaStreamTrack.enabled?0:1;let ie=C._player;if(ie){let{freezeTimeCounterList:Ie,renderFreezeAccTime:Ve,videoElementStatus:He}=ie;if(Ie&&Ie.length>0&&Oe(U,_c.FREEZE_TIME,Ie.splice(0,1)[0]),y&&vs.visibility==="visible"&&He===tr.PLAYING&&Ke().supportRequestVideoFrameCallback){let ut=Math.min(6e3,Ve);ie.renderFreezeAccTime=Math.max(0,Ve-ut),Oe(U,_c.FREEZE_TIME_RENDER,ut)}if(typeof P.totalFreezesDuration=="number"){let ut=J&&J.totalFreezesDuration?P.totalFreezesDuration-J.totalFreezesDuration:P.totalFreezesDuration;Oe(U,_c.FREEZE_DURATION,1e3*ut)}}}if(U[qi.PLAYER_STATUS]=dR[C._player?C._player.videoElementStatus:"uninit"],J&&P.totalInterFrameDelay!==void 0&&P.totalSquaredInterFrameDelay!==void 0&&J.totalInterFrameDelay!==void 0&&J.totalSquaredInterFrameDelay!==void 0){let ie=P.totalInterFrameDelay-J.totalInterFrameDelay,Ie=P.totalSquaredInterFrameDelay-J.totalSquaredInterFrameDelay,Ve=P.framesDecodeCount-J.framesDecodeCount,He=ie/Ve*1e3,ut=Math.round(1e3*Math.sqrt((Ie-Math.pow(ie,2)/Ve)/Ve));!isNaN(ut)&&He+ut>Math.max(3*He,He+150)&&(U[qi.I_FRAME_DELAY]=ut)}return U}(c._videoSSRC,e,t,c.videoTrack,h===!0,this.needUploadRenderFreezeTime,i):void 0;p&&(u.video=p)}if(l.has(_e.AUDIO)&&c.audioTrack){let h=c.audioTrack?function(p,_,m,S,C){let v=_.audioRecv.find(J=>J.ssrc===p);if(!v)return;let y={},I=m&&m.audioRecv.find(J=>J.ssrc===p),{receivedFrames:O,droppedFrames:P}=v;var U,x;if(Oe(y,Ha.JITTER,v.jitterMs),O!=null&&P!=null&&(y[Ha.FREEZE]=(x=P,(U=O)===0||100*x/U>20?1:0)),I){let J=_.timestamp-m.timestamp||(C?gs:gs*dc);v.packets!=null&&I.packets!=null&&Oe(y,Ha.PACKAGE_RATE,1e3*(v.packets-I.packets)/J),I.bytes!=null&&v.bytes!=null&&Oe(y,Ha.BITRATE,8*(v.bytes-I.bytes)/J),v.packetsLost!=null&&I.packetsLost!=null&&Oe(y,Ha.PACKAGE_LOST,v.packetsLost-I.packetsLost)}if(C)return y;let G=100*S._source.getAccurateVolumeLevel(),Z=v.outputLevel;if(Z!=null){let J=Math.ceil(50*Math.log10(100*Z+1));Oe(y,dB.LEVEL,J)}if(Oe(y,Ha.PCM_LEVEL,G),S&&(y[Ha.DISABLED]=S._originMediaStreamTrack.enabled&&S._mediaStreamTrack.enabled?0:1),Oe(y,Ha.JITTER_BUFFER,v.jitterBufferMs),Oe(y,Ha.CURRENT_DELAY,v.jitterBufferMs),y[Ha.PLAYER_STATUS]=dR[vr.getPlayerState(S.getTrackId())],I){let J=v.concealedSamples-I.concealedSamples;J>0&&Oe(y,Ha.CONCEALED_SAMPLES,J)}return y}(c._audioSSRC,e,t,c.audioTrack,i):void 0;h&&(u.audio=h)}(u.video||u.audio)&&a.push(u)}),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,a}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval(()=>{if(!this.requestAllTracks||!this.requestUpload)return;let e=(this.requestAllTracks()||[]).find(t=>t instanceof EE);if(e&&e._external.getDenoiserStats){let t=e._external.getDenoiserStats();t&&this.requestUpload(xh.DENOISER_STATS,t)}},2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval(()=>{!this.requestAllTracks||!this.requestUpload||this.requestAllTracks().forEach(e=>{e.getProcessorStats().forEach(t=>{this.requestUpload&&this.requestUpload(t.type,t.stats)})})},2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval(()=>{!this.requestUpload||!this.requestRemoteMedia||(this.requestRemoteMedia()||[]).forEach(e=>{let[t,i]=e;i.has(_e.VIDEO)&&t.videoTrack&&t.videoTrack.getProcessorStats().forEach(r=>{this.requestUpload&&this.requestUpload(r.type,r.stats)}),i.has(_e.AUDIO)&&t.audioTrack&&t.audioTrack.getProcessorStats().forEach(r=>{this.requestUpload&&this.requestUpload(r.type,r.stats)})})},2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0))}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);let e=new Map;this.uploadExtUsageStatsTimer=window.setInterval(async()=>{let t=Date.now(),i={connectionInterval:k("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:t},r=[],a=this.requestAllTracks&&this.requestAllTracks()||[];for(let u of a)!u.muted&&u.enabled&&(r=r.concat(await u.getProcessorUsage()));let s=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(let[u,h]of s)h.has(_e.VIDEO)&&u.videoTrack&&(r=r.concat(await u.videoTrack.getProcessorUsage())),h.has(_e.AUDIO)&&u.audioTrack&&(r=r.concat(await u.audioTrack.getProcessorUsage()));if(r.length===0)return;i.details=function(u,h){let p={};for(let{id:C,value:v,level:y,direction:I}of u){var _;let O=(_=h.get(C))!==null&&_!==void 0?_:0,P=v===2?O+k("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:O;var m,S;h.set(C,P),p[C]?(v===2&&(p[C].value=v),y>p[C].level&&(p[C].level=y),I==="remote"&&(p[C].remoteUidCount+=1),p[C].totalTs=(m=h.get(C))!==null&&m!==void 0?m:0):p[C]={value:v,level:y,remoteUidCount:I==="local"?0:1,totalTs:(S=h.get(C))!==null&&S!==void 0?S:0}}return Object.keys(p).map(C=>{let{level:v,value:y,totalTs:I}=p[C];return{id:C,level:v,value:y,totalTs:I}})}(r,e);let c=Date.now(),l=c>t?c:t+1;this.requestUpload&&this.requestUpload(xh.EXTENSION_USAGE_STATS,{usageStats:i,sendTs:l})},k("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}},Eo=class{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(e,t){b(this,"uid",void 0),b(this,"_uintid",void 0),b(this,"_trust_in_room_",!0),b(this,"_trust_audio_enabled_state_",!0),b(this,"_trust_video_enabled_state_",!0),b(this,"_trust_audio_mute_state_",!0),b(this,"_trust_video_mute_state_",!0),b(this,"_audio_muted_",!1),b(this,"_video_muted_",!1),b(this,"_audio_enabled_",!0),b(this,"_video_enabled_",!0),b(this,"_audio_added_",!1),b(this,"_video_added_",!1),b(this,"_is_pre_created",!1),b(this,"_video_pre_subscribed",!1),b(this,"_audio_pre_subscribed",!1),b(this,"_trust_video_stream_added_state_",!0),b(this,"_trust_audio_stream_added_state_",!0),b(this,"_audioTrack",void 0),b(this,"_videoTrack",void 0),b(this,"_dataChannels",[]),b(this,"_audioSSRC",void 0),b(this,"_videoSSRC",void 0),b(this,"_audioOrtc",void 0),b(this,"_videoOrtc",void 0),b(this,"_cname",void 0),b(this,"_rtxSsrcId",void 0),b(this,"_videoMid",void 0),b(this,"_audioMid",void 0),this.uid=e,this._uintid=t}},fn=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({});function zJ(e,t){var i;let r;switch(t){case Q.LocalAudioTrack:r=Qe.Audio;break;case Q.LocalVideoTrack:r=oe(i=e._hints).call(i,Rt.SCREEN_TRACK)?Qe.Screen:Qe.High;break;case Q.LocalVideoLowTrack:r=Qe.Low}return r}function $v(e){let t=Ke();if(e.some(i=>i._bypassWebAudio))throw new H(A.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!t.webAudioMediaStreamDest)throw new H(A.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function RR(e,t){$v(e);let i=new hi;return e.forEach(r=>i.addAudioTrack(r)),i}var zL,YL,qL,XL,JL,QL,ZL,$L,ek,tk,ik,bt;function rk(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),i.push.apply(i,r)}return i}function h_(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?rk(Object(i),!0).forEach(function(r){b(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):rk(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}var Mr=(zL=dn(fn.SEND_ONLY),YL=dn(fn.SEND_ONLY),qL=dn(),XL=dn(fn.RECEIVE_ONLY),JL=dn(fn.RECEIVE_ONLY),QL=dn(fn.RECEIVE_ONLY),ZL=dn(fn.RECEIVE_ONLY),$L=dn(fn.RECEIVE_ONLY),ek=dn(fn.RECEIVE_ONLY),tk=dn(),ik=dn(fn.RECEIVE_ONLY),bt=class extends Lt{get state(){return this._state}set state(e){let t=this._state;this._state=e,this.emit(Te.StateChange,t,this._state)}constructor(e,t){super(),b(this,"isPlanB",!1),b(this,"store",void 0),b(this,"statsUploader",void 0),b(this,"sendConnection",void 0),b(this,"recvConnection",void 0),b(this,"localTrackMap",new Map),b(this,"remoteUserMap",new Map),b(this,"localDataChannels",[]),b(this,"pendingLocalTracks",[]),b(this,"pendingRemoteTracks",[]),b(this,"statsCollector",void 0),b(this,"dtlsFailedCount",0),b(this,"sendMutex",new Fi("P2PChannel2-send-mutex")),b(this,"recvMutex",new Fi("P2PChannel2-recv-mutex")),b(this,"_state",Je.Disconnected),b(this,"_restartStates",["disconnected","failed"]),b(this,"reconnectInterval",void 0),b(this,"uploadUnplinkStarted",!1),b(this,"uploadDownlinkStarted",!1),b(this,"uplinkStateUploadInterval",void 0),b(this,"downlinkStatsUploadInterval",void 0),b(this,"handleMuteLocalTrack",async(i,r,a)=>{let s=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==Je.Connected)return void a(new H(A.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));let u=this.filterTobeMutedTracks(i);if(u.length===0)return void r();let h=u.find(S=>S[0]==="videoLowTrack");h&&h[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal(u.map(S=>{let[,{id:C}]=S;return C}));let p=!1;var c,l;i.trackMediaType==="video"?p=!((c=this.localTrackMap.get(Q.LocalAudioTrack))===null||c===void 0||!c.track._muted):p=((l=this.localTrackMap.get(Q.LocalVideoTrack))===null||l===void 0?void 0:l.id)===void 0;let _=this.createMuteMessage(u);await lt(this,Te.RequestMuteLocal,_);let m=i.trackMediaType==="video"?To.MUTE_LOCAL_VIDEO:To.MUTE_LOCAL_AUDIO;await lt(this,Te.RequestP2PMuteLocal,{action:m,message:_,isMuteAll:p}),r()}catch(u){a(u)}finally{s()}}),b(this,"handleUnmuteLocalTrack",async(i,r,a)=>{let s=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==Je.Connected)return void a(new H(A.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));let c=this.filterTobeUnmutedTracks(i);if(c.length===0)return void r();await this.sendConnection.unmuteLocal(c.map(h=>{let[,{id:p}]=h;return p}));let l=this.createUnmuteMessage(c),u=i.trackMediaType==="video"?To.UNMUTE_LOCAL_VIDEO:To.UNMUTE_LOCAL_AUDIO;await lt(this,Te.RequestP2PMuteLocal,{action:u,message:l}),r()}catch(c){a(c)}finally{s()}}),b(this,"handleUpdateVideoEncoder",async(i,r,a)=>{let s=await this.sendMutex.lock("Locking from P2PChannel2.handleSetVideoEncoder");try{let c=this.localTrackMap.get(Q.LocalVideoTrack);if(!this.sendConnection||!c||c.track!==i||this.state!==Je.Connected)return void r();let{id:l,track:u}=c;l&&(await this.sendConnection.updateSendParameters(l,u),await this.sendConnection.updateEncoderConfig(l,u),this.emit(Te.UpdateVideoEncoder,u)),r()}catch(c){a(c)}finally{s()}}),b(this,"handleUpdateVideoSendParameters",async(i,r,a)=>{let s=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{let c=this.localTrackMap.get(Q.LocalVideoTrack);if(!this.sendConnection||!c||c.track!==i||this.state!==Je.Connected)return void r();let{id:l,track:u}=c;l&&await this.sendConnection.updateSendParameters(l,u),r()}catch(c){a(c)}finally{s()}}),b(this,"handleReplaceTrack",async(i,r,a,s)=>{let c;R.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(i.getTrackId(),"]")),typeof s=="boolean"&&s||(c=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var l;let h=Array.from(this.localTrackMap.entries()).find(p=>{let[,{track:_}]=p;return i===_});if(!this.sendConnection||!h||h[1].id===void 0||this.state!==Je.Connected)return void r();if(await((l=this.sendConnection)===null||l===void 0?void 0:l.replaceTrack(i,h[1].id)),h[0]===Q.LocalVideoTrack&&Ke().supportDualStreamEncoding){let p=this.localTrackMap.get(Q.LocalVideoLowTrack);if(p){let _=i._mediaStreamTrack.clone();p.track._originMediaStreamTrack.stop(),p.track._mediaStreamTrack=_,p.track._originMediaStreamTrack=_,await new ae((m,S)=>{this.handleReplaceTrack(p.track,m,S,!0)})}}r()}catch(h){a(h)}finally{var u;(u=c)===null||u===void 0||u()}}),b(this,"handleGetLocalVideoStats",i=>{i(this.statsCollector.getLocalVideoTrackStats())}),b(this,"handleGetLocalAudioStats",i=>{i(this.statsCollector.getLocalAudioTrackStats())}),b(this,"handleGetRemoteVideoStats",i=>this.statsCollector.getRemoteVideoTrackStats(i.uid)[i.uid]),b(this,"handleGetRemoteAudioStats",i=>this.statsCollector.getRemoteAudioTrackStats(i.uid)[i.uid]),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new uB(e),this.bindStatsUploaderEvents(),this.reconnectInterval=window.setInterval(()=>{[this.sendConnection,this.recvConnection].forEach(i=>{i&&(i.iceConnectionState!=="disconnected"&&i.iceConnectionState!=="failed"||this.handleDisconnect(i.direction))})},k("ICE_RESTART_INTERVAL"))}async startP2PConnection(e,t){throw new H(A.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(e){throw new H(A.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(e,t){let i;try{if(t){this.recvConnection&&(R.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),i=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new HL(e,this.store,ur.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);let r=await this.recvConnection.establish(t);return{iceParameters:r.iceParameters,dtlsParameters:r.dtlsParameters,sdp:r.sdp}}{this.state=Je.New,this.sendConnection&&(R.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),i=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new HL(e,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);let r=await this.sendConnection.establish();return{iceParameters:r.iceParameters,dtlsParameters:r.dtlsParameters,sdp:r.sdp}}}finally{i&&i()}}async p2pConnect(e){if(!this.sendConnection)throw new H(A.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Je.Connected}async addRemoteCandidate(e,t){if(t===ur.RECEIVE_ONLY){if(!this.sendConnection)throw new H(A.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(e)}else{if(!this.recvConnection)throw new H(A.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(e)}}publish(e,t,i){var r=this;return gn(function*(){let a=yield Ye(r.sendMutex.lock("From P2PChannel.publish"));try{if(!r.sendConnection||r.state!==Je.Connected){r.throwIfTrackTypeNotMatch(e);let h=e.filter(p=>r.pendingLocalTracks.indexOf(p)===-1);return void(r.pendingLocalTracks=r.pendingLocalTracks.concat(h))}r.store.pubId=r.store.pubId+1,ji.markPublishStart(r.store.clientId,r.store.pubId);let s=r.filterTobePublishedTracks(e,t,i);if(s.length===0)return void(yield Ye(r.tryToUnmuteAudio(e)));s.forEach(h=>{let{track:p,type:_}=h,m=Date.now();r.store.publish(p.getTrackId(),_===Q.LocalAudioTrack?"audio":"video",m)}),r.bindLocalTrackEvents(s);let c=yield Ye(r.sendConnection.send(s.map(h=>{let{track:p}=h;return p}),r.store.codec,r.store.audioCodec)),l=(yield Ye(c.next())).value,u=r.createGatewayPublishMessage(s,l);try{yield u}catch(h){throw c.throw(h),(h==null?void 0:h.code)===A.WS_ABORT&&s.forEach(p=>{let{track:_}=p;r.pendingLocalTracks.indexOf(_)===-1&&r.pendingLocalTracks.push(_)}),r.unbindLocalTrackEvents(s),h}yield Ye(c.next()),s.forEach(h=>{let{type:p}=h;r.statsCollector.addLocalStats(p)}),r.statsUploader.startUploadOutboundStats(),r.assignLocalTracks(s,l),s.forEach(h=>{let{track:p,type:_}=h,m=Date.now();r.store.publish(p.getTrackId(),_===Q.LocalAudioTrack?"audio":"video",void 0,m)}),r.startUploadUplinkState()}finally{a()}})()}async unpublish(e){if(!this.sendConnection||this.state!==Je.Connected)return void(e.length===0?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter(a=>!oe(e).call(e,a)));let t=this.filterTobeUnpublishedTracks(e);if(t.length===0)return;let i=t.find(a=>a[0]==="videoLowTrack");i&&i[1].track.close();let r=this.createGatewayUnpublishMessage(t);if(await this.sendConnection.stopSending(t.map(a=>{let[,{id:s}]=a;return s})),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map(a=>{let[s,{track:c}]=a;return{type:s,track:c}})),t.forEach(a=>{let[s]=a;this.statsCollector.removeLocalStats(s)}),this.localTrackMap.size===0&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===Je.Connected)return i&&i[1].track.close(),r;e.forEach(a=>{let s=this.pendingLocalTracks.indexOf(a);s!==-1&&this.pendingLocalTracks.splice(s,1)})}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);let e=()=>{let t=[],i=[];Array.from(this.localTrackMap.entries()).forEach(r=>{let[a,{track:s,ssrcs:c}]=r,l={stream_type:zJ(s,a),ssrcs:c};s._muted||!s._enabled?t.push(l):i.push(l)}),t.length>0&&t.forEach(r=>{lt(this,Te.RequestMuteLocal,[r])}),i.length>0&&i.forEach(r=>{lt(this,Te.RequestUnmuteLocal,[r])})};e(),this.uplinkStateUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(e){return gn(function*(){throw new H(A.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}async republish(){this.pendingLocalTracks.length>0&&(R.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await ki(this,Te.RequestRePublish,this.pendingLocalTracks),this.emit(Te.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new H(A.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(e,t,i,r){var a;if(!this.recvConnection)throw new H(A.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if((a=this.remoteUserMap.get(e))!==null&&a!==void 0&&a.has(t))return;let{track:s,mid:c,transceiver:l}=await this.recvConnection.receive(t,[{ssrcId:i}],String(e.uid),r);t===_e.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(s):(e._audioTrack=new ld(s,e.uid,e._uintid,this.store),R.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),l&&e._audioTrack._updateRtpTransceiver(l),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoSSRC=i,e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(s):(e._videoTrack=new cd(s,e.uid,e._uintid,this.store),R.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),l&&e._videoTrack._updateRtpTransceiver(l),this.bindRemoteTrackEvents(e,e._videoTrack));let u=this.remoteUserMap.get(e);u?u.set(t,c):this.remoteUserMap.set(e,new Map([[t,c]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();let h=this.pendingRemoteTracks.findIndex(p=>{let{user:_,kind:m}=p;return _.uid===e.uid&&t===m});h!==-1&&(this.pendingRemoteTracks.splice(h,1),this.emit(Te.MediaReconnectEnd,e.uid))}async mockSubscribe(e,t,i,r){if(!this.recvConnection)throw new H(A.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(t,[{ssrcId:i}],String(e.uid),r)}async unsubscribe(e,t,i){let r=this.pendingRemoteTracks.filter(s=>{let{user:c,kind:l}=s;return t!==void 0?c.uid===e.uid&&t===l:c.uid===e.uid});if(r.forEach(s=>{let c=this.pendingRemoteTracks.indexOf(s);this.pendingRemoteTracks.splice(c,1)}),this.recvConnection||i||r.forEach(s=>{let{kind:c}=s;var l;if(c===_e.AUDIO)(l=e._audioTrack)===null||l===void 0||l._destroy(),e._audioTrack=void 0;else if(c===_e.VIDEO){var u;(u=e._videoTrack)===null||u===void 0||u._destroy(),e._videoTrack=void 0}}),!this.recvConnection)return;let a=this.filterTobeUnSubscribedTracks(e,t);a.length!==0&&(await this.recvConnection.stopReceiving(a.map(s=>{let[,{id:c}]=s;return c})),this.withdrawRemoteTracks(a),this.remoteUserMap.size===0&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),a.forEach(s=>{let[c,{kind:l}]=s;var u,h;if(l===_e.VIDEO&&c._videoSSRC&&((u=this.recvConnection)===null||u===void 0||u.setStatsRemoteVideoIsReady(c._videoSSRC,!1)),l===_e.VIDEO)this.unbindRemoteTrackEvents(c._videoTrack),i||((h=c._videoTrack)===null||h===void 0||h._destroy(),c._videoTrack=void 0);else if(l===_e.AUDIO){var p;this.unbindRemoteTrackEvents(c._audioTrack),!i&&((p=c._audioTrack)===null||p===void 0||p._destroy(),c._audioTrack=void 0)}}),a.forEach(s=>{let[,{kind:c}]=s;lt(this,Te.RequestP2PMuteRemote,c)}))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);let e=()=>Array.from(this.remoteUserMap.entries()).forEach(t=>{let[,i]=t;[_e.VIDEO,_e.AUDIO].forEach(r=>{i.has(r)?lt(this,Te.RequestP2PUnmuteRemote,r):lt(this,Te.RequestP2PMuteRemote,r)})});e(),this.downlinkStatsUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(e){throw new H(A.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(e){throw new H(A.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(e){throw new H(A.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(e){throw new H(A.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(e,t){if(!this.recvConnection)return;let i=this.remoteUserMap.get(e);if(!i)return void R.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid,"."));if(!i.get(t))return void R.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));let r=t===_e.VIDEO?e._videoSSRC:e._audioSSRC;r!==void 0&&this.recvConnection.setStatsRemoteVideoIsReady(r,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.recvConnection)return;let i=this.remoteUserMap.get(e);if(!i)return void R.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid,"."));i.get(t)||R.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."))}getAllTracks(e){let t=this.localTrackMap.get(Q.LocalAudioTrack);if((t==null?void 0:t.track)instanceof hi){let i=t.track;return Array.from(this.localTrackMap.entries()).filter(r=>{let[a]=r;return a!==Q.LocalAudioTrack}).filter(r=>{let[a]=r;return!(e&&a===Q.LocalVideoLowTrack)}).map(r=>{let[,{track:a}]=r;return a}).concat(i.trackList)}return Array.from(this.localTrackMap.entries()).filter(i=>{let[r]=i;return!(e&&r===Q.LocalVideoLowTrack)}).map(i=>{let[,{track:r}]=i;return r})}reportPublishEvent(e,t,i,r,a){if(e){let c=this.localTrackMap.get(Q.LocalAudioTrack),l=r?this.localTrackMap.get(Q.LocalVideoLowTrack):this.localTrackMap.get(Q.LocalVideoTrack);fe.publish(this.store.sessionId,{eventElapse:ji.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:c==null?void 0:c.track.getTrackLabel(),videoName:l==null?void 0:l.track.getTrackLabel(),screenshare:(l==null?void 0:l.track._hints.indexOf(Rt.SCREEN_TRACK))!==-1,audio:!!c,video:!!l,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:a})}else{var s;i||(i=[]);let c=i.find(u=>u instanceof xt),l=r?(s=this.localTrackMap.get(Q.LocalVideoTrack))===null||s===void 0?void 0:s.track:i.find(u=>u instanceof St);fe.publish(this.store.sessionId,{eventElapse:ji.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:c==null?void 0:c.getTrackLabel(),videoName:l==null?void 0:l.getTrackLabel(),screenshare:(l==null?void 0:l._hints.indexOf(Rt.SCREEN_TRACK))!==-1,audio:!!c,video:!!l,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:a})}}reportSubscribeEvent(e,t,i,r){let a=r===_e.VIDEO?i._videoSSRC:i._audioSSRC;a&&fe.subscribe(this.store.sessionId,{succ:e,ec:t,video:r===_e.VIDEO,audio:r===_e.AUDIO,peerid:i.uid,subscribeRequestid:r===_e.VIDEO?i._videoSSRC:i._audioSSRC,p2pid:this.store.p2pId,eventElapse:ji.measureFromSubscribeStart(this.store.clientId,a)})}reset(){R.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new Fi("P2PChannel2-send-mutex"),this.sendMutex=new Fi("P2PChannel2-recv-mutex"),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();let e=this.localTrackMap.get(Q.LocalAudioTrack);if((e==null?void 0:e.track)instanceof hi){if(e.track.trackList.length>0){let t=e.track;e.track.trackList.forEach(i=>{t.removeAudioTrack(i)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=Je.Disconnected}getStats(e){var t,i;return e?(i=this.recvConnection)===null||i===void 0?void 0:i.getStats():(t=this.sendConnection)===null||t===void 0?void 0:t.getStats()}getRemoteVideoIsReady(e){var t;return((t=this.recvConnection)===null||t===void 0?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){let e=this.localTrackMap.get(Q.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){let e=this.localTrackMap.get(Q.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){let t=this.localTrackMap.get(e);return t&&t.track instanceof St||t&&t.track instanceof xt?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;let i=this.remoteUserMap.get(e);return!!i&&(!t||i.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;let i=this.remoteUserMap.get(e);return!!i&&(!t||i.has(t))}getRemoteMedia(e){var t;let i=Array.from(Xr(t=this.remoteUserMap).call(t)).find(r=>r.uid===e);return i?{audioTrack:i.audioTrack,audioSSRC:i._audioSSRC,videoTrack:i.videoTrack,videoSSRC:i._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(i=>{let[r]=i;return{uid:r.uid,level:r.audioTrack?100*r.audioTrack._source.getAccurateVolumeLevel():0}}),t=this.localTrackMap.get(Q.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=cp(e).call(e,(i,r)=>i.level-r.level),e}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(R.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=Je.Reconnecting,k("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t]=e;var i;t._videoTrack&&t._videoTrack._player&&((i=t._videoTrack._player.getVideoElement())===null||i===void 0||i.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())}),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var t;let[i,{track:r}]=e;switch(i){case Q.LocalVideoTrack:oe(t=r._hints).call(t,Rt.LOW_STREAM)?r.close():this.pendingLocalTracks.push(r);break;case Q.LocalAudioTrack:r instanceof hi?this.pendingLocalTracks=this.pendingLocalTracks.concat(r.trackList):this.pendingLocalTracks.push(r);case Q.LocalVideoLowTrack:}}),this.emit(Te.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,i]=e;Array.from(Xr(i).call(i)).forEach(r=>{this.setPendingRemoteMedia(t,r)}),this.emit(Te.MediaReconnectStart,t.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),R.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(e,t){for(let i of this.pendingRemoteTracks){let{user:r,kind:a}=i;if((e instanceof Eo?e.uid:e)===r.uid&&t===a)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}async restartICE(e,t){let i,r;if(e===ur.SEND_ONLY){if(!this.sendConnection)throw new H(A.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");i=await this.sendMutex.lock("From P2PChannel.restartICE"),r=this.sendConnection}else{if(!this.recvConnection)throw new H(A.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");i=await this.recvMutex.lock("From P2PChannel.restartICE"),r=this.recvConnection}try{if(t){let a=await r.restartICE(t);return r.isInRestartIce=!1,a}{let a=await r.restartICE();if(a){let s=await ki(this,Te.RequestP2PRestartICE,{direction:ur.RECEIVE_ONLY,iceParameter:a});await r.restartICE(s),r.isInRestartIce=!1}}}finally{i()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;let e=this.sendConnection.getStats(),t=this.localTrackMap.get(Q.LocalVideoTrack),i=this.localTrackMap.get(Q.LocalAudioTrack),r=e.videoSend.find(S=>{var C;return S.ssrc===(t==null||(C=t.ssrcs)===null||C===void 0?void 0:C[0].ssrcId)}),a=e.audioSend.find(S=>{var C;return S.ssrc===(i==null||(C=i.ssrcs)===null||C===void 0?void 0:C[0].ssrcId)});if(!r||!a)return 1;let s=ga(this,Te.NeedSignalRTT),c=r?r.rttMs:void 0,l=a?a.rttMs:void 0,u=c&&l?(c+l)/2:c||l,h=(u&&s?(u+s)/2:u||s)||0,p=100*e.sendPacketLossRate*.7/50+.3*h/1500,_=p<.17?1:p<.36?2:p<.59?3:p<.1?4:5,m=t==null?void 0:t.track;if(m&&m._encoderConfig&&m._hints.indexOf(Rt.SCREEN_TRACK)===-1){let S=m._encoderConfig.bitrateMax,C=e.bitrate.actualEncoded;if(S&&C){let v=(1e3*S-C)/(1e3*S);return nV[v<.15?0:v<.3?1:v<.45?2:v<.6?3:4][_]}}return _}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;let e=this.recvConnection.getStats(),t=0;return Array.from(this.remoteUserMap.entries()).forEach(i=>{let[r]=i,a=r._audioSSRC,s=r._videoSSRC,c=e.audioRecv.find(C=>C.ssrc===a),l=e.videoRecv.find(C=>C.ssrc===s);if(!c&&!l)return void(t+=1);let u=ga(this,Te.NeedSignalRTT),h=e.rtt,p=(h&&u?(h+u)/2:h||u)||0,_=c?c.jitterMs:void 0,m=e.recvPacketLossRate,S=.7*m*100/50+.3*p/1500;_&&(S=.6*m*100/50+.2*p/1500+.2*_/400),t+=S<.1?1:S<.17?2:S<.36?3:S<.59?4:5}),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new ae((t,i)=>{this.handleMuteLocalTrack(e,t,i)})}filterTobePublishedTracks(e,t,i){let r=[],a=Ke(),s=this.getAllTracks();e=Zl(e=e.filter(u=>s.indexOf(u)===-1));let c=!1,l=!1;for(let u of e){if(u instanceof St&&(this.localTrackMap.has(Q.LocalVideoTrack)||c?new H(A.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(r.push({track:u,type:Q.LocalVideoTrack}),c=!0),t)){let h=this.getLowVideoTrack(u,i);r.push({track:h,type:Q.LocalVideoLowTrack})}if(u instanceof xt){let h=this.localTrackMap.get(Q.LocalAudioTrack);if(h){if(!(h.track instanceof hi))throw new H(A.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(u._bypassWebAudio)throw new H(A.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");h.track.addAudioTrack(u),this.bindLocalAudioTrackEvents(u,!0)}else if(l){let p=r.find(_=>{let{type:m}=_;return m===Q.LocalAudioTrack});if(!(p.track instanceof hi))throw new H(A.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(u._bypassWebAudio)throw new H(A.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");p.track.addAudioTrack(u)}else{if(!a.webAudioMediaStreamDest||u instanceof hi||u._bypassWebAudio)r.push({track:u,type:Q.LocalAudioTrack});else{let p=new hi;p.addAudioTrack(u),r.push({track:p,type:Q.LocalAudioTrack})}l=!0}}}return r}filterTobeUnpublishedTracks(e){let t=[],i=this.getAllTracks();e=Zl(e=e.filter(r=>i.indexOf(r)!==-1));for(let r of e){if(r instanceof xt){let a=this.localTrackMap.get(Q.LocalAudioTrack);if(!a)continue;a.track instanceof hi?(a.track.removeAudioTrack(r),this.unbindLocalAudioTrackEvents(r),a.track.trackList.length===0&&(t.push([Q.LocalAudioTrack,a]),a.track.close())):t.push([Q.LocalAudioTrack,a])}if(r instanceof St){let a=this.localTrackMap.get(Q.LocalVideoTrack);if(!a)continue;t.push([Q.LocalVideoTrack,a]);let s=this.localTrackMap.get(Q.LocalVideoLowTrack);s&&t.push([Q.LocalVideoLowTrack,s])}}return t}bindLocalTrackEvents(e){e.forEach(t=>{let{track:i,type:r}=t;switch(r){case Q.LocalVideoTrack:i.addListener(ce.GET_STATS,this.handleGetLocalVideoStats),i.addListener(ce.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(ce.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(ce.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),i.addListener(ce.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),i.addListener(ce.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.addListener(ce.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(ce.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Q.LocalAudioTrack:this.bindLocalAudioTrackEvents(i);case Q.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,t){e instanceof hi?e.trackList.forEach(i=>{i.addListener(ce.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(ce.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(ce.GET_STATS,this.handleGetLocalAudioStats),i.addListener(ce.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(ce.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(ce.GET_STATS,this.handleGetLocalAudioStats),e.addListener(ce.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(ce.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(ce.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(ce.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||e.addListener(ce.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(t=>{let[i,{track:r}]=t;return{track:r,type:i}})),e.forEach(t=>{let{track:i,type:r}=t;switch(r){case Q.LocalVideoTrack:i.off(ce.GET_STATS,this.handleGetLocalVideoStats),i.off(ce.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.off(ce.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.off(ce.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),i.off(ce.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),i.off(ce.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.off(ce.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.off(ce.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Q.LocalAudioTrack:this.unbindLocalAudioTrackEvents(i);case Q.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof hi?e.trackList.forEach(t=>{t.off(ce.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(ce.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(ce.GET_STATS,this.handleGetLocalAudioStats),t.off(ce.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(ce.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(ce.GET_STATS,this.handleGetLocalAudioStats),e.off(ce.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(ce.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(ce.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(ce.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(ce.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof cd&&t.addListener(ce.GET_STATS,i=>{i(this.handleGetRemoteVideoStats(e))}),t instanceof ld&&t.addListener(ce.GET_STATS,i=>{i(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(ce.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,i]=e;i.has(_e.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),i.has(_e.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)})}createGatewayPublishMessage(e,t){return e.map((i,r)=>{var a;let s,{track:c,type:l}=i;switch(l){case Q.LocalAudioTrack:s=Qe.Audio;break;case Q.LocalVideoTrack:s=oe(a=c._hints).call(a,Rt.SCREEN_TRACK)?Qe.Screen:Qe.High;break;case Q.LocalVideoLowTrack:s=Qe.Low}return{kind:l===Q.LocalAudioTrack?_e.AUDIO:_e.VIDEO,stream_type:s,mid:t[r].id,ssrcs:t[r].localSSRC,isMuted:c.muted||!c.enabled}})}createGatewayUnpublishMessage(e){return e.map(t=>{var i;let r,[a,{track:s,ssrcs:c,id:l}]=t;switch(a){case Q.LocalVideoTrack:r=oe(i=s._hints).call(i,Rt.SCREEN_TRACK)?Qe.Screen:Qe.High;break;case Q.LocalAudioTrack:r=Qe.Audio;break;case Q.LocalVideoLowTrack:r=Qe.Low}return{stream_type:r,ssrcs:c,mid:l}})}assignLocalTracks(e,t){e.forEach((i,r)=>{let{track:a,type:s}=i;this.localTrackMap.set(s,{track:a,id:t[r].id,ssrcs:t[r].localSSRC})})}withdrawLocalTracks(e){e.forEach(t=>{let[i]=t;this.localTrackMap.delete(i)})}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{var i;R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(e.name,".onConnectionStateChange(").concat(t,")")),this.emit(Te.PeerConnectionStateChange,t),t!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),t==="connected"&&(e.isInRestartIce=!1),oe(i=this._restartStates).call(i,t)&&!e.isInRestartIce&&(t==="disconnected"&&await yi(800),e.iceConnectionState!=="disconnected"&&e.iceConnectionState!=="failed"||this.handleDisconnect(e.direction))},e.onICEConnectionStateChange=t=>{t!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(t,")")),fe.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:t,tag:Vt.TRACER}).onSuccess(),this.emit(Te.IceConnectionStateChange,t)},e.onICETransportStateChange=t=>{R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(t,")"))},e.onDTLSTransportStateChange=t=>{R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(t,")"))},e.onDTLSTransportError=t=>{R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(t,")"))},e.onFirstAudioDecoded=t=>{var i;let r=Array.from(Xr(i=this.remoteUserMap).call(i)).find(s=>s._audioSSRC===t);var a;r&&(this.store.subscribe(r.uid,"audio",void 0,void 0,void 0,Date.now()),(a=r.audioTrack)===null||a===void 0||a.emit(od.FIRST_FRAME_DECODED),fe.firstRemoteFrame(this.store.sessionId,Si.FIRST_AUDIO_DECODE,Pt.FIRST_AUDIO_DECODE,{peer:r._uintid,subscribeElapse:ji.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=t=>{var i;let r=Array.from(Xr(i=this.remoteUserMap).call(i)).find(a=>a._audioSSRC===t);r&&fe.firstRemoteFrame(this.store.sessionId,Si.FIRST_AUDIO_RECEIVED,Pt.FIRST_AUDIO_RECEIVED,{peer:r._uintid,subscribeElapse:ji.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(t,i,r)=>{this.reportVideoFirstFrameDecoded(t,i,r)},e.onFirstVideoReceived=t=>{var i;let r=Array.from(Xr(i=this.remoteUserMap).call(i)).find(a=>a._videoSSRC===t);r&&fe.firstRemoteFrame(this.store.sessionId,Si.FIRST_VIDEO_RECEIVED,Pt.FIRST_VIDEO_RECEIVED,{peer:r._uintid,subscribeElapse:ji.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(t,i)=>{let r=t.candidateType==="relay",a=i.candidateType==="relay";i.candidateType!=="unknown"&&r===a||this.emit(Te.ConnectionTypeChange,r),R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Ro(i))," -> ").concat(JSON.stringify(Ro(t)),")"))},e.onSelectedRemoteCandidateChanged=(t,i)=>{R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Ro(i))," -> ").concat(JSON.stringify(Ro(t)),")"))},e.onFirstVideoDecodedTimeout=t=>{this.reportVideoFirstFrameDecoded(t,void 0,void 0,!0)},e.onLocalCandidate=t=>{this.emit(Te.LocalCandidate,{candidate:t,direction:e.direction})}}unbindConnectionEvents(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.onLocalCandidate=void 0}async handleDisconnect(e){let t=e===ur.SEND_ONLY?this.sendConnection:this.recvConnection;t&&!t.isInRestartIce&&(t.isInRestartIce=!0,R.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(t.name,"] start use restartICE")),e===ur.SEND_ONLY?this.restartICE(e):ki(this,Te.RequestP2PRestartICE,{direction:ur.SEND_ONLY}))}filterTobeMutedTracks(e){let t=[];if(this.getAllTracks().indexOf(e)===-1)return t;let i=this.localTrackMap.get(Q.LocalAudioTrack);if(e instanceof xt&&(i==null?void 0:i.track)instanceof hi)return i.track.isActive||t.push([Q.LocalAudioTrack,i]),t;let r=Array.from(this.localTrackMap.entries()).find(a=>{let[,{track:s}]=a;return e===s});if(r&&(t.push(r),r[0]===Q.LocalVideoTrack)){let a=this.localTrackMap.get(Q.LocalVideoLowTrack);a&&t.push([Q.LocalVideoLowTrack,a])}return t}filterTobeUnmutedTracks(e){let t=[],i=this.localTrackMap.get(Q.LocalAudioTrack);if(e instanceof xt&&(i==null?void 0:i.track)instanceof hi)return i.track.isActive&&t.push([Q.LocalAudioTrack,i]),t;let r=Array.from(this.localTrackMap.entries()).find(a=>{let[,{track:s}]=a;return e===s});if(r)if(r[0]===Q.LocalVideoTrack){t.push(r);let a=this.localTrackMap.get(Q.LocalVideoLowTrack);a&&t.push([Q.LocalVideoLowTrack,a])}else t.push(r);return t}createMuteMessage(e){return e.map(t=>{var i;let r,[a,{track:s,ssrcs:c,id:l}]=t;switch(a){case Q.LocalAudioTrack:r=Qe.Audio;break;case Q.LocalVideoTrack:r=oe(i=s._hints).call(i,Rt.SCREEN_TRACK)?Qe.Screen:Qe.High;break;case Q.LocalVideoLowTrack:r=Qe.Low}return{stream_type:r,ssrcs:c,mid:l}})}createUnmuteMessage(e){return e.map(t=>{var i;let r,[a,{track:s,ssrcs:c,id:l}]=t;switch(a){case Q.LocalAudioTrack:r=Qe.Audio;break;case Q.LocalVideoTrack:r=oe(i=s._hints).call(i,Rt.SCREEN_TRACK)?Qe.Screen:Qe.High;break;case Q.LocalVideoLowTrack:r=Qe.Low}return{stream_type:r,ssrcs:c,mid:l}})}filterTobeUnSubscribedTracks(e,t){let i=[],r=this.remoteUserMap.get(e);if(!r)return i;if(t){let a=r.get(t);if(!a)return i;i.push([e,{kind:t,id:a}])}else Array.from(r.entries()).forEach(a=>{let[s,c]=a;i.push([e,{kind:s,id:c}])});return i}createUnsubscribeMessage(e){let t=[];return e.forEach(i=>{let[r,{kind:a,id:s}]=i;switch(a){case _e.VIDEO:return void(r._videoSSRC&&t.push({stream_type:_e.VIDEO,ssrcId:r._videoSSRC}));case _e.AUDIO:return void(r._audioSSRC&&t.push({stream_type:_e.AUDIO,ssrcId:r._audioSSRC}))}}),t}withdrawRemoteTracks(e){e.forEach(t=>{let[i,{kind:r}]=t,a=this.remoteUserMap.get(i);a&&(a.delete(r),Array.from(a.entries()).length===0&&this.remoteUserMap.delete(i))})}async updateBitrateLimit(e){let t=this.localTrackMap.get(Q.LocalVideoTrack),i=this.localTrackMap.get(Q.LocalVideoLowTrack);t&&await t.track.setBitrateLimit(e.uplink),i&&e.low_stream_uplink&&await i.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0})}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){let e=this.sendConnection.peerConnectionState,t=this.recvConnection.peerConnectionState;return e!=="connected"&&t!=="connected"}return!0}async tryToUnmuteAudio(e){for(let t=0;t<e.length;t++)if(e[t]instanceof xt){let i=this.filterTobeUnmutedTracks(e[t]);if(i.length===0)continue;let r=this.createUnmuteMessage(i);return void await lt(this,Te.RequestUnmuteLocal,r)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=e=>this.getStats(e),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(e=>{let[,{ssrcs:t}]=e;return!!t}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!((t=this.recvConnection)===null||t===void 0||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(Te.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(Te.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await yi(Xy(this.dtlsFailedCount,ti)),this.emit(Te.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has(Q.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof St)}throwIfTrackTypeNotMatch(e){if(e.filter(t=>t instanceof St).length>1)throw new H(A.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(t=>t instanceof xt).length>1&&(e.some(t=>t instanceof xt&&t._bypassWebAudio)||!Ke().webAudioMediaStreamDest))throw new H(A.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(let t of e){if(t instanceof St&&this.pendingLocalTracks.some(i=>i instanceof St))throw new H(A.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof xt&&this.pendingLocalTracks.some(i=>i instanceof xt)&&(!Ke().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some(i=>i instanceof xt&&i._bypassWebAudio)))throw new H(A.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){let i=!k("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ke().supportDualStreamEncoding,r=h_(h_({},{width:160,height:120,framerate:15,bitrate:50}),t),a;a=i?e._mediaStreamTrack.clone():Zv(e,r);let s=ft(8,"track-low-"),c=new St(a,h_(h_({},i&&{scaleResolutionDownBy:Vv(r,e)}),{},{frameRate:r.framerate,bitrateMax:r.bitrate,bitrateMin:r.bitrate}),void 0,void 0,s);return c.on(wc.TRANSCEIVER_UPDATED,l=>{e._updateRtpTransceiver(l,Td.LOW_STREAM)}),c._hints.push(Rt.LOW_STREAM),e.addListener(ce.NEED_CLOSE,()=>{c.close()}),c}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(e,t,i,r){var a;let s=Array.from(Xr(a=this.remoteUserMap).call(a)).find(c=>c._videoSSRC===e);if(s){r||this.store.subscribe(s.uid,"video",void 0,void 0,void 0,void 0,Date.now());let c=this.store.keyMetrics,l=c.subscribe.find(u=>u.userId===s.uid&&u.type==="video");fe.firstRemoteVideoDecode(this.store.sessionId,Si.FIRST_VIDEO_DECODE,Pt.FIRST_VIDEO_DECODE,{peer:s._uintid,videowidth:t,videoheight:i,subscribeElapse:ji.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:c.requestAPEnd||0,apStart:c.requestAPStart||0,joinGwEnd:c.joinGatewayEnd||0,joinGwStart:c.joinGatewayStart||0,pcEnd:c.peerConnectionEnd||0,pcStart:c.peerConnectionStart||0,subscriberEnd:(l==null?void 0:l.subscribeEnd)||0,subscriberStart:(l==null?void 0:l.subscribeStart)||0,videoAddNotify:(l==null?void 0:l.streamAdded)||0,state:r?1:0})}}async remoteMediaSsrcChanged(e,t,i){if(!this.recvConnection)return!1;let r=this.remoteUserMap.get(e);if(!r)return!1;let a=r.get(t);if(!a)return!1;let s=await this.recvConnection.getRemoteSSRC(a);return s!==void 0&&s!==i}isPreSubScribe(e){return!1}async publishDataChannel(e){throw new H(A.NOT_SUPPORTED)}async unpublishDataChannel(e){throw new H(A.NOT_SUPPORTED)}async subscribeDataChannel(e,t){throw new H(A.NOT_SUPPORTED)}async unsubscribeDataChannel(e,t){throw new H(A.NOT_SUPPORTED)}hasPendingRemoteDataChannel(e,t){throw new H(A.NOT_SUPPORTED)}setPendingRemoteDataChannel(e,t){throw new H(A.NOT_SUPPORTED)}async preConnect(e){throw new H(A.NOT_SUPPORTED)}getEstablishParams(){throw new H(A.NOT_SUPPORTED)}async reSubscribe(e){throw new H(A.NOT_SUPPORTED)}async updateVideoStreamParameter(e,t){throw new H(A.NOT_SUPPORTED)}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[t,{track:i}]=e;t===Q.LocalVideoLowTrack?i._updateRtpTransceiver(void 0,Td.LOW_STREAM):i._updateRtpTransceiver(void 0)})}},de(bt.prototype,"p2pConnect",[zL],Object.getOwnPropertyDescriptor(bt.prototype,"p2pConnect"),bt.prototype),de(bt.prototype,"unpublish",[YL],Object.getOwnPropertyDescriptor(bt.prototype,"unpublish"),bt.prototype),de(bt.prototype,"unpublishLowStream",[qL],Object.getOwnPropertyDescriptor(bt.prototype,"unpublishLowStream"),bt.prototype),de(bt.prototype,"subscribe",[XL],Object.getOwnPropertyDescriptor(bt.prototype,"subscribe"),bt.prototype),de(bt.prototype,"mockSubscribe",[JL],Object.getOwnPropertyDescriptor(bt.prototype,"mockSubscribe"),bt.prototype),de(bt.prototype,"unsubscribe",[QL],Object.getOwnPropertyDescriptor(bt.prototype,"unsubscribe"),bt.prototype),de(bt.prototype,"muteRemote",[ZL],Object.getOwnPropertyDescriptor(bt.prototype,"muteRemote"),bt.prototype),de(bt.prototype,"unmuteRemote",[$L],Object.getOwnPropertyDescriptor(bt.prototype,"unmuteRemote"),bt.prototype),de(bt.prototype,"hasRemoteMediaWithLock",[ek],Object.getOwnPropertyDescriptor(bt.prototype,"hasRemoteMediaWithLock"),bt.prototype),de(bt.prototype,"disconnectForReconnect",[tk],Object.getOwnPropertyDescriptor(bt.prototype,"disconnectForReconnect"),bt.prototype),de(bt.prototype,"remoteMediaSsrcChanged",[ik],Object.getOwnPropertyDescriptor(bt.prototype,"remoteMediaSsrcChanged"),bt.prototype),bt);function dn(e){return function(t,i,r){let a=t[i];if(typeof a!="function")throw new Error("Cannot use mutex on object property.");return r.value=async function(){for(var s=arguments.length,c=new Array(s),l=0;l<s;l++)c[l]=arguments[l];switch(e){case fn.SEND_ONLY:{let u=await this.sendMutex.lock("From P2PChannel2.".concat(i));try{return await a.apply(this,c)}finally{u()}}case fn.RECEIVE_ONLY:{let u=await this.recvMutex.lock("From P2PChannel2.".concat(i));try{return await a.apply(this,c)}finally{u()}}default:{let u=await this.sendMutex.lock("From P2PChannel2.".concat(i)),h=await this.recvMutex.lock("From P2PChannel2.".concat(i));try{return await a.apply(this,c)}finally{u(),h()}}}},r}}function ak(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),i.push.apply(i,r)}return i}function uc(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?ak(Object(i),!0).forEach(function(r){b(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):ak(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}var hB=class ey{constructor(t){b(this,"store",void 0),b(this,"onStatsException",void 0),b(this,"onUploadPublishDuration",void 0),b(this,"onStatsChanged",void 0),b(this,"localStats",new Map),b(this,"remoteStats",new Map),b(this,"updateStatsInterval",void 0),b(this,"trafficStats",void 0),b(this,"trafficStatsPeerList",[]),b(this,"uplinkStats",void 0),b(this,"exceptionMonitor",void 0),b(this,"p2pChannel",void 0),b(this,"scalabilityMode",Mv.L1T1),b(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=t,this.exceptionMonitor=new OJ,this.exceptionMonitor.on("exception",(i,r,a)=>{this.onStatsException&&this.onStatsException(i,r,a)})}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(Q.LocalAudioTrack)||uc({},Fv)}getLocalVideoTrackStats(){return this.localStats.get(Q.LocalVideoTrack)||uc({},Gv)}getRemoteAudioTrackStats(t){let i=(s,c)=>{if(!this.trafficStats)return c;let l=this.trafficStats.peer_delay.find(u=>u.peer_uid===s);return l&&(c.publishDuration=l.B_ppad+(Date.now()-this.trafficStats.timestamp)),c},r={};if(t){var a;let s=(a=this.remoteStats.get(t))===null||a===void 0?void 0:a.audioStats;s&&(r[t]=i(t,s))}else Array.from(this.remoteStats.entries()).forEach(s=>{let[c,{audioStats:l}]=s;l&&(r[c]=i(c,l))});return r}getRemoteNetworkQualityStats(t){let i={};if(t){var r;let a=(r=this.remoteStats.get(t))===null||r===void 0?void 0:r.networkStats;a&&(i[t]=a)}else Array.from(this.remoteStats.entries()).forEach(a=>{let[s,{networkStats:c}]=a;c&&(i[s]=c)});return i}getRemoteVideoTrackStats(t){let i=(s,c)=>{if(!this.trafficStats)return c;let l=this.trafficStats.peer_delay.find(u=>u.peer_uid===s);return l&&(c.publishDuration=l.B_ppvd+(Date.now()-this.trafficStats.timestamp)),c},r={};if(t){var a;let s=(a=this.remoteStats.get(t))===null||a===void 0?void 0:a.videoStats;s&&(r[t]=i(t,s))}else Array.from(this.remoteStats.entries()).forEach(s=>{let[c,{videoStats:l}]=s;l&&(r[c]=i(c,l))});return r}getRTCStats(){let t=0,i=0,r=0,a=0,s=this.localStats.get(Q.LocalAudioTrack);s&&(t+=s.sendBytes,i+=s.sendBitrate);let c=this.localStats.get(Q.LocalVideoTrack);c&&(t+=c.sendBytes,i+=c.sendBitrate);let l=this.localStats.get(Q.LocalVideoLowTrack);l&&(t+=l.sendBytes,i+=l.sendBitrate),this.remoteStats.forEach(h=>{let{audioStats:p,videoStats:_}=h;p&&(r+=p.receiveBytes,a+=p.receiveBitrate),_&&(r+=_.receiveBytes,a+=_.receiveBitrate)});let u=1;return this.trafficStats&&(u+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:u,SendBitrate:i,SendBytes:t,RecvBytes:r,RecvBitrate:a,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(t){this.localStats.set(t,void 0)}removeLocalStats(t){t?this.localStats.delete(t):this.localStats.clear()}addRemoteStats(t){this.remoteStats.set(t,{})}removeRemoteStats(t){t?this.remoteStats.delete(t):this.remoteStats.clear()}addP2PChannel(t){this.p2pChannel=t}updateTrafficStats(t){t.peer_delay=t.peer_delay.filter(i=>i.B_ppad!==void 0||i.B_ppvd!==void 0),t.peer_delay.filter(i=>this.trafficStatsPeerList.indexOf(i.peer_uid)===-1).forEach(i=>{var r;let a=(r=this.p2pChannel)===null||r===void 0?void 0:r.getRemoteMedia(i.peer_uid),s=a!=null&&a.videoSSRC?ji.measureFromSubscribeStart(this.store.clientId,a.videoSSRC):0,c=a!=null&&a.audioSSRC?ji.measureFromSubscribeStart(this.store.clientId,a.audioSSRC):0;i.B_ppad!==void 0&&i.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(i.peer_uid,i.B_ppad,i.B_ppvd,s>c?s:c),this.trafficStatsPeerList.push(i.peer_uid))}),this.trafficStats=t}updateUplinkStats(t){this.uplinkStats&&this.uplinkStats.B_fir!==t.B_fir&&R.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(t.B_fir)),this.uplinkStats=t}static isRemoteVideoFreeze(t,i,r){if(!t)return!1;let a=!!r&&i.framesDecodeFreezeTime>r.framesDecodeFreezeTime,s=!r||i.framesDecodeCount>r.framesDecodeCount;return a||!s}static isRemoteAudioFreeze(t){return!!t&&t._isFreeze()}isLocalVideoFreeze(t){return!(!t.inputFrame||!t.sentFrame)&&t.inputFrame.frameRate>5&&t.sentFrame.frameRate<3}updateLocalStats(t){Array.from(this.localStats.entries()).forEach(i=>{let[r,a]=i;switch(r){case Q.LocalVideoTrack:case Q.LocalVideoLowTrack:{let c=a,l=uc({},Gv),u=t.getStats(),h=t.getLocalMedia(r);if(u){let p=u.videoSend.find(_=>_.ssrc===(h==null?void 0:h.ssrcs[0].ssrcId));if(p){let _=t.getLocalVideoSize(),m=t.getEncoderConfig(Q.LocalVideoTrack);p.codec!=="H264"&&p.codec!=="H265"&&p.codec!=="VP8"&&p.codec!=="VP9"&&p.codec!=="AV1X"&&p.codec!=="AV1"||(l.codecType=p.codec),l.sendBytes=p.bytes,l.sendBitrate=c?8*Math.max(0,l.sendBytes-c.sendBytes):0,p.inputFrame?(l.captureFrameRate=p.inputFrame.frameRate,l.captureResolutionHeight=p.inputFrame.height,l.captureResolutionWidth=p.inputFrame.width):_&&(l.captureResolutionWidth=_.width,l.captureResolutionHeight=_.height),p.sentFrame?(l.sendFrameRate=p.sentFrame.frameRate,l.sendResolutionHeight=p.sentFrame.height,l.sendResolutionWidth=p.sentFrame.width):_&&(l.sendResolutionWidth=_.width,l.sendResolutionHeight=_.height),p.avgEncodeMs&&(l.encodeDelay=p.avgEncodeMs),m&&m.bitrateMax&&(l.targetSendBitrate=1e3*m.bitrateMax),l.sendPackets=p.packets,l.sendPacketsLost=p.packetsLost,l.sendJitterMs=p.jitterMs,l.sendRttMs=p.rttMs,l.totalDuration=c?c.totalDuration+1:1,l.totalFreezeTime=c?c.totalFreezeTime:0,this.isLocalVideoFreeze(p)&&(l.totalFreezeTime+=1),p.scalabilityMode&&this.scalabilityMode!==p.scalabilityMode&&(R.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(p.scalabilityMode)),this.scalabilityMode=p.scalabilityMode)}this.trafficStats&&(l.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var s;this.localStats.set(r,l),((c==null?void 0:c.sendResolutionWidth)!==l.sendResolutionWidth||(c==null?void 0:c.sendResolutionHeight)!==l.sendResolutionHeight)&&((s=this.onStatsChanged)===null||s===void 0||s.call(this,"resolution",{width:l.sendResolutionWidth,height:l.sendResolutionHeight})),l&&h&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,h.track,l);break}case Q.LocalAudioTrack:{let c=a,l=uc({},Fv),u=t.getStats(),h=t.getLocalMedia(r);if(u){let p=u.audioSend.find(_=>_.ssrc===(h==null?void 0:h.ssrcs[0].ssrcId));if(p){if(p.codec!=="opus"&&p.codec!=="aac"&&p.codec!=="PCMU"&&p.codec!=="PCMA"&&p.codec!=="G722"||(l.codecType=p.codec),p.inputLevel)l.sendVolumeLevel=Math.round(32767*p.inputLevel);else{let _=t.getLocalAudioVolume();_&&(l.sendVolumeLevel=Math.round(32767*_))}l.sendBytes=p.bytes,l.sendPackets=p.packets,l.sendPacketsLost=p.packetsLost,l.sendJitterMs=p.jitterMs,l.sendRttMs=p.rttMs,l.sendBitrate=c?8*Math.max(0,l.sendBytes-c.sendBytes):0}}this.trafficStats&&(l.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(Q.LocalAudioTrack,l),l&&h&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,h.track,l);break}}})}updateRemoteStats(t){Array.from(this.remoteStats.entries()).forEach(i=>{var r,a;let[s,{videoStats:c,audioStats:l,videoPcStats:u}]=i,h=l,p=c,_=u,m=uc({},RV),S=uc({},vV),C=uc({},nJ),{audioTrack:v,videoTrack:y,audioSSRC:I,videoSSRC:O}=t.getRemoteMedia(s),P;P=t instanceof Mr?t.getStats(!0):t.getStats();let U=(r=P)===null||r===void 0?void 0:r.audioRecv.find(Z=>Z.ssrc===I),x=(a=P)===null||a===void 0?void 0:a.videoRecv.find(Z=>Z.ssrc===O),G=this.trafficStats&&this.trafficStats.peer_delay.find(Z=>Z.peer_uid===s);if(U&&(U.codec!=="opus"&&U.codec!=="aac"&&U.codec!=="PCMU"&&U.codec!=="PCMA"&&U.codec!=="G722"||(m.codecType=U.codec),U.outputLevel?m.receiveLevel=Math.round(32767*U.outputLevel):v&&(m.receiveLevel=Math.round(32767*v.getVolumeLevel())),m.receiveBytes=U.bytes,m.receivePackets=U.packets,m.receivePacketsLost=U.packetsLost,m.receivePacketsDiscarded=U.packetsDiscarded,m.packetLossRate=m.receivePacketsLost/(m.receivePackets+m.receivePacketsLost),m.receiveBitrate=h?8*Math.max(0,m.receiveBytes-h.receiveBytes):0,m.totalDuration=h?h.totalDuration+1:1,m.totalFreezeTime=h?h.totalFreezeTime:0,m.freezeRate=m.totalFreezeTime/m.totalDuration,m.receiveDelay=U.jitterBufferMs,m.totalDuration>10&&ey.isRemoteAudioFreeze(v)&&(m.totalFreezeTime+=1)),x){x.codec!=="H264"&&x.codec!=="H265"&&x.codec!=="VP8"&&x.codec!=="VP9"&&x.codec!=="AV1X"&&x.codec!=="AV1"||(S.codecType=x.codec),S.receiveBytes=x.bytes,S.receiveBitrate=p?8*Math.max(0,S.receiveBytes-p.receiveBytes):0,S.decodeFrameRate=x.decodeFrameRate<0?0:x.decodeFrameRate,S.renderFrameRate=x.decodeFrameRate<0?0:x.decodeFrameRate,x.outputFrame&&(S.renderFrameRate=x.outputFrame.frameRate),x.receivedFrame?(S.receiveFrameRate=x.receivedFrame.frameRate,S.receiveResolutionHeight=x.receivedFrame.height,S.receiveResolutionWidth=x.receivedFrame.width):y&&(S.receiveResolutionHeight=y._videoHeight||0,S.receiveResolutionWidth=y._videoWidth||0),x.framesRateFirefox!==void 0&&(S.receiveFrameRate=Math.round(x.framesRateFirefox)),S.receivePackets=x.packets,S.receivePacketsLost=x.packetsLost,S.packetLossRate=S.receivePacketsLost/(S.receivePackets+S.receivePacketsLost),S.totalDuration=p?p.totalDuration+1:1,S.totalFreezeTime=p?p.totalFreezeTime:0,S.receiveDelay=x.jitterBufferMs||0;let Z=!!O&&t.getRemoteVideoIsReady(O);y&&Z&&ey.isRemoteVideoFreeze(y,x,_)&&(S.totalFreezeTime+=1),S.freezeRate=S.totalFreezeTime/S.totalDuration}G&&(m.end2EndDelay=G.B_ad,S.end2EndDelay=G.B_vd,m.transportDelay=G.B_ed,S.transportDelay=G.B_ed,m.currentPacketLossRate=G.B_ealr4/100,S.currentPacketLossRate=G.B_evlr4/100,C.uplinkNetworkQuality=G.B_punq?G.B_punq:0,C.downlinkNetworkQuality=G.B_pdnq?G.B_pdnq:0),this.remoteStats.set(s,{audioStats:m,videoStats:S,videoPcStats:x,networkStats:C}),v&&this.exceptionMonitor.setRemoteAudioStats(v,m),y&&this.exceptionMonitor.setRemoteVideoStats(y,S)})}},pB=class{constructor(){b(this,"destChannelMediaInfos",new Map),b(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(e){sD(e),this.srcChannelMediaInfo=e}addDestChannelInfo(e){sD(e),this.destChannelMediaInfos.set(e.channelName,e)}removeDestChannelInfo(e){$E(e),this.destChannelMediaInfos.delete(e)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}};function nk(e){if(!(e instanceof pB))return new B(A.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();let t=e.getSrcChannelMediaInfo(),i=e.getDestChannelMediaInfo();if(!t)return new B(A.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(i.size===0)return new B(A.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}function sk(e){var t={},i=!1;function r(a,s){return i=!0,{done:!1,value:new _C(s=new Jv(function(c){c(e[a](s))}),1)}}return t[Xl!==void 0&&Tx||"@@iterator"]=function(){return this},t.next=function(a){return i?(i=!1,a):r("next",a)},typeof e.throw=="function"&&(t.throw=function(a){if(i)throw i=!1,a;return r("throw",a)}),typeof e.return=="function"&&(t.return=function(a){return i?(i=!1,a):r("return",a)}),t}var YJ=zt(aB);function ok(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),i.push.apply(i,r)}return i}function ck(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?ok(Object(i),!0).forEach(function(r){b(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):ok(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}var ct;function lk(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),i.push.apply(i,r)}return i}function p_(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?lk(Object(i),!0).forEach(function(r){b(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):lk(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}var Qu=(ct=class lh extends lV{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map(t=>t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"").filter(t=>{var i;return oe(i=Object.keys(ZE)).call(i,t)}))]}constructor(t,i){super(t,i),b(this,"store",void 0),b(this,"peerConnection",void 0),b(this,"remoteSDP",void 0),b(this,"initialOffer",void 0),b(this,"statsFilter",void 0),b(this,"useRTX",!1),b(this,"localCapabilities",void 0),b(this,"localCandidateCount",0),b(this,"allCandidatesReceived",!1),b(this,"establishPromise",void 0),b(this,"mutex",new Fi("P2PConnection-mutex")),this.store=i,this.peerConnection=new RTCPeerConnection(lh.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.statsFilter=mC(this.peerConnection,k("STATS_UPDATE_INTERVAL"),void 0,Bt()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{let t=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!t.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");let i=vo(t.sdp),r=Fh(t.sdp,{filterRTX:!this.useRTX,filterVideoFec:k("FILTER_VIDEO_FEC"),filterAudioFec:k("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=r,this.initialOffer=t,p_(p_({},i),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:r},offerSDP:t.sdp})}catch(t){throw new H(A.GET_LOCAL_CONNECTION_PARAMS_FAILED,t.toString())}}async updateRemoteConnect(){}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new class{constructor(r){b(this,"sessionDesc",void 0),b(this,"localCapabilities",void 0),b(this,"rtpCapabilities",void 0),b(this,"candidates",void 0),b(this,"iceParameters",void 0),b(this,"dtlsParameters",void 0),b(this,"setup",void 0),b(this,"currentMidIndex",void 0),b(this,"cname",void 0),r=Xt(r);let{iceParameters:a,dtlsParameters:s,candidates:c,rtpCapabilities:l,setup:u,localCapabilities:h,sdkCodec:p,cname:_}=r,m=vi.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=l,this.candidates=c,this.iceParameters=a,this.dtlsParameters=s,this.setup=u,this.localCapabilities=h,this.cname=_;for(let S=0;S<m.mediaDescriptions.length;S++){let C=m.mediaDescriptions[S];if(C.attributes.iceUfrag=a.iceUfrag,C.attributes.icePwd=a.icePwd,C.attributes.fingerprints=s.fingerprints,C.attributes.candidates=c,C.attributes.setup=u,C.media.mediaType==="video"){C.media.fmts=l.videoCodecs.map(y=>y.payloadType.toString(10));let v=l.videoCodecs.filter(y=>{var I,O;return(I=y.rtpMap)===null||I===void 0?void 0:oe(O=I.encodingName.toLowerCase()).call(O,p)});v.length===0&&(v=l.videoCodecs),C.attributes.payloads=v,C.attributes.extmaps=l.videoExtensions}C.media.mediaType==="audio"&&(C.media.fmts=l.audioCodecs.map(v=>v.payloadType.toString(10)),C.attributes.payloads=l.audioCodecs,C.attributes.extmaps=l.audioExtensions),m.mediaDescriptions[S]=this.mungMediaDesc(C)}this.sessionDesc=m,this.currentMidIndex=m.mediaDescriptions.length-1}toString(){return vi.print(this.sessionDesc)}send(r,a,s){let{ssrcs:c,ssrcGroups:l}=mc(a,this.cname),u=this.sessionDesc.mediaDescriptions.find(_=>r===_e.VIDEO?_.media.mediaType==="video":_.media.mediaType==="audio"),h=c[0].attributes.label,p=c[0].attributes.mslabel;return u.attributes.ssrcs=u.attributes.ssrcs.concat(c),u.attributes.ssrcGroups=u.attributes.ssrcGroups.concat(l),{id:h,mslabel:p}}batchSend(r){return r.map(a=>{let{kind:s,ssrcMsg:c}=a;return this.send(s,c,void 0)})}stopSending(r){this.sessionDesc.mediaDescriptions.forEach(a=>{let s=[],c=[],l=[];a.attributes.ssrcs.forEach(u=>{oe(r).call(r,u.attributes.label||"")?l.push(u):s.push(u)}),a.attributes.ssrcGroups.forEach(u=>{var h;oe(h=l.map(p=>p.ssrcId)).call(h,u.ssrcIds[0])||c.push(u)}),a.attributes.ssrcs=s,a.attributes.ssrcGroups=c})}mute(r){let a=this.sessionDesc.mediaDescriptions.find(s=>s.attributes.mid===r);if(!a)throw new Error("mediaDescription not found with ".concat(r," in remote SDP when calling RemoteSDP.mute."));a.attributes.direction="inactive"}unmute(r){let a=this.sessionDesc.mediaDescriptions.find(s=>s.attributes.mid===r);if(!a)throw new Error("mediaDescription not found with ".concat(r," in remote SDP when calling RemoteSDP.unmute."));a.attributes.direction="sendonly"}receive(r,a,s){r.forEach((c,l)=>{let u=c._mediaStreamTrack,h=this.sessionDesc.mediaDescriptions.findIndex(_=>_.attributes.mid===u.kind),p=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[h],c);this.sessionDesc.mediaDescriptions[h]=p})}stopReceiving(r){}updateCandidates(r){r===Vr.TCP?this.candidates.forEach(a=>{this.candidates.findIndex(s=>s.transport==="tcp"&&s.connectionAddress===a.connectionAddress&&s.port===a.port)===-1&&this.candidates.push(ck(ck({},a),{},{foundation:"tcpcandidate",priority:Number(a.priority)-1+"",transport:"tcp",port:Number(a.port)+90+""}))}):this.candidates=this.candidates.filter(a=>a.transport!=="tcp");for(let a of this.sessionDesc.mediaDescriptions)a.attributes.candidates=this.candidates}restartICE(r){r=Xt(r),this.iceParameters=r,this.sessionDesc.mediaDescriptions.forEach(a=>{a.attributes.iceUfrag=r.iceUfrag,a.attributes.icePwd=r.icePwd})}predictReceivingMids(r){let a=[];for(let s=0;s<r;s++)a.push((this.currentMidIndex+s+1).toString(10));return a}mungRecvMediaDsec(r,a){let s=Xt(r);return Rd(s,a),dC(s,a),s}updateRecvMedia(r,a){let s=this.sessionDesc.mediaDescriptions.findIndex(c=>c.attributes.mid===r);if(s!==-1){let c=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[s],a);this.sessionDesc.mediaDescriptions[s]=c}}bumpMid(r){this.currentMidIndex+=r}updateTrackLabel(r,a,s){let c=this.sessionDesc.mediaDescriptions.find(u=>r===_e.VIDEO?u.attributes.mid==="video":u.attributes.mid==="audio");if(c){let u=c.attributes.ssrcs.find(h=>h.attributes.label===a);var l;u&&(u.attributes.label=s,(l=u.attributes.msid)===null||l===void 0||l.replace(a,s))}}mungMediaDesc(r){let a=Xt(r);return lC(a),function(s){let c=s.attributes.extmaps.find(l=>l.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01");c&&s.attributes.extmaps.splice(s.attributes.extmaps.indexOf(c),1),s.attributes.payloads.forEach(l=>{let u=l.rtcpFeedbacks.findIndex(h=>h.type==="transport-cc");u!==-1&&l.rtcpFeedbacks.splice(u,1)})}(a),a}getSSRC(r){for(let a of this.sessionDesc.mediaDescriptions)for(let s of a.attributes.ssrcs)if(s.attributes.label===r)return[s]}}(p_(p_({},t),{},{rtpCapabilities:t.rtpCapabilities.send,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec}));let i=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(i){throw new H(A.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(i.toString()))}}async updateRemoteRTPCapabilities(t,i){throw new H(A.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}getPreMedia(t){}send(t,i){var r=this;return gn(function*(){let a=yield Ye(r.mutex.lock());try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");let s=t.map(m=>r.peerConnection.addTrack(m._mediaStreamTrack)),c=yield Ye(r.peerConnection.createOffer()),l=vi.parse(c.sdp),u=t.map(m=>{let S=m._mediaStreamTrack,C=l.mediaDescriptions.find(v=>v.attributes.mid===S.kind);if(!C)throw new Error("Cannot extract ssrc from mediaDescription.");return function(v,y,I){let O=v.attributes.ssrcs.filter(U=>U.attributes.label===y),P=v.attributes.ssrcGroups;if(O.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(P&&O.length>1){let U=P.find(x=>x.ssrcIds.indexOf(O[0].ssrcId)!==-1);return U?[{ssrcId:U.ssrcIds[0],rtx:I?U.ssrcIds[1]:void 0}]:[{ssrcId:O[0].ssrcId}]}return[{ssrcId:O[0].ssrcId}]}(C,S.id,r.useRTX)}),h;try{h=yield u}catch(m){throw s.forEach(S=>{Li()&&S.replaceTrack(null),r.peerConnection.removeTrack(S)}),m}let p=r.mungSendOfferSDP(c.sdp,t);r.remoteSDP.receive(t,i,h);let _=r.remoteSDP.toString();return yield Ye(r.peerConnection.setLocalDescription({type:"offer",sdp:p})),yield Ye(r.applySendEncodings(s,t)),yield Ye(r.peerConnection.setRemoteDescription({type:"answer",sdp:_})),t.map((m,S)=>{let C=m._mediaStreamTrack.id;return{localSSRC:u[S],id:C}})}catch(s){throw new H(A.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(s.toString()))}finally{a()}})()}async stopSending(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");let i=this.peerConnection.getSenders().filter(s=>{var c;return t.indexOf(((c=s.track)===null||c===void 0?void 0:c.id)||"")!==-1});if(i.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");i.map(s=>{Li()&&s.replaceTrack(null),this.peerConnection.removeTrack(s)});let r=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(r),this.remoteSDP.stopReceiving(t);let a=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}catch(i){throw new H(A.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(i.toString()))}}async receive(t,i,r,a){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));let{id:s,mslabel:c}=this.remoteSDP.send(t,i,a),l=new ae((p,_)=>{let m=setTimeout(()=>{_(new Error("Cannot receive track, id: ".concat(s)))},1e4),S=C=>{let v=Ge();if((v.name==="Safari"&&Number(v.version)===11||pr())&&C.track.id!==s&&C.streams[0].id===c){var y;let I=C.streams[0].getTracks()[0];return(y=this.remoteSDP)===null||y===void 0||y.updateTrackLabel(t,s,C.track.id),this.peerConnection.removeEventListener("track",S),clearTimeout(m),void p(I)}if(C.track.id===s)return this.peerConnection.removeEventListener("track",S),clearTimeout(m),void p(C.track)};this.peerConnection.addEventListener("track",S)}),u=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:u});let h=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(h),{track:await l,id:s}}catch(s){throw new H(A.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);let i=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});let r=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(r)}catch(i){throw new H(A.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(i.toString()))}}async muteRemote(t){}async unmuteRemote(t){}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");let i=this.peerConnection.getSenders().filter(r=>{var a;return t.indexOf(((a=r.track)===null||a===void 0?void 0:a.id)||"")!==-1});if(i.length!==t.length)throw new Error("sender' length doesn't match mids' length.");i.map(r=>{if(Li()&&r.track)r.track.enabled=!1;else{let a=r.getParameters();a.encodings.forEach(s=>s.active=!1),r.setParameters(a)}})}catch(i){throw new H(A.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(i.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");let i=this.peerConnection.getSenders().filter(s=>{var c;return t.indexOf(((c=s.track)===null||c===void 0?void 0:c.id)||"")!==-1});if(i.length!==t.length)throw new Error("Senders' length doesn't match mids' length.");i.map(async s=>{if(Li()&&s.track)s.track.enabled=!0;else{let c=s.getParameters();c.encodings.forEach(l=>l.active=!0),await s.setParameters(c)}});let r=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(r);let a=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}catch(i){throw new H(A.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(i.toString()))}}restartICE(t){var i=this;return gn(function*(){let r=yield Ye(i.mutex.lock("From P2PConnection.restartICE"));try{if(!i.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(Ke().supportPCSetConfiguration){let u=i.peerConnection.getConfiguration(),h=t===Vr.RELAY?"relay":"all";u.iceTransportPolicy!==h&&(R.debug("[".concat(i.store.clientId,"] restartICE change iceTransportPolicy from [").concat(u.iceTransportPolicy,"] to [").concat(h,"]")),u.iceTransportPolicy=h,i.peerConnection.setConfiguration(u))}else if(t===Vr.RELAY)return;t!==Vr.RELAY&&i.remoteSDP.updateCandidates(t);let a=yield Ye(i.peerConnection.createOffer({iceRestart:!0}));if(!a.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");let s=vo(a.sdp),{remoteIceParameters:c}=yield s.iceParameters;i.remoteSDP.restartICE(c);let l=i.remoteSDP.toString();yield Ye(i.peerConnection.setLocalDescription(a)),yield Ye(i.peerConnection.setRemoteDescription({type:"answer",sdp:l}))}catch(a){R.warning("[".concat(i.store.clientId,"] restart ICE failed, abort operation"),a)}finally{r()}})()}close(){var t;this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");let r=await this.peerConnection.createOffer(),a=this.mungSendOfferSDP(r.sdp,[i]);this.remoteSDP.updateRecvMedia(i._mediaStreamTrack.kind,i);let s=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:a}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(r){throw new H(A.EXCHANGE_SDP_FAILED,r.toString())}}async updateSendParameters(t,i){let r=this.peerConnection.getSenders().filter(a=>{var s;return((s=a.track)===null||s===void 0?void 0:s.id)===t});r.length===1&&await this.applySendEncodings(r,[i])}setStatsRemoteVideoIsReady(t,i){this.statsFilter.setVideoIsReady2(t,i)}async replaceTrack(t,i){let r=this.peerConnection.getSenders().find(a=>{var s;return((s=a.track)===null||s===void 0?void 0:s.id)===i});r&&await r.replaceTrack(t._mediaStreamTrack)}createDataChannels(t,i){throw new H(A.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(t){throw new H(A.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,R.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,R.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},k("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){let i={iceServers:[],sdpSemantics:"plan-b"};return t.iceServers?i.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(XE(t.turnServer.servers)?i.iceServers=t.turnServer.servers:(i.iceServers&&i.iceServers.push(...lh.turnServerConfigToIceServers(t.turnServer.servers)),k("USE_TURN_SERVER_OF_GATEWAY")&&i.iceServers&&t.turnServer.serversFromGateway&&i.iceServers.push(...lh.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(r=>{r.forceturn&&(i.iceTransportPolicy="relay")}))),i}static turnServerConfigToIceServers(t){let i=[];return t.forEach(r=>{r.security?r.tcpport&&i.push({username:r.username,credential:r.password,credentialType:"password",urls:"turns:".concat(r.turnServerURL,":").concat(r.tcpport,"?transport=tcp")}):(r.udpport&&i.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.udpport,"?transport=udp")}),r.tcpport&&i.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.tcpport,"?transport=tcp")}))}),i}async updateRtpSenderEncodings(t,i){var r;if(i||(i=this.peerConnection.getSenders().find(h=>{var p;return((p=h.track)===null||p===void 0?void 0:p.id)===t._mediaStreamTrack.id})),!i)return R.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(!Ke().supportSetRtpSenderParameters)return R.warn("Browser not support set rtp-sender parameters");let a={},s={};if(t instanceof St)switch(t._optimizationMode){case"motion":a.degradationPreference="maintain-framerate";break;case"detail":a.degradationPreference="maintain-resolution";break;default:a.degradationPreference="balanced"}if(k("DSCP_TYPE")&&No()){var c;let h=k("DSCP_TYPE");oe(c=["very-low","low","medium","high"]).call(c,h)&&(s.networkPriority=h)}let l=i.getParameters(),u=(r=l.encodings)===null||r===void 0?void 0:r[0];u&&Object.assign(u,s),Object.assign(l,a),R.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(l.encodings))),await i.setParameters(l)}async applySendEncodings(t,i){try{if(!Ke().supportSetRtpSenderParameters||t.length!==i.length)return;for(let r=0;r<t.length;r++){let a=t[r],s=i[r];a&&s&&await this.updateRtpSenderEncodings(s,a)}}catch{R.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,i){let r=vi.parse(t);return i.forEach((a,s)=>{let c=a._mediaStreamTrack,l=r.mediaDescriptions.find(u=>u.attributes.mid===c.kind);l&&Rd(l,a)}),vi.print(r)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var i;(i=this.onFirstAudioReceived)===null||i===void 0||i.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var i;(i=this.onFirstVideoReceived)===null||i===void 0||i.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var i;(i=this.onFirstAudioDecoded)===null||i===void 0||i.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,i,r)=>{var a;(a=this.onFirstVideoDecoded)===null||a===void 0||a.call(this,t,i,r)},this.statsFilter.onSelectedLocalCandidateChanged=(t,i)=>{var r;(r=this.onSelectedLocalCandidateChanged)===null||r===void 0||r.call(this,t,i)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,i)=>{var r;(r=this.onSelectedRemoteCandidateChanged)===null||r===void 0||r.call(this,t,i)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");let i=this.remoteSDP.batchSend(t).map((s,c)=>{let{id:l,mslabel:u}=s,{kind:h}=t[c];return new ae((p,_)=>{let m=setTimeout(()=>{_(new Error("Cannot receive track, id: ".concat(l)))},1e4),S=C=>{let v=Ge();if(v.name==="Safari"&&Number(v.version)===11&&C.track.id!==l&&C.streams[0].id===u){var y;let I=C.streams[0].getTracks()[0];return(y=this.remoteSDP)===null||y===void 0||y.updateTrackLabel(h,l,C.track.id),this.peerConnection.removeEventListener("track",S),clearTimeout(m),void p({track:I,id:l})}if(C.track.id===l)return this.peerConnection.removeEventListener("track",S),clearTimeout(m),void p({track:C.track,id:l})};this.peerConnection.addEventListener("track",S)})}),r=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:r});let a=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(a),await ae.all(i)}catch(i){throw new H(A.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(i.toString()))}}async getRemoteSSRC(t){if(!this.remoteSDP)return;let i=this.remoteSDP.getSSRC(t);return i==null?void 0:i[0].ssrcId}setConfiguration(t){if(Ke().supportPCSetConfiguration){let i=lh.resolvePCConfiguration(t);this.peerConnection.setConfiguration(i)}}},de(ct.prototype,"connect",[ua],Object.getOwnPropertyDescriptor(ct.prototype,"connect"),ct.prototype),de(ct.prototype,"stopSending",[ua],Object.getOwnPropertyDescriptor(ct.prototype,"stopSending"),ct.prototype),de(ct.prototype,"receive",[ua],Object.getOwnPropertyDescriptor(ct.prototype,"receive"),ct.prototype),de(ct.prototype,"stopReceiving",[ua],Object.getOwnPropertyDescriptor(ct.prototype,"stopReceiving"),ct.prototype),de(ct.prototype,"muteRemote",[ua],Object.getOwnPropertyDescriptor(ct.prototype,"muteRemote"),ct.prototype),de(ct.prototype,"unmuteRemote",[ua],Object.getOwnPropertyDescriptor(ct.prototype,"unmuteRemote"),ct.prototype),de(ct.prototype,"muteLocal",[ua],Object.getOwnPropertyDescriptor(ct.prototype,"muteLocal"),ct.prototype),de(ct.prototype,"unmuteLocal",[ua],Object.getOwnPropertyDescriptor(ct.prototype,"unmuteLocal"),ct.prototype),de(ct.prototype,"close",[ua],Object.getOwnPropertyDescriptor(ct.prototype,"close"),ct.prototype),de(ct.prototype,"updateEncoderConfig",[ua],Object.getOwnPropertyDescriptor(ct.prototype,"updateEncoderConfig"),ct.prototype),de(ct.prototype,"updateSendParameters",[ua],Object.getOwnPropertyDescriptor(ct.prototype,"updateSendParameters"),ct.prototype),de(ct.prototype,"replaceTrack",[ua],Object.getOwnPropertyDescriptor(ct.prototype,"replaceTrack"),ct.prototype),de(ct.prototype,"getRemoteSSRC",[ua],Object.getOwnPropertyDescriptor(ct.prototype,"getRemoteSSRC"),ct.prototype),ct);function ua(e,t,i){let r=e[t];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){let a=this.mutex,s=await a.lock("Locking from P2PConnection.".concat(t));try{for(var c=arguments.length,l=new Array(c),u=0;u<c;u++)l[u]=arguments[u];return await r.apply(this,l)}finally{s()}},i}function dk(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),i.push.apply(i,r)}return i}function oo(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?dk(Object(i),!0).forEach(function(r){b(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):dk(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}var Zu="9",uk=4e4,qJ=class{get localCapabilities(){return Xt(this._localCapabilities)}get rtpCapabilities(){return Xt(this._rtpCapabilities)}get candidates(){return Xt(this._candidates)}get iceParameters(){return Xt(this._iceParameters)}get dtlsParameters(){return Xt(this._dtlsParameters)}constructor(e){b(this,"sessionDesc",void 0),b(this,"_localCapabilities",void 0),b(this,"_rtpCapabilities",void 0),b(this,"_candidates",void 0),b(this,"_iceParameters",void 0),b(this,"_dtlsParameters",void 0),b(this,"setup",void 0),b(this,"currentMidIndex",void 0),b(this,"cname",void 0),b(this,"firefoxSsrcMidMap",new Map),e=Xt(e);let{iceParameters:t,dtlsParameters:i,candidates:r,rtpCapabilities:a,setup:s,localCapabilities:c,cname:l}=e;this._rtpCapabilities=a,this._candidates=r,this._iceParameters=t,this._dtlsParameters=i,this._localCapabilities=c,this.setup=s,this.cname=l,this.sessionDesc=this.updateRemoteRTPCapabilities(a),this.currentMidIndex=this.sessionDesc.mediaDescriptions.length-1}preloadRemoteMedia(e){let t=this.candidates,i=this.dtlsParameters,r=this.iceParameters,a=this.rtpCapabilities.send,s=this.sessionDesc.mediaDescriptions.length-1;for(let c=1;c<e;c++){let l=2*c+2e4,u=2*c+uk,{ssrcs:h,ssrcGroups:p}=mc([{ssrcId:l}],this.cname),{ssrcs:_,ssrcGroups:m}=mc([{ssrcId:u,rtx:k("USE_SUB_RTX")?u+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:Zu,protos:["UDP","TLS","RTP","SAVPF"],fmts:a.videoCodecs.map(S=>S.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:r.iceUfrag,icePwd:r.icePwd,unrecognized:[],candidates:t,extmaps:a.videoExtensions,fingerprints:i.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:_,ssrcGroups:m,rtcpFeedbackWildcards:[],payloads:a.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++s)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:Zu,protos:["UDP","TLS","RTP","SAVPF"],fmts:a.audioCodecs.map(S=>S.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:r.iceUfrag,icePwd:r.icePwd,unrecognized:[],candidates:t,extmaps:a.audioExtensions,fingerprints:i.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:h,ssrcGroups:p,rtcpFeedbackWildcards:[],payloads:a.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++s)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return vi.print(this.sessionDesc)}send(e,t,i,r){let{ssrcs:a,ssrcGroups:s}=mc(t,this.cname,k("SYNC_GROUP")?i:void 0),c=this.findPreloadMediaDesc(a);if(c){if(Bt()&&this.firefoxSsrcMidMap.set(a[0].ssrcId,c.attributes.mid),r&&(r.twcc||r.remb)){let l=this.sessionDesc.mediaDescriptions.indexOf(c);return this.sessionDesc.mediaDescriptions[l]=this.mungSendMediaDesc(c,r),{mid:c.attributes.mid,needExchangeSDP:!0}}return{mid:c.attributes.mid,needExchangeSDP:!1}}{let l=this.findAvailableMediaIndex(e,a),u;return l===-1||l===1&&(Li()||function(){let h=Ge();return!(h.name!==Ze.CHROME||!h.osVersion)&&Number(h.version)<=90}())||l===0&&k("USE_SUB_RTX")||xN()?(u=this.createOrRecycleSendMedia(e,a,s,"sendonly",r),this.updateBundleMids()):(u=Xt(this.sessionDesc.mediaDescriptions[l]),u.attributes.direction="sendonly",u.attributes.ssrcs=a,u.attributes.ssrcGroups=s,this.sessionDesc.mediaDescriptions[l]=this.mungSendMediaDesc(u,r)),Bt()&&this.firefoxSsrcMidMap.set(a[0].ssrcId,u.attributes.mid),{mid:u.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){let{mediaDesc:e,needExchangeSDP:t}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:e.attributes.mid,needExchangeSDP:t}}batchSend(e){let t=e.map(a=>{let{kind:s,ssrcMsg:c,mslabel:l}=a;return this.send(s,c,l)}),i=[],r=!1;return t.forEach(a=>{let{mid:s,needExchangeSDP:c}=a;c&&(r=!0),i.push(s)}),{mids:i,needExchangeSDP:r}}stopSending(e){let t=this.sessionDesc.mediaDescriptions.filter(i=>i.attributes.mid&&e.indexOf(i.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");t.forEach(i=>{i.attributes.mid==="0"||Bt()||xN()?i.attributes.ssrcs=[]:(i.attributes.ssrcs=[],i.attributes.direction="inactive",i.media.port="0")}),this.updateBundleMids()}mute(e){let t=this.sessionDesc.mediaDescriptions.find(i=>i.attributes.mid===e);if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.mute."));t.attributes.direction="inactive"}unmute(e){let t=this.sessionDesc.mediaDescriptions.find(i=>i.attributes.mid===e);if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.unmute."));t.attributes.direction="sendonly"}muteRemote(e){let t=this.sessionDesc.mediaDescriptions.filter(i=>oe(e).call(e,i.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(i=>{i.attributes.direction="inactive"})}unmuteRemote(e){let t=this.sessionDesc.mediaDescriptions.filter(i=>oe(e).call(e,i.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(i=>{i.attributes.direction="recvonly"})}receive(e,t,i,r){e.forEach((a,s)=>{this.createOrRecycleRecvMedia(a,[],"recvonly",t,i,r[s])}),this.updateBundleMids()}stopReceiving(e){let t=this.sessionDesc.mediaDescriptions.filter(i=>e.indexOf(i.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");t.forEach(i=>{i.media.port="0",i.attributes.direction="inactive"}),this.updateBundleMids()}updateRemoteRTPCapabilities(e){let t=this.sessionDesc||vi.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`);this._rtpCapabilities=e;let i=this.rtpCapabilities.send,r=this.localCapabilities.send;for(let a of t.mediaDescriptions){if(a.attributes.iceUfrag=this._iceParameters.iceUfrag,a.attributes.icePwd=this._iceParameters.icePwd,a.attributes.fingerprints=this._dtlsParameters.fingerprints,a.attributes.candidates=this._candidates,a.attributes.setup=this.setup,a.media.mediaType==="application"&&(a.attributes.sctpPort="5000"),a.media.mediaType==="video"){if(i.videoCodecs.length===0){let s=r.videoCodecs.filter(c=>{var l,u;return(l=c.rtpMap)===null||l===void 0?void 0:oe(u=l.encodingName.toLowerCase()).call(u,"vp8")})||[r.videoCodecs[0]];a.media.fmts=s.map(c=>c.payloadType.toString(10)),a.attributes.payloads=s,a.attributes.extmaps=[]}else if(a.media.fmts=i.videoCodecs.map(s=>s.payloadType.toString(10)),a.attributes.payloads=i.videoCodecs,a.attributes.extmaps=i.videoExtensions,k("PRELOAD_MEDIA_COUNT")>0){let{ssrcs:s,ssrcGroups:c}=mc([{ssrcId:uk,rtx:k("USE_SUB_RTX")?40001:void 0}],this.cname);a.attributes.ssrcs=s,a.attributes.ssrcGroups=c}}if(a.media.mediaType==="audio"){if(i.audioCodecs.length===0){let s=r.audioCodecs.filter(c=>{var l,u;return(l=c.rtpMap)===null||l===void 0?void 0:oe(u=l.encodingName.toLowerCase()).call(u,"opus")})||[r.audioCodecs[0]];a.media.fmts=s.map(c=>c.payloadType.toString(10)),a.attributes.payloads=s,a.attributes.extmaps=[]}else if(a.media.fmts=i.audioCodecs.map(s=>s.payloadType.toString(10)),a.attributes.payloads=i.audioCodecs,a.attributes.extmaps=i.audioExtensions,vd(a),k("PRELOAD_MEDIA_COUNT")>0){let{ssrcs:s,ssrcGroups:c}=mc([{ssrcId:2e4}],this.cname);a.attributes.ssrcs=s,a.attributes.ssrcGroups=c}}}return this.sessionDesc=t,this.currentMidIndex=t.mediaDescriptions.length-1,this.sessionDesc}updateCandidates(e){let t=this._candidates.filter(i=>i.transport==="udp");if(e===Vr.TCP){if(t.length===0)return;if(k("TCP_CANDIDATE_ONLY")){let i=this._candidates.filter(r=>r.transport==="tcp");t.forEach(r=>{i.findIndex(a=>a.connectionAddress===r.connectionAddress)===-1&&i.push(oo(oo({},r),{},{foundation:"tcpcandidate",priority:Number(r.priority)-1+"",transport:"tcp",port:Number(r.port)+90+""}))}),this._candidates=i}else{let i=[];t.forEach(r=>{i.push(oo(oo({},r),{},{foundation:"tcpcandidate",priority:Number(r.priority)-1+"",transport:"tcp",port:Number(r.port)+90+""}))}),this._candidates=[...t,...i]}}else if(e===Vr.RELAY){if(t.length!==0)return;{let i=this._candidates.filter(r=>r.transport==="tcp");i.forEach(r=>{t.push(oo(oo({},r),{},{foundation:"udpcandidate",priority:Number(r.priority)+1+"",transport:"udp",port:Number(r.port)-90+""}))}),this._candidates=[...t,...i]}}else t.length===0?(this._candidates.filter(i=>i.transport==="tcp").forEach(i=>{t.push(oo(oo({},i),{},{foundation:"udpcandidate",priority:Number(i.priority)+1+"",transport:"udp",port:Number(i.port)-90+""}))}),this._candidates=t):this._candidates=this._candidates.filter(i=>i.transport!=="tcp");for(let i of this.sessionDesc.mediaDescriptions)i.attributes.candidates=this.candidates}restartICE(e){e=Xt(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach(t=>{t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd})}predictReceivingMids(e){let t=[];for(let i=0;i<e;i++)t.push((this.currentMidIndex+i+1).toString(10));return t}findAvailableMediaIndex(e,t){return this.sessionDesc.mediaDescriptions.findIndex(i=>{let r=i.media.mediaType===e&&i.media.port!=="0"&&(i.attributes.direction==="sendonly"||i.attributes.direction==="sendrecv")&&i.attributes.ssrcs.length===0;if(Bt()){if(r){let a=this.firefoxSsrcMidMap.get(t[0].ssrcId);return!(a||i.attributes.mid!=="0"&&i.attributes.mid!=="1")||!(!a||a!==i.attributes.mid)}return!1}return r})}createOrRecycleDataChannel(){for(let i of this.sessionDesc.mediaDescriptions)if(i.media.mediaType==="application")return{mediaDesc:i,needExchangeSDP:!1};this.currentMidIndex+=1;let e="".concat(this.currentMidIndex),t={media:{mediaType:"application",port:Zu,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(e),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(t),{mediaDesc:t,needExchangeSDP:!0}}createOrRecycleRecvMedia(e,t,i,r,a,s){let c=e._mediaStreamTrack.kind,l=this.rtpCapabilities.recv,u=Th(c,l,this.localCapabilities.send,c===_e.VIDEO?r:a),h=c===_e.VIDEO?l.videoExtensions:l.audioExtensions;this.currentMidIndex+=1;let p="".concat(this.currentMidIndex),_={media:{mediaType:c,port:Zu,protos:["UDP","TLS","RTP","SAVPF"],fmts:u.map(S=>S.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:h,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:u,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:i,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(p)}};_=this.mungRecvMediaDsec(_,e,s);let m=this.findFirstClosedMedia(c);if(m){let S=this.sessionDesc.mediaDescriptions.indexOf(m);this.sessionDesc.mediaDescriptions[S]=_}else this.sessionDesc.mediaDescriptions.push(_);return _}updateRemoteCodec(e,t,i){let r=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(_=>_.rtpMap&&_.rtpMap.encodingName.toLowerCase()||"").filter(_=>{var m;return oe(m=Object.keys(ZE)).call(m,_)}))],a=new Set(t);if(r.every(_=>a.has(_)))return R.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(t)),!1;let s=this._rtpCapabilities.recv.videoCodecs.filter(_=>t.some(m=>{var S;return oe(S=_.rtpMap&&_.rtpMap.encodingName.toLowerCase()||"").call(S,m)}));if(s.length===0)return R.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(r," codecs: ").concat(t)),!1;let c=[...new Set(s.map(_=>_.rtpMap&&_.rtpMap.encodingName.toLowerCase()||""))],l;if(R.debug("updateRemoteCodec, from ".concat(r," to ").concat(c)),e.length===0)l=this.sessionDesc.mediaDescriptions.filter(_=>_.media.mediaType==="video"&&_.attributes.direction==="recvonly");else if(l=this.sessionDesc.mediaDescriptions.filter(_=>_.attributes.mid&&oe(e).call(e,_.attributes.mid)&&_.attributes.direction==="recvonly"),l.length!==e.length)return R.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(e,", codecs: ").concat(t)),!1;if(k("USE_PUB_RTX")||k("USE_SUB_RTX")){let _=uC(s,this.rtpCapabilities.recv.videoCodecs);s.push(..._)}this._rtpCapabilities.recv.videoCodecs=s;let u=this.localCapabilities.send,h=this.rtpCapabilities.recv,p=Th(_e.VIDEO,h,u,i);return l.forEach(_=>{let m=p.map(S=>S.payloadType.toString(10));R.debug("updateRemoteCodec mid: ".concat(_.attributes.mid,", from ").concat(_.attributes.payloads," to ").concat(p)),_.attributes.payloads=p,_.media.fmts=m}),!0}createOrRecycleSendMedia(e,t,i,r,a){let s=this.rtpCapabilities.send,c=e===_e.VIDEO?s.videoCodecs:s.audioCodecs,l=e===_e.VIDEO?s.videoExtensions:s.audioExtensions;this.currentMidIndex+=1;let u="".concat(this.currentMidIndex),h={media:{mediaType:e,port:Zu,protos:["UDP","TLS","RTP","SAVPF"],fmts:c.map(_=>_.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:l,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:i,rtcpFeedbackWildcards:[],payloads:c,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:r,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(u)}};h=this.mungSendMediaDesc(h,a);let p=this.findFirstClosedMedia(e);if(p){let _=this.sessionDesc.mediaDescriptions.indexOf(p);this.sessionDesc.mediaDescriptions[_]=h}else this.sessionDesc.mediaDescriptions.push(h);return h}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(e=>e.media.port!=="0").map(e=>e.attributes.mid)}mungRecvMediaDsec(e,t,i){let r=Xt(e);return lC(r),Rd(r,t),dC(r,t),XV(r),gE(r,i,this.localCapabilities.send),r}mungSendMediaDesc(e,t){let i=Xt(e);return gE(i,t,this.localCapabilities.recv),vd(i),i}updateRecvMedia(e,t){let i=this.sessionDesc.mediaDescriptions.findIndex(r=>r.attributes.mid===e);if(i!==-1){let r=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[i],t);this.sessionDesc.mediaDescriptions[i]=r}}bumpMid(e){this.currentMidIndex+=e}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find(t=>Bt()?t.media.port==="0"&&t.media.mediaType===e:t.media.port==="0")}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find(t=>{var i;return((i=t.attributes)===null||i===void 0||(i=i.ssrcs[0])===null||i===void 0?void 0:i.ssrcId)===e[0].ssrcId})}getSSRC(e){var t;return(t=this.sessionDesc.mediaDescriptions.find(i=>i.attributes.mid===e))===null||t===void 0?void 0:t.attributes.ssrcs}};function hk(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),i.push.apply(i,r)}return i}function ys(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?hk(Object(i),!0).forEach(function(r){b(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):hk(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}var Rh=function(e){return e.BANDWIDTH="bandwidth",e.CPU="cpu",e.NONE="none",e.OTHER="other",e}({}),ud=function(e){return e[e.DOWN=0]="DOWN",e[e.UP=1]="UP",e}(ud||{}),TE=new Map;function pk(e,t,i,r){let{scale:a}=e;if(a===0&&r===ud.UP||a>=t.length-1&&r===ud.DOWN)return e;let s=ys(ys({},e),{},{scale:r===ud.DOWN?++a:--a});switch(i){case"maintain-framerate":s=ys(ys({},s),t[a].motion);break;case"maintain-resolution":s=ys(ys({},s),t[a].detail);break;case"balanced":s=ys(ys({},s),t[a].balanced)}return s}function fB(e,t){if(t){let i={overUse:0,underUse:0,adaptationList:_B(t)};TE.set(e,i)}else TE.delete(e)}function _B(e){let t=ys({},e),{bitrateMax:i,frameRate:r,scaleResolutionDownBy:a,bitrateMin:s}=t,{MIN_FRAME_RATE:c,MAX_THRESHOLD_FRAMERATE:l,MAX_SCALE:u,BITRATE_MIN_THRESHOLD:h,BITRATE_MAX_THRESHOLD:p,BWE_SCALE_UP_THRESHOLD:_,BWE_SCALE_DOWN_THRESHOLD:m,PERF_SCALE_DOWN_THRESHOLD:S,PERF_SCALE_UP_THRESHOLD:C,BALANCE_BITRATE_FACTOR:v,BALANCE_FRAMERATE_FACTOR:y,BALANCE_RESOLUTION_FACTOR:I,MOTION_RESOLUTION_FACTOR:O,MOTION_BITRATE_FACTOR:P,DETAIL_FRAMERATE_FACTOR:U,DETAIL_BITRATE_FACTOR:x}=Qy,G=Math.min(t.frameRate,l),Z=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(m,1)*i),bwe_up:i,fps_down:Math.round(Math.pow(S,1)*G),fps_up:r},balanced:{scaleResolutionDownBy:1,frameRate:r,bitrateMax:i,bitrateMin:s},motion:{scaleResolutionDownBy:1,frameRate:r,bitrateMax:i,bitrateMin:s},detail:{scaleResolutionDownBy:1,frameRate:r,bitrateMax:i,bitrateMin:s}}];for(let J=1;J<=u;J++){let q={bwe_up:Math.round(Math.pow(_,J)*i),bwe_down:Math.round(Math.pow(m,J+1)*i),fps_up:Math.round(Math.pow(C,J)*G),fps_down:Math.round(Math.pow(S,J+1)*G)},ie={scaleResolutionDownBy:a/Math.pow(I,J),frameRate:Math.max(Math.round(Math.pow(y,J)*r),c),bitrateMax:Math.max(Math.round(Math.pow(v,J)*i),p),bitrateMin:Math.max(Math.round(Math.pow(v,J)*s),h)},Ie={scaleResolutionDownBy:a/Math.pow(O,J),frameRate:r,bitrateMax:Math.max(Math.round(Math.pow(P,J)*i),p),bitrateMin:Math.max(Math.round(Math.pow(P,J)*s),h)},Ve={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(U,J)*r),c),bitrateMax:Math.max(Math.round(Math.pow(x,J)*i),p),bitrateMin:Math.max(Math.round(Math.pow(x,J)*s),h)};Z.push({scale:J,threshold:q,balanced:ie,motion:Ie,detail:Ve})}return Z}function XJ(e,t,i,r,a,s){let c=TE.get(e)||{overUse:0,underUse:0,adaptationList:_B(a)},{adaptationList:l}=c;TE.set(e,c);let{OVERUSE_TIMES_THRESHOLD:u,UNDERUSE_TIMES_THRESHOLD:h}=Qy,{scale:p}=r,_,m;return typeof t=="number"&&t>0&&function(S,C,v,y){if(C>=v.length)return!1;let{threshold:{fps_down:I}}=v[C];return k("FORCE_AG_HIGH_FRAMERATE")&&y==="maintain-framerate"&&(I=v[0].threshold.fps_down),S<I}(t,p,l,s)&&(c.overUse++,m=Rh.CPU,c.overUse>u)||typeof i=="number"&&i>0&&function(S,C,v){if(C>=v.length)return!1;let{threshold:{bwe_down:y}}=v[C];return S<y}(i,p,l)&&(c.overUse++,m=Rh.BANDWIDTH,c.overUse>u)?(c.overUse=0,c.underUse=0,_=pk(r,l,s,ud.DOWN),[_,m]):(typeof t=="number"&&t>0&&typeof i=="number"&&i>0&&function(S,C,v,y){if(C===0)return;let{threshold:{fps_up:I}}=v[C];return k("FORCE_AG_HIGH_FRAMERATE")&&y==="maintain-framerate"&&(I=v[1].threshold.fps_up),S>I}(t,p,l,s)&&function(S,C,v){if(C===0)return;let{threshold:{bwe_up:y}}=v[C];return S>y}(i,p,l)&&(c.underUse++,c.underUse>h&&(c.overUse=0,c.underUse=0,_=pk(r,l,s,ud.UP),_.scale===0&&(m=Rh.NONE))),[_,m])}function fk(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),i.push.apply(i,r)}return i}function vR(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?fk(Object(i),!0).forEach(function(r){b(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):fk(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}function JJ(e){var t;return!!k("ENABLE_AG_ADAPTATION")&&!!(e instanceof Kv||oe(t=e._hints).call(t,Rt.CUSTOM_TRACK))&&(!!k("FORCE_SUPPORT_AG_ADAPTATION")||!!(function(i){let r=Ge();if(r.os!==pi.IOS||!r.osVersion)return!1;let a=r.osVersion.split(".");return Number(a[0])>=i}(14)&&Kx(17,4)||Wx(14)&&zx(17,4)))}var RE=new Map;function f_(e,t){let i=RE.get(e);if(i){let{timer:r}=i;window.clearTimeout(r),RE.delete(e)}t.qualityLimitationReason=Rh.NONE,fB(e)}var xe;function _k(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),i.push.apply(i,r)}return i}function kn(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?_k(Object(i),!0).forEach(function(r){b(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):_k(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}var un=(xe=class dh extends lV{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,i;return(t=(i=this.peerConnection.getReceivers()[0])===null||i===void 0||(i=i.transport)===null||i===void 0?void 0:i.state)!==null&&t!==void 0?t:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(t=>t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"").filter(t=>{var i;return oe(i=Object.keys(ZE)).call(i,t)}))]}constructor(t,i){super(t,i),b(this,"store",void 0),b(this,"peerConnection",void 0),b(this,"id",ft(5,"connection-")),b(this,"remoteSDP",void 0),b(this,"initialOffer",void 0),b(this,"transportEventReceiver",void 0),b(this,"statsFilter",void 0),b(this,"extension",{useXR:k("USE_XR")}),b(this,"localCapabilities",void 0),b(this,"remoteCodecs",void 0),b(this,"localCandidateCount",0),b(this,"allCandidatesReceived",!1),b(this,"isPreallocation",!1),b(this,"preSSRCMap",new Map),b(this,"dataStreamChannelMap",new Map),b(this,"establishPromise",void 0),b(this,"recoveredDataChannelIds",[]),b(this,"currentDataChannelId",1),b(this,"mutex",new Fi("P2PConnection-mutex")),b(this,"qualityLimitationReason",Rh.NONE),this.store=i,this.peerConnection=new RTCPeerConnection(dh.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.statsFilter=mC(this.peerConnection,k("STATS_UPDATE_INTERVAL"),void 0,Bt()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}getPreMedia(t){let i=this.preSSRCMap.get(t);if(i!==void 0){let r=this.peerConnection.getTransceivers().find(a=>a.mid===i);if(r)return{transceiver:r,track:r.receiver.track,id:i}}}async updateRemoteRTPCapabilities(t,i){if(this.remoteCodecs=i,!this.remoteSDP)return void R.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(i));if(this.remoteSDP.updateRemoteCodec(t,i,this.store.codec)){let r=await this.peerConnection.createOffer(),a=this.logSDPExchange(r.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(r);let s=this.remoteSDP.toString();a==null||a(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}else R.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});let t=await this.peerConnection.createOffer();if(!t.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");let i=vo(t.sdp),r=await QV({filterRTX:!k("USE_PUB_RTX")&&!k("USE_SUB_RTX"),filterVideoFec:k("FILTER_VIDEO_FEC"),filterAudioFec:k("FILTER_AUDIO_FEC"),filterVideoCodec:k("FILTER_VIDEO_CODEC")},this.extension);return this.localCapabilities=SE(r),this.initialOffer=t,kn(kn({},i),{},{rtpCapabilities:r,offerSDP:t.sdp})}catch(t){throw new H(A.GET_LOCAL_CONNECTION_PARAMS_FAILED,t.toString())}}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new qJ(kn(kn({},t),{},{localCapabilities:this.localCapabilities})),t.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);let i=this.remoteSDP.toString(),r=ZV(this.initialOffer.sdp,this.extension),a=this.logSDPExchange(r||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:r}),a==null||a(i),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i});let s=this.peerConnection.getTransceivers()[0];if(s!=null&&s.receiver&&this.tryBindTransportEvents(s.receiver),k("PRELOAD_MEDIA_COUNT")>0){this.remoteSDP.preloadRemoteMedia(k("PRELOAD_MEDIA_COUNT"));let l=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:l});let u=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(u)}let{preSSRCs:c}=t;if(Array.isArray(c)&&c.length>0){let{mids:l}=this.remoteSDP.batchSend(c.map(u=>({kind:u.kind,ssrcMsg:[{ssrcId:u.ssrcId,rtx:u.rtx}],mslabel:u.mslabel})));l.forEach((u,h)=>{this.preSSRCMap.set(c[h].ssrcId,u)}),await l_(this.peerConnection,this.remoteSDP,this.extension),R.debug("[".concat(this.store.clientId,"] [P2PConnection] pre-batchReceive exchange SDP."))}}catch(i){throw new H(A.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(i.toString()))}}async updateRemoteConnect(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateRemoteConnect before remote SDP created");let{rtpCapabilities:i}=t;this.remoteSDP.updateRemoteRTPCapabilities(i),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);let{preSSRCs:r}=t;if(Array.isArray(r)&&r.length>0){let{mids:a}=this.remoteSDP.batchSend(r.map(s=>Object.assign({},{kind:s.kind,ssrcMsg:[{ssrcId:s.ssrcId,rtx:s.rtx}],mslabel:s.mslabel})));a.forEach((s,c)=>{this.preSSRCMap.set(r[c].ssrcId,s)})}await l_(this.peerConnection,this.remoteSDP,this.extension),R.debug("[P2PConnection] updateRemoteRTPCapabilities by exchanging SDP.")}catch(i){throw new H(A.EXCHANGE_SDP_FAILED,"P2PConnection.updateRemoteConnect failed; ".concat(i.toString()))}}send(t,i,r){var a=this;return gn(function*(){let s=yield Ye(a.mutex.lock("From P2PConnection.send"));try{if(!a.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");let c=[];t.forEach(v=>{let y=a.peerConnection.addTransceiver(v._mediaStreamTrack,{direction:"sendonly"});c.push(y),v._updateRtpTransceiver(y)}),Bt()&&k("SIMULCAST")===!0&&(yield Ye(a.applySimulcastForFirefox(c,t)));let l=yield Ye(a.peerConnection.createOffer()),u=a.remoteSDP.predictReceivingMids(t.length),h=a.mungSendOfferSDP(l.sdp,t,u),p=vi.parse(h),_=u.map(v=>{let y=p.mediaDescriptions.find(I=>I.attributes.mid===v);if(!y)throw new Error("Cannot extract ssrc from mediaDescription.");return YV(y,k("USE_PUB_RTX"))}),m;try{m=yield _}catch(v){m=[],a.remoteSDP.receive(t,i,r,m);let y=a.remoteSDP.toString();throw yield Ye(a.peerConnection.setLocalDescription({type:"offer",sdp:h})),yield Ye(a.peerConnection.setRemoteDescription({type:"answer",sdp:y})),yield Ye(a.stopSending(u,!0)),v}a.remoteSDP.receive(t,i,r,m);let S=a.remoteSDP.toString(),C=a.logSDPExchange(h,"offer","local","send");return yield Ye(a.peerConnection.setLocalDescription({type:"offer",sdp:h})),yield Ye(a.applySimulcastEncodings(c,t)),yield Ye(a.applySendEncodings(c,t)),C==null||C(S),yield Ye(a.peerConnection.setRemoteDescription({type:"answer",sdp:S})),c.map((v,y)=>{let I=u[y];return{localSSRC:_[y],id:I,transceiver:v}})}catch(c){throw c instanceof H?c:new H(A.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(c.toString()))}finally{s()}})()}async createDataChannels(t,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let r=this.dataStreamChannelMap.get(t);if(r&&r.readyState==="open")R.debug("[P2PConnection] Channels are already available and can be reused directly.");else{let s=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof s!="number")throw new Error("create DataChannel error, because cannot get dc id");r=this.peerConnection.createDataChannel("datastream-channel",{id:s,negotiated:!0,ordered:!1,maxRetransmits:k("DATASTREAM_MAX_RETRANSMITS")}),r.binaryType="arraybuffer",this.dataStreamChannelMap.set(t,r)}i.forEach(s=>{s._updateOriginDataChannel(r)});let{needExchangeSDP:a}=this.remoteSDP.sendDataChannel();if(a){let s=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});let c=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(c),R.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else R.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(r){throw r instanceof H?r:new H(A.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(r.toString()))}}async stopDataChannels(t){try{let i=this.dataStreamChannelMap.get(t);return i&&(i.id&&this.recoveredDataChannelIds.push(i.id),i.close()),void this.dataStreamChannelMap.delete(t)}catch(i){throw i instanceof H?i:new H(A.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(i.toString()))}}async stopSending(t,i){let r=i?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");let a=this.peerConnection.getTransceivers().filter(u=>t.indexOf(u.mid)!==-1);if(a.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");a.map(u=>{var h;f_(this.id+u.mid,this),u.direction="inactive",(h=u.stop)===null||h===void 0||h.call(u)});let s=await this.peerConnection.createOffer(),c=this.logSDPExchange(s.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(s),this.remoteSDP.stopReceiving(t);let l=this.remoteSDP.toString();c==null||c(l),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(a){throw new H(A.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(a.toString()))}finally{r&&r()}}async receive(t,i,r,a){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));let{mid:s,needExchangeSDP:c}=this.remoteSDP.send(t,i,r,a);c&&(await l_(this.peerConnection,this.remoteSDP,this.extension),R.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP.")));let l=this.peerConnection.getTransceivers().find(u=>u.mid===s);if(!l)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:l.receiver.track,id:s,transceiver:l}}catch(s){throw new H(A.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");let{mids:i,needExchangeSDP:r}=this.remoteSDP.batchSend(t);return r&&(await l_(this.peerConnection,this.remoteSDP,this.extension),R.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))),i.map(a=>{let s=this.peerConnection.getTransceivers().find(c=>c.mid===a);if(!s)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:s.receiver.track,id:a,transceiver:s}})}catch(i){throw new H(A.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(i.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");t.forEach(s=>{Array.from(this.preSSRCMap.entries()).some(c=>{let[l,u]=c;if(u===s)return this.preSSRCMap.delete(l),!0})}),this.remoteSDP.stopSending(t);let i=this.remoteSDP.toString(),r=this.logSDPExchange(i,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});let a=await this.peerConnection.createAnswer();r==null||r(a.sdp||""),await this.peerConnection.setLocalDescription(a)}catch(i){throw new H(A.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(i.toString()))}}async muteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.mute(t);let i=this.remoteSDP.toString(),r=this.logSDPExchange(i,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});let a=await this.peerConnection.createAnswer();r==null||r(a.sdp||""),await this.peerConnection.setLocalDescription(a)}catch(i){throw new H(A.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(i.toString()))}}async unmuteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.unmute(t);let i=this.remoteSDP.toString(),r=this.logSDPExchange(i,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});let a=await this.peerConnection.createAnswer();r==null||r(a.sdp||""),await this.peerConnection.setLocalDescription(a)}catch(i){throw new H(A.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(i.toString()))}}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");let i=this.peerConnection.getTransceivers().filter(c=>c.mid&&t.indexOf(c.mid)!==-1);if(i.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");i.map(c=>{c.direction="inactive"});let r=await this.peerConnection.createOffer(),a=this.logSDPExchange(r.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(r),this.remoteSDP.muteRemote(t);let s=this.remoteSDP.toString();a==null||a(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(i){throw new H(A.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(i.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");let i=this.peerConnection.getTransceivers().filter(c=>c.mid&&t.indexOf(c.mid)!==-1);if(i.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");i.map(async(c,l)=>{c.direction="sendonly"});let r=await this.peerConnection.createOffer(),a=this.logSDPExchange(r.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(r),this.remoteSDP.unmuteRemote(t);let s=this.remoteSDP.toString();a==null||a(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(i){throw new H(A.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(i.toString()))}}restartICE(t){var i=this;return gn(function*(){let r=yield Ye(i.mutex.lock("From P2PConnection.restartICE"));try{if(!i.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(Ke().supportPCSetConfiguration){let h=i.peerConnection.getConfiguration(),p=t===Vr.RELAY?"relay":"all";h.iceTransportPolicy!==p&&(R.debug("[".concat(i.store.clientId,"] restartICE change iceTransportPolicy from [").concat(h.iceTransportPolicy,"] to [").concat(p,"]")),h.iceTransportPolicy=p,i.peerConnection.setConfiguration(h))}else if(t===Vr.RELAY)return;i.remoteSDP.updateCandidates(t);let a=yield Ye(i.peerConnection.createOffer({iceRestart:!0}));if(!a.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");let s=vo(a.sdp),{remoteIceParameters:c}=yield s.iceParameters;i.remoteSDP.restartICE(c);let l=i.remoteSDP.toString(),u=i.logSDPExchange(a.sdp||"","offer","local","restartICE");i.store.descriptionStart(),yield Ye(i.peerConnection.setLocalDescription(a)),u==null||u(l),yield Ye(i.peerConnection.setRemoteDescription({type:"answer",sdp:l}))}catch(a){R.warning("[".concat(i.store.clientId,"] restart ICE failed, abort operation"),a)}finally{r()}})()}close(){var t;this.peerConnection.getTransceivers().forEach(i=>{f_(this.id+i.mid,this)}),this.preSSRCMap.clear(),this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return kn(kn({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");let r=await this.peerConnection.createOffer(),a=this.mungSendOfferSDP(r.sdp,[i],[t]);this.remoteSDP.updateRecvMedia(t,i);let s=this.remoteSDP.toString(),c=this.logSDPExchange(a,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:a}),c==null||c(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(r){throw new H(A.EXCHANGE_SDP_FAILED,r.toString())}}async updateSendParameters(t,i){let r=this.peerConnection.getTransceivers().filter(a=>a.mid===t);r.length===1&&(this.isVP8Simulcast(i)?Bt()||await this.applySimulcastEncodings(r,[i]):await this.applySendEncodings(r,[i]))}setStatsRemoteVideoIsReady(t,i){this.statsFilter.setVideoIsReady2(t,i)}async replaceTrack(t,i){let r=this.peerConnection.getTransceivers().find(a=>a.mid===i);r&&await r.sender.replaceTrack(t._mediaStreamTrack)}async getSelectedCandidatePair(){let t=this.peerConnection.getReceivers();if(t.length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair()){let i=t[0].transport.iceTransport,{local:r,remote:a}=i.getSelectedCandidatePair();return{local:kn(kn({},Yn),{},{candidateType:r.type,protocol:r.protocol,address:r.address,port:r.port}),remote:kn(kn({},Yn),{},{candidateType:a.type,protocol:a.protocol,address:a.address,port:a.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,R.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,R.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},k("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){let i={iceServers:[]};return t.iceServers?i.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(XE(t.turnServer.servers)?i.iceServers=t.turnServer.servers:(i.iceServers&&i.iceServers.push(...dh.turnServerConfigToIceServers(t.turnServer.servers)),k("USE_TURN_SERVER_OF_GATEWAY")&&i.iceServers&&t.turnServer.serversFromGateway&&i.iceServers.push(...dh.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),k("FORCE_TURN_TCP")?i.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(r=>{r.forceturn&&(i.iceTransportPolicy="relay")}))),k("ENABLE_ENCODED_TRANSFORM")&&Ke().supportWebRTCEncodedTransform&&(i.encodedInsertableStreams=!0),i}static turnServerConfigToIceServers(t){let i=[];return t.forEach(r=>{r.security?r.tcpport&&i.push({username:r.username,credential:r.password,credentialType:"password",urls:"turns:".concat(ed(r.turnServerURL),":").concat(r.tcpport,"?transport=tcp")}):(r.udpport&&!k("FORCE_TURN_TCP")&&i.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.udpport,"?transport=udp")}),r.tcpport&&i.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.tcpport,"?transport=tcp")}))}),i}tryBindTransportEvents(t){let i=t.transport;if(i){this.transportEventReceiver=t,i.onstatechange=()=>{var a;i!=null&&i.state&&((a=this.onDTLSTransportStateChange)===null||a===void 0||a.call(this,i.state))},i.onerror=a=>{var s;(s=this.onDTLSTransportError)===null||s===void 0||s.call(this,"error"in a?a.error:a)};let r=i.iceTransport;r&&(r.onstatechange=()=>{let a=i==null?void 0:i.iceTransport.state;var s;a&&((s=this.onICETransportStateChange)===null||s===void 0||s.call(this,a))},r.getSelectedCandidatePair&&(r.onselectedcandidatepairchange=()=>{if(r.getSelectedCandidatePair()){let{local:a,remote:s}=r.getSelectedCandidatePair();R.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:a.type,protocol:a.protocol}),", remote ").concat(JSON.stringify({candidateType:s.type,protocol:s.protocol,address:s.address,port:s.port})," )"))}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(t,i){var r,a;if(i||(i=this.peerConnection.getSenders().find(v=>v.track===t._mediaStreamTrack)),!i)return R.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(t))return R.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Ke().supportSetRtpSenderParameters)return R.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");let s={},c={};switch(t._optimizationMode){case"motion":s.degradationPreference="maintain-framerate";break;case"detail":s.degradationPreference="maintain-resolution";break;case"balanced":s.degradationPreference="balanced"}let l=function(v,y){return v.getTransceivers().find(I=>I.sender.track===y||I.receiver.track===y)}(this.peerConnection,t._mediaStreamTrack),u=dJ(t);if(JJ(t)&&l&&i&&u&&this.getLocalVideoStats&&oe(r=["vp8","vp9"]).call(r,this.store.codec)){var h;let v=s.degradationPreference||(oe(h=t._hints).call(h,Rt.CUSTOM_TRACK)?k("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");(function(y,I,O,P,U,x){if(f_(y,O),U(I),P!=="balanced"&&P!=="maintain-framerate"&&P!=="maintain-resolution")return;let G=-1;fB(y,I);let Z=window.setInterval(()=>{let q=RE.get(y);if(!k("ENABLE_AG_ADAPTATION")||!q)return f_(y,O),void U(I);let ie=x();if(ie.sendPackets>0&&ie.OutgoingAvailableBandwidth>0){if(G===-1)return void(G=Date.now());if(Date.now()-G<1e3)return;let Ie=ie.sendFrameRate,Ve=ie.OutgoingAvailableBandwidth,[He,ut]=XJ(y,Ie,Ve,q.adaptationConfig,I,P);ut&&(O.qualityLimitationReason=ut),He&&q.adaptationConfig.scale!==He.scale&&(R.debug("[".concat(y,"] applyAdaptation: ").concat(O.qualityLimitationReason,`
           sendFps `).concat(Ie,", bwe ").concat(Ve,", switch from ").concat(q.adaptationConfig.scale," to ").concat(He.scale," ")),q.adaptationConfig=vR(vR({},q.adaptationConfig),He),U(He))}},k("CHECK_LOCAL_STATS_INTERVAL")),J=vR({},I);RE.set(y,{timer:Z,adaptationConfig:J,originConfig:I,adaptationFunc:U}),R.debug("[".concat(y,"] start adaptation, originConfig: ").concat(JSON.stringify(I),", degradationPreference: ").concat(P))})(this.id+l.mid,u,this,v,y=>{i&&this.updateAdaptation(i,y)},this.getLocalVideoStats.bind(this))}if(t._encoderConfig){var p;let{bitrateMax:v,frameRate:y,scaleResolutionDownBy:I}=t._encoderConfig;v&&(c.maxBitrate=1e3*v),(oe(p=t._hints).call(p,Rt.LOW_STREAM)||t.isUseScaleResolutionDownBy)&&(y&&(c.maxFramerate=Br(y)),I&&I>=1&&(c.scaleResolutionDownBy=I))}let{maxFramerate:_}=k("ENCODER_CONFIG_LIMIT");if(_&&typeof _=="number"&&(c.maxFramerate=c.maxFramerate?Math.min(c.maxFramerate,_):_),k("DSCP_TYPE")&&No()){var m;let v=k("DSCP_TYPE");oe(m=["very-low","low","medium","high"]).call(m,v)&&(c.networkPriority=v)}let S=i.getParameters(),C=(a=S.encodings)===null||a===void 0?void 0:a[0];Bt()&&!C&&(s.encodings=[c]),C&&Object.assign(C,c),Object.assign(S,s),R.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(S.encodings))),await i.setParameters(S),await async function(v,y,I){try{var O;if(!Ke().supportSetRtpSenderParameters||!function(Z){return Z==="vp9"}(v)||!k("ENABLE_SVC"))return;let P={},U={},x=y.getParameters(),G=(O=x.encodings)===null||O===void 0?void 0:O[0];U.scalabilityMode=Yv(I),G&&Object.assign(G,U),Object.assign(x,P),await y.setParameters(x),R.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode success: ".concat(JSON.stringify(x.encodings)))}catch(P){R.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode failed",P)}}(this.store.codec,i,k("SVC_MODE"))}async updateAdaptation(t,i){var r,a;if(!t)return R.debug("[updateAdaptation] no rtpSender found");if(!Ke().supportSetRtpSenderParameters)return R.debug("[updateAdaptation] Browser not support set rtp-sender parameters");let s={},{bitrateMax:c,frameRate:l,scaleResolutionDownBy:u}=i;c&&(s.maxBitrate=1e3*c),l&&(s.maxFramerate=Br(l)),u&&u>=1&&oe(r=["vp8","vp9"]).call(r,this.store.codec)&&(s.scaleResolutionDownBy=u);let h=t.getParameters(),p=(a=h.encodings)===null||a===void 0?void 0:a[0];p&&Object.assign(p,s),Object.assign(h,{});try{await t.setParameters(h),R.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(h.encodings)))}catch(_){!("transport"in t)||t.transport&&t.transport.state==="connected"?this.peerConnectionState!=="connected"?R.debug("[updateAdaptation] peerConnection not connected}"):R.debug("[updateAdaptation] updateRtpSenderEncodings failed",_):R.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(t,i){try{if(!Ke().supportSetRtpSenderParameters||t.length!==i.length)return;for(let r=0;r<t.length;r++){let a=t[r],s=i[r];s instanceof St&&!this.isVP8Simulcast(s)&&await this.updateRtpSenderEncodings(s,a.sender)}}catch{R.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,i,r){let a=vi.parse(t);return i.forEach((s,c)=>{let l=r[c],u=a.mediaDescriptions.find(h=>h.attributes.mid===l);u&&(Rd(u,s),JV(u,s,this.store.codec))}),vi.print(a)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var i;(i=this.onFirstAudioReceived)===null||i===void 0||i.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var i;(i=this.onFirstVideoReceived)===null||i===void 0||i.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var i;(i=this.onFirstAudioDecoded)===null||i===void 0||i.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,i,r)=>{var a;(a=this.onFirstVideoDecoded)===null||a===void 0||a.call(this,t,i,r)},this.statsFilter.onSelectedLocalCandidateChanged=(t,i)=>{var r;(r=this.onSelectedLocalCandidateChanged)===null||r===void 0||r.call(this,t,i)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,i)=>{var r;(r=this.onSelectedRemoteCandidateChanged)===null||r===void 0||r.call(this,t,i)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var i;(i=this.onFirstVideoDecodedTimeout)===null||i===void 0||i.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,i){if(t.length===i.length)for(let u=0;u<t.length;u++){var r,a,s,c,l;let h=t[u],p=i[u];if(p instanceof St&&!oe(r=p._hints).call(r,Rt.LOW_STREAM)&&(a=p._encoderConfig)!==null&&a!==void 0&&a.bitrateMax&&((s=p._encoderConfig)===null||s===void 0?void 0:s.bitrateMax)>200&&(c=p._scalabilityMode)!==null&&c!==void 0&&c.numSpatialLayers&&((l=p._scalabilityMode)===null||l===void 0?void 0:l.numSpatialLayers)>1&&this.store.codec==="vp8"){let _={},m={high:1e3*(p._encoderConfig.bitrateMax-50),medium:5e4};_.encodings=[{rid:"m",active:!0,maxBitrate:m.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:m.high}];let S=h.sender.getParameters();await h.sender.setParameters(Object.assign(S,_))}}}async applySimulcastEncodings(t,i){if(!Bt()&&t.length===i.length)for(let r=0;r<t.length;r++){let a=i[r];if(a instanceof St&&this.isVP8Simulcast(a)){let s=t[r],c={},l={high:1e3*(a._encoderConfig.bitrateMax-50),medium:5e4};c.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:l.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:l.medium,scaleResolutionDownBy:4}];let u=s.sender.getParameters();await s.sender.setParameters(Object.assign(u,c))}}}isVP8Simulcast(t){var i,r,a,s,c;return!!(t instanceof St&&k("SIMULCAST")&&this.store.codec==="vp8"&&!oe(i=t._hints).call(i,Rt.LOW_STREAM)&&(r=t._encoderConfig)!==null&&r!==void 0&&r.bitrateMax&&((a=t._encoderConfig)===null||a===void 0?void 0:a.bitrateMax)>200&&(s=t._scalabilityMode)!==null&&s!==void 0&&s.numSpatialLayers&&((c=t._scalabilityMode)===null||c===void 0?void 0:c.numSpatialLayers)>1)}logSDPExchange(t,i,r,a){if(k("SDP_LOGGING"))return R.upload("[".concat(this.store.clientId,"] exchanging ").concat(r," ").concat(i," SDP during P2PConnection.").concat(a,`
`),t),i==="offer"?s=>{this.logSDPExchange(s,"answer",r==="local"?"remote":"local",a)}:void 0}async getRemoteSSRC(t){if(!this.remoteSDP)return;let i=this.remoteSDP.getSSRC(t);return i&&i.length!==0?i[0].ssrcId:void 0}setConfiguration(t){if(Ke().supportPCSetConfiguration){let i=dh.resolvePCConfiguration(t);this.peerConnection.setConfiguration(i)}}},de(xe.prototype,"updateRemoteRTPCapabilities",[Tr],Object.getOwnPropertyDescriptor(xe.prototype,"updateRemoteRTPCapabilities"),xe.prototype),de(xe.prototype,"connect",[Tr],Object.getOwnPropertyDescriptor(xe.prototype,"connect"),xe.prototype),de(xe.prototype,"updateRemoteConnect",[Tr],Object.getOwnPropertyDescriptor(xe.prototype,"updateRemoteConnect"),xe.prototype),de(xe.prototype,"createDataChannels",[Tr],Object.getOwnPropertyDescriptor(xe.prototype,"createDataChannels"),xe.prototype),de(xe.prototype,"receive",[Tr],Object.getOwnPropertyDescriptor(xe.prototype,"receive"),xe.prototype),de(xe.prototype,"batchReceive",[Tr],Object.getOwnPropertyDescriptor(xe.prototype,"batchReceive"),xe.prototype),de(xe.prototype,"stopReceiving",[Tr],Object.getOwnPropertyDescriptor(xe.prototype,"stopReceiving"),xe.prototype),de(xe.prototype,"muteRemote",[Tr],Object.getOwnPropertyDescriptor(xe.prototype,"muteRemote"),xe.prototype),de(xe.prototype,"unmuteRemote",[Tr],Object.getOwnPropertyDescriptor(xe.prototype,"unmuteRemote"),xe.prototype),de(xe.prototype,"muteLocal",[Tr],Object.getOwnPropertyDescriptor(xe.prototype,"muteLocal"),xe.prototype),de(xe.prototype,"unmuteLocal",[Tr],Object.getOwnPropertyDescriptor(xe.prototype,"unmuteLocal"),xe.prototype),de(xe.prototype,"close",[Tr],Object.getOwnPropertyDescriptor(xe.prototype,"close"),xe.prototype),de(xe.prototype,"updateEncoderConfig",[Tr],Object.getOwnPropertyDescriptor(xe.prototype,"updateEncoderConfig"),xe.prototype),de(xe.prototype,"updateSendParameters",[Tr],Object.getOwnPropertyDescriptor(xe.prototype,"updateSendParameters"),xe.prototype),de(xe.prototype,"replaceTrack",[Tr],Object.getOwnPropertyDescriptor(xe.prototype,"replaceTrack"),xe.prototype),de(xe.prototype,"updateAdaptation",[Tr],Object.getOwnPropertyDescriptor(xe.prototype,"updateAdaptation"),xe.prototype),de(xe.prototype,"getRemoteSSRC",[Tr],Object.getOwnPropertyDescriptor(xe.prototype,"getRemoteSSRC"),xe.prototype),xe);function Tr(e,t,i){let r=e[t];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){let a=this.mutex,s=await a.lock("From P2PConnection.".concat(t));try{for(var c=arguments.length,l=new Array(c),u=0;u<c;u++)l[u]=arguments[u];return await r.apply(this,l)}finally{s()}},i}var Ne;function Ek(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),i.push.apply(i,r)}return i}function Mn(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?Ek(Object(i),!0).forEach(function(r){b(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Ek(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}function mk(e){var t,i,r,a=2;for(typeof Symbol<"u"&&(i=YJ,r=Symbol.iterator);a--;){if(i&&(t=e[i])!=null)return t.call(e);if(r&&(t=e[r])!=null)return new q_(t.call(e));i="@@asyncIterator",r="@@iterator"}throw new TypeError("Object is not async iterable")}function q_(e){function t(i){if(Object(i)!==i)return ae.reject(new TypeError(i+" is not an object."));var r=i.done;return ae.resolve(i.value).then(function(a){return{value:a,done:r}})}return q_=function(i){this.s=i,this.n=i.next},q_.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(i){var r=this.s.return;return r===void 0?ae.resolve({value:i,done:!0}):t(r.apply(this.s,arguments))},throw:function(i){var r=this.s.return;return r===void 0?ae.reject(i):t(r.apply(this.s,arguments))}},new q_(e)}var __=(Ne=class extends Lt{get state(){return this._state}set state(e){let t=this._state;this._state=e,this.emit(Te.StateChange,t,this._state)}constructor(e,t){super(),b(this,"isPlanB",void 0),b(this,"store",void 0),b(this,"statsUploader",void 0),b(this,"connection",void 0),b(this,"localTrackMap",new Map),b(this,"remoteUserMap",new Map),b(this,"localDataChannels",[]),b(this,"remoteDataChannelMap",new Map),b(this,"pendingLocalTracks",[]),b(this,"pendingRemoteTracks",[]),b(this,"pendingLocalDataChannels",[]),b(this,"pendingRemoteDataChannels",[]),b(this,"statsCollector",void 0),b(this,"shouldForwardP2PCreation",void 0),b(this,"iceFailedCount",0),b(this,"dtlsFailedCount",0),b(this,"mutex",new Fi("P2PChannel-mutex")),b(this,"_state",Je.Disconnected),b(this,"_pcStatsUploadType",k("NEW_ICE_RESTART")?Es.FIRST_CONNECTION:Es.OLD_FIRST_CONNECTION),b(this,"_isInRestartIce",!1),b(this,"_isStartRestartIce",!1),b(this,"_restartStates",["disconnected","failed"]),b(this,"_restartTimer",void 0),b(this,"_isFirstConnected",!0),b(this,"handleMuteLocalTrack",async(i,r,a)=>{let s=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==Je.Connected)return void a(new H(A.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));let c=this.filterTobeMutedTracks(i);if(c.length===0)return void r();let l=c.find(h=>h[0]==="videoLowTrack");l&&l[1].track._originMediaStreamTrack.stop(),await this.connection.muteLocal(c.map(h=>{let[,{id:p}]=h;return p}));let u=this.createMuteMessage(c);await lt(this,Te.RequestMuteLocal,u),r()}catch(c){a(c)}finally{s()}}),b(this,"handleUnmuteLocalTrack",async(i,r,a)=>{let s=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==Je.Connected)return void a(new H(A.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));let c=this.filterTobeUnmutedTracks(i);if(c.length===0)return void r();let l=c.find(h=>h[0]==="videoLowTrack");if(l){let h=l[1];if(h.track._originMediaStreamTrack.stop(),!k("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ke().supportDualStreamEncoding){let p=i._mediaStreamTrack.clone();h.track._mediaStreamTrack=p,h.track._originMediaStreamTrack=p}else{let p=Zv(i,Uh(this,Te.RequestLowStreamParameter));h.track._mediaStreamTrack=p,h.track._originMediaStreamTrack=p}await new ae((p,_)=>{this.handleReplaceTrack(h.track,p,_,!0)})}await this.connection.unmuteLocal(c.map(h=>{let[,{id:p}]=h;return p}));let u=this.createUnmuteMessage(c);await lt(this,Te.RequestUnmuteLocal,u),r()}catch(c){a(c)}finally{s()}}),b(this,"handleUpdateVideoEncoder",async(i,r,a)=>{let s=await this.mutex.lock("Locking from P2PChannel.handleSetVideoEncoder");try{let c=this.localTrackMap.get(Q.LocalVideoTrack);if(!this.connection||!c||c.track!==i||this.state!==Je.Connected)return void r();let{id:l,track:u}=c;await this.connection.updateSendParameters(l,u),await this.connection.updateEncoderConfig(l,u),this.emit(Te.UpdateVideoEncoder,u),r()}catch(c){a(c)}finally{s()}}),b(this,"handleUpdateVideoSendParameters",async(i,r,a)=>{let s=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{let c=this.localTrackMap.get(Q.LocalVideoTrack);if(!this.connection||!c||c.track!==i||this.state!==Je.Connected)return void r();let{id:l,track:u}=c;await this.connection.updateSendParameters(l,u),r()}catch(c){a(c)}finally{s()}}),b(this,"handleReplaceMixingTrack",async(i,r,a,s)=>{if(!this.connection||this.state!==Je.Connected)return void r();let c=RR([i]),l;R.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(c.getTrackId(),"]")),typeof s=="boolean"&&s||(l=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(i,c),r()}catch(h){a(h)}finally{var u;(u=l)===null||u===void 0||u()}}),b(this,"handleReplaceTrack",async(i,r,a,s)=>{let c;R.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(i.getTrackId(),"]")),typeof s=="boolean"&&s||(c=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var l;let h=Array.from(this.localTrackMap.entries()).find(p=>{let[,{track:_}]=p;return i===_});if(!this.connection||!h||this.state!==Je.Connected)return void r();if(await((l=this.connection)===null||l===void 0?void 0:l.replaceTrack(i,h[1].id)),this.isPlanB){let p=h[1];p.id=i._mediaStreamTrack.id,this.localTrackMap.set(h[0],p)}if(h[0]===Q.LocalVideoTrack&&!k("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ke().supportDualStreamEncoding){let p=this.localTrackMap.get(Q.LocalVideoLowTrack);if(p){let _=i._mediaStreamTrack.clone();p.track._originMediaStreamTrack.stop(),p.track._mediaStreamTrack=_,p.track._originMediaStreamTrack=_,await new ae((m,S)=>{this.handleReplaceTrack(p.track,m,S,!0)})}}r()}catch(h){a(h)}finally{var u;(u=c)===null||u===void 0||u()}}),b(this,"handleGetRTCStats",i=>{i(this.statsCollector.getRTCStats())}),b(this,"handleGetLocalVideoStats",i=>{i(this.statsCollector.getLocalVideoTrackStats())}),b(this,"handleGetLocalAudioStats",i=>{i(this.statsCollector.getLocalAudioTrackStats())}),b(this,"handleGetRemoteVideoStats",i=>this.statsCollector.getRemoteVideoTrackStats(i.uid)[i.uid]),b(this,"handleGetRemoteAudioStats",i=>this.statsCollector.getRemoteAudioTrackStats(i.uid)[i.uid]),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new uB(this.store),this.bindStatsUploaderEvents(),this.isPlanB=!Ke().supportUnifiedPlan||k("CHROME_FORCE_PLAN_B")&&No(),this.shouldForwardP2PCreation=k("FORWARD_P2P_CREATION")&&Ke().supportPCSetConfiguration&&Yy(),this.shouldForwardP2PCreation&&(this.connection=this.isPlanB?new Qu({},this.store):new un({},this.store),this.bindConnectionEvents(this.connection))}async startP2PConnection(e){var t;this.state=Je.New;let i=this.shouldForwardP2PCreation&&((t=this.connection)===null||t===void 0?void 0:t.peerConnectionState)==="closed";if(this.shouldForwardP2PCreation&&!i||(i&&this.connection&&(R.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.connection.close(),this.unbindConnectionEvents(this.connection)),this.connection=this.isPlanB?new Qu(e,this.store):new un(e,this.store),this.bindConnectionEvents(this.connection)),!this.connection)throw new H(A.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=k("NEW_ICE_RESTART")?Es.FIRST_CONNECTION:Es.OLD_FIRST_CONNECTION,this._isFirstConnected=!0,this._isInRestartIce=!1,this._isStartRestartIce=!1,this.connection.setConfiguration(e),this.connection.establishPromise}async connect(e){if(!this.connection)throw new H(A.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");k("ENABLE_PREALLOC_PC")&&this.state===Je.Connected?await this.connection.updateRemoteConnect(e):(this.store.peerConnectionStart(),await this.connection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Je.Connected)}updateRemoteRTPCapabilities(e){let t=Array.from(this.localTrackMap.entries()).filter(a=>{var s;let[c]=a;return oe(s=[Q.LocalVideoLowTrack,Q.LocalVideoTrack]).call(s,c)}),i=t.map(a=>{let[,{id:s}]=a;return s}),r=t.map(a=>{let[s]=a;return s});if(this.connection instanceof un){if(fe.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(r),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(e)}),!oe(e).call(e,this.store.codec)){let a=["vp9","vp8","h264"].find(s=>oe(e).call(e,s));a&&(this.store.codec=a,R.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(a,".")))}this.connection.updateRemoteRTPCapabilities(i,e)}}async getEstablishParams(){var e;if(this.connection instanceof un&&this.connection.peerConnectionState!=="closed"&&oe(e=[Je.New,Je.Connected]).call(e,this.state))return this.connection.establishPromise}async publishDataChannel(e){if(!this.connection||this.state!==Je.Connected){if(this.state===Je.Disconnected)throw new H(A.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return e.forEach(i=>{var r;oe(r=this.pendingLocalDataChannels).call(r,i)||this.pendingLocalDataChannels.push(i)}),[]}let t=this.filterTobePublishedDataChannels(e);return t.length===0?[]:(t.forEach(i=>{let r=Date.now();this.store.publish(i.id.toString(),"datachannel",r)}),await this.connection.createDataChannels(this.store.uid,t),t.forEach(i=>{this.localDataChannels.push(i);let r=Date.now();this.store.publish(i.id+"","datachannel",void 0,r)}),e.map(i=>({streamId:i.id,ordered:i.ordered,maxRetransmits:i.maxRetransmits,metadata:i.metadata,channelId:i._originDataChannelId})))}publish(e,t,i){var r=this;return gn(function*(){let a=yield Ye(r.mutex.lock("From P2PChannel.publish"));try{if(!r.connection||r.state!==Je.Connected){if(r.state===Je.Disconnected)throw new H(A.UNEXPECTED_ERROR,"PeerConnection already disconnected.");r.throwIfTrackTypeNotMatch(e);let c=e.filter(l=>r.pendingLocalTracks.indexOf(l)===-1);return void(r.pendingLocalTracks=r.pendingLocalTracks.concat(c))}r.store.pubId=r.store.pubId+1,ji.markPublishStart(r.store.clientId,r.store.pubId);let s=r.filterTobePublishedTracks(e,t,i);if(s.length===0)return void(yield Ye(r.tryToUnmuteAudio(e)));yield*sk(mk(r.doPublish(r.connection,s)))}finally{a()}})()}doPublish(e,t){var i=this;return gn(function*(){t.forEach(_=>{let{track:m,type:S}=_,C=Date.now();i.store.publish(m.getTrackId(),S===Q.LocalAudioTrack?"audio":"video",C)}),i.bindLocalTrackEvents(t);let r=t.map(_=>{let{track:m}=_;return m}),a=yield Ye(e.send(t.map(_=>{let{track:m}=_;return m}),i.store.codec,i.store.audioCodec)),s=(yield Ye(a.next())).value,c=i.createGatewayPublishMessage(t,s),l;try{l=yield c}catch(_){throw a.throw(_),(_==null?void 0:_.code)===A.WS_ABORT&&t.forEach(m=>{let{track:S}=m;i.pendingLocalTracks.indexOf(S)===-1&&i.pendingLocalTracks.push(S)}),i.unbindLocalTrackEvents(t),_}let u=i.mapPubResToRemoteConfig(c,l),h=(yield Ye(a.next(u))).value,p=k("ENABLE_VIDEO_SEI");r.forEach(async _=>{let m=_.getRTCRtpTransceiver();m&&p&&(_.trackMediaType===_e.VIDEO?await EJ(m.sender,_):_.trackMediaType===_e.AUDIO&&await async function(S){if(!Ke().supportWebRTCEncodedTransform)return void R.warning("browser not support audio encoded transform");if(s_.has(S)||!S.track)return;let C={track:S.track};if(Co()){if(!S.createEncodedStreams)return void R.warning("browser not support createEncodedStreams() API");let y=null;try{y=S.createEncodedStreams()}catch(O){return void R.error("create audio-encoded-streams error",O&&O.message)}let I=new TransformStream({transform(O,P){C.controller||(C.controller=P),S.track&&S.track.id!==C.track.id&&(R.debug("audio track changed: ".concat(C.track.id," => ").concat(S.track.id)),C.track.removeEventListener("ended",v),C.track=S.track,C.track.addEventListener("ended",v)),P.enqueue(O)}});y.readable.pipeThrough(I).pipeTo(y.writable)}else if(Li()){if(typeof RTCRtpScriptTransform>"u")return void R.warning("browser not support RTCRtpScriptTransform");let y=K_(),I=new MessageChannel;await new ae(P=>y.onmessage=U=>{U.data==="registered"&&P(void 0)});let O=new RTCRtpScriptTransform(y,{name:"tx",port:I.port2},[I.port2]);S.transform=O,await new ae(P=>y.onmessage=U=>{U.data==="started"&&P(void 0)}),I.port1.onmessage=P=>{var U;P.data.transformed&&S.track&&((U=S.track)===null||U===void 0?void 0:U.id)!==C.track.id&&(R.debug("audio track changed: ".concat(C.track.id," => ").concat(S.track.id)),C.track.removeEventListener("ended",v),C.track=S.track,C.track.addEventListener("ended",v))},C.worker=y}function v(){if(S.track){if(this.id!==S.track.id)return;S.track.removeEventListener("ended",v)}let y=s_.get(S);if(y){s_.delete(S);try{var I,O;(I=y.controller)===null||I===void 0||I.terminate(),(O=y.worker)===null||O===void 0||O.terminate()}catch(P){R.warning(P&&P.message)}}}s_.set(S,C),S.track.addEventListener("ended",v)}(m.sender))}),t.forEach(_=>{let{type:m}=_;i.statsCollector.addLocalStats(m)}),i.assignLocalTracks(t,h),i.statsUploader.startUploadOutboundStats(),t.forEach(_=>{let{track:m,type:S}=_,C=Date.now();i.store.publish(m.getTrackId(),S===Q.LocalAudioTrack?"audio":"video",void 0,C)})})()}async updateVideoStreamParameter(e,t){let i=this.localTrackMap.get(t);if(!i)return;if(!(i.track instanceof St))return R.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");if(!(this.connection instanceof un||this.connection instanceof Qu))return R.warn("[updateVideoStreamParameter]: connection is not P2PConnection or P2PConnectionPlanB");let{track:r}=i,a=function(s,c){let l={};return s.height&&s.width&&(l.scaleResolutionDownBy=Vv(s,c)),l.maxFramerate=s.framerate?Br(s.framerate):void 0,l.maxBitrate=s.bitrate?1e3*s.bitrate:void 0,l}(e,r);if(r._encoderConfig||(r._encoderConfig={}),t!==Q.LocalVideoLowTrack||!k("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ke().supportDualStreamEncoding)a.scaleResolutionDownBy!=null&&(r._encoderConfig.scaleResolutionDownBy=a.scaleResolutionDownBy);else{let s=r._originMediaStreamTrack;if(!s.canvas)return R.warn("[".concat(r.getTrackId(),"] no canvas on track"));(function(c,l){let u=c.canvas;l.width&&(u.width=Br(l.width)),l.height&&(u.height=Br(l.height)),l.framerate&&(u.stopCapture&&u.stopCapture(),u.stopCapture=sC(()=>{!u.startCapture&&u.stopCapture&&u.stopCapture(),u.startCapture&&u.startCapture()},Br(l.framerate)))})(s,e)}a.maxBitrate!=null&&(r._encoderConfig.bitrateMax=a.maxBitrate/1e3),a.maxFramerate!=null&&(r._encoderConfig.frameRate&&typeof r._encoderConfig.frameRate=="object"?r._encoderConfig.frameRate.max=a.maxFramerate:r._encoderConfig.frameRate={max:a.maxFramerate}),R.debug("[".concat(r.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(r._encoderConfig))),await this.connection.updateRtpSenderEncodings(r)}publishLowStream(e){var t=this;return gn(function*(){if(!t.connection||t.state!==Je.Connected)return;let i=yield Ye(t.mutex.lock("Locking from P2PChannel.publishLowStream"));try{let a=t.localTrackMap.get(Q.LocalVideoTrack);if(!a)throw new H(A.UNEXPECTED_ERROR,"Could not find high stream");if(t.localTrackMap.has(Q.LocalVideoLowTrack))throw new H(A.UNEXPECTED_ERROR,"[".concat(t.store.clientId,"] Can't publish low stream when stream already publish"));let s=[{track:t.getLowVideoTrack(a.track,e),type:Q.LocalVideoLowTrack}];if(yield*sk(mk(t.doPublish(t.connection,s))),a.track.muted||!a.track.enabled){var r;let c=(r=t.localTrackMap.get(Q.LocalVideoLowTrack))===null||r===void 0?void 0:r.id;c!==void 0&&(yield Ye(t.connection.muteLocal([c])))}}finally{i()}})()}async republish(){this.pendingLocalTracks.length>0&&(R.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await ki(this,Te.RequestRePublish,this.pendingLocalTracks),this.emit(Te.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(R.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await ki(this,Te.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[])}async reSubscribe(e){for(let t=this.pendingRemoteTracks.length-1;t>=0;t--){let{user:i,kind:r}=this.pendingRemoteTracks[t];(r!==_e.AUDIO||i._audio_added_&&i._audioSSRC)&&(r!==_e.VIDEO||i._video_added_&&i._videoSSRC)||this.pendingRemoteTracks.splice(t,1)}if(e)await ki(this,Te.RequestReSubscribe,this.pendingRemoteTracks);else for(let{user:t,kind:i}of this.pendingRemoteTracks)await this.subscribe(t,i,i===_e.VIDEO?t._videoSSRC:t._audioSSRC);this.pendingRemoteTracks.forEach(t=>{let{user:i}=t;this.emit(Te.MediaReconnectEnd,i.uid)}),this.pendingRemoteTracks=[]}async unpublish(e){if(!this.connection||this.state!==Je.Connected)return void e.forEach(r=>{let a=this.pendingLocalTracks.indexOf(r);a!==-1&&this.pendingLocalTracks.splice(a,1)});let t=this.filterTobeUnpublishedTracks(e);if(t.length===0)return;let i=t.find(r=>r[0]==="videoLowTrack");return i&&i[1].track.close(),this.doUnpublish(this.connection,t)}async unpublishDataChannel(e){if(!this.connection||this.state!==Je.Connected)return void e.forEach(i=>{let r=this.pendingLocalDataChannels.indexOf(i);r!==-1&&this.pendingLocalDataChannels.splice(r,1)});let t=this.filterTobeUnpublishedDataChannels(e);return t.length!==0?(t.forEach(i=>{let r=this.localDataChannels.indexOf(i);r!==-1&&this.localDataChannels.splice(r,1)}),this.localDataChannels.length===0&&await this.connection.stopDataChannels(this.store.uid),t.map(i=>i.id)):void 0}async unpublishLowStream(){if(!this.connection||this.state!==Je.Connected)return;let e=this.localTrackMap.get(Q.LocalVideoLowTrack);if(!e)return;e.track.close();let t=[[Q.LocalVideoLowTrack,e]];return this.doUnpublish(this.connection,t)}async doUnpublish(e,t){let i=this.createGatewayUnpublishMessage(t);return await e.stopSending(t.map(r=>{let[,{id:a}]=r;return a})),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map(r=>{let[a,{track:s}]=r;return{type:a,track:s}})),t.forEach(r=>{let[a]=r;this.statsCollector.removeLocalStats(a)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadOutboundStats(),i}async subscribeDataChannel(e,t){if(!this.connection||this.state!==Je.Connected)throw new H(A.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");let i=t.filter(r=>{var a;return!((a=this.remoteDataChannelMap.get(e))!==null&&a!==void 0&&a.get(r.id))});if(i.length!==0)return await this.connection.createDataChannels(e.uid,i),i.forEach(r=>{var a;this.remoteDataChannelMap.has(e)?(a=this.remoteDataChannelMap.get(e))===null||a===void 0||a.set(r.id,r):this.remoteDataChannelMap.set(e,new Map([[r.id,r]]));let s=this.pendingRemoteDataChannels.findIndex(c=>{let{user:l,id:u}=c;return l.uid===e.uid&&u===r.id});s!==-1&&this.pendingRemoteDataChannels.splice(s,1)}),i.map(r=>r.id)}async subscribe(e,t,i,r,a){var s;if(!this.connection||this.state!==Je.Connected)throw new H(A.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((s=this.remoteUserMap.get(e))!==null&&s!==void 0&&s.has(t))return;let c,l,u,h=this.connection.getPreMedia(i);if(h)R.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] preSSRCMap has ssrcId: ").concat(i,", no need to send sub to gateway.")),u=h.transceiver,c=h.track,l=h.id;else if(a){let m=a.find(C=>{let{stream_type:v}=C;return v===t});if(!m)throw new H(A.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(t," for user: ").concat(e.uid," because subscribe answer from gateway does not contain stream_type: ").concat(t,"."));let S=await this.connection.receive(t,m.ssrcs,String(e._uintid),m.attributes);this.connection instanceof un&&(u=S.transceiver),c=S.track,l=S.id}else{let m=await this.connection.receive(t,[{ssrcId:i,rtx:r}],String(e._uintid),void 0);this.connection instanceof un&&(u=m.transceiver),c=m.track,l=m.id}t===_e.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(c):(e._audioTrack=new ld(c,e.uid,e._uintid,this.store),R.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),u&&e._audioTrack._updateRtpTransceiver(u),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(c):(e._videoTrack=new cd(c,e.uid,e._uintid,this.store),R.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),u&&e._videoTrack._updateRtpTransceiver(u),this.bindRemoteTrackEvents(e,e._videoTrack)),k("ENABLE_VIDEO_SEI")&&u&&(t==_e.VIDEO?await async function(m){let S=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Ke().supportWebRTCEncodedTransform)return void R.warning("browser not support video encoded transform");if(!m.track)return;if(Ju.has(m)){let y=Ju.get(m);return void(y&&(y.onSei=S.onSei))}let C={track:m.track,onSei:S.onSei};if(Co()){if(!m.createEncodedStreams)return void R.warning("browser not support createEncodedStreams() API");let y=null;try{y=m.createEncodedStreams()}catch(O){return void R.error("create video-encoded-streams error",O&&O.message)}let I=new TransformStream({transform(O,P){C.controller||(C.controller=P),m.track&&m.track.id!==C.track.id&&(R.debug("video track changed: ".concat(C.track.id," => ").concat(m.track.id)),C.track.removeEventListener("ended",v),C.track=m.track,C.track.addEventListener("ended",v));let U=function(x){let G=new DataView(x.data),Z=0;for(;Z+4<x.data.byteLength;){if(G.getUint8(Z+0)===0&&G.getUint8(Z+1)===0&&G.getUint8(Z+2)===0&&G.getUint8(Z+3)===1&&G.getUint8(Z+4)===6){let J=Z+6,q=0,ie=0;for(;(ie=G.getUint8(J++))===255;)q+=255;q+=ie;let Ie=_J(x.data,J,q);return new Uint8Array(Ie)}Z++}return null}(O);U&&C.onSei&&C.onSei(U),P.enqueue(O)}});y.readable.pipeThrough(I).pipeTo(y.writable)}else if(Li()){if(typeof RTCRtpScriptTransform>"u")return void R.warning("browser not support RTCRtpScriptTransform");let y=K_(),I=new MessageChannel;await new ae(P=>y.onmessage=U=>{U.data==="registered"&&P(void 0)});let O=new RTCRtpScriptTransform(y,{name:"rx",port:I.port2},[I.port2]);m.transform=O,await new ae(P=>y.onmessage=U=>{U.data==="started"&&P(void 0)}),I.port1.onmessage=P=>{var U;P.data.transformed&&m.track&&((U=m.track)===null||U===void 0?void 0:U.id)!==C.track.id?(R.debug("video track changed: ".concat(C.track.id," => ").concat(m.track.id)),C.track.removeEventListener("ended",v),C.track=m.track,C.track.addEventListener("ended",v)):P.data.sei&&C.onSei&&C.onSei(P.data.sei)},C.worker=y}function v(){if(m.track){if(this.id!==m.track.id)return;m.track.removeEventListener("ended",v)}(function(y){let I=Ju.get(y);if(I){Ju.delete(y);try{var O,P;(O=I.controller)===null||O===void 0||O.terminate(),(P=I.worker)===null||P===void 0||P.terminate()}catch(U){R.warning(U&&U.message)}}})(m)}Ju.set(m,C),m.track.addEventListener("ended",v)}(u.receiver,{onSei:m=>{var S;(S=e._videoTrack)===null||S===void 0||S._onSei(m)}}):t==_e.AUDIO&&await async function(m){if(!Ke().supportWebRTCEncodedTransform)return void R.warning("browser not support audio encoded transform");if(o_.has(m))return;let S={track:m.track};if(Co()){if(!m.createEncodedStreams)return void R.warning("browser not support createEncodedStreams() API");let v=null;try{v=m.createEncodedStreams()}catch(I){return void R.error("create audio-encoded-streams error",I&&I.message)}let y=new TransformStream({transform(I,O){S.controller||(S.controller=O),m.track&&m.track.id!==S.track.id&&(R.debug("audio track changed: ".concat(S.track.id," => ").concat(m.track.id)),S.track.removeEventListener("ended",C),S.track=m.track,S.track.addEventListener("ended",C)),O.enqueue(I)}});v.readable.pipeThrough(y).pipeTo(v.writable)}else if(Li()){if(typeof RTCRtpScriptTransform>"u")return void R.warning("browser not support RTCRtpScriptTransform");let v=K_(),y=new MessageChannel;await new ae(O=>v.onmessage=P=>{P.data==="registered"&&O(void 0)});let I=new RTCRtpScriptTransform(v,{name:"rx",port:y.port2},[y.port2]);m.transform=I,await new ae(O=>v.onmessage=P=>{P.data==="started"&&O(void 0)}),y.port1.onmessage=O=>{var P;O.data.transformed&&m.track&&((P=m.track)===null||P===void 0?void 0:P.id)!==S.track.id&&(R.debug("audio track changed: ".concat(S.track.id," => ").concat(m.track.id)),S.track.removeEventListener("ended",C),S.track=m.track,S.track.addEventListener("ended",C))},S.worker=v}function C(){m.track.removeEventListener("ended",C),function(v){let y=o_.get(v);if(y){o_.delete(v);try{var I,O;(I=y.controller)===null||I===void 0||I.terminate(),(O=y.worker)===null||O===void 0||O.terminate()}catch(P){R.warning(P&&P.message)}}}(m)}o_.set(m,S),m.track.addEventListener("ended",C)}(u.receiver));let p=this.remoteUserMap.get(e);p?p.set(t,l):this.remoteUserMap.set(e,new Map([[t,l]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats();let _=this.pendingRemoteTracks.findIndex(m=>{let{user:S,kind:C}=m;return S.uid===e.uid&&t===C});_!==-1&&(this.pendingRemoteTracks.splice(_,1),this.emit(Te.MediaReconnectEnd,e.uid))}async massSubscribe(e){return this.massSubscribeNoLock(e)}async massSubscribeNoLock(e){if(!this.connection||this.state!==Je.Connected)throw new H(A.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");e=e.filter(a=>{var s;let{user:c,mediaType:l}=a;return!((s=this.remoteUserMap.get(c))!==null&&s!==void 0&&s.has(l))});let t=[],i=new Map;e.forEach(a=>{if(!this.connection)return;let s=this.connection.getPreMedia(a.ssrcId);s?i.set(a.ssrcId,s):t.push(a)});let r=await this.connection.batchReceive(t.map(a=>{let{user:s,mediaType:c,ssrcId:l,rtxSsrcId:u}=a;return{kind:c,ssrcMsg:[{ssrcId:l,rtx:u}],mslabel:String(s._uintid)}}));t.forEach((a,s)=>{i.set(a.ssrcId,r[s])}),e.forEach(a=>{let{user:s,mediaType:c,ssrcId:l}=a,u=i.get(l);if(!u)return void R.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] cannot find ").concat(s.uid," subscribe data,").concat(c,", ").concat(l));let{track:h,id:p,transceiver:_}=u;c===_e.AUDIO?(s._audioTrack?s._audioTrack._updateOriginMediaStreamTrack(h):(s._audioTrack=new ld(h,s.uid,s._uintid,this.store),R.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(s._audioTrack.getTrackId()))),_&&s._audioTrack._updateRtpTransceiver(_),this.bindRemoteTrackEvents(s,s._audioTrack)):(s._videoTrack?s._videoTrack._updateOriginMediaStreamTrack(h):(s._videoTrack=new cd(h,s.uid,s._uintid,this.store),R.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(s._videoTrack.getTrackId()))),_&&s._videoTrack._updateRtpTransceiver(_),this.bindRemoteTrackEvents(s,s._videoTrack));let m=this.remoteUserMap.get(s);m?m.set(c,p):this.remoteUserMap.set(s,new Map([[c,p]])),this.statsCollector.addRemoteStats(s.uid),this.statsUploader.startUploadInboundStats();let S=this.pendingRemoteTracks.findIndex(C=>{let{user:v,kind:y}=C;return v.uid===s.uid&&c===y});S!==-1&&(this.pendingRemoteTracks.splice(S,1),this.emit(Te.MediaReconnectEnd,s.uid))})}async unsubscribe(e,t,i){let r=this.pendingRemoteTracks.filter(c=>{let{user:l,kind:u}=c;return t!==void 0?l.uid===e.uid&&t===u:l.uid===e.uid});if(r.forEach(c=>{let l=this.pendingRemoteTracks.indexOf(c);this.pendingRemoteTracks.splice(l,1)}),this.connection&&this.state===Je.Connected||i||r.forEach(c=>{let{kind:l}=c;var u;if(l===_e.AUDIO)(u=e._audioTrack)===null||u===void 0||u._destroy(),e._audioTrack=void 0;else if(l===_e.VIDEO){var h;(h=e._videoTrack)===null||h===void 0||h._destroy(),e._videoTrack=void 0}}),!this.connection||this.state!==Je.Connected)return;let a=this.filterTobeUnSubscribedTracks(e,t);if(a.length===0)return;await this.connection.stopReceiving(a.map(c=>{let[,{id:l}]=c;return l}));let s=this.createUnsubscribeMessage(a);return this.withdrawRemoteTracks(a),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),a.forEach(c=>{let[l,{kind:u}]=c;var h,p;if(u===_e.VIDEO&&l._videoSSRC&&((h=this.connection)===null||h===void 0||h.setStatsRemoteVideoIsReady(l._videoSSRC,!1)),u===_e.VIDEO)this.unbindRemoteTrackEvents(l._videoTrack),i||((p=l._videoTrack)===null||p===void 0||p._destroy(),l._videoTrack=void 0);else if(u===_e.AUDIO){var _;this.unbindRemoteTrackEvents(l._audioTrack),!i&&((_=l._audioTrack)===null||_===void 0||_._destroy(),l._audioTrack=void 0)}}),s}async unsubscribeDataChannel(e,t){if(t.forEach(a=>{let s=this.pendingRemoteDataChannels.findIndex(c=>c.id===a.id);s!==-1&&this.pendingRemoteDataChannels.splice(s,1)}),!this.connection)return;let i=this.filterTobeUnSubscribedDataChannels(e,t);if(i.length===0)return;t.forEach(a=>{a._close()});let r=this.remoteDataChannelMap.get(e);return i.forEach(a=>{r&&r.delete(a.id)}),r&&r.size===0&&(this.remoteDataChannelMap.delete(e),await this.connection.stopDataChannels(e.uid)),i.map(a=>a.id)}async massUnsubscribe(e){return this.massUnsubscribeNoLock(e)}async massUnsubscribeNoLock(e){let t=[];for(let{user:a,mediaType:s}of e){let c=this.pendingRemoteTracks.filter(l=>{let{user:u,kind:h}=l;return s!==void 0?u.uid===a.uid&&s===h:u.uid===a.uid});c.forEach(l=>{let u=this.pendingRemoteTracks.indexOf(l);this.pendingRemoteTracks.splice(u,1)}),t=t.concat(c)}if(!this.connection||this.state!==Je.Connected)return void t.forEach(a=>{let{user:s,kind:c}=a;var l;if(c===_e.AUDIO)(l=s._audioTrack)===null||l===void 0||l._destroy(),s._audioTrack=void 0;else if(c===_e.VIDEO){var u;(u=s._videoTrack)===null||u===void 0||u._destroy(),s._videoTrack=void 0}});let i=Sn(e).call(e,(a,s)=>{let{user:c,mediaType:l}=s,u=this.filterTobeUnSubscribedTracks(c,l);return a.concat(u)},[]);if(i.length===0)return;await this.connection.stopReceiving(i.map(a=>{let[,{id:s}]=a;return s}));let r=this.createUnsubscribeAllMessage(i);return this.withdrawRemoteTracks(i),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),i.forEach(a=>{let[s,{kind:c}]=a;var l,u;if(c===_e.VIDEO&&s._videoSSRC&&((l=this.connection)===null||l===void 0||l.setStatsRemoteVideoIsReady(s._videoSSRC,!1)),c===_e.VIDEO)this.unbindRemoteTrackEvents(s._videoTrack),(u=s._videoTrack)===null||u===void 0||u._destroy(),s._videoTrack=void 0;else if(c===_e.AUDIO){var h;this.unbindRemoteTrackEvents(s._audioTrack),(h=s._audioTrack)===null||h===void 0||h._destroy(),s._audioTrack=void 0}}),r}isPreSubScribe(e){return!this.connection||this.state!==Je.Connected?!1:!!this.connection.getPreMedia(e)}async muteRemote(e,t){if(!this.connection)return;let i=this.remoteUserMap.get(e);if(!i)return void R.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid,"."));if(!i.get(t))return void R.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));let r=t===_e.VIDEO?e._videoSSRC:e._audioSSRC;r!==void 0&&this.connection.setStatsRemoteVideoIsReady(r,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.connection)return;let i=this.remoteUserMap.get(e);if(!i)return void R.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid,"."));i.get(t)||R.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."))}getAllTracks(e){let t=this.localTrackMap.get(Q.LocalAudioTrack);if((t==null?void 0:t.track)instanceof hi){let i=t.track;return Array.from(this.localTrackMap.entries()).filter(r=>{let[a]=r;return a!==Q.LocalAudioTrack}).filter(r=>{let[a]=r;return!(e&&a===Q.LocalVideoLowTrack)}).map(r=>{let[,{track:a}]=r;return a}).concat(i.trackList)}return Array.from(this.localTrackMap.entries()).filter(i=>{let[r]=i;return!(e&&r===Q.LocalVideoLowTrack)}).map(i=>{let[,{track:r}]=i;return r})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(e,t,i,r,a){if(e){let c=this.localTrackMap.get(Q.LocalAudioTrack),l=r?this.localTrackMap.get(Q.LocalVideoLowTrack):this.localTrackMap.get(Q.LocalVideoTrack);fe.publish(this.store.sessionId,{eventElapse:ji.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:c==null?void 0:c.track.getTrackLabel(),videoName:l==null?void 0:l.track.getTrackLabel(),screenshare:(l==null?void 0:l.track._hints.indexOf(Rt.SCREEN_TRACK))!==-1,audio:!!c,video:!!l,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:a})}else{var s;i||(i=[]);let c=i.find(u=>u instanceof xt),l=r?(s=this.localTrackMap.get(Q.LocalVideoTrack))===null||s===void 0?void 0:s.track:i.find(u=>u instanceof St);fe.publish(this.store.sessionId,{eventElapse:ji.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:c==null?void 0:c.getTrackLabel(),videoName:l==null?void 0:l.getTrackLabel(),screenshare:(l==null?void 0:l._hints.indexOf(Rt.SCREEN_TRACK))!==-1,audio:!!c,video:!!l,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:a})}}reportSubscribeEvent(e,t,i,r){let a=r===_e.VIDEO?i._videoSSRC:i._audioSSRC;a&&fe.subscribe(this.store.sessionId,{succ:e,ec:t,video:r===_e.VIDEO,audio:r===_e.AUDIO,peerid:i.uid,subscribeRequestid:a,p2pid:this.store.p2pId,eventElapse:ji.measureFromSubscribeStart(this.store.clientId,a),preSsrc:this.isPreSubScribe(a)})}reset(){R.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new Fi("P2PChannel-mutex"),this.connection&&(this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=this.isPlanB?new Qu({},this.store):new un({},this.store),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();let e=this.localTrackMap.get(Q.LocalAudioTrack);if((e==null?void 0:e.track)instanceof hi){if(e.track.trackList.length>0){let t=e.track;e.track.trackList.forEach(i=>{t.removeAudioTrack(i)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=Je.Disconnected}getStats(){var e;return(e=this.connection)===null||e===void 0?void 0:e.getStats()}getRemoteVideoIsReady(e){var t;return((t=this.connection)===null||t===void 0?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){let e=this.localTrackMap.get(Q.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){let e=this.localTrackMap.get(Q.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){let t=this.localTrackMap.get(e);return t&&t.track instanceof St||t&&t.track instanceof xt?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;let i=this.remoteUserMap.get(e);return!!i&&(!t||i.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;let i=this.remoteUserMap.get(e);return!!i&&(!t||i.has(t))}getRemoteMedia(e){var t;let i=Array.from(Xr(t=this.remoteUserMap).call(t)).find(r=>r.uid===e);return i?{audioTrack:i.audioTrack,audioSSRC:i._audioSSRC,videoTrack:i.videoTrack,videoSSRC:i._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(i=>{let[r]=i;return{uid:r.uid,level:r.audioTrack?100*r.audioTrack._source.getAccurateVolumeLevel():0}}),t=this.localTrackMap.get(Q.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=cp(e).call(e,(i,r)=>i.level-r.level),e}async disconnectForReconnect(){this.connection&&(R.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=Je.Reconnecting,k("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t]=e;var i;t._videoTrack&&t._videoTrack._player&&((i=t._videoTrack._player.getVideoElement())===null||i===void 0||i.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())}),this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=this.isPlanB?new Qu({},this.store):new un({},this.store),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var t;let[i,{track:r}]=e;switch(i){case Q.LocalVideoTrack:oe(t=r._hints).call(t,Rt.LOW_STREAM)?r.close():this.pendingLocalTracks.push(r);break;case Q.LocalAudioTrack:r instanceof hi?this.pendingLocalTracks=this.pendingLocalTracks.concat(r.trackList):this.pendingLocalTracks.push(r);case Q.LocalVideoLowTrack:}}),this.emit(Te.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,i]=e;Array.from(Xr(i).call(i)).forEach(r=>{this.setPendingRemoteMedia(t,r)}),this.emit(Te.MediaReconnectStart,t.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.localDataChannels.length!==0&&(this.localDataChannels.forEach(e=>{this.pendingLocalDataChannels.push(e)}),this.localDataChannels.length=0),this.remoteDataChannelMap.size!==0&&(Array.from(this.remoteDataChannelMap.entries()).forEach(e=>{let[t,i]=e;Array.from(Xr(i).call(i)).forEach(r=>{this.setPendingRemoteDataChannel(t,r)})}),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),R.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(e,t){for(let i of this.pendingRemoteDataChannels){let{user:r,id:a}=i;if((e instanceof Eo?e.uid:e)===r.uid&&a===t)return!0}return!1}setPendingRemoteDataChannel(e,t){this.hasPendingRemoteDataChannel(e,t)||this.pendingRemoteDataChannels.push({user:e,id:t})}hasPendingRemoteMedia(e,t){for(let i of this.pendingRemoteTracks){let{user:r,kind:a}=i;if((e instanceof Eo?e.uid:e)===r.uid&&t===a)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}restartICE(e){var t=this;return gn(function*(){if(!t.connection||t.state!==Je.Connected)return;let i=yield Ye(t.mutex.lock("From P2PChannel.restartICE")),r;try{r=yield Ye(t.connection.restartICE(e));let s=yield Ye(r.next());if(s.done)return;let c=s.value,l=yield c;switch(t.reportPCDisconnectedOrFailed(e),e){case Vr.TCP:t._pcStatsUploadType=Es.TCP_RESTART;break;case Vr.RELAY:t._pcStatsUploadType=Es.RELAY_RESTART;break;default:t._pcStatsUploadType=Es.OLD_RESTART}t._isInRestartIce=!0,r.next(l)}catch(s){var a;(a=r)===null||a===void 0||a.throw(s)}finally{i()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;let e=this.connection.getStats(),t=this.localTrackMap.get(Q.LocalVideoTrack),i=this.localTrackMap.get(Q.LocalAudioTrack),r=e.videoSend.find(S=>S.ssrc===(t==null?void 0:t.ssrcs[0].ssrcId)),a=e.audioSend.find(S=>S.ssrc===(i==null?void 0:i.ssrcs[0].ssrcId));if(!r||!a)return 1;let s=ga(this,Te.NeedSignalRTT),c=r?r.rttMs:void 0,l=a?a.rttMs:void 0,u=c&&l?(c+l)/2:c||l,h=(u&&s?(u+s)/2:u||s)||0,p=100*e.sendPacketLossRate*.7/50+.3*h/1500,_=p<.17?1:p<.36?2:p<.59?3:p<.1?4:5,m=t==null?void 0:t.track;if(m&&m._encoderConfig&&m._hints.indexOf(Rt.SCREEN_TRACK)===-1){let S=m._encoderConfig.bitrateMax,C=e.bitrate.actualEncoded;if(S&&C){let v=(1e3*S-C)/(1e3*S);return nV[v<.15?0:v<.3?1:v<.45?2:v<.6?3:4][_]}}return _}getDownlinkNetworkQuality(){if(!this.connection)return 0;let e=this.connection.getStats(),t=0;return Array.from(this.remoteUserMap.entries()).forEach(i=>{let[r]=i,a=r._audioSSRC,s=r._videoSSRC,c=e.audioRecv.find(C=>C.ssrc===a),l=e.videoRecv.find(C=>C.ssrc===s);if(!c&&!l)return void(t+=1);let u=ga(this,Te.NeedSignalRTT),h=e.rtt,p=(h&&u?(h+u)/2:h||u)||0,_=c?c.jitterMs:void 0,m=e.recvPacketLossRate,S=.7*m*100/50+.3*p/1500;_&&(S=.6*m*100/50+.2*p/1500+.2*_/400),t+=S<.1?1:S<.17?2:S<.36?3:S<.59?4:5}),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new ae((t,i)=>{this.handleMuteLocalTrack(e,t,i)})}async replaceTrack(e,t){var i;if(R.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(e.getTrackId(),"] to [").concat(t.getTrackId(),"]")),!this.connection||this.state!==Je.Connected)return;let r=Array.from(this.localTrackMap.entries()).find(s=>{let[,{track:c}]=s;return e===c});if(!r)return;let a=r[0];if(e!==t&&(this.unbindLocalTrackEvents([{track:e,type:a}]),this.bindLocalTrackEvents([{track:t,type:a}]),r[1].track=t),await((i=this.connection)===null||i===void 0?void 0:i.replaceTrack(t,r[1].id)),this.isPlanB){let s=r[1];s.id=t._mediaStreamTrack.id,this.localTrackMap.set(a,s)}if(a===Q.LocalVideoTrack&&!k("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ke().supportDualStreamEncoding){let s=this.localTrackMap.get(Q.LocalVideoLowTrack);if(s){let c=e._mediaStreamTrack.clone();s.track._originMediaStreamTrack.stop(),s.track._mediaStreamTrack=c,s.track._originMediaStreamTrack=c,await new ae((l,u)=>{this.handleReplaceTrack(s.track,l,u,!0)})}}}filterTobePublishedTracks(e,t,i){let r=[],a=this.getAllTracks();e=Zl(e=e.filter(u=>a.indexOf(u)===-1));let s,c=!1,l=this.localTrackMap.get(Q.LocalAudioTrack);for(let u of e){if(u instanceof St&&(this.localTrackMap.has(Q.LocalVideoTrack)||c?new H(A.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(r.push({track:u,type:Q.LocalVideoTrack}),c=!0),t)){let h=this.getLowVideoTrack(u,i);r.push({track:h,type:Q.LocalVideoLowTrack})}if(u instanceof xt)if(l){let h=l.track;if(h instanceof hi)$v([u]),h.addAudioTrack(u),this.bindLocalAudioTrackEvents(u,!0);else{let p=RR([h,u]);R.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(p.getTrackId(),"]")),this.replaceTrack(h,p)}}else s instanceof hi?($v([u]),s.addAudioTrack(u)):s||!u._useAudioElement&&Ke().webAudioMediaStreamDest&&!u._bypassWebAudio?s=RR(s?[u,s]:[u]):s=u}return s&&(R.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(s.getTrackId(),"]")),r.push({track:s,type:Q.LocalAudioTrack})),r}filterTobeUnpublishedTracks(e){let t=[],i=this.getAllTracks();e=Zl(e=e.filter(r=>i.indexOf(r)!==-1));for(let r of e){if(r instanceof xt){let a=this.localTrackMap.get(Q.LocalAudioTrack);if(!a)continue;a.track instanceof hi?(a.track.removeAudioTrack(r),this.unbindLocalAudioTrackEvents(r),a.track.trackList.length===0&&(t.push([Q.LocalAudioTrack,a]),a.track.close())):t.push([Q.LocalAudioTrack,a])}if(r instanceof St){let a=this.localTrackMap.get(Q.LocalVideoTrack);if(!a)continue;t.push([Q.LocalVideoTrack,a]);let s=this.localTrackMap.get(Q.LocalVideoLowTrack);s&&t.push([Q.LocalVideoLowTrack,s])}}return t}filterTobePublishedDataChannels(e){return e=(e=Zl(e)).filter(t=>this.localDataChannels.findIndex(i=>i.id===t.id)===-1)}filterTobeUnpublishedDataChannels(e){return e=(e=(e=Zl(e)).filter(t=>this.localDataChannels.indexOf(t)!==-1)).filter(t=>t._originDataChannel)}bindLocalTrackEvents(e){e.forEach(t=>{let{track:i,type:r}=t;switch(r){case Q.LocalVideoTrack:i.addListener(ce.GET_STATS,this.handleGetLocalVideoStats),i.addListener(ce.GET_RTC_STATS,this.handleGetRTCStats),i.addListener(ce.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(ce.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(ce.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),i.addListener(ce.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),i.addListener(ce.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.addListener(ce.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(ce.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Q.LocalAudioTrack:this.bindLocalAudioTrackEvents(i);case Q.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,t){e instanceof hi?e.trackList.forEach(i=>{i.addListener(ce.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(ce.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(ce.GET_STATS,this.handleGetLocalAudioStats),i.addListener(ce.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(ce.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(ce.GET_STATS,this.handleGetLocalAudioStats),e.addListener(ce.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(ce.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(ce.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(ce.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||(e.addListener(ce.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.addListener(ce.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(t=>{let[i,{track:r}]=t;return{track:r,type:i}})),e.forEach(t=>{let{track:i,type:r}=t;switch(r){case Q.LocalVideoTrack:i.off(ce.GET_STATS,this.handleGetLocalVideoStats),i.off(ce.GET_RTC_STATS,this.handleGetRTCStats),i.off(ce.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.off(ce.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.off(ce.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),i.off(ce.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),i.off(ce.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.off(ce.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.off(ce.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Q.LocalAudioTrack:this.unbindLocalAudioTrackEvents(i);case Q.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof hi?e.trackList.forEach(t=>{t.off(ce.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(ce.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(ce.GET_STATS,this.handleGetLocalAudioStats),t.off(ce.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(ce.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(ce.GET_STATS,this.handleGetLocalAudioStats),e.off(ce.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(ce.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(ce.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(ce.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),e.off(ce.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(ce.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof cd&&t.addListener(ce.GET_STATS,i=>{i(this.handleGetRemoteVideoStats(e))}),t instanceof ld&&t.addListener(ce.GET_STATS,i=>{i(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(ce.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,i]=e;i.has(_e.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),i.has(_e.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)})}createGatewayPublishMessage(e,t){return e.map((i,r)=>{var a;let s,c,{track:l,type:u}=i;switch(u){case Q.LocalAudioTrack:s=Qe.Audio,c={dtx:l instanceof EE&&l._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case Q.LocalVideoTrack:s=oe(a=l._hints).call(a,Rt.SCREEN_TRACK)?Qe.Screen:Qe.High,c=Mn(Mn({},pD(l)),{},{codec:this.store.codec,svc_mode:Yv()});break;case Q.LocalVideoLowTrack:s=Qe.Low,c=Mn(Mn({},pD(l)),{},{codec:this.store.codec,svc_mode:Yv()})}return{stream_type:s,attributes:c,ssrcs:t[r]}})}createGatewayUnpublishMessage(e){return e.map(t=>{var i;let r,[a,{track:s,ssrcs:c,id:l}]=t;switch(a){case Q.LocalVideoTrack:r=oe(i=s._hints).call(i,Rt.SCREEN_TRACK)?Qe.Screen:Qe.High;break;case Q.LocalAudioTrack:r=Qe.Audio;break;case Q.LocalVideoLowTrack:r=Qe.Low}return{stream_type:r,ssrcs:c,mid:l}})}assignLocalTracks(e,t){e.forEach((i,r)=>{let{track:a,type:s}=i;this.localTrackMap.set(s,{track:a,id:t[r].id,ssrcs:t[r].localSSRC})})}withdrawLocalTracks(e){e.forEach(t=>{let[i]=t;this.localTrackMap.delete(i)})}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{if(R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(t,")")),this.emit(Te.PeerConnectionStateChange,t),t!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),t==="connected"&&(this._restartTimer&&(clearTimeout(this._restartTimer),this._restartTimer=void 0),(this._isFirstConnected||this._isInRestartIce)&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isInRestartIce=!1,this._isFirstConnected=!1,this._isStartRestartIce=!1),k("NEW_ICE_RESTART")){var i;if(oe(i=this._restartStates).call(i,t)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;let r=c=>{(e.iceConnectionState==="disconnected"||e.iceConnectionState==="checking"||e.iceConnectionState==="failed")&&(R.debug("[".concat(this.store.clientId,"] [P2PChannel] start use restartICE, type is ").concat(c)),ga(this,Te.QueryClientConnectionState)==="CONNECTED"&&this.emit(Te.RequestRestartICE,c))},a=()=>{e.iceConnectionState!=="disconnected"&&e.iceConnectionState!=="checking"&&e.iceConnectionState!=="failed"||(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),R.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>this.emit(Te.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},s=k("ICE_RESTART_INTERVAL");return void(this._restartTimer=window.setTimeout(()=>{if(k("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&Ke().supportPCSetConfiguration)r(Vr.RELAY),this._restartTimer=window.setTimeout(a,s);else if(Bt())r(Vr.UDP),this._restartTimer=window.setTimeout(a,4e3);else{if(r(Vr.TCP),Ke().supportPCSetConfiguration)return void(this._restartTimer=window.setTimeout(()=>{r(Vr.RELAY),this._restartTimer=window.setTimeout(a,s)},s));this._restartTimer=window.setTimeout(a,s)}},800))}}else{if(t==="disconnected"&&e.iceConnectionState==="disconnected")return setTimeout(()=>{e.iceConnectionState==="disconnected"&&k("ICE_RESTART")&&ga(this,Te.QueryClientConnectionState)==="CONNECTED"&&this.emit(Te.RequestRestartICE)},800),void setTimeout(()=>{e.peerConnectionState==="disconnected"&&(R.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isInRestartIce=!1,setTimeout(()=>this.emit(Te.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);t==="failed"&&(R.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCDisconnectedOrFailed(),setTimeout(()=>this.emit(Te.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())}},e.onICEConnectionStateChange=t=>{t!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(t,")")),fe.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:t,tag:Vt.TRACER}).onSuccess(),this.emit(Te.IceConnectionStateChange,t)},e.onICETransportStateChange=t=>{R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(t,")"))},e.onDTLSTransportStateChange=t=>{R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(t,")"))},e.onDTLSTransportError=t=>{R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(t,")"))},e.onFirstAudioDecoded=t=>{var i;let r=Array.from(Xr(i=this.remoteUserMap).call(i)).find(s=>s._audioSSRC===t);var a;r&&(this.store.subscribe(r.uid,"audio",void 0,void 0,void 0,Date.now()),(a=r.audioTrack)===null||a===void 0||a.emit(od.FIRST_FRAME_DECODED),fe.firstRemoteFrame(this.store.sessionId,Si.FIRST_AUDIO_DECODE,Pt.FIRST_AUDIO_DECODE,{peer:r._uintid,subscribeElapse:ji.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=t=>{var i;let r=Array.from(Xr(i=this.remoteUserMap).call(i)).find(a=>a._audioSSRC===t);r&&fe.firstRemoteFrame(this.store.sessionId,Si.FIRST_AUDIO_RECEIVED,Pt.FIRST_AUDIO_RECEIVED,{peer:r._uintid,subscribeElapse:ji.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(t,i,r)=>{this.reportVideoFirstFrameDecoded(t,i,r)},e.onFirstVideoReceived=t=>{var i;let r=Array.from(Xr(i=this.remoteUserMap).call(i)).find(a=>a._videoSSRC===t);r&&fe.firstRemoteFrame(this.store.sessionId,Si.FIRST_VIDEO_RECEIVED,Pt.FIRST_VIDEO_RECEIVED,{peer:r._uintid,subscribeElapse:ji.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(t,i)=>{let r=t.candidateType==="relay",a=i.candidateType==="relay";i.candidateType!=="unknown"&&r===a||this.emit(Te.ConnectionTypeChange,r),R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Ro(i))," -> ").concat(JSON.stringify(Ro(t)),")"))},e.onSelectedRemoteCandidateChanged=(t,i)=>{R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Ro(i))," -> ").concat(JSON.stringify(Ro(t)),")"))},e.onFirstVideoDecodedTimeout=t=>{this.reportVideoFirstFrameDecoded(t,void 0,void 0,!0)},e.getLocalVideoStats=()=>{let t=this.statsCollector.getLocalVideoTrackStats(),i=this.statsCollector.getRTCStats();return Mn(Mn({},t),i)}}unbindConnectionEvents(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.getLocalVideoStats=void 0}filterTobeMutedTracks(e){let t=[];if(this.getAllTracks().indexOf(e)===-1)return t;let i=this.localTrackMap.get(Q.LocalAudioTrack);if(e instanceof xt&&(i==null?void 0:i.track)instanceof hi)return i.track.isActive||t.push([Q.LocalAudioTrack,i]),t;let r=Array.from(this.localTrackMap.entries()).find(a=>{let[,{track:s}]=a;return e===s});if(r&&(t.push(r),r[0]===Q.LocalVideoTrack)){let a=this.localTrackMap.get(Q.LocalVideoLowTrack);a&&t.push([Q.LocalVideoLowTrack,a])}return t}filterTobeUnmutedTracks(e){let t=[],i=this.localTrackMap.get(Q.LocalAudioTrack);if(e instanceof xt&&(i==null?void 0:i.track)instanceof hi)return i.track.isActive&&t.push([Q.LocalAudioTrack,i]),t;let r=Array.from(this.localTrackMap.entries()).find(a=>{let[,{track:s}]=a;return e===s});if(r)if(r[0]===Q.LocalVideoTrack){t.push(r);let a=this.localTrackMap.get(Q.LocalVideoLowTrack);a&&t.push([Q.LocalVideoLowTrack,a])}else t.push(r);return t}createMuteMessage(e){return e.map(t=>{var i;let r,[a,{track:s,ssrcs:c,id:l}]=t;switch(a){case Q.LocalAudioTrack:r=Qe.Audio;break;case Q.LocalVideoTrack:r=oe(i=s._hints).call(i,Rt.SCREEN_TRACK)?Qe.Screen:Qe.High;break;case Q.LocalVideoLowTrack:r=Qe.Low}return{stream_type:r,ssrcs:c,mid:l}})}createUnmuteMessage(e){return e.map(t=>{var i;let r,[a,{track:s,ssrcs:c,id:l}]=t;switch(a){case Q.LocalAudioTrack:r=Qe.Audio;break;case Q.LocalVideoTrack:r=oe(i=s._hints).call(i,Rt.SCREEN_TRACK)?Qe.Screen:Qe.High;break;case Q.LocalVideoLowTrack:r=Qe.Low}return{stream_type:r,ssrcs:c,mid:l}})}filterTobeUnSubscribedTracks(e,t){let i=[],r=this.remoteUserMap.get(e);if(!r)return i;if(t){let a=r.get(t);if(!a)return i;i.push([e,{kind:t,id:a}])}else Array.from(r.entries()).forEach(a=>{let[s,c]=a;i.push([e,{kind:s,id:c}])});return i}filterTobeUnSubscribedDataChannels(e,t){let i=[];return t.forEach(r=>{var a;(a=this.remoteDataChannelMap.get(e))!==null&&a!==void 0&&a.has(r.id)&&i.push(r)}),i}createUnsubscribeMessage(e){let t=[];return e.forEach(i=>{let[r,{kind:a,id:s}]=i;switch(a){case _e.VIDEO:return void(r._videoSSRC&&t.push({stream_type:_e.VIDEO,ssrcId:r._videoSSRC}));case _e.AUDIO:return void(r._audioSSRC&&t.push({stream_type:_e.AUDIO,ssrcId:r._audioSSRC}))}}),t}createUnsubscribeAllMessage(e){let t=new Map;return e.forEach(i=>{let[r,{kind:a}]=i;if(t.has(r)){let s=t.get(r);a===_e.VIDEO?s|=ui.Video:s|=ui.Audio,t.set(r,s)}else a===_e.VIDEO?t.set(r,ui.Video):t.set(r,ui.Audio)}),{users:Array.from(t.entries()).map(i=>{let[r,a]=i;return{stream_id:r.uid,stream_type:a}})}}withdrawRemoteTracks(e){e.forEach(t=>{let[i,{kind:r}]=t,a=this.remoteUserMap.get(i);a&&(a.delete(r),Array.from(a.entries()).length===0&&this.remoteUserMap.delete(i))})}async updateBitrateLimit(e){let t=this.localTrackMap.get(Q.LocalVideoTrack),i=this.localTrackMap.get(Q.LocalVideoLowTrack);t&&await t.track.setBitrateLimit(e.uplink),i&&e.low_stream_uplink&&await i.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0})}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}mapPubResToRemoteConfig(e,t){return e.map((i,r)=>{var a;let{stream_type:s}=i;return(a=t.find(c=>{let{stream_type:l}=c;return s===l}))===null||a===void 0?void 0:a.attributes})}async tryToUnmuteAudio(e){for(let i=0;i<e.length;i++)if(e[i]instanceof xt){var t;let r=this.filterTobeUnmutedTracks(e[i]);if(r.length===0)continue;await((t=this.connection)===null||t===void 0?void 0:t.unmuteLocal(r.map(s=>{let[,{id:c}]=s;return c})));let a=this.createUnmuteMessage(r);return void await lt(this,Te.RequestUnmuteLocal,a)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!((t=this.connection)===null||t===void 0||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(Te.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(Te.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await yi(Xy(this.dtlsFailedCount,ti)),this.emit(Te.RequestReconnect)}async reconnectP2P(){let e=Array.from(this.localTrackMap.entries()),t=this.createGatewayUnpublishMessage(e);Array.from(this.remoteUserMap.entries()),t.length>0&&await ki(this,Te.RequestUnpublishForReconnectPC,t),this.disconnectForReconnect(),this.emit(Te.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(Q.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof St)}throwIfTrackTypeNotMatch(e){if(e.filter(t=>t instanceof St).length>1)throw new H(A.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(t=>t instanceof xt).length>1&&(e.some(t=>t instanceof xt&&t._bypassWebAudio)||!Ke().webAudioMediaStreamDest))throw new H(A.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(let t of e){if(t instanceof St&&this.pendingLocalTracks.some(i=>i instanceof St))throw new H(A.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof xt&&this.pendingLocalTracks.some(i=>i instanceof xt)&&(!Ke().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some(i=>i instanceof xt&&i._bypassWebAudio)))throw new H(A.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){let i=!k("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ke().supportDualStreamEncoding,r=Mn(Mn({},{width:160,height:120,framerate:15,bitrate:50}),t),a;a=i?e._mediaStreamTrack.clone():Zv(e,r);let s=ft(8,"track-low-"),c=new St(a,Mn(Mn({},i&&{scaleResolutionDownBy:Vv(r,e)}),{},{frameRate:r.framerate,bitrateMax:r.bitrate,bitrateMin:r.bitrate}),void 0,void 0,s);return c.on(wc.TRANSCEIVER_UPDATED,l=>{e._updateRtpTransceiver(l,Td.LOW_STREAM)}),c._hints.push(Rt.LOW_STREAM),e.on("sei-to-send",l=>{c.emit("sei-to-send",l)}),e.addListener(ce.NEED_CLOSE,()=>{c.close()}),c}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(e,t,i){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof un){var a,s,c,l;let u=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:h,dtlsTransportState:p,peerConnectionState:_}=this.connection,{local:m,remote:S}=await this.connection.getSelectedCandidatePair();fe.pcStats(this.store.sessionId,{startTime:u,eventElapse:e-u||0,iceconnectionsate:h,dtlsstate:p,connectionstate:_,intSucc:t?1:2,error:r,selectedLocalCandidateProtocol:(a=m==null?void 0:m.protocol)!==null&&a!==void 0?a:"",selectedLocalCandidateType:(s=m.candidateType)!==null&&s!==void 0?s:"",selectedLocalCandidateAddress:"".concat(m.address,":").concat(m.port),selectedRemoteCandidateProtocol:(c=S.protocol)!==null&&c!==void 0?c:"",selectedRemoteCandidateType:(l=S.candidateType)!==null&&l!==void 0?l:"",selectedRemoteCandidateAddress:"".concat(S.address,":").concat(S.port),restartCnt:i,preallocation:this.connection.isPreallocation})}}reportVideoFirstFrameDecoded(e,t,i,r){var a;let s=Array.from(Xr(a=this.remoteUserMap).call(a)).find(c=>c._videoSSRC===e);if(s){r||this.store.subscribe(s.uid,"video",void 0,void 0,void 0,void 0,Date.now());let c=this.store.keyMetrics,l=c.subscribe.find(u=>u.userId===s.uid&&u.type==="video");fe.firstRemoteVideoDecode(this.store.sessionId,Si.FIRST_VIDEO_DECODE,Pt.FIRST_VIDEO_DECODE,{peer:s._uintid,videowidth:t,videoheight:i,subscribeElapse:ji.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:c.requestAPEnd||0,apStart:c.requestAPStart||0,joinGwEnd:c.joinGatewayEnd||0,joinGwStart:c.joinGatewayStart||0,pcEnd:c.peerConnectionEnd||0,pcStart:c.peerConnectionStart||0,subscriberEnd:(l==null?void 0:l.subscribeEnd)||0,subscriberStart:(l==null?void 0:l.subscribeStart)||0,videoAddNotify:(l==null?void 0:l.streamAdded)||0,state:r?1:0,firstFrame:(l==null?void 0:l.firstFrame)||0})}}async remoteMediaSsrcChanged(e,t,i){if(!this.connection)return!1;let r=this.remoteUserMap.get(e);if(!r)return!1;let a=r.get(t);if(!a)return!1;let s=await this.connection.getRemoteSSRC(a);return s!==void 0&&s!==i}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[t,{track:i}]=e;t===Q.LocalVideoLowTrack?i._updateRtpTransceiver(void 0,Td.LOW_STREAM):i._updateRtpTransceiver(void 0)})}reportPCDisconnectedOrFailed(e){this.connection&&this.connection instanceof un&&(this.connection.iceConnectionState!=="disconnected"&&this.connection.iceConnectionState!=="checking"&&this.connection.iceConnectionState!=="failed"||(this._isFirstConnected?(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isFirstConnected=!1):this._pcStatsUploadType===Es.TCP_RESTART&&e===Vr.RELAY?this.reportPCStats(Date.now(),!1,this._pcStatsUploadType):this.reportPCStats(Date.now(),!1,Es.DISCONNECTED_OR_FAILED)))}},de(Ne.prototype,"startP2PConnection",[$i],Object.getOwnPropertyDescriptor(Ne.prototype,"startP2PConnection"),Ne.prototype),de(Ne.prototype,"connect",[$i],Object.getOwnPropertyDescriptor(Ne.prototype,"connect"),Ne.prototype),de(Ne.prototype,"updateRemoteRTPCapabilities",[$i],Object.getOwnPropertyDescriptor(Ne.prototype,"updateRemoteRTPCapabilities"),Ne.prototype),de(Ne.prototype,"publishDataChannel",[$i],Object.getOwnPropertyDescriptor(Ne.prototype,"publishDataChannel"),Ne.prototype),de(Ne.prototype,"unpublish",[$i],Object.getOwnPropertyDescriptor(Ne.prototype,"unpublish"),Ne.prototype),de(Ne.prototype,"unpublishDataChannel",[$i],Object.getOwnPropertyDescriptor(Ne.prototype,"unpublishDataChannel"),Ne.prototype),de(Ne.prototype,"unpublishLowStream",[$i],Object.getOwnPropertyDescriptor(Ne.prototype,"unpublishLowStream"),Ne.prototype),de(Ne.prototype,"subscribeDataChannel",[$i],Object.getOwnPropertyDescriptor(Ne.prototype,"subscribeDataChannel"),Ne.prototype),de(Ne.prototype,"subscribe",[$i],Object.getOwnPropertyDescriptor(Ne.prototype,"subscribe"),Ne.prototype),de(Ne.prototype,"massSubscribe",[$i],Object.getOwnPropertyDescriptor(Ne.prototype,"massSubscribe"),Ne.prototype),de(Ne.prototype,"unsubscribe",[$i],Object.getOwnPropertyDescriptor(Ne.prototype,"unsubscribe"),Ne.prototype),de(Ne.prototype,"unsubscribeDataChannel",[$i],Object.getOwnPropertyDescriptor(Ne.prototype,"unsubscribeDataChannel"),Ne.prototype),de(Ne.prototype,"massUnsubscribe",[$i],Object.getOwnPropertyDescriptor(Ne.prototype,"massUnsubscribe"),Ne.prototype),de(Ne.prototype,"muteRemote",[$i],Object.getOwnPropertyDescriptor(Ne.prototype,"muteRemote"),Ne.prototype),de(Ne.prototype,"unmuteRemote",[$i],Object.getOwnPropertyDescriptor(Ne.prototype,"unmuteRemote"),Ne.prototype),de(Ne.prototype,"hasRemoteMediaWithLock",[$i],Object.getOwnPropertyDescriptor(Ne.prototype,"hasRemoteMediaWithLock"),Ne.prototype),de(Ne.prototype,"disconnectForReconnect",[$i],Object.getOwnPropertyDescriptor(Ne.prototype,"disconnectForReconnect"),Ne.prototype),de(Ne.prototype,"updateBitrateLimit",[$i],Object.getOwnPropertyDescriptor(Ne.prototype,"updateBitrateLimit"),Ne.prototype),de(Ne.prototype,"remoteMediaSsrcChanged",[$i],Object.getOwnPropertyDescriptor(Ne.prototype,"remoteMediaSsrcChanged"),Ne.prototype),Ne);function $i(e,t,i){let r=e[t];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){let a=this.mutex,s=await a.lock("From P2PChannel.".concat(t));try{for(var c=arguments.length,l=new Array(c),u=0;u<c;u++)l[u]=arguments[u];return await r.apply(this,l)}finally{s()}},i}var EB={};function $u(e){(!(arguments.length>1&&arguments[1]!==void 0)||arguments[1])&&R.debug("install service ".concat(e.name)),EB[e.name]=e}function uh(e){let t=EB[e];if(!t)throw new H(A.INVALID_OPERATION,"".concat(e," not found, please use AgoraRTC.use(").concat(e,"Service) to load it first"));return t}function gk(e,t){return uh("DataStream").create(e,t)}function Sk(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),i.push.apply(i,r)}return i}function Tk(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?Sk(Object(i),!0).forEach(function(r){b(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Sk(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}var QJ=Date.now(),ZJ=20,ty=new Map,X_=new Map;async function mB(e){let t=ty.get(e),i=Array.isArray(t)&&t[t.length-1],r=X_.get(e);if(!i)return void(r.isSyncing=!1);let a={uid:i.uid,payload:i.payload};r.firstRecvTs===0&&(r.firstRecvTs=i.recvTs,r.firstSendTs=i.sendTs);let s=i.sendTs-r.firstSendTs,c=s-(Date.now()-r.firstRecvTs);c>0&&(r.firstRecvTs=Date.now()-s);let l=i.mediaDelay+c;l<=0?(t.pop(),gB(i.context,a),l=0):l=Math.min(l,ZJ),setTimeout(()=>t.length&&mB(e),l)}function gB(e,t){e.safeEmit(Me.STREAM_MESSAGE,t.uid,t.payload),e.onStreamMessage&&e.onStreamMessage(t)}function $J(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,i=arguments.length>2?arguments[2]:void 0;if(!e.syncWithAudio)return gB(i,{uid:e.uid,payload:e.payload});let r="".concat(i.id,"-").concat(e.uid),a=ty.get(r)||[],s=a.findIndex(h=>e.sendTs>=h.sendTs),c=Tk(Tk({},e),{},{context:i,mediaDelay:t,recvTs:Date.now()});s===-1?a.push(c):a.splice(s,0,c),ty.set(r,a);let l=!1;var u;X_.has(r)?l=!((u=X_.get(r))===null||u===void 0||!u.isSyncing):X_.set(r,{isSyncing:l,firstRecvTs:0,firstSendTs:0}),l||mB(r)}var eQ=Ge().name;function Rk(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),i.push.apply(i,r)}return i}function vk(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?Rk(Object(i),!0).forEach(function(r){b(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Rk(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}var hd="websdk_ng_cache_parameter",tQ=k("MAX_PRELOAD_ASYNC_LENGTH"),iQ=1e4,gc=new Map,Sc=[],yR=null,CR=0,bR=0,E_=new Map,rQ=function(e,t){let i=[],r=0,a=async()=>{let s=i.shift();s&&await s(),i.length>0&&r<t?a():r--};return async function(){for(var s=arguments.length,c=new Array(s),l=0;l<s;l++)c[l]=arguments[l];return new ae(async(u,h)=>{i.push(async()=>{try{let p=await e(...c);u(p)}catch(p){h(p)}}),r<t&&(r++,a())})}}(SB,tQ),AR=yr.CancelToken.source();async function SB(e,t,i,r,a,s){try{if(!k("ENABLE_PRELOAD"))return;if(!Ke().supportWebCrypto)return void Do(()=>{R.warn("Your browser does not support preloading, this feature  be run in a secure environment")},"preload_webcrypto_not_supported");if(!i&&i!==null)throw new H(A.INVALID_PARAMS,"Invalid token: ".concat(i,". If you don not use token, set it to null"));i&&Ti(i,"token",1,2047),Ti(e,"appid",1,2047),$E(t),r&&em(r);let c=$l();R.debug("preload channel ".concat(t,", uid is ").concat(r));let l={appId:e,cname:t,token:i||e,uid:typeof r!="string"?r:null,sid:c,proxyServer:a},u,h;typeof r=="string"?(l.stringUid=r,[h,u]=await ae.all([yJ(r,{sid:c,appId:e},AR.token),IL(vk(vk({},l),{},{token:i||e,uid:0}),AR.token)]),l.uid=h.uid,u.gatewayInfo.uid=l.uid,u.gatewayInfo.res.uid=l.uid):(s&&(l.stringUid=s),u=await IL(l,AR.token));let p={sid:c,appId:e,cname:t,token:i||e,uid:l.stringUid||r,intUid:l.uid||u.gatewayInfo.uid,stringUid:l.stringUid,ts:Date.now(),sua:h,ap:u};await async function(_){let m;try{_.uid&&TB({appId:_.appId,cname:_.cname,token:_.token,uid:_.uid,stringUid:_.stringUid});let S=yB(_),C=await async function(y,I){try{let O=await window.crypto.subtle.importKey("raw",$x(I),"AES-GCM",!1,["encrypt"]),P=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:new Uint8Array(1)},O,vc(window.btoa(JSON.stringify(y))));return bo(new Uint8Array(P))}catch{return}}(_,_.token||_.appId);if(!C)return;m=vB(hd);let v=m?JSON.parse(m):[];v.push({[S]:C}),v.length>k("AP_CACHE_NUM")&&v.shift(),vE(hd,JSON.stringify(v))}catch(S){R.warn("Error caching server parameters:",S.message),vE(hd,"")}}(p),CR++}catch(c){throw bR++,function(l){yR||(yR=window.setTimeout(()=>{let h="";E_.forEach((p,_)=>{h+="".concat(_,": ").concat(p," ;")}),fe.reportApiInvoke(null,{name:ni.PRELOAD,options:{success:CR,failed:bR,err:h}}).onError(l),CR=0,bR=0,E_.clear(),yR=null},iQ));let u=E_.get(l.code)||0;E_.set(l.code,u+1)}(c),c}}async function yk(e){try{let t=TB(e);if(!t||e.cloudProxyServer!=="disabled")return;let i=await async function(r,a){try{let s=await window.crypto.subtle.importKey("raw",$x(a),"AES-GCM",!1,["decrypt"]),c=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(1)},s,vc(r));return JSON.parse(window.atob(bo(new Uint8Array(c))))}catch{return}}(t,e.token||e.appId);if(!i||!function(r,a){return r.cname===a.cname&&r.appId===a.appId&&r.token===a.token?a.stringUid?r.stringUid===a.stringUid:typeof a.uid=="number"?r.uid===a.uid:r.uid==a.uid:!1}(i,e))return;if(i&&Date.now()-i.ts<k("AP_CACHE_LIFETIME"))return i}catch(t){R.warn("Error get preloadInfo",t.message)}}function TB(e){let t;try{if(t=vB(hd),!t)return;let i=JSON.parse(t),r=yB(e),a=function(c,l){for(let u=c.length-1;u>=0;u--)if(l(c[u]))return u;return-1}(i,c=>r in c);if(a===-1)return;let s=i.splice(a,1)[0];return vE(hd,JSON.stringify(i)),s[r]}catch(i){R.warn("Error delete preload info: ".concat(t),i.message),vE(hd,"")}}function gC(e){if(e){let t=gc.get(e);t&&(window.clearTimeout(t),t=null,gc.delete(e)),oe(Sc).call(Sc,e)||e.cloudProxyServer!=="disabled"||Sc.push(e)}if(gc.size<k("AP_CACHE_NUM")&&Sc.length>0){let t=Sc.shift();gc.set(t,window.setTimeout(async()=>{let{appId:i,cname:r,token:a,stringUid:s,uid:c,proxyServer:l}=t;try{await rQ(i,r,a,c,l,s),gc.has(t)&&gC(t)}catch(u){R.warn("update preload failed",u.message),RB(t)}},k("AP_UPDATE_INTERVAL")))}}function RB(e){let t=Sc.indexOf(e);t!==-1&&Sc.splice(t,1);let i=gc.get(e);i&&(window.clearTimeout(i),i=null,gc.delete(e),gC())}function Ck(e,t){let i=e.sua,r=e.ap;t&&i&&fe.reqUserAccount(e.sid,{lts:i.requestTime,elapse:i.elapse,success:!0,serverAddr:i.url,stringUid:t,uid:e.intUid,errorCode:null,extend:i.req}),fe.reportResourceTiming(e.ap.url,e.sid),fe.joinWebProxyAP(e.sid,{lts:r.requestTime,elapse:r.elapse,sucess:1,apServerAddr:r.url,turnServerAddrList:r.proxyInfo.addresses.map(a=>a.ip).join(","),eventType:"disabled",unilbsServerIds:[Jt.CHOOSE_SERVER,Jt.CLOUD_PROXY_FALLBACK].toString()}),fe.joinChooseServer(e.sid,{lts:r.requestTime,elapse:r.elapse,succ:!0,csAddr:r.url,opid:r.opid,serverList:r.gatewayInfo.gatewayAddrs.map(a=>a.address),ec:null,cid:r.gatewayInfo.cid.toString(),uid:r.gatewayInfo.uid.toString(),csIp:r.gatewayInfo.csIp,unilbsServerIds:[Jt.CHOOSE_SERVER].toString(),isHttp3:r.isHttp3})}function vB(e){return window.atob(window.localStorage.getItem(e)||"")}function vE(e,t){window.localStorage.setItem(e,window.btoa(t))}function yB(e){let t="".concat(e.appId,"_").concat(e.cname);return typeof e.uid=="string"&&(t+="_s_".concat(e.uid)),typeof e.uid=="number"&&(t+="_".concat(e.uid)),e.token&&(t+="_".concat(e.token)),tV(t)}function aQ(e){let t=function(){let i=oQ.pop();return i?(i.offset=i.limit=0,i):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(i,r){let a=i.appId;a!==void 0&&(qt(r,10),co(r,a));let s=i.cid;s!==void 0&&(qt(r,16),qt(r,s));let c=i.cname;c!==void 0&&(qt(r,26),co(r,c));let l=i.deviceId;l!==void 0&&(qt(r,34),co(r,l));let u=i.elapse;u!==void 0&&(qt(r,40),lo(r,u));let h=i.fileSize;h!==void 0&&(qt(r,48),lo(r,Vl(h)));let p=i.height;p!==void 0&&(qt(r,56),lo(r,Vl(p)));let _=i.jpg;_!==void 0&&(qt(r,66),qt(r,_.length),bk(r,_));let m=i.networkType;m!==void 0&&(qt(r,72),lo(r,Vl(m)));let S=i.osType;S!==void 0&&(qt(r,80),lo(r,Vl(S)));let C=i.requestId;C!==void 0&&(qt(r,90),co(r,C));let v=i.sdkVersion;v!==void 0&&(qt(r,98),co(r,v));let y=i.sequence;y!==void 0&&(qt(r,104),lo(r,Vl(y)));let I=i.sid;I!==void 0&&(qt(r,114),co(r,I));let O=i.timestamp;O!==void 0&&(qt(r,120),lo(r,O));let P=i.uid;P!==void 0&&(qt(r,128),qt(r,P));let U=i.vid;U!==void 0&&(qt(r,136),qt(r,U));let x=i.width;x!==void 0&&(qt(r,144),lo(r,Vl(x)));let G=i.service;G!==void 0&&(qt(r,152),qt(r,G));let Z=i.callbackData;Z!==void 0&&(qt(r,162),qt(r,Z.length),bk(r,Z));let J=i.ticket;J!==void 0&&(qt(r,170),co(r,J));let q=i.vendorConfigs;q!==void 0&&(qt(r,178),co(r,q))}(e,t),function(i){let r=i.bytes,a=i.limit;return r.length===a?r:r.subarray(0,a)}(t)}function nQ(e){return function(i){let r={};e:for(;!cQ(i);){let a=hh(i);switch(a>>>3){case 0:break e;case 1:r.code=hh(i);break;case 2:r.msg=Ak(i,hh(i));break;case 3:r.requestId=Ak(i,hh(i));break;case 4:r.timestamp=lQ(i,!1);break;default:sQ(i,7&a)}}return r}({bytes:t=e,offset:0,limit:t.length});var t}function sQ(e,t){switch(t){case 0:for(;128&Ka(e););break;case 2:IR(e,hh(e));break;case 5:IR(e,4);break;case 1:IR(e,8);break;default:throw new Error("Unimplemented type: "+t)}}function Vl(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}var oQ=[];function IR(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function cQ(e){return e.offset>=e.limit}function im(e,t){let i=e.bytes,r=e.offset,a=e.limit,s=r+t;if(s>i.length){let c=new Uint8Array(2*s);c.set(i),e.bytes=c}return e.offset=s,s>a&&(e.limit=s),r}function CB(e,t){let i=e.offset;if(i+t>e.limit)throw new Error("Read past limit");return e.offset+=t,i}function bk(e,t){let i=im(e,t.length);e.bytes.set(t,i)}function Ak(e,t){let i=CB(e,t),r=String.fromCharCode,a=e.bytes,s="�",c="";for(let l=0;l<t;l++){let u,h,p,_,m=a[l+i];128&m?(224&m)==192?l+1>=t?c+=s:(u=a[l+i+1],(192&u)!=128?c+=s:(_=(31&m)<<6|63&u,_<128?c+=s:(c+=r(_),l++))):(240&m)==224?l+2>=t?c+=s:(u=a[l+i+1],h=a[l+i+2],(49344&(u|h<<8))!=32896?c+=s:(_=(15&m)<<12|(63&u)<<6|63&h,_<2048||_>=55296&&_<=57343?c+=s:(c+=r(_),l+=2))):(248&m)==240?l+3>=t?c+=s:(u=a[l+i+1],h=a[l+i+2],p=a[l+i+3],(12632256&(u|h<<8|p<<16))!=8421504?c+=s:(_=(7&m)<<18|(63&u)<<12|(63&h)<<6|63&p,_<65536||_>1114111?c+=s:(_-=65536,c+=r(55296+(_>>10),56320+(1023&_)),l+=3))):c+=s:c+=r(m)}return c}function co(e,t){let i=t.length,r=0;for(let c=0;c<i;c++){let l=t.charCodeAt(c);l>=55296&&l<=56319&&c+1<i&&(l=(l<<10)+t.charCodeAt(++c)-56613888),r+=l<128?1:l<2048?2:l<65536?3:4}qt(e,r);let a=im(e,r),s=e.bytes;for(let c=0;c<i;c++){let l=t.charCodeAt(c);l>=55296&&l<=56319&&c+1<i&&(l=(l<<10)+t.charCodeAt(++c)-56613888),l<128?s[a++]=l:(l<2048?s[a++]=l>>6&31|192:(l<65536?s[a++]=l>>12&15|224:(s[a++]=l>>18&7|240,s[a++]=l>>12&63|128),s[a++]=l>>6&63|128),s[a++]=63&l|128)}}function Ka(e){return e.bytes[CB(e,1)]}function Ik(e,t){let i=im(e,1);e.bytes[i]=t}function hh(e){let t,i=0,r=0;do t=Ka(e),i<32&&(r|=(127&t)<<i),i+=7;while(128&t);return r}function qt(e,t){for(t>>>=0;t>=128;)Ik(e,127&t|128),t>>>=7;Ik(e,t)}function lQ(e,t){let i,r=0,a=0,s=0;return i=Ka(e),r=127&i,128&i&&(i=Ka(e),r|=(127&i)<<7,128&i&&(i=Ka(e),r|=(127&i)<<14,128&i&&(i=Ka(e),r|=(127&i)<<21,128&i&&(i=Ka(e),a=127&i,128&i&&(i=Ka(e),a|=(127&i)<<7,128&i&&(i=Ka(e),a|=(127&i)<<14,128&i&&(i=Ka(e),a|=(127&i)<<21,128&i&&(i=Ka(e),s=127&i,128&i&&(i=Ka(e),s|=(127&i)<<7))))))))),{low:r|a<<28,high:a>>>4|s<<24,unsigned:t}}function lo(e,t){let i=t.low>>>0,r=(t.low>>>28|t.high<<4)>>>0,a=t.high>>>24,s=a===0?r===0?i<16384?i<128?1:2:i<1<<21?3:4:r<16384?r<128?5:6:r<1<<21?7:8:a<128?9:10,c=im(e,s),l=e.bytes;switch(s){case 10:l[c+9]=a>>>7&1;case 9:l[c+8]=s!==9?128|a:127&a;case 8:l[c+7]=s!==8?r>>>21|128:r>>>21&127;case 7:l[c+6]=s!==7?r>>>14|128:r>>>14&127;case 6:l[c+5]=s!==6?r>>>7|128:r>>>7&127;case 5:l[c+4]=s!==5?128|r:127&r;case 4:l[c+3]=s!==4?i>>>21|128:i>>>21&127;case 3:l[c+2]=s!==3?i>>>14|128:i>>>14&127;case 2:l[c+1]=s!==2?i>>>7|128:i>>>7&127;case 1:l[c]=s!==1?128|i:127&i}}var Ok={},wk={},yE=4294967296,dQ=yE*yE,uQ=dQ/2;bB(0,!0);var Nk=bB(0),hQ=Kh(0,-2147483648,!1),pQ=Kh(-1,2147483647,!1);function bB(e,t){let i,r,a;return t?(a=0<=(e>>>=0)&&e<256)&&(r=wk[e],r)?r:(i=Kh(e,0,!0),a&&(wk[e]=i),i):(a=-128<=(e|=0)&&e<128)&&(r=Ok[e],r)?r:(i=Kh(e,e<0?-1:0,!1),a&&(Ok[e]=i),i)}function Kh(e,t,i){return{low:0|e,high:0|t,unsigned:!!i}}function fQ(e,t){if(isNaN(e))return Nk;{if(e<=-9223372036854776e3)return hQ;if(e+1>=uQ)return pQ}return e<0?Nk:Kh(e%yE|0,e/yE|0,t)}function Dk(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),i.push.apply(i,r)}return i}var _Q=class AB extends Lt{get connectionState(){return this._connectionState}set connectionState(t){if(this._connectionState===t)return;let i=this._connectionState;this._connectionState=t,this.emit(pn.CONNECTION_STATE_CHANGE,t,i)}get quality(){return this._quality}set quality(t){this._quality=t>1?1:t<.1?.1:t,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(t){var i;super(),b(this,"name","AgoraRTCImageModeration"),b(this,"_connectionState",ha.CONNECTING),b(this,"_sequence",0),b(this,"_moderationStartTime",void 0),b(this,"_workerConnection",void 0),b(this,"_workerMessageLengthLimit",void 0),b(this,"_qualityRatio",void 0),b(this,"_connectInfo",void 0),b(this,"_cancelTokenSource",yr.CancelToken.source()),b(this,"_retryConfig",void 0),b(this,"_moderationInterval",void 0),b(this,"_moderationTimer",null),b(this,"_moderationMode",1),b(this,"_quality",1),b(this,"_qualityTimer",null),b(this,"_ticket",void 0),b(this,"_moderationIntervalMinimum",void 0),b(this,"_uploadFailedNum",0),b(this,"_uploadNum",0),b(this,"_uploadTimer",null),b(this,"_extraInfo",void 0),b(this,"_vendor",""),b(this,"_encoder",new TextEncoder),b(this,"_moderationId",void 0),b(this,"inspectImage",()=>{if(this.connectionState!==ha.CONNECTED)throw new B(A.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===ha.CONNECTED?this.requestToInspectImage():R.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=ft(5,"image-moderation-"),this._workerMessageLengthLimit=k("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=k("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=(i=t.interval)!==null&&i!==void 0?i:1e3,t.extraInfo&&(this._extraInfo=this._encoder.encode(t.extraInfo)),t.vendor&&(this._vendor=t.vendor),this._qualityRatio=k("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new Bh("worker-"+this._moderationId,ti),this.on(pn.STATE_CHANGE,(r,a)=>{R.debug("[".concat(this._moderationId,"] Moderation operation :").concat(Nl[r]," ").concat(a||""))}),this.handleWorkerEvents()}async init(t,i){this.emit(pn.STATE_CHANGE,Nl.CONNECT_AP),this._connectInfo=t;let r=this._cancelTokenSource.token;return this._retryConfig=i,new ae((a,s)=>{this.on(pn.CONNECTION_STATE_CHANGE,(c,l)=>{c===ha.CONNECTED&&a()}),this.requestAP(t,r,i).then(c=>{this.connectWorker(c)}).catch(c=>{s(c)})})}updateConfig(t){var i;this._moderationInterval=(i=t.interval)!==null&&i!==void 0?i:1e3,t.extraInfo&&(this._extraInfo=this._encoder.encode(t.extraInfo)),t.vendor&&(this._vendor=t.vendor),R.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(t))),this.connectionState===ha.CONNECTED&&this.inspectImage()}async requestAP(t,i,r){let a=k("WEBCS_DOMAIN").map(u=>"https://".concat(u,"/api/v1")),s=await function(u,h,p,_){let{appId:m,areaCode:S,cname:C,sid:v,token:y,uid:I}=h;dd++;let O="moderation_plugin",P={service_name:O,json_body:JSON.stringify({appId:m,areaCode:S,cname:C,command:"allocateEdge",requestId:dd,seq:dd,sid:v,appToken:y,ts:Date.now(),uid:I+""})},U,x,G=u[0];return Rn(async()=>{U=Date.now();let Z=await vn(G,{data:P,cancelToken:p,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(x=Date.now()-U,Z.code!==0){let ie=new B(A.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+Z.code,{retry:!0,responseTime:x});throw R.error(ie.toString()),ie}let J=JSON.parse(Z.json_body);if(J.code!==200){let ie=new B(A.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(J.code,", reason: ").concat(J.reason),{code:J.code,responseTime:x});throw R.error(ie.toString()),ie}if(!J.servers||!Array.isArray(J.servers)||J.servers.length===0){let ie=new B(A.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:J.code,responseTime:x});throw R.error(ie.toString()),ie}if(!J.servers.some(ie=>!!ie.wss)){let ie=new B(A.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:J.code,responseTime:x});throw R.error(ie.toString()),ie}let q=k("IMAGE_MODERATION_WORKER_HOST");return{addressList:J.servers.map(ie=>{let{address:Ie,wss:Ve}=ie;if(Ie&&Ve)return"wss://".concat(Ie.replace(/\./g,"-"),".").concat(q,":").concat(Ve,"/moderation")}).filter(ie=>!!ie),workerToken:J.workerToken,vid:J.vid,ticket:J.appTicket,responseTime:x}},(Z,J)=>(fe.apworkerEvent(v,{success:!0,sc:200,serviceName:O,responseDetail:JSON.stringify(Z.addressList),firstSuccess:J===0,responseTime:x,serverIp:u[J%u.length]}),!1),(Z,J)=>(fe.apworkerEvent(v,{success:!1,sc:Z.data&&Z.data.code||200,serviceName:O,responseTime:x,serverIp:u[J%u.length]}),!!(Z.code!==A.OPERATION_ABORTED&&Z.code!==A.UNEXPECTED_RESPONSE||Z.data&&Z.data.retry)&&(G=u[(J+1)%u.length],!0)),_)}(a,t,i,r);this.emit(pn.STATE_CHANGE,Nl.AP_CONNECTED);let{addressList:c,ticket:l}=s;return this._ticket=l,c}async connectWorker(t){this.emit(pn.STATE_CHANGE,Nl.CONNECT_WORKER),await this._workerConnection.init(t,1e4)}handleWorkerEvents(){this._workerConnection.on(Ce.CONNECTED,async()=>{this.emit(pn.STATE_CHANGE,Nl.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=ha.CONNECTED}),this._workerConnection.on(Ce.CLOSED,()=>{this.connectionState=ha.CLOSED}),this._workerConnection.on(Ce.FAILED,()=>{this.connectionState=ha.CLOSED}),this._workerConnection.on(Ce.RECONNECTING,()=>{this.connectionState=this.connectionState===ha.CONNECTED?ha.RECONNECTING:ha.CONNECTING}),this._workerConnection.on(Ce.ON_MESSAGE,async t=>{if(t.data instanceof ArrayBuffer){let i=nQ(new Uint8Array(t.data));k("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&R.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(i)),this._uploadNum++,i.code===void 0||i.code===0||(this._uploadFailedNum++,R.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(i.code,", msg is ").concat(i.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout(()=>{fe.reportApiInvoke(this._connectInfo.sid||null,{name:ni.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,i.code],tag:Vt.TRACER}).onError(new B(A.IMAGE_MODERATION_UPLOAD_FAILED,i.msg)),this._uploadTimer=null},k("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else R.error("[".concat(this._moderationId,"] Unexpected message type from worker"))}),this._workerConnection.on(Ce.WILL_RECONNECT,(t,i,r)=>{t==="recover"&&r(t),r("tryNext")}),this._workerConnection.on(Ce.REQUEST_NEW_URLS,(t,i)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(t).catch(i)})}static intToLong(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}async requestToInspectImage(){let t=ga(this,pn.CLIENT_LOCAL_VIDEO_TRACK),i={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(t){if(!t.isPlaying)return void(k("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&R.debug("Only the track being played can be inspected"));this._sequence++;let r=await this.generateRequestData(t,i);this._workerConnection.sendMessage(r,!0,!0)}else k("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&R.debug("Only the track being published can be inspected")}async generateRequestData(t,i){let{appId:r,cname:a,cid:s,vid:c,sid:l,uid:u}=i,h=Date.now(),p=await t.getCurrentFrameImage("image/jpeg",this.quality),_=await VV(p,r,a),m=this._sequence+"-"+s+"-"+u+"-"+h+"-"+ft(12,""),S={appId:r,cid:s,cname:a,deviceId:"",elapse:AB.intToLong(Number(h-this._moderationStartTime)),fileSize:p.buffer.byteLength,height:p.height,width:p.width,jpg:_,networkType:6,osType:7,requestId:m,sdkVersion:"4.22.0",sequence:this._sequence,sid:l,timestamp:fQ(h),uid:u,vid:c,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};this._extraInfo===void 0&&delete S.callbackData;let C=aQ(S);if(C.byteLength<this._workerMessageLengthLimit){if(k("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){let v=function(y){for(var I=1;I<arguments.length;I++){var O=arguments[I]!=null?arguments[I]:{};I%2?Dk(Object(O),!0).forEach(function(P){b(y,P,O[P])}):Object.getOwnPropertyDescriptors?Object.defineProperties(y,Object.getOwnPropertyDescriptors(O)):Dk(Object(O)).forEach(function(P){Object.defineProperty(y,P,Object.getOwnPropertyDescriptor(O,P))})}return y}({},S);delete v.jpg,R.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(v))}return C}{let v=this.quality*this._qualityRatio;return this.quality=v,await this.generateRequestData(t,{appId:r,cname:a,cid:s,vid:c,sid:l,uid:u})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=yr.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=ha.CLOSED,this.emit(pn.STATE_CHANGE,Nl.CLOSED)}};function IB(e){if(nt(e.interval,"interval",1e3,1/0),e&&e.extraInfo&&e.extraInfo.length>1024)throw new B(A.INVALID_PARAMS,"config.extraInfo length cannot exceed 1024 bytes");if(e&&e.vendor&&e.vendor.length>1024)throw new B(A.INVALID_PARAMS,"config.vendor length cannot exceed 1024 bytes")}var EQ={name:"ImageModeration",create:function(e){let{config:t}=e;return IB(t),new _Q(t)}},Pk,Lk,kk,Mk,Uk,xk,Vk,Bk,jk,Fk,Gk,Hk,Wk,Kk,zk,Yk,qk,Xk,Jk,Qk,Zk,$k,eM,tM,iM,rM,aM,nM,sM,oM,cM,lM,dM,uM,hM,pM,fM,_M,EM,mM,se;function gM(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),i.push.apply(i,r)}return i}function _n(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?gM(Object(i),!0).forEach(function(r){b(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):gM(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}Fi.setLogger(R);var mQ=(Pk=Se(),Lk=Se({argsMap:(e,t)=>{if(!Array.isArray(t)){if(!(t instanceof id))return[t];t=[t]}return t.map(i=>i?Object(i).toString():"null")}}),kk=Se({argsMap:(e,t)=>(t||(t=[]),Array.isArray(t)||t.trackMediaType!==Ld.DATA?(Array.isArray(t)||(t=[t]),t.map(i=>i.getTrackId())):[t.getChannelId()])}),Mk=Se({argsMap:(e,t,i,r)=>[typeof t=="object"?t.uid:t,i,r]}),Uk=Se({argsMap:(e,t,i)=>[t,i]}),xk=Se({argsMap:(e,t)=>t.map(i=>{let{user:r,mediaType:a}=i;return[r==null?void 0:r.uid,a]})}),Vk=Se({argsMap:(e,t,i,r)=>[typeof t=="object"?t.uid:t,i,r]}),Bk=Se({argsMap:(e,t)=>t.map(i=>{let{user:r,mediaType:a}=i;return{uid:r==null?void 0:r.uid,mediaType:a}})}),jk=Se(),Fk=Se(),Gk=Se(),Hk=Se(),Wk=Se(),Kk=Se(),zk=Se(),Yk=Se(),qk=Se(),Xk=Se(),Jk=Se(),Qk=Se(),Zk=Se(),$k=Se(),eM=Se({argsMap:(e,t)=>[t]}),tM=Se(),iM=Se(),rM=Se(),aM=Se(),nM=Se(),sM=Se(),oM=Se(),cM=Se(),lM=Se({argsMap:(e,t)=>(Array.isArray(t)||(t=[t]),[JSON.stringify(t)])}),dM=Se(),uM=Se(),hM=Se(),pM=Se(),fM=Se(),_M=Se(),EM=Se({reportResult:!0}),mM=Se(),se=class extends Lt{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var e;return((e=this._config)===null||e===void 0?void 0:e.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(e){let t;if(super(),b(this,"store",void 0),b(this,"_uid",void 0),b(this,"_channelName",void 0),b(this,"_uintUid",void 0),b(this,"_users",[]),b(this,"_config",void 0),b(this,"_clientId",void 0),b(this,"_appId",void 0),b(this,"_sessionId",null),b(this,"_key",void 0),b(this,"_rtmConfig",{}),b(this,"_joinInfo",void 0),b(this,"_gateway",void 0),b(this,"_statsCollector",void 0),b(this,"_configDistribute",void 0),b(this,"_leaveMutex",new Fi("client-leave")),b(this,"_publishMutex",new Fi("client-publish")),b(this,"_renewTokenMutex",new Fi("client-renewtoken")),b(this,"_subscribeMutex",new Fi("client-subscribe")),b(this,"_encryptionMode","none"),b(this,"_encryptionSecret",null),b(this,"_encryptionSalt",null),b(this,"_encryptDataStream",!1),b(this,"_encryptDataStreamKey",null),b(this,"_encryptDataStreamIv",null),b(this,"_proxyServer",void 0),b(this,"_turnServer",{servers:[],mode:"auto"}),b(this,"_cloudProxyServerMode","disabled"),b(this,"_isDualStreamEnabled",!1),b(this,"_defaultStreamFallbackType",void 0),b(this,"_lowStreamParameter",void 0),b(this,"_streamFallbackTypeCacheMap",new Map),b(this,"_remoteStreamTypeCacheMap",new Map),b(this,"_axiosCancelSource",yr.CancelToken.source()),b(this,"_audioVolumeIndicationInterval",void 0),b(this,"_networkQualityInterval",void 0),b(this,"_userOfflineTimeout",void 0),b(this,"_streamRemovedTimeout",void 0),b(this,"_liveTranscodeStreamingClient",void 0),b(this,"_liveRawStreamingClient",void 0),b(this,"_channelMediaRelayClient",void 0),b(this,"_networkQualitySensitivity","normal"),b(this,"_p2pChannel",void 0),b(this,"_useLocalAccessPoint",!1),b(this,"_setLocalAPVersion",void 0),b(this,"_joinAndNotLeaveYet",!1),b(this,"_numberOfJoinCount",0),b(this,"_remoteDefaultVideoStreamType",void 0),b(this,"_inspect",void 0),b(this,"_moderation",void 0),b(this,"_license",void 0),b(this,"_pendingPublishedUsers",[]),b(this,"ntpAlignErrorCount",0),b(this,"remoteInboundOffset",0),b(this,"_handleLocalTrackEnable",(i,r,a)=>{this.publish(i,!1).then(r).catch(a)}),b(this,"_handleLocalTrackDisable",(i,r,a)=>{this.unpublish(i).then(r).catch(a)}),b(this,"_handleUserOnline",i=>{if(k("BLOCK_LOCAL_CLIENT")&&oc(i.uid,this.channelName))return void R.debug("[".concat(i.uid,"] will be ignored in local"));this.isStringUID&&typeof i.uid!="string"&&R.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));let r=this._users.find(a=>a.uid===i.uid);if(r)r._trust_in_room_=!0,r._is_pre_created&&(r._is_pre_created=!1,this.safeEmit(Me.USER_JOINED,r));else{let a=new Eo(i.uid,i.uint_id||i.uid);this._users.push(a),R.debug("[".concat(this._clientId,"] user online"),i.uid),this.safeEmit(Me.USER_JOINED,a)}}),b(this,"_handleUserOffline",i=>{if(k("BLOCK_LOCAL_CLIENT")&&oc(i.uid,this.channelName))return;let r=this._users.find(a=>a.uid===i.uid);r&&(this._handleRemoveStream(i),this._handleRemoveDataChannels(i),r._audio_pre_subscribed||r._video_pre_subscribed?r._is_pre_created=!0:hE(this._users,r),this._remoteStreamTypeCacheMap.delete(r.uid),this._streamFallbackTypeCacheMap.delete(r.uid),R.debug("[".concat(this._clientId,"] user offline"),i.uid,"reason:",i.reason),this.safeEmit(Me.USER_LEAVED,r,i.reason))}),b(this,"_handleAddAudioOrVideoStream",(i,r,a,s,c,l,u)=>{if(k("BLOCK_LOCAL_CLIENT")&&oc(r,this.channelName))return;let h=this._users.find(_=>_.uid===r);if(!h)return void R.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));R.debug("[".concat(this._clientId,"] stream added with uid ").concat(r,", type ").concat(i)),this.store.subscribe(h.uid,i,void 0,void 0,void 0,Date.now());let p=i==="audio"?h.hasAudio:h.hasVideo;h._uintid||(h._uintid=c||r),i==="audio"?h._trust_audio_stream_added_state_=!0:h._trust_video_stream_added_state_=!0,i==="audio"?(h._audio_added_=!0,a!==void 0&&(h._audioSSRC=a),s!==void 0&&(h._cname=s),l&&(h._audioOrtc=l)):(h._video_added_=!0,a!==void 0&&(h._videoSSRC=a),s!==void 0&&(h._cname=s),u!==void 0&&(h._rtxSsrcId=u),l&&(h._videoOrtc=l)),(i==="audio"?h.hasAudio:h.hasVideo)&&!p&&(R.info("[".concat(this._clientId,"] remote user ").concat(h.uid," published ").concat(i)),this.safeEmit(Me.USER_PUBLISHED,h,i)),i==="video"?fe.onGatewayStream(this._sessionId,Si.ON_ADD_VIDEO_STREAM,Pt.ON_ADD_VIDEO_STREAM,{peer:c||r,ssrc:h._videoSSRC}):fe.onGatewayStream(this._sessionId,Si.ON_ADD_AUDIO_STREAM,Pt.ON_ADD_AUDIO_STREAM,{peer:c||r,ssrc:h._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(h,i,a).then(_=>{if(_&&(R.debug("[".concat(this._clientId,"] resubscribe ").concat(i," for user ").concat(h.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof __))return this._p2pChannel.unsubscribe(h,i,!0).then(()=>this._subscribe(h,i,!0).catch(m=>{R.error("[".concat(this._clientId,"] resubscribe error"),m.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(h,i)&&(R.debug("[".concat(this._clientId,"] resubscribe ").concat(i," for user ").concat(h.uid," after reconnect.")),this._subscribe(h,i,!0).catch(_=>{R.error("[".concat(this._clientId,"] resubscribe error"),_.toString())}))}),b(this,"_handleRemoveStream",i=>{if(k("BLOCK_LOCAL_CLIENT")&&oc(i.uid,this.channelName))return;let r=this._users.find(s=>s.uid===i.uid);if(!r)return void R.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));R.debug("[".concat(this._clientId,"] stream removed with uid ").concat(i.uid));let a=()=>{};r.hasAudio&&r.hasVideo?a=()=>{R.info("[".concat(this._clientId,"] remote user ").concat(r.uid," unpublished audio track")),this.safeEmit(Me.USER_UNPUBLISHED,r,"audio"),R.info("[".concat(this._clientId,"] remote user ").concat(r.uid," unpublished video track")),this.safeEmit(Me.USER_UNPUBLISHED,r,"video")}:r.hasVideo?a=()=>{R.info("[".concat(this._clientId,"] remote user ").concat(r.uid," unpublished video track")),this.safeEmit(Me.USER_UNPUBLISHED,r,"video")}:r.hasAudio&&(a=()=>{R.info("[".concat(this._clientId,"] remote user ").concat(r.uid," unpublished audio track")),this.safeEmit(Me.USER_UNPUBLISHED,r,"audio")}),r._video_pre_subscribed||r._audio_pre_subscribed||(r._trust_audio_stream_added_state_=!0,r._trust_video_stream_added_state_=!0,r._audio_added_=!1,r._video_added_=!1,this._p2pChannel instanceof __&&this._p2pChannel.unsubscribe(r).then(s=>{if(s)return this._gateway.unsubscribe(s,r.uid)}),r._audioSSRC=void 0,r._videoSSRC=void 0,r._audioOrtc=void 0,r._videoOrtc=void 0,r._rtxSsrcId=void 0),fe.onGatewayStream(this._sessionId,Si.ON_REMOVE_STREAM,Pt.ON_REMOVE_STREAM,{peer:i.uint_id||i.uid}),a()}),b(this,"_handleSetStreamLocalEnable",(i,r,a)=>{if(k("BLOCK_LOCAL_CLIENT")&&oc(r,this.channelName))return;let s=this._users.find(u=>u.uid===r);if(!s)return void R.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));R.debug("[".concat(this._clientId,"] local ").concat(i," ").concat(a?"enabled":"disabled"," with uid ").concat(r));let c=i==="audio"?s.hasAudio:s.hasVideo;if(i==="audio"){s._trust_audio_enabled_state_=!0;let u=s._audio_enabled_;if(s._audio_enabled_=a,s._audio_enabled_===u)return;{let h=s._audio_enabled_?"enable-local-audio":"disable-local-audio";R.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(r,", msg: ").concat(h)),this.safeEmit(Me.USER_INFO_UPDATED,r,h)}}else{s._trust_video_enabled_state_=!0;let u=s._video_enabled_;if(s._video_enabled_=a,s._video_enabled_===u)return;{let h=s._video_enabled_?"enable-local-video":"disable-local-video";R.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(r,", msg: ").concat(h)),this.safeEmit(Me.USER_INFO_UPDATED,r,h)}}let l=i==="audio"?s.hasAudio:s.hasVideo;return c!==l?!c&&l?(R.info("[".concat(this._clientId,"] remote user ").concat(r," published ").concat(i)),void this.safeEmit(Me.USER_PUBLISHED,s,i)):(i==="video"&&s._videoTrack&&s._videoTrack._destroy(),i==="audio"&&s._audioTrack,this._p2pChannel.muteRemote(s,i),R.info("[".concat(this._clientId,"] remote user ").concat(r," unpublished ").concat(i)),void this.safeEmit(Me.USER_UNPUBLISHED,s,i)):void 0}),b(this,"_handleMuteStream",(i,r,a)=>{if(k("BLOCK_LOCAL_CLIENT")&&oc(i,this.channelName))return;R.debug("[".concat(this._clientId,"] receive mute message"),i,r,a);let s=this._users.find(u=>u.uid===i);if(!s)return void R.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(i));let c=r==="audio"?s.hasAudio:s.hasVideo;if(r==="audio"){s._trust_audio_mute_state_=!0;let u=s._audio_muted_;if(s._audio_muted_=a,s._audio_muted_===u)return;{let h=s._audio_muted_?"mute-audio":"unmute-audio";R.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(i,", msg: ").concat(h)),this.safeEmit(Me.USER_INFO_UPDATED,i,h)}}else{s._trust_video_mute_state_=!0;let u=s._video_muted_;if(s._video_muted_=a,s._video_muted_===u)return;{let h=s._video_muted_?"mute-video":"unmute-video";R.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(i,", msg: ").concat(h)),this.safeEmit(Me.USER_INFO_UPDATED,i,h)}}let l=r==="audio"?s.hasAudio:s.hasVideo;if(c!==l){if(!c&&l)return(r==="audio"?s._audioSSRC:s._videoSSRC)?(R.info("[".concat(this._clientId,"] remote user ").concat(i," published ").concat(r)),void this.safeEmit(Me.USER_PUBLISHED,s,r)):void R.warning("[".concat(this._clientId,"] remote user ").concat(i," receive ").concat(r," unmute message  before add stream message, ").concat(r," SSRC doesn't exist yet."));r==="video"&&s._videoTrack&&!s._video_pre_subscribed&&s._videoTrack._destroy(),r==="audio"&&s._audioTrack,this._p2pChannel.muteRemote(s,r),R.info("[".concat(this._clientId,"] remote user ").concat(i," unpublished ").concat(r)),this.safeEmit(Me.USER_UNPUBLISHED,s,r)}}),b(this,"_handleP2PLost",async i=>{R.debug("[".concat(this._clientId,"] receive p2p lost"),i),parseInt(i.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():R.warning("[".concat(this._clientId,"] P2PLost stream not found"),i)}),b(this,"_handleTokenWillExpire",()=>{R.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(Me.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),b(this,"_handleBeforeUnload",i=>{i.type==="beforeunload"&&i.returnValue!==void 0&&i.returnValue!==""||(this.leave(),R.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),b(this,"_handleUpdateNetworkQuality",()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.safeEmit(Me.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});let i={downlinkNetworkQuality:0,uplinkNetworkQuality:0};i.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),i.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(Me.NETWORK_QUALITY,i)}),b(this,"_handleP2PAddAudioOrVideoStream",(i,r,a,s)=>{let c=this._users.find(u=>u.uid===r);if(!c)return void R.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));R.debug("[".concat(this._clientId,"] stream added with uid ").concat(r,", type ").concat(i)),this.store.subscribe(c.uid,i,void 0,void 0,void 0,Date.now());let l=i==="audio"?c.hasAudio:c.hasVideo;i==="audio"?c._trust_audio_stream_added_state_=!0:c._trust_video_stream_added_state_=!0,i==="audio"?(c._audio_added_=!0,a!==void 0&&(c._audioSSRC=a),s!==void 0&&(c._audioMid=s)):(c._video_added_=!0,a!==void 0&&(c._videoSSRC=a),s!==void 0&&(c._videoMid=s)),(i==="audio"?c.hasAudio:c.hasVideo)&&!l&&(R.info("[".concat(this._clientId,"] remote user ").concat(c.uid," published ").concat(i)),this.safeEmit(Me.USER_PUBLISHED,c,i)),this._p2pChannel.hasPendingRemoteMedia(c,i)&&(R.debug("[".concat(this._clientId,"] resubscribe ").concat(i," for user ").concat(c.uid," after reconnect.")),this._subscribe(c,i,!0).catch(u=>{R.error("[".concat(this._clientId,"] resubscribe error"),u.toString())}))}),this._config=e,this._clientId=ft(5,"client-"),this.store=new F7(e.codec,e.audioCodec,e.mode,this._clientId),this.store.clientCreated(),e.proxyServer&&this.setProxyServer(e.proxyServer,!0),e.turnServer&&this.setTurnServer(e.turnServer,!0),R.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(Sa," build: ").concat(Zy,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),e.clientRoleOptions)try{GN(e.clientRoleOptions),t=Object.assign({},e.clientRoleOptions)}catch(i){R.warning("[".concat(this._clientId,"] ").concat(i.toString()))}this._statsCollector=new hB(this.store),this._statsCollector.onStatsException=(i,r,a)=>{R.debug("[".concat(this._clientId,"] receive exception msg, code: ").concat(i,", msg: ").concat(r,", uid: ").concat(a)),this.safeEmit(Me.EXCEPTION,{code:i,msg:r,uid:a})},this._statsCollector.onUploadPublishDuration=(i,r,a,s)=>{let c=this._users.find(l=>l.uid===i);c&&fe.peerPublishStatus(this._sessionId,{subscribeElapse:s,audioPublishDuration:r,videoPublishDuration:a,peer:c._uintid})},this.store.useP2P=e.mode==="p2p",this._gateway=new mJ(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:e.websocketRetryConfig||ti,httpRetryConfig:e.httpRetryConfig||ti,forceWaitGatewayResponse:e.forceWaitGatewayResponse===void 0||e.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:e.role,clientRoleOptions:t}),this._configDistribute=new IJ,this.store.useP2P?(this._p2pChannel=new Mr(this.store,this._statsCollector),this._handleP2PEvents()):this._p2pChannel=new __(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(e,t,i,r,a){let s=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5],c=arguments.length>6&&arguments[6]!==void 0&&arguments[6];at("JOIN_GATEWAY_USE_443PORT_ONLY",s),at("JOIN_GATEWAY_USE_DUAL_DOMAIN",c);let l=this._gateway.signal.websocket;return l instanceof eC&&(l.use443PortOnly=s,l.tryDoubleDomain=c),async function(u,h,p){Yf.get(u)||Yf.set(u,[]),qf.get(u)||qf.set(u,h),wn.get(u)||wn.set(u,0);let _=Yf.get(u),m=qf.get(u);if(!_||!m)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(wn.get(u)===m){let I=kh();_.push(I),await I.promise}wn.set(u,wn.get(u)+1);for(var S=arguments.length,C=new Array(S>3?S-3:0),v=3;v<S;v++)C[v-3]=arguments[v];let y=await p(...C);return wn.set(u,wn.get(u)-1),wn.get(u)===m-1&&_.length>0&&(_[0].resolve(),_.shift()),wn.get(u)===0&&(Yf.set(u,[]),qf.set(u,0),wn.set(u,0)),y}("client.join",k("JOIN_MAX_CONCURRENCY"),this.join.bind(this),e,t,i,r,a)}async join(e,t,i,r,a){let s=++this._numberOfJoinCount;this.store.joinStart(),r&&(this.store.uid=r);let c=(Jf||Jf||(Jf=(window.location.protocol.split(":")[0]||"").toUpperCase(),Jf))==="HTTPS",l=XN()?window.isSecureContext:"Browser Not Support";(!XN()&&!c||!window.isSecureContext)&&R.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser"),this.connectionState==="DISCONNECTED"&&(this.store.avoidJoinStart=Math.round(Date.now()),R.debug("[".concat(this._clientId,"] set avoidJoinStart to ").concat(this.store.avoidJoinStart))),fe.setAppId(e);try{if(!i&&i!==null)throw new B(A.INVALID_PARAMS,"Invalid token: ".concat(i,". If you don not use token, set it to null"));i&&Ti(i,"token",1,2047),Ti(e,"appid",1,2047),$E(t),r&&em(r),a&&Ti(a,"optionalInfo",1,2047)}catch(v){throw fe.reportApiInvoke($l(),{name:ni.JOIN,options:[e,t,i,r],states:{isHttps:c,isSecureContext:l},tag:Vt.TRACER}).onError(v),v}if(this._leaveMutex.isLocked&&(R.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),R.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){let v=new B(A.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw fe.reportApiInvoke($l(),{name:ni.JOIN,options:[e,t,i,r],states:{isHttps:c,isSecureContext:l},tag:Vt.TRACER}).onError(v),v}this._gateway.state="CONNECTING";let u=await yk({appId:e,cname:t,uid:r,stringUid:typeof r=="string"?r:void 0,token:i||e,cloudProxyServer:this._cloudProxyServerMode});if(!this._joinAndNotLeaveYet)throw new B(A.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));let h=(u==null?void 0:u.sid)||$l();R.info("[".concat(this._clientId,"] start join channel ").concat(t,", join number: ").concat(s)),this._sessionId||(this._sessionId=h,this.store.sessionId=this._sessionId);let p=fe.reportApiInvoke(h,{name:ni.JOIN,options:[e,t,i,r],states:{isHttps:c,isSecureContext:l},tag:Vt.TRACER}),_=_n(_n({},this._rtmConfig),{},{clientId:this._clientId,appId:e,sid:this._sessionId,cname:t,uid:typeof r!="string"?r:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:i||e,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:a,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!u},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType});if(this._useLocalAccessPoint&&(_.setLocalAPVersion=this._setLocalAPVersion),typeof r=="string"&&(_.stringUid=r,this._uintUid?(_.uid=this._uintUid,this._uintUid=void 0):_.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(_.aesmode=this._encryptionMode,_.aespassword=await(async v=>{let y=function(U){let x=window.atob(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),G=new Uint8Array(new ArrayBuffer(x.length));for(let Z=0;Z<x.length;Z+=1)G[Z]=x.charCodeAt(Z);return G}(),I=await window.crypto.subtle.importKey("spki",y,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),O=qy(v),P=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},I,O);return function(U){let x="";for(let G=0;G<U.length;G+=1)x+=String.fromCharCode(U[G]);return window.btoa(x)}(new Uint8Array(P))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new B(A.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(_.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&(this._encryptionMode==="aes-128-gcm2"||this._encryptionMode==="aes-256-gcm2"))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){let v=new TextEncoder,y=k("USE_PURE_ENCRYPTION_MASTER_KEY")?v.encode(_.appId+this._encryptionSecret+this._encryptionSecret):v.encode(_.appId+_.cname+this._encryptionSecret);this._encryptDataStreamIv=await async function(I,O,P){let U=await window.crypto.subtle.importKey("raw",O,"PBKDF2",!1,["deriveBits","deriveKey"]),x=I==="aes-128-gcm2"?128:256,G=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:QN,hash:"SHA-256",salt:P},U,x+G7);return new Uint8Array(G).subarray(x/8)}(this._encryptionMode,y,vc(this._encryptionSalt)),this._encryptDataStreamKey=await async function(I,O,P){let U=await window.crypto.subtle.importKey("raw",O,"PBKDF2",!1,["deriveBits","deriveKey"]),x=I==="aes-128-gcm2"?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:QN,hash:"SHA-256",salt:P},U,{name:"AES-GCM",length:x},!0,["encrypt","decrypt"])}(this._encryptionMode,y,vc(this._encryptionSalt))}else l?R.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):R.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,R.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:t,appId:e,stringUid:_.stringUid});let m=this._sessionId;setTimeout(()=>{this.connectionState==="CONNECTING"&&m===this._sessionId&&fe.joinChannelTimeout(this._sessionId,5)},5e3);try{var S;let v,y=_.cloudProxyServer;if(oe(S=["proxy3","proxy4","proxy5"]).call(S,y)){let x=k("PROXY_SERVER_TYPE3");Array.isArray(x)?_.proxyServer=x[0]:_.proxyServer=x}if(fe.setProxyServer(_.proxyServer),R.setProxyServer(_.proxyServer),this.store.requestAPStart(),u){if(R.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(_.stringUid?", ".concat(_.stringUid," => ").concat(u.intUid):""," ")),_.stringUid&&!_.uid&&(_.uid=u.intUid),v={gatewayInfo:u.ap.gatewayInfo},k("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&_.turnServer.mode==="auto")if(u.ap.proxyInfo.addresses.length===0)R.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{let x=(await hV(u.ap.proxyInfo,u.ap.gatewayInfo.uid)).map(G=>({turnServerURL:G.address,tcpport:G.tcpport||Ni.tcpport,udpport:G.udpport||Ni.udpport,username:G.username||Ni.username,password:G.password||Ni.password,forceturn:!1,security:!0}));_.turnServer={mode:"manual",servers:x}}Ck(u,_.stringUid)}else{if(_.stringUid&&!_.uid){let x;[x,v]=await ae.all([rB(_.stringUid,_,this._axiosCancelSource.token,this._config.httpRetryConfig||ti,this.store),AL(_,this._axiosCancelSource.token,this._config.httpRetryConfig||ti,!0,this.store)]),R.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(_.stringUid," => ").concat(x)),_.uid=x,v.gatewayInfo.uid=x,v.gatewayInfo.res.uid=x}else v=await AL(_,this._axiosCancelSource.token,this._config.httpRetryConfig||ti,!0,this.store);if(!this._joinAndNotLeaveYet)throw new B(A.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(_,this._axiosCancelSource.token),this._configDistribute.on(xv.UPDATE_BITRATE_LIMIT,x=>{this._p2pChannel.updateBitrateLimit(x)})},0),this._key=i||e;let I=v.gatewayInfo,O=_.uid?_.uid:I.uid;this._joinInfo=_n(_n({},_),{},{cid:I.cid,uid:O,vid:I.vid,apResponse:I.res,apGatewayAddress:I.apGatewayAddress,uni_lbs_ip:I.uni_lbs_ip,gatewayAddrs:I.gatewayAddrs}),this.store.intUid=O;let P=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new B(A.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));p.onSuccess(P),this._appId=e,this._channelName=_.cname,this._uid=P,this.store.uid=P,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener(Li()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()},0);let U=_.stringUid?"string uid: ".concat(_.stringUid,",uid: ").concat(_.uid):"uid: ".concat(this._uid);return R.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(t,",").concat(U)),setTimeout(()=>{R.startUpload()},5e3),this.store.joinEnd(),C=this,oe(fo).call(fo,C)||fo.push(C),this._cloudProxyServerMode==="disabled"&&Ke().supportWebCrypto&&k("ENABLE_PRELOAD")&&gC(this._joinInfo),P}catch(v){let y=Array.isArray(v)?v[0]:v;throw y&&y.code===A.OPERATION_ABORTED?R.warning("[".concat(this._clientId,"] join number: ").concat(s,", Joining channel failed, rollback"),y):R.error("[".concat(this._clientId,"] join number: ").concat(s,", Joining channel failed, rollback"),y),y.code!==A.OPERATION_ABORTED&&this._numberOfJoinCount===s&&(this._gateway.state="DISCONNECTED",this._reset()),p.onError(y),y}var C}_joinGateway(){if(!this._joinInfo||!this._key)throw new B(A.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!k("JOIN_WITH_FALLBACK_SIGNAL_PROXY")))}async leave(){R.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(Li()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(t){let i=fo.indexOf(t);i!==-1&&fo.splice(i,1)}(this),this._statsCollector.stopUpdateStats();let e=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return R.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void e();await this._gateway.leave(this.connectionState!=="CONNECTED"),R.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),e()}async publish(e){let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!Array.isArray(e)){if(!(e instanceof id))return this._publishDataChannel(e);e=[e]}if(e.length===0)throw new B(A.INVALID_PARAMS,"param list is empty");let i=e;if(this._gateway.role==="audience")throw new B(A.INVALID_OPERATION,"audience can not publish stream");for(let a of i){if(!(a instanceof id))throw new B(A.INVALID_PARAMS,"parameter is not local track");if(!a._enabled&&t)throw new B(A.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(a.getTrackId()))}R.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(i.map(a=>"".concat(a.getTrackId()," "))));let r=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),t&&i.forEach(a=>{let s=this._configDistribute.getBitrateLimit();a instanceof St&&s&&a.setBitrateLimit(s.uplink)});try{await this._publishHighStream(i),R.info("[".concat(this._clientId,"] Publish success, id ").concat(i.map(a=>"".concat(a.getTrackId()," "))))}catch(a){throw R.error("[".concat(this._clientId,"] publish error"),a.toString()),a}finally{r()}}async _publishDataChannel(e){nt(e.id,"id",0,65535,!0),Is(e.ordered,"ordered"),Ti(e.metadata,"metadata",0,512),R.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(e.id));let t=await this._publishMutex.lock();try{if(this._p2pChannel.getAllDataChannels().findIndex(a=>a.id===e.id)!==-1)throw new B(A.INVALID_PARAMS,"Invalid id: ".concat(e.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||this._uid===void 0)throw new B(A.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new B(A.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&k("FORCE_TURN")&&!k("TURN_ENABLE_TCP")&&!k("TURN_ENABLE_UDP"))throw new B(A.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");let i=function(a){return gk(a,!1)}(e),r=await this._p2pChannel.publishDataChannel([i]);if(r.length>0){if(typeof i._originDataChannelId!="number")throw R.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new B(A.CREATE_DATACHANNEL_ERROR);try{await ae.all(r.map(a=>this._uid&&this._gateway.publishDataChannel(this._uid,a,!0))),await i._waitTillOpen()}catch(a){if(a.code!==A.DISCONNECT_P2P)throw a}}return R.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(i.id)),i}catch(i){throw R.error("[".concat(this._clientId,"] publish datachannels error"),i.toString()),i}finally{t()}}async unpublish(e){if(!this._joinInfo||this._uid===void 0)throw new B(A.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let t=[];if(e)if(Array.isArray(e))t=e;else{if(!(e instanceof id))return this._unpublishDataChannel([e]);t=[e]}else this.store.useP2P||await this._unpublishDataChannel(),t=this._p2pChannel.getAllTracks(!0);R.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(t.map(r=>"".concat(r.getTrackId()," "))," "));let i=await this._publishMutex.lock();try{if(this._p2pChannel instanceof Mr){let r=await this._p2pChannel.unpublish(t);r&&await this._gateway.sendExtensionMessage(Gt.UNPUBLISH,{unpubMsg:r},!0)}else{let r=await this._p2pChannel.unpublish(t);r&&await this._gateway.unpublish(r,this._uid),R.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(t.map(a=>"".concat(a.getTrackId()))))}}catch(r){throw R.error("[".concat(this._clientId,"] unpublish error"),r.toString()),r}finally{i&&i()}}async _unpublishDataChannel(e){e!==void 0&&e.length!==0||(e=this._p2pChannel.getAllDataChannels()),R.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(e.map(i=>"".concat(i.id," "))," "));let t=await this._publishMutex.lock();try{let i=await this._p2pChannel.unpublishDataChannel(e);i&&await this._gateway.unpublishDataChannel(i),R.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(e.map(r=>"".concat(r.id))))}catch(i){throw R.error("[".concat(this._clientId,"] unpublish dataChannel error"),i.toString()),i}finally{t&&t()}}async subscribe(e,t,i){if(!(e instanceof Eo)){let r=this.remoteUsers.find(a=>a.uid===e);if(!r)throw new B(A.INVALID_REMOTE_USER,"user is not in the channel");e=r}return t==="datachannel"?this._subscribeDataChannel(e,i):this._subscribe(e,t)}async presubscribe(e,t){if(li(t,"mediaType",["audio","video"]),this._p2pChannel instanceof Mr)throw new B(A.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new B(A.INVALID_OPERATION,"can't presub when not join");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new B(A.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));let i=t===_e.AUDIO,r=t===_e.VIDEO,a=await this._subscribeMutex.lock();try{let{ssrcId:s,ortc:c,rtxSsrcId:l,cname:u,uint_id:h}=await this._gateway.presubscribe(e,t,!0);if(s==null)throw new B(A.UNEXPECTED_RESPONSE,"no ssrc id");let p=this._users.find(m=>m.uid===e);p||(p=new Eo(e,h||e),p._is_pre_created=!0,this._users.push(p)),u&&(p._cname=u),p._uintid||(p._uintid=h||e),i&&(p._audioSSRC=s,p._audio_pre_subscribed=!0,c&&(p._audioOrtc=c)),r&&(p._videoSSRC=s,p._video_pre_subscribed=!0,c&&(p._videoOrtc=c),l!=null&&(p._rtxSsrcId=l)),R.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(s)),await this._p2pChannel.subscribe(p,t,s,l,c);let _=i?p._audioTrack:p._videoTrack;if(!_)throw new B(A.UNEXPECTED_ERROR,"can not find remote track in user");return i&&(p._trust_audio_stream_added_state_=!0,p._audio_added_=!0),r&&(p._trust_video_stream_added_state_=!0,p._video_added_=!0),_}catch(s){throw R.error("[".concat(this._clientId,"] presub user ").concat(e," error"),s),s}finally{a()}}async _subscribeDataChannel(e,t){var i;if(nt(t,"channelId",0,65535,!0),!this._joinInfo)throw new B(A.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new B(A.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find(c=>c===e))throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),new B(A.INVALID_REMOTE_USER,"user is not in the channel");if(!e.hasAudio&&!e.hasVideo&&e._dataChannels.length===0)throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),new B(A.INVALID_REMOTE_USER,"user is not published");let r=(i=e._dataChannels)===null||i===void 0?void 0:i.find(c=>c.id===t);if(!r)throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, remote datachannel is not published")),new B(A.REMOTE_USER_IS_NOT_PUBLISHED);let a=await this._subscribeMutex.lock();R.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: datachannel"));try{let c=await this._p2pChannel.subscribeDataChannel(e,[r]);if(c&&oe(c).call(c,r.id))try{var s;if(typeof r._originDataChannelId!="number")throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, cannot get RTCDatachannel")),new B(A.CREATE_DATACHANNEL_ERROR);let l={id:r.id,datachannelId:r._originDataChannelId,ordered:r.ordered,maxRetransmits:r.maxRetransmits,metadata:(s=r.metadata)!==null&&s!==void 0?s:""};await this._gateway.subscribeDataChannel(e.uid,l,!0),await r._waitTillOpen()}catch(l){if((l==null?void 0:l.code)!==A.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(e,[r]),l;await this._p2pChannel.unsubscribeDataChannel(e,[r]),this._p2pChannel.setPendingRemoteDataChannel(e,r.id)}return R.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: datachannel")),r}finally{a()}}async _p2pSubscribe(e,t,i){if(li(t,"mediaType",["audio","video"]),!this._joinInfo)throw new B(A.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new B(A.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(a=>a===e)){let a=new B(A.INVALID_REMOTE_USER,"user is not in the channel");throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),a}if(!e.hasAudio&&!e.hasVideo){let a=new B(A.INVALID_REMOTE_USER,"user is not published");throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),a}if(!i&&(t==="audio"&&!e.hasAudio||t==="video"&&!e.hasVideo)){let a=new B(A.REMOTE_USER_IS_NOT_PUBLISHED);throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),a}let r=await this._subscribeMutex.lock();R.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{let s=t==="audio"?e._audioSSRC:e._videoSSRC,c=t==="audio"?e._audioMid:e._videoMid;this.store.subscribe(e.uid,t,Date.now()),this._p2pChannel instanceof Mr&&await this._p2pChannel.subscribe(e,t,s,c)}catch(s){throw s}R.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(s=>{R.warning("[".concat(this._clientId,"] auto set fallback failed"),s)});let a=t==="audio"?e._audioTrack:e._videoTrack;if(!a)throw new B(A.UNEXPECTED_ERROR,"can not find remote track in user object");return a}catch(a){throw R.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),a),a}finally{r()}}async _subscribe(e,t,i){if(this._p2pChannel instanceof Mr)return this._p2pSubscribe(e,t);if(li(t,"mediaType",["audio","video"]),!this._joinInfo)throw new B(A.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new B(A.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(u=>u===e)){let u=new B(A.INVALID_REMOTE_USER,"user is not in the channel");throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),u}if(!e.hasAudio&&!e.hasVideo){let u=new B(A.INVALID_REMOTE_USER,"user is not published");throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),u}if(!(i||(t!=="audio"||e.hasAudio&&e._audioSSRC!==void 0)&&(t!=="video"||e.hasVideo&&e._videoSSRC!==void 0))){let u=new B(A.REMOTE_USER_IS_NOT_PUBLISHED);throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),u}let r=t==="audio"?e._audioSSRC:e._videoSSRC,a=t==="audio"?e._audioOrtc:e._videoOrtc,s=t==="video"?e._rtxSsrcId:void 0,c={stream_type:t==="audio"?_e.AUDIO:_e.VIDEO,ssrcId:r},l=await this._subscribeMutex.lock();R.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{let h=t==="audio"?e._audioSSRC:e._videoSSRC;h!==void 0&&h!==r&&(r=h,a=t==="audio"?e._audioOrtc:e._videoOrtc,s=t==="video"?e._rtxSsrcId:void 0,c={stream_type:t==="audio"?_e.AUDIO:_e.VIDEO,ssrcId:r}),ji.markSubscribeStart(this.store.clientId,r),this.store.subscribe(e.uid,t,Date.now()),await this._p2pChannel.subscribe(e,t,r,s,a);try{this._p2pChannel.isPreSubScribe(r)||await this._gateway.subscribe(e.uid,c,!0)}catch(p){if((p==null?void 0:p.code)!==A.WS_ABORT)throw await this._p2pChannel.unsubscribe(e,t),p;await this._p2pChannel.unsubscribe(e,t,!0),this._p2pChannel.setPendingRemoteMedia(e,t)}this.store.subscribe(e.uid,t,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,e,t)}catch(h){throw this._p2pChannel.reportSubscribeEvent(!1,h==null?void 0:h.code,e,t),h}R.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(h=>{R.warning("[".concat(this._clientId,"] auto set fallback failed"),h)});let u=t==="audio"?e._audioTrack:e._videoTrack;if(!u)throw new B(A.UNEXPECTED_ERROR,"can not find remote track in user object");return u}catch(u){throw R.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),u),u}finally{l()}}async massSubscribe(e){if(Cs(e,"subscribeList"),!this._joinInfo)throw new B(A.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new B(A.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));let t=Date.now(),i=new Map,r=await this._subscribeMutex.lock();R.info("[".concat(this._clientId,"]start massSubscribe user ").concat(e.map(l=>{let{user:u,mediaType:h}=l;return"user: ".concat(u==null?void 0:u.uid,", mediaType: ").concat(h)}).join("; ")));let a=(e=[...e]).map(l=>{let{user:u,mediaType:h}=l;return{user:u,mediaType:h}}),s=await this._p2pChannel.globalLock();try{var c;for(let u=e.length-1;u>=0;u--){let h=e[u],{user:p,mediaType:_}=h;if(li(_,"mediaType",["audio","video"]),!p){let C=new B(A.INVALID_PARAMS,"user property does not exist in subscribeList item");throw R.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),C}if(!this._users.find(C=>C===p)){let C=new B(A.INVALID_REMOTE_USER,"user is not in the channel");R.error("[".concat(this._clientId,"] can not massSubscribe ").concat(p.uid,", this user is not in the channel")),a[u].error=C,e.splice(u,1);continue}if(_==="audio"&&(!p.hasAudio||p._audioSSRC===void 0)||_==="video"&&(!p.hasVideo||p._videoSSRC===void 0)){let C=new B(A.REMOTE_USER_IS_NOT_PUBLISHED);R.error("[".concat(this._clientId,"] can not subscribe ").concat(p.uid," with mediaType ").concat(_,", remote user is not published")),a[u].error=C,e.splice(u,1);continue}let m=ui.Video|ui.LwoVideo,S=i.get(p);if(S){if(_==="video"?S&m:S&ui.Audio){e.splice(u,1),R.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(p.uid,", mediaType:").concat(_," twice"));continue}i.set(p,S|(_==="video"?m:ui.Audio))}else i.set(p,_==="video"?m:ui.Audio)}for(let u=e.length-1;u>=0;u--){let h=e[u],{user:p,mediaType:_}=h,m=ui.Video|ui.LwoVideo;if(this._p2pChannel.hasRemoteMedia(p,_)){await this._p2pChannel.unmuteRemoteNoLock(p,_);let S=i.get(p);i.set(p,_==="video"?S^m:S^ui.Audio),e.splice(u,1)}}this.store.massSubscribe(e.map(u=>({userId:u.user.uid,type:u.mediaType})),t);let l=Sn(c=Array.from(i.entries())).call(c,(u,h)=>{let[p,_]=h;if(_===0)return u;let m={stream_id:p.uid,stream_type:_};return _&ui.Audio&&(m.audio_ssrc=p._audioSSRC),_&ui.Video&&(m.video_ssrc=p._videoSSRC),u.push(m),u},[]);try{e.length>0&&await this._p2pChannel.massSubscribeNoLock(e.map(h=>{let{user:p,mediaType:_}=h;return{user:p,mediaType:_,ssrcId:_===_e.VIDEO?p._videoSSRC:p._audioSSRC,rtxSsrcId:_===_e.VIDEO?p._rtxSsrcId:void 0}}));let u=new Map;if(l=l.filter(h=>h.video_ssrc&&!this._p2pChannel.isPreSubScribe(h.video_ssrc)||h.audio_ssrc&&!this._p2pChannel.isPreSubScribe(h.audio_ssrc)||!h.video_ssrc&&!h.audio_ssrc),l.length>0){let h=await this._gateway.subscribeAll(l,!0);((h==null?void 0:h.users)||[]).forEach(p=>{let{stream_id:_,video_error_code:m,audio_error_code:S,error_code:C}=p;(m||S||C)&&u.set(_,{video_error_code:m,audio_error_code:S,error_code:C})})}if(Array.from(u.entries()).length>0){let h=[];Array.from(u.entries()).forEach(p=>{let[_,m]=p,S=this.remoteUsers.find(C=>C.uid===_);if(S){let C;m.error_code||m.video_error_code&&m.audio_error_code?C=void 0:m.video_error_code?C=_e.VIDEO:m.audio_error_code&&(C=_e.AUDIO),h.push({user:S,mediaType:C})}}),h.length>0&&await this._p2pChannel.massUnsubscribeNoLock(h)}for(let h of a){let p=u.get(h.user.uid);if(p){let _=p.error_code||h.mediaType==="audio"&&p.audio_error_code||h.mediaType==="video"&&p.video_error_code;if(_){let m=Vh(_);R.error("user:".concat(h.user.uid," mediaType:").concat(h.mediaType," has massSubscribe error ").concat(m.desc)),h.error=new B(A.SUBSCRIBE_FAILED,"code ".concat(_,": ").concat(m.desc))}}h.error||(h.mediaType==="video"?h.track=h.user.videoTrack:h.track=h.user.audioTrack)}return this.store.massSubscribe(a.filter(h=>!h.error).map(h=>({userId:h.user.uid,type:h.mediaType})),void 0,Date.now()),a.forEach(h=>{var p;fe.subscribe(this.store.sessionId,{succ:!!h.error,ec:((p=h.error)===null||p===void 0?void 0:p.code)||null,video:h.mediaType===_e.VIDEO,audio:h.mediaType===_e.AUDIO,peerid:h.user.uid,subscribeRequestid:h.mediaType===_e.VIDEO?h.user._videoSSRC:h.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-t),preSsrc:this._p2pChannel.isPreSubScribe(h.user._videoSSRC)},!0)}),R.info("[".concat(this._clientId,"] massSubscribe success ").concat(e.map(h=>{let{user:p,mediaType:_}=h;return"user: ".concat(p==null?void 0:p.uid,", mediaType: ").concat(_)}).join("; "))),a}catch(u){throw await this._p2pChannel.massUnsubscribeNoLock(e),u}}finally{s(),r()}}async unsubscribe(e,t,i){if(!(e instanceof Eo)){let a=this.remoteUsers.find(s=>s.uid===e);if(!a)throw new B(A.INVALID_REMOTE_USER,"user is not in the channel");e=a}if(t||this.store.useP2P){if(t==="datachannel")return this._unsubscribeDataChannel(e,i)}else await this._unsubscribeDataChannel(e,i);if(t&&li(t,"mediaType",["audio","video"]),!this._joinInfo)throw new B(A.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find(a=>a===e)){let a=new B(A.INVALID_REMOTE_USER,"user is not in the channel");throw R.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),a}R.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: ").concat(t));let r=await this._subscribeMutex.lock();try{if(this._p2pChannel instanceof Mr)await this._p2pChannel.unsubscribe(e,t);else{let a=await this._p2pChannel.unsubscribe(e,t);a&&await this._gateway.unsubscribe(a,e.uid),t&&t!=="audio"||(e._audio_pre_subscribed=!1),t&&t!=="video"||(e._video_pre_subscribed=!1),e._is_pre_created&&hE(this._users,e),R.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(e.uid,", mediaType: ").concat(t))}}catch(a){if(a.code===A.DISCONNECT_P2P)return void R.warning("disconnecting p2p, abort unsubscribe request.");throw R.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),a.toString()),a}finally{r()}}async _unsubscribeDataChannel(e,t){if(t&&nt(t,"id",0,65535,!0),!this._joinInfo)throw new B(A.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find(r=>r===e)){let r=new B(A.INVALID_REMOTE_USER,"user is not in the channel");throw R.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),r}let i;if(typeof t=="number"){let r=e._dataChannels.find(a=>a.id===t);r&&(i=[r])}else i=e._dataChannels;if(i===void 0){let r=new B(A.REMOTE_USER_IS_NOT_PUBLISHED);throw R.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid," with channelId ").concat(t,", remote datachannel is not published")),r}R.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(i.map(r=>r.id)));try{let r=await this._p2pChannel.unsubscribeDataChannel(e,i);r&&await this._gateway.unsubscribeDataChannel(r,e.uid),R.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(r))}catch(r){if(r.code===A.DISCONNECT_P2P)return void R.warning("disconnecting p2p, abort unsubscribe request.");throw R.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),r.toString()),r}}async massUnsubscribe(e){if(Cs(e,"unsubscribeList"),!this._joinInfo)throw new B(A.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");R.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(e.map(i=>{let{user:r,mediaType:a}=i;return"user: ".concat(r==null?void 0:r.uid,", mediaType: ").concat(a,";")}).join())),e=[...e];let t=new Map;for(let i=e.length-1;i>=0;i--){let{user:r,mediaType:a}=e[i];if(!r){let c=new B(A.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw R.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),c}if(li(a,"mediaType",["video","audio",void 0]),!this._users.find(c=>c===r)){R.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(r.uid,", user is not in the channel")),e.splice(i,1);continue}let s=ui.Video|ui.LwoVideo;if(t.has(r)){let c=t.get(r),l;switch(a){case"video":l=c&s;break;case"audio":l=c&ui.Audio;break;default:l=c&(ui.Audio|s)}if(l){R.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(r.uid,",mediaType:").concat(a," twice.")),e.splice(i,1);continue}a?a==="audio"?t.set(r,c|ui.Audio):a==="video"&&t.set(r,c|s):t.set(r,c|ui.Audio|s)}else a?a==="audio"?t.set(r,ui.Audio):a==="video"&&t.set(r,s):t.set(r,ui.Audio|s)}try{let i=await this._p2pChannel.massUnsubscribe(e);i&&await this._gateway.massUnsubscribe(i),R.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(e.map(r=>{let{user:a,mediaType:s}=r;return"user: ".concat(a==null?void 0:a.uid,", mediaType: ").concat(s,";")}).join()))}catch(i){if(i.code===A.DISCONNECT_P2P)return void R.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw R.error("[".concat(this._clientId,"] massUnsubscribe error"),i.toString()),i}}async setLowStreamParameter(e){(function(i){if(!i)throw new H(A.INVALID_PARAMS);Dt(i.width)||PT(i.width,"streamParameter.width"),Dt(i.height)||PT(i.height,"streamParameter.height"),Dt(i.framerate)||PT(i.framerate,"streamParameter.framerate"),Dt(i.bitrate)||nt(i.bitrate,"streamParameter.bitrate")})(e),(!e.width&&e.height||e.width&&!e.height)&&R.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),R.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(e));let t=this._configDistribute.getLowStreamConfigDistribute();if(t&&t.bitrate&&e.bitrate&&t.bitrate<e.bitrate&&(e.bitrate=t.bitrate),this._lowStreamParameter=e,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(e,Q.LocalVideoLowTrack)}async enableDualStream(){if(!Ke().supportDualStream)throw fe.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new B(A.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new B(A.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(e){throw fe.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),e}this._isDualStreamEnabled=!0,fe.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),R.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new B(A.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia(Q.LocalVideoLowTrack))try{let e=await this._p2pChannel.unpublishLowStream();e&&await this._gateway.unpublish(e,this._joinInfo.stringUid||this._joinInfo.uid)}catch(e){throw fe.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),e}this._isDualStreamEnabled=!1,fe.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),R.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(e,t){if(function(i){li(i,"role",["audience","host"])}(e),t&&GN(t),this.mode==="rtc"||this.mode==="p2p")throw R.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new B(A.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(t&&t.level&&e==="host")throw new B(A.INVALID_OPERATION,"host mode can not set audience latency level");if(e==="audience"&&this._p2pChannel.hasLocalMedia())throw new B(A.INVALID_OPERATION,"can not set client role to audience when publishing stream");await this._gateway.setClientRole(e,t),this._config.role=e,R.info("[".concat(this._clientId,"] set client role to ").concat(e,", level: ").concat(t&&t.level))}getRemoteInboundOffset(){var e;let t=(e=this._p2pChannel.getStats())===null||e===void 0?void 0:e.audioSend[0];if(!t||!t.timestamp)return 0;let i=t.timestamp-Date.now();return Math.abs(i)>1e3+t.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?i:0}getNtpWallTimeInMs(){return document.visibilityState==="visible"&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(e,t){if(Ti(e,"proxyServer"),!t){if(this.connectionState!=="DISCONNECTED")throw new B(A.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new B(A.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=e,fe.setProxyServer(this._proxyServer),R.setProxyServer(this._proxyServer),R.info("[".concat(this._clientId,"] Set proxy server ").concat(t?"by initialize call":""," success."))}setTurnServer(e,t){if(Array.isArray(e)||(e=[e]),!t){if(this.connectionState!=="DISCONNECTED")throw new B(A.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new B(A.INVALID_OPERATION,"You have already set the proxy")}if(XE(e))return this._turnServer={servers:e,mode:"original-manual"},void R.info("[".concat(this._clientId,"] Set original turnserver ").concat(t?"by initialize call":""," success: ").concat(e.map(i=>i.urls).join(","),"."));e.forEach(i=>Zx(i)),this._turnServer={servers:e,mode:"manual"},R.info("[".concat(this._clientId,"] Set turnserver ").concat(t?"by initialize call":""," success."))}setLicense(e){if(this.connectionState!=="DISCONNECTED")throw new B(A.INVALID_OPERATION,"you should set license before join channel");if(Ti(e,"license",32,32),!/^[A-Za-z\d]+$/.test(e))throw new B(A.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=e,R.info("[".concat(this._clientId,"] set license success"),e)}startProxyServer(e){if(this.connectionState!=="DISCONNECTED")throw new B(A.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new B(A.INVALID_OPERATION,"You have already set the proxy");let t=[3,4,5],i;switch(e===void 0&&(e=3),e){case 1:case 2:throw new B(A.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:i="proxy3";break;case 4:i="proxy4";break;case 5:i="proxy5";break;default:throw new B(A.INVALID_PARAMS,"proxy server mode must be ".concat(t.join("|")))}this._cloudProxyServerMode=i,this.store.cloudProxyServerMode=i,R.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new B(A.INVALID_OPERATION,"Stop proxy server after leave channel");fe.setProxyServer(),R.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",R.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(e){if(!e.accessPoints)throw new B(A.INVALID_PARAMS,"accessPoints is required.");Cs(e.accessPoints.serverList,"accessPoints.serverList"),Ti(e.accessPoints.domain,"accessPoints.domain");let t=(m,S)=>{nt(m,S,0,65535,!0)},i=443;if(e.accessPoints.port&&(t(e.accessPoints.port,"accessPoints.port"),i=e.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new B(A.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");k("CLOSE_AFB_FOR_LOCAL_AP")&&(at("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),at("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));let r=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,a=e.accessPoints.domain,s=e.accessPoints.serverList.map(m=>r.test(m)?"".concat(m.replace(/\./g,"-"),".").concat(a):m),c=s.map(m=>"".concat(m,":").concat(i));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,at("WEBCS_DOMAIN",c),at("WEBCS_DOMAIN_BACKUP_LIST",c),at("GATEWAY_DOMAINS",[a]),e.report&&e.report.hostname&&Array.isArray(e.report.hostname)&&e.report.hostname.length?(Cs(e.report.hostname,"report.hostname"),at("EVENT_REPORT_DOMAIN",e.report.hostname[0]),at("EVENT_REPORT_BACKUP_DOMAIN",e.report.hostname[1]||e.report.hostname[0])):(at("EVENT_REPORT_DOMAIN",s[0]),at("EVENT_REPORT_BACKUP_DOMAIN",s[1]||s[0]));let l=6443;e.report&&e.report.port&&(t(e.report.port,"report.port"),l=e.report.port),at("STATS_COLLECTOR_PORT",l),e.report?at("ENABLE_EVENT_REPORT",!0):at("ENABLE_EVENT_REPORT",!1);let u="";e.log&&e.log.hostname&&Array.isArray(e.log.hostname)&&e.log.hostname.length?(Cs(e.log.hostname,"log.hostname"),u=e.log.hostname[0]):u=s[0];let h=6444;e.log&&e.log.port&&(t(e.log.port,"log.port"),h=e.log.port),at("LOG_UPLOAD_SERVER","".concat(u,":").concat(h));let p=[];e.cds&&e.cds.hostname&&Array.isArray(e.cds.hostname)&&e.cds.hostname.length?(Cs(e.cds.hostname,"cds.hostname"),p=e.cds.hostname):p=s;let _=443;e.cds&&e.cds.port&&(t(e.cds.port,"cds.port"),_=e.cds.port),at("CDS_AP",p.map(m=>"".concat(m,":").concat(_))),e.cds?at("ENABLE_CONFIG_DISTRIBUTE",!0):at("ENABLE_CONFIG_DISTRIBUTE",!1),R.info("set local access point v2 success")}setLocalAccessPoints(e,t){if(Cs(e,"serverList"),Ti(t,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new B(A.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");let i=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;e=e.map(r=>i.test(r)?"".concat(r.replace(/\./g,"-"),".").concat(t):r),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,at("WEBCS_DOMAIN",e),at("WEBCS_DOMAIN_BACKUP_LIST",e),at("GATEWAY_DOMAINS",[t]),at("EVENT_REPORT_DOMAIN",e[0]),at("EVENT_REPORT_BACKUP_DOMAIN",e[1]||e[0]),at("LOG_UPLOAD_SERVER","".concat(e[0],":6444")),R.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(e){if(li(e,"streamType",[0,1]),this._remoteDefaultVideoStreamType=e,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(e),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(t){throw R.error("[".concat(this._clientId,"] set default remote video stream type error"),t.toString()),t}else R.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(e))}async setRemoteVideoStreamType(e,t){li(t,"streamType",[0,1]);try{await this._gateway.setRemoteVideoStreamType(e,t),setTimeout(()=>{let i=this._users.find(r=>r.uid===e);i&&i.videoTrack&&i.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(i){throw R.error("[".concat(this._clientId,"] set remote video stream type error"),i.toString()),i}R.info("[".concat(this._clientId,"] set remote ").concat(e," video stream type to ").concat(t)),this._remoteStreamTypeCacheMap.set(e,t)}async setStreamFallbackOption(e,t){li(t,"fallbackType",[0,1,2]);try{await this._gateway.setStreamFallbackOption(e,t)}catch(i){throw R.error("[".concat(this._clientId,"] set stream fallback option"),i.toString()),i}R.info("[".concat(this._clientId,"] set remote ").concat(e," stream fallback type to ").concat(t)),this._streamFallbackTypeCacheMap.set(e,t)}setEncryptionConfig(e,t,i,r){(function(s){li(s,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(e),Ti(t,"secret");let a=["aes-128-gcm2","aes-256-gcm2"];if(oe(a).call(a,e)){if(!i||!(i instanceof Uint8Array&&i.length===32))throw new B(A.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(i)throw new B(A.INVALID_PARAMS,"current encrypt mode does not need salt");if(r){if(Is(r,"encryptDataStream"),!oe(a).call(a,e))throw new B(A.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(t)||R.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=e,this._encryptionSecret=t,i&&(this._encryptionSalt=bo(i))}async renewToken(e){if(Ti(e,"token",1,2047),!this._key||!this._joinInfo)throw new B(A.INVALID_OPERATION,"renewToken should not be called before user join");let t=this._key;this._key=e,this._joinInfo&&(this._joinInfo.token=e);let i=await this._renewTokenMutex.lock();try{if(k("USE_NEW_TOKEN")){R.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));let r=await AJ(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||ti);R.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:e,ticket:r})}else R.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:e});R.debug("[".concat(this._clientId,"] renewToken success"))}catch(r){throw this._key=t,this._joinInfo.token=t,R.error("[".concat(this._clientId,"] renewToken failed"),r.toString()),r}finally{i()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?R.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{let e=this._p2pChannel.getAudioLevels();this.safeEmit(Me.VOLUME_INDICATOR,e)},k("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){let e=this._statsCollector.getRTCStats(),t=this._gateway.getInChannelInfo();return e.Duration=Math.round(t.duration/1e3),e}async startLiveStreaming(e,t){if(!t){if(this.codec!=="h264")throw new B(A.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new B(A.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(e)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(e))throw new B(A.LIVE_STREAMING_TASK_CONFLICT);let i=t?Os.TRANSCODE:Os.RAW;return this._createLiveStreamingClient(i).startLiveStreamingTask(e,i)}setLiveTranscoding(e){return this._createLiveStreamingClient(Os.TRANSCODE).setTranscodingConfig(e)}async stopLiveStreaming(e){let t=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(i=>i&&i.hasUrl(e));if(!t.length)throw new B(A.INVALID_PARAMS,"can not find live streaming url to stop");await ae.all(t.map(i=>i&&i.stopLiveStreamingTask(e)))}async startChannelMediaRelay(e){nk(e),await this._createChannelMediaRelayClient().startChannelMediaRelay(e)}async updateChannelMediaRelay(e){nk(e),await this._createChannelMediaRelayClient().updateChannelMediaRelay(e)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}async sendStreamMessage(e){var t;let i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new B(A.INVALID_OPERATION,"can not send data stream, not joined");if((typeof e=="string"||e instanceof Uint8Array)&&(e={payload:e}),typeof e.payload=="string"){let a=new TextEncoder;e.payload=a.encode(e.payload)}let r=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&oe(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)&&(r=!0,e.payload=await async function(a,s,c){var l;let u=Sn(l=Array.from(c)).call(l,(v,y)=>v+y,0),h={serverTs:0,seq:H7++,length:c.length,checkSum:u},p=new Uint8Array(qN(u,2)),_=new ArrayBuffer(wl),m=new DataView(_);m.setUint32(0,h.serverTs),m.setUint16(4,h.seq),m.setUint16(6,h.length),m.setUint16(8,h.checkSum);let S=16-c.length%16;c=WN(c,new Uint8Array(S));let C=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:a,tagLength:JN,additionalData:p},s,c);return WN(new Uint8Array(_),new Uint8Array(C))}(this._encryptDataStreamIv,this._encryptDataStreamKey,e.payload)),new Blob([e.payload]).size>1024)throw new B(A.INVALID_PARAMS,r?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(ve.DATA_STREAM,{payload:bo(e.payload),syncWithAudio:e.syncWithAudio,sendTs:Date.now()-QJ},!i)}sendMetadata(e){if(!this._joinInfo)throw new B(A.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([e]).size>1024)throw new B(A.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(ve.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:bo(e)})}async sendCustomReportMessage(e){if(Array.isArray(e)||(e=[e]),e.forEach(K7),!this._joinInfo)throw new B(A.INVALID_OPERATION,"can not send custom report, not joined");await fe.sendCustomReportMessage(this._joinInfo.sid,e)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){return this._statsCollector.getRemoteNetworkQualityStats()}async pickSVCLayer(e,t){li(t.spatialLayer,"spatialLayer",[0,1,2,3]),li(t.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(e,t)}catch(i){throw R.error("[".concat(this._clientId,"] pick SVC layer failed"),i.toString()),i}}async setRTMConfig(e){let{apRTM:t=!1,rtmFlag:i}=e;if(Is(t,"apRTM"),nt(i,"rtmFlag",0),this._rtmConfig.apRTM=t,this._rtmConfig.rtmFlag=i,R.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(e)," in ").concat(this.connectionState," state")),(this.connectionState==="CONNECTED"||this.connectionState==="RECONNECTING")&&this._joinInfo)return this._joinInfo.apRTM=t,this._joinInfo.rtmFlag=i,this._gateway.setRTM2Flag(i)}_reset(){if(R.debug("[".concat(this._clientId,"] reset client")),this._axiosCancelSource.cancel(),this._axiosCancelSource=yr.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&RB(this._joinInfo),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId=null,this.store.sessionId=null,this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach(e=>{e._audioTrack&&e._audioTrack._destroy(),e._videoTrack&&e._videoTrack._destroy(),e._dataChannels&&(e._dataChannels.forEach(t=>t._close()),e._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new Fi("client-publish"),this._subscribeMutex=new Fi("client-subscribe"),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(e,t){var i;let r=e||$l();e?R.debug("[".concat(this._clientId,"] new Session ").concat(r)):R.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(r));let a=e?"":this._sessionId||"";this._sessionId=r,this.store.sessionId=r;let s={lts:new Date().getTime(),mode:this.mode,buildFormat:2,stringUid:(t==null?void 0:t.stringUid)||((i=this._joinInfo)===null||i===void 0?void 0:i.stringUid),channelProfile:this.mode==="live"?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:a,clientRole:this.role==="audience"?2:1};fe.sessionInit(this._sessionId,_n({cname:t.channel,appid:t.appId},s)),this._joinInfo&&(this._joinInfo.sid=r),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=r)}async _publishHighStream(e){if(!this._joinInfo||this._uid===void 0)throw new B(A.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new B(A.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&k("FORCE_TURN")&&!k("TURN_ENABLE_TCP")&&!k("TURN_ENABLE_UDP"))throw new B(A.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");R.debug("[".concat(this._clientId,"] publish high stream"));try{let i=await this._p2pChannel.publish(e,this._isDualStreamEnabled,this._lowStreamParameter);if(this._p2pChannel instanceof Mr){let r=(await i.next()).value;if(r){try{await this._gateway.sendExtensionMessage(Gt.PUBLISH,r,!0)}catch(a){throw i.throw(a),a}await i.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{let r=(await i.next()).value;if(r){var t;let a;try{a=await this._gateway.publish(this._uid,r,!0)}catch(s){if(s.code!==A.DISCONNECT_P2P)throw i.throw(s),s}await i.next(((t=a)===null||t===void 0?void 0:t.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(let a of e)a instanceof St&&a._encoderConfig&&this._gateway.setVideoProfile(a._encoderConfig),!a.muted&&a.enabled||await this._p2pChannel.muteLocalTrack(a)}}catch(i){if(this._p2pChannel.reportPublishEvent(!1,i==null?void 0:i.code,e),(i==null?void 0:i.code)===A.WS_ABORT)return;throw i}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new B(A.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new B(A.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));R.debug("[".concat(this._clientId,"] publish low stream"));let e=this._configDistribute.getLowStreamConfigDistribute();e&&e.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&e.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=e.bitrate));try{let i=await this._p2pChannel.publishLowStream(this._lowStreamParameter),r=(await i.next()).value;if(r){var t;let a;try{a=await this._gateway.publish(this._uid,r,!0)}catch(s){if(s.code!==A.DISCONNECT_P2P)throw i.throw(s),s}i.next(((t=a)===null||t===void 0?void 0:t.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(i){if(this._p2pChannel.reportPublishEvent(!1,i==null?void 0:i.code,void 0,!0),(i==null?void 0:i.code)===A.WS_ABORT)return;throw i}}_createLiveStreamingClient(e){let t=()=>{if(!this._joinInfo||!this._appId)return new B(A.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();let i=(r={joinInfo:this._joinInfo,appId:this._appId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig},uh("LiveStreaming").create(r));var r;return i.onLiveStreamError=(a,s)=>{fe.reportApiInvoke(this._sessionId,{name:ni.ON_LIVE_STREAM_ERROR,options:[a,s],tag:Vt.TRACER}).onSuccess(),this.safeEmit(Me.LIVE_STREAMING_ERROR,a,s)},i.onLiveStreamWarning=(a,s)=>{fe.reportApiInvoke(this._sessionId,{name:ni.ON_LIVE_STREAM_WARNING,options:[a,s],tag:Vt.TRACER}).onSuccess(),this.safeEmit(Me.LIVE_STREAMING_WARNING,a,s)},i.on(Uv.REQUEST_WORKER_MANAGER_LIST,(a,s,c)=>{if(!this._joinInfo)return c(new B(A.INVALID_OPERATION,"can not find join info to get worker manager"));(async function(l,u,h,p){let _=k("UAP_AP").slice(0,k("AJAX_REQUEST_CONCURRENT")).map(m=>u.proxyServer?"https://".concat(u.proxyServer,"/ap/?url=").concat(m+"/api/v1?action=uap"):"https://".concat(m,"/api/v1?action=uap"));return await TJ(_,l,u,h,p)})(a,this._joinInfo,this._axiosCancelSource.token,ti).then(s).catch(c)}),i};return e===Os.RAW?(this._liveRawStreamingClient=this._liveRawStreamingClient||t(),this._liveRawStreamingClient):(this._liveTranscodeStreamingClient=this._liveTranscodeStreamingClient||t(),this._liveTranscodeStreamingClient)}_createChannelMediaRelayClient(){if(!this._joinInfo)return new B(A.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){let{sendResolutionWidth:t,sendResolutionHeight:i}=this.getLocalVideoStats(),r=(e={joinInfo:this._joinInfo,clientId:this._clientId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig,resolution:{width:t,height:i}},uh("ChannelMediaRelay").create(e));r.on("state",a=>{a===Or.RELAY_STATE_FAILURE&&r&&r.dispose(),this.safeEmit(Me.CHANNEL_MEDIA_RELAY_STATE,a)}),r.on("event",a=>{this.safeEmit(Me.CHANNEL_MEDIA_RELAY_EVENT,a)}),this._channelMediaRelayClient=r,this._statsCollector.onStatsChanged=(a,s)=>{var c;a==="resolution"&&((c=this._channelMediaRelayClient)===null||c===void 0||c.setVideoProfile(s))}}var e;return this._channelMediaRelayClient}_handleUpdateDataChannel(e,t){let{added:i,deleted:r}=e,a=[];if(t){let s=[];this._users.forEach(c=>{c._dataChannels.forEach(l=>{i.every(u=>u.uid!==c._uintid||u.stream_id!==l.id)&&s.push({uid:c._uintid,stream_id:l.id,ordered:l.ordered,max_retrans_times:l.maxRetransmits,metadata:l.metadata})})}),s.length>0&&this._handleUpdateDataChannel({added:[],deleted:s})}Array.isArray(i)&&i.length>0&&i.forEach(s=>{let{uid:c,stream_id:l,ordered:u,max_retrans_times:h,metadata:p}=s,_=this._users.find(m=>m._uintid===c);if(!_)return void R.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"));if(R.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(c)),oe(a).call(a,_)||a.push(_),_._uintid||(_._uintid=c),_._dataChannels.findIndex(m=>m.id===s.stream_id)===-1){let m={id:l,ordered:!!u,maxRetransmits:h,metadata:p},S=function(C){return gk(C,!0)}(m);_._dataChannels.push(S),R.info("[".concat(this._clientId,"] remote user ").concat(_.uid," published datachannel")),t||this.safeEmit(Me.USER_PUBLISHED,_,"datachannel",m)}this._p2pChannel.hasPendingRemoteDataChannel(_,s.stream_id)&&(R.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(_.uid," after reconnect.")),this._subscribeDataChannel(_,s.stream_id).catch(m=>{R.error("[".concat(this._clientId,"] resubscribe datachannel error"),m.toString())}))}),t&&(this.safeEmit(Me.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(r)&&r.length>0&&r.forEach(s=>{let{uid:c,stream_id:l}=s,u=this._users.find(p=>p._uintid===c);if(!u)return void R.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));let h=u._dataChannels.find(p=>p.id===s.stream_id);h&&(R.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(c)),this._p2pChannel.unsubscribeDataChannel(u,[h]).then(p=>{if(u._dataChannels=u._dataChannels.filter(_=>_!==h),p)return this._gateway.unsubscribeDataChannel(p,u.uid)}),R.info("[".concat(this._clientId,"] remote user ").concat(c," unpublished datachannel ,id:").concat(h.id)),this.safeEmit(Me.USER_UNPUBLISHED,u,"datachannel",h._config))})}_handleRemoveDataChannels(e){let t=this._users.find(i=>i.uid===e.uid);if(t){if(t._dataChannels!==void 0&&t._dataChannels.length>0){R.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(e.uid));let i=()=>{R.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished datachannel")),t._dataChannels.forEach(r=>{this.safeEmit(Me.USER_UNPUBLISHED,t,"datachannel",r._config)})};this._p2pChannel.unsubscribeDataChannel(t,t._dataChannels).then(r=>{if(r)return this._gateway.unsubscribeDataChannel(r,t.uid)}),i()}}else R.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(wi.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on(wi.CONNECTION_STATE_CHANGE,(e,t,i)=>{var r;if(i===tt.FALLBACK)return;let a=()=>{this.safeEmit(Me.CONNECTION_STATE_CHANGE,e,t,i)};if(fe.reportApiInvoke(this._sessionId||((r=this._gateway.joinInfo)===null||r===void 0?void 0:r.sid)||null,{name:ni.CONNECTION_STATE_CHANGE,options:[e,t,i],tag:Vt.TRACER}).onSuccess(JSON.stringify({cur:e,prev:t,reason:i})),R.info("[".concat(this._clientId,"] connection state change: ").concat(t," -> ").concat(e)),e==="DISCONNECTED")return this._reset(),void a();if(e==="RECONNECTING")this._users.forEach(c=>{c._trust_in_room_=!1,c._trust_audio_enabled_state_=!1,c._trust_video_enabled_state_=!1,c._trust_audio_mute_state_=!1,c._trust_video_mute_state_=!1,c._trust_audio_stream_added_state_=!1,c._trust_video_stream_added_state_=!1,c._is_pre_created||(c._audio_pre_subscribed||(c._audioSSRC=void 0,c._audioOrtc=void 0),c._video_pre_subscribed||(c._videoSSRC=void 0,c._videoOrtc=void 0,c._rtxSsrcId=void 0),c._cname=void 0)}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(e==="CONNECTED"){var s;this._streamFallbackTypeCacheMap.forEach((c,l)=>{this._gateway.setStreamFallbackOption(l,c).catch(u=>{R.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),u)})}),this._remoteStreamTypeCacheMap.forEach((c,l)=>{this._gateway.setRemoteVideoStreamType(l,c).catch(u=>{R.warning("[".concat(this._clientId,"] auto set remote stream type failed"),u)})}),this._remoteDefaultVideoStreamType!==void 0&&((s=this._joinInfo)===null||s===void 0?void 0:s.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{R.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(c=>{R.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(c))}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter(c=>!c._trust_in_room_).forEach(c=>{R.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(c.uid)),this._handleUserOffline({uid:c.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach(c=>{c._trust_audio_mute_state_||(R.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(c.uid)),this._handleMuteStream(c.uid,_e.AUDIO,!1)),c._trust_video_mute_state_||(R.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(c.uid)),this._handleMuteStream(c.uid,_e.VIDEO,!1)),c._trust_audio_enabled_state_||(R.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(c.uid)),this._handleSetStreamLocalEnable("audio",c.uid,!0)),c._trust_video_enabled_state_||(R.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(c.uid)),this._handleSetStreamLocalEnable("video",c.uid,!0)),c._trust_video_stream_added_state_||(R.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(c.uid)),this._handleResetAddStream(c,"video")),c._trust_audio_stream_added_state_||(R.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(c.uid)),this._handleResetAddStream(c,"audio")),c._video_added_||c._audio_added_||(R.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(c.uid)),this._handleRemoveStream({uid:c.uid,uint_id:c._uintid}))}))},1e3))}a()}),this._gateway.on(wi.REQUEST_NEW_GATEWAY_LIST,async(e,t)=>{if(!this._joinInfo)return t(new B(A.UNEXPECTED_ERROR,"can not recover, no join info"));try{let i,r=await yk(_n(_n({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));r?(i=r.ap,Ck(r),this._joinInfo.preload=!0):(i=await Xv(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||ti,this.store),this._joinInfo.preload=!1),this._joinInfo&&(this._joinInfo.apResponse=i.gatewayInfo.res,this._joinInfo.gatewayAddrs=i.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=i.gatewayInfo.uni_lbs_ip);let a=[];i.gatewayInfo.gatewayAddrs.forEach(s=>{let{address:c}=s,[l,u]=c.split(":");this._joinInfo&&this._joinInfo.proxyServer?a.push({proxy:this._joinInfo.proxyServer,host:l,port:u}):a.push({host:l,port:u})}),e(a)}catch(i){t(i)}}),this._gateway.on(wi.NETWORK_QUALITY,e=>{this._networkQualitySensitivity==="normal"&&this.safeEmit(Me.NETWORK_QUALITY,e)}),this._gateway.on(wi.STREAM_TYPE_CHANGE,(e,t)=>{this.safeEmit(Me.STREAM_TYPE_CHANGED,e,t),fe.reportApiInvoke(this._sessionId,{name:ni.STREAM_TYPE_CHANGE,options:[e,t],tag:Vt.TRACER}).onSuccess(JSON.stringify({uid:e,streamType:t}))}),this._gateway.on(wi.IS_P2P_DISCONNECTED,e=>{this._p2pChannel.isP2PDisconnected()?e(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?e(!1):e(!0)}),this._gateway.on(wi.REQUEST_P2P_CONNECTION_PARAMS,async(e,t,i)=>{try{let r=await this._p2pChannel.getEstablishParams();k("ENABLE_PREALLOC_PC")&&r||(r=await this._p2pChannel.startP2PConnection(e)),t(r)}catch(r){i(r)}}),this._gateway.on(wi.JOIN_RESPONSE,(e,t)=>{if(this.store.useP2P)return;let i=SL(e.ortc,t,e.attributes.userAttributes.preSubSsrcs);this._p2pChannel.connect(i)}),this._gateway.on(wi.PRE_CONNECT_PC,async e=>{let{candidates:t,fingerprint:i}=e;if(this._joinInfo&&t.length>0&&!this._p2pChannel.isPlanB){var r;await this._p2pChannel.startP2PConnection({turnServer:this._joinInfo.turnServer});let{cert:a,cid:s}=this._joinInfo.apResponse;await this._p2pChannel.connect({iceParameters:{iceUfrag:"".concat(s,"_").concat(a),icePwd:"".concat(s,"_").concat(a)},dtlsParameters:{fingerprints:[{hashFunction:"sha-256",fingerprint:(r=k("FINGERPRINT"))!==null&&r!==void 0?r:i}]},candidates:t,rtpCapabilities:{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},setup:"active",cname:"o/i14u9pJrxRKAsu",preallocation:!0})}})}_handleGatewaySignalEvents(){this._gateway.signal.on(Le.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(Le.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(Le.ON_ADD_AUDIO_STREAM,e=>this._handleAddAudioOrVideoStream("audio",e.uid,e.ssrcId,e.cname,e.uint_id,e.ortc)),this._gateway.signal.on(Le.ON_ADD_VIDEO_STREAM,e=>this._handleAddAudioOrVideoStream("video",e.uid,e.ssrcId,e.cname,e.uint_id,e.ortc,e.rtxSsrcId)),this._gateway.signal.on(Le.ON_REMOTE_DATASTREAM_UPDATE,e=>{this._handleUpdateDataChannel(e)}),this._gateway.signal.on(Le.ON_REMOTE_FULL_DATASTREAM_INFO,e=>{this._handleUpdateDataChannel({added:e.datastreams||[],deleted:[]},!0)}),this._gateway.signal.on(Le.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(Le.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(Le.MUTE_AUDIO,e=>this._handleMuteStream(e.uid,_e.AUDIO,!0)),this._gateway.signal.on(Le.UNMUTE_AUDIO,e=>this._handleMuteStream(e.uid,_e.AUDIO,!1)),this._gateway.signal.on(Le.MUTE_VIDEO,e=>this._handleMuteStream(e.uid,_e.VIDEO,!0)),this._gateway.signal.on(Le.UNMUTE_VIDEO,e=>this._handleMuteStream(e.uid,_e.VIDEO,!1)),this._gateway.signal.on(Le.RECEIVE_METADATA,e=>{let t=vc(e.metadata);this.safeEmit(Me.RECEIVE_METADATA,e.uid,t)}),this._gateway.signal.on(Le.ON_DATA_STREAM,async e=>{var t;if(!e)return;let i=vc(e.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&oe(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)){if(e.payload.length<wl)throw new B(A.UNEXPECTED_RESPONSE,"payload length ".concat(e.payload.length," is less than header length ").concat(wl));i=await async function(a,s,c){let l=c.subarray(0,wl),u=l.slice(8,wl),h=(u[0]<<8)+u[1],p=(l[6]<<8)+l[7],_=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:a,tagLength:JN,additionalData:new Uint8Array(qN(h,2))},s,c.subarray(wl));return new Uint8Array(_).subarray(0,p)}(this._encryptDataStreamIv,this._encryptDataStreamKey,i)}let r=0;if(e.ordered||e.syncWithAudio){let a=this._p2pChannel.getStats(),s=this.remoteUsers.find(l=>l.uid===e.uid),c=a==null?void 0:a.audioRecv.find(l=>l.ssrc===(s==null?void 0:s._audioSSRC));r=c==null?void 0:c.jitterBufferMs}r==null&&(r=0),$J(_n(_n({},e),{},{payload:i}),r,{id:this._clientId,onStreamMessage:typeof this.onStreamMessage=="function"?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})}),this._gateway.signal.on(Le.ON_CRYPT_ERROR,()=>{Do(()=>{R.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(Me.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(Le.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(Le.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{R.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,tt.TOKEN_EXPIRE),this.safeEmit(Me.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(Le.ON_STREAM_FALLBACK_UPDATE,e=>{R.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(e.stream_id,", attr: ").concat(e.stream_type)),this.safeEmit(Me.STREAM_FALLBACK,e.stream_id,e.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(Le.ON_PUBLISH_STREAM,e=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:e.proxy})),R.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(e))))}),this._gateway.signal.on(Le.ENABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!0)}),this._gateway.signal.on(Le.DISABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!1)}),this._gateway.signal.on(ye.REQUEST_TIMEOUT,(e,t)=>{if(this._joinInfo)switch(e){case ve.PUBLISH:{if(!t)return;let a=t.ortc;if(a){var i,r;let s=a.some(u=>{let{stream_type:h}=u;return h===Qe.Audio}),c=a.some(u=>{let{stream_type:h}=u;return h!==Qe.Audio}),l=a.some(u=>{let{stream_type:h}=u;return h===Qe.Screen||h===Qe.ScreenLow});t.state==="offer"&&fe.publish(this._joinInfo.sid,{eventElapse:ji.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:A.TIMEOUT,audio:s,video:c,p2pid:t.p2p_id,publishRequestid:this.store.pubId,screenshare:l,audioName:s?(i=a.find(u=>{let{stream_type:h}=u;return h===Qe.Audio}))===null||i===void 0||(i=i.ssrcs[0])===null||i===void 0?void 0:i.ssrcId.toString():void 0,videoName:c?(r=a.find(u=>{let{stream_type:h}=u;return h!==Qe.Audio}))===null||r===void 0||(r=r.ssrcs[0])===null||r===void 0?void 0:r.ssrcId.toString():void 0})}break}case ve.SUBSCRIBE:t&&fe.subscribe(this._joinInfo.sid,{succ:!1,ec:A.TIMEOUT,audio:t.stream_type===_e.AUDIO,video:t.stream_type===_e.VIDEO,peerid:t.stream_id,subscribeRequestid:t.ssrcId,p2pid:this.store.p2pId,eventElapse:ji.measureFromSubscribeStart(this.store.clientId,t.ssrcId),preSsrc:this._p2pChannel.isPreSubScribe(t.ssrcId)})}}),this._gateway.signal.on(Le.ON_P2P_OK,e=>{this.uid,this._uid}),this._gateway.signal.on(Le.ON_PUBLISHED_USER_LIST,e=>{if(e==null||!e.users)return;k("BLOCK_LOCAL_CLIENT")&&(e.users=e.users.filter(r=>!oc(r.string_id||r.stream_id,this.channelName)));let t=[],i=[];for(let r of e.users){let a=this._users.find(p=>p._uintid===r.stream_id);a?a._trust_in_room_=!0:(a=new Eo(r.string_id||r.stream_id,r.stream_id),this._users.push(a),this.getListeners(Me.PUBLISHED_USER_LIST).length===0&&(R.debug("[".concat(this._clientId,"] user online"),r.stream_id),this.safeEmit(Me.USER_JOINED,a)));let s=ui.Audio&r.stream_type,c=(ui.Video|ui.LwoVideo)&r.stream_type,l=(65280&r.stream_type)!=0,u=s&&a.hasAudio,h=c&&a.hasVideo;c&&(a._trust_video_stream_added_state_=!0,a._video_added_=!0,a._videoSSRC=r.video_ssrc,a._rtxSsrcId=r.video_rtx),s&&(a._trust_audio_stream_added_state_=!0,a._audio_added_=!0,a._audioSSRC=r.audio_ssrc),s&&!u&&this.getListeners(Me.PUBLISHED_USER_LIST).length===0&&(R.info("[".concat(this._clientId,"] remote user ").concat(a.uid," published audio")),this.safeEmit(Me.USER_PUBLISHED,a,"audio")),c&&!h&&this.getListeners(Me.PUBLISHED_USER_LIST).length===0&&(R.info("[".concat(this._clientId,"] remote user ").concat(a.uid," published video")),this.safeEmit(Me.USER_PUBLISHED,a,"video")),(s&&!u||c&&!h||l)&&t.push(a),c&&this._p2pChannel.hasPendingRemoteMedia(a,"video")&&i.push({user:a,mediaType:"video"}),s&&this._p2pChannel.hasPendingRemoteMedia(a,"audio")&&i.push({user:a,mediaType:"audio"})}i.length>0&&(R.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(i.map(r=>"user: ".concat(r.user.uid,", mediaType: ").concat(r.mediaType)).join("; ")," ")),this.massSubscribe(i).catch(r=>{R.error("[".concat(this._clientId,"] mass resubscribe error"),r.toString())})),this.getListeners(Me.PUBLISHED_USER_LIST).length>0?k("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=t:(R.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(t.map(r=>r.uid).join(", "))),this.safeEmit(Me.PUBLISHED_USER_LIST,t)):R.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(t.map(r=>r.uid).join(", ")))}),this._gateway.signal.on(Le.ON_RTP_CAPABILITY_CHANGE,e=>{let{video_codec:t}=e;this._p2pChannel instanceof __&&this._p2pChannel.updateRemoteRTPCapabilities(t.map(i=>i.toLowerCase()).filter(i=>{var r;return oe(r=Object.keys(ZE)).call(r,i)}))})}_handleP2PEvents(){this._gateway.signal.on(Le.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(Gt.PUBLISH,(e,t,i)=>{let{uid:r}=e;e.forEach(a=>{let{kind:s,ssrcs:c,mid:l,isMuted:u}=a;this._handleP2PAddAudioOrVideoStream(s,r,c[0].ssrcId,l);let h=this._users.find(p=>p.uid===r);return h&&this._p2pChannel instanceof Mr?this._p2pChannel.mockSubscribe(h,s,c[0].ssrcId,l).then(()=>{t()}).catch(i):t(),this._handleMuteStream(r,s,!!u)})}),this._gateway.signal.on(Gt.CALL,async(e,t,i)=>{if(this._p2pChannel instanceof Mr)try{var r;t(await this._p2pChannel.startP2P({turnServer:(r=this._joinInfo)===null||r===void 0?void 0:r.turnServer},e))}catch(a){i(a)}}),this._gateway.signal.on(ye.P2P_CONNECTION,async e=>{this._p2pChannel instanceof Mr&&await this._p2pChannel.p2pConnect(e)}),this._gateway.signal.on(Gt.UNPUBLISH,async(e,t,i)=>{if(this._p2pChannel instanceof Mr){let{unpubMsg:r,uid:a}=e,s=this._users.find(c=>c.uid===a);if(!s)return R.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(a)),void t();try{r.forEach(async c=>{let{stream_type:l}=c,u=l===Qe.Audio?_e.AUDIO:_e.VIDEO;await this._p2pChannel.unsubscribe(s,u),this._handleMuteStream(a,u,!0)}),t()}catch(c){i(c)}}}),this._gateway.signal.on(Gt.CONTROL,async(e,t)=>{let{action:i}=e;switch(i){case To.MUTE_LOCAL_VIDEO:this._handleMuteStream(t,_e.VIDEO,!0);break;case To.MUTE_LOCAL_AUDIO:this._handleMuteStream(t,_e.AUDIO,!0);break;case To.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",t),this._handleMuteStream(t,_e.VIDEO,!1);break;case To.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",t),this._handleMuteStream(t,_e.AUDIO,!1)}}),this._gateway.signal.on(Gt.RESTART_ICE,async(e,t,i)=>{if(this._p2pChannel instanceof Mr)try{let{direction:r,iceParameter:a}=e;r!==ur.SEND_ONLY||a?t(await this._p2pChannel.restartICE(r,a)):(this._p2pChannel.handleDisconnect(r),t())}catch(r){i(r)}}),this._gateway.signal.on(Gt.CANDIDATE,e=>{if(this._p2pChannel instanceof Mr){let{candidate:t,direction:i}=e;this._p2pChannel.addRemoteCandidate(t,i)}}),this._p2pChannel.on(Te.RequestP2PRestartICE,async(e,t,i)=>{try{let{direction:r}=e;t(await this._gateway.sendExtensionMessage(Gt.RESTART_ICE,e,r===ur.SEND_ONLY))}catch(r){i(r)}}),this._p2pChannel.on(Te.LocalCandidate,e=>{this._gateway.sendExtensionMessage(Gt.CANDIDATE,JSON.stringify(e),!0)}),this._p2pChannel.on(Te.RequestP2PMuteLocal,async(e,t,i)=>{try{await this._gateway.sendExtensionMessage(Gt.CONTROL,e,!0),t()}catch(r){i(r)}}),this._p2pChannel.on(Te.RequestP2PUnmuteRemote,async(e,t,i)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(r){r.code===A.DISCONNECT_P2P?t():i(r)}else t()}),this._p2pChannel.on(Te.RequestP2PMuteRemote,async(e,t,i)=>{if(this._joinInfo)try{await this._gateway.muteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(r){r.code===A.DISCONNECT_P2P?t():i(r)}else t()}),this._p2pChannel.on(Te.StateChange,(e,t)=>{t===Je.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){this._p2pChannel.on(Te.RequestMuteLocal,async(e,t,i)=>{if(this._joinInfo)try{await this._gateway.muteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(r){r.code===A.DISCONNECT_P2P?t():i(r)}else t()}),this._p2pChannel.on(Te.RequestUnmuteLocal,async(e,t,i)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(r){r.code===A.DISCONNECT_P2P?t():i(r)}else t()}),this._p2pChannel.on(Te.RequestRePublish,(e,t,i)=>{this.publish(e,!1).then(t).catch(i)}),this._p2pChannel.on(Te.RequestRePublishDataChannel,(e,t,i)=>{ae.all(e.map(async r=>{let a=await this._p2pChannel.publishDataChannel([r]);try{a.forEach(s=>{this._uid&&this._gateway.publishDataChannel(this._uid,s,!0)})}catch(s){if(s.code!==A.DISCONNECT_P2P)throw s}})).then(t).catch(i)}),this._p2pChannel.on(Te.RequestReSubscribe,async(e,t,i)=>{try{for(let{user:r,kind:a}of e)a===_e.VIDEO?await this.subscribe(r,"video"):await this.subscribe(r,"audio");t()}catch(r){i(r)}}),this._p2pChannel.on(Te.RequestUpload,(e,t)=>{this._gateway.upload(e,t)}),this._p2pChannel.on(Te.RequestUploadStats,e=>{this._gateway.uploadWRTCStats(e)}),this._p2pChannel.on(Te.MediaReconnectStart,e=>{this.safeEmit(Me.MEDIA_RECONNECT_START,e)}),this._p2pChannel.on(Te.MediaReconnectEnd,e=>{this.safeEmit(Me.MEDIA_RECONNECT_END,e)}),this._p2pChannel.on(Te.NeedSignalRTT,e=>{e(this._gateway.getSignalRTT())}),this._p2pChannel.on(Te.RequestRestartICE,async e=>{if(this._p2pChannel instanceof Mr)return;let t=await this._p2pChannel.restartICE(e),i=await t.next();if(i.done)return;let r=i.value,a;try{a=await this._gateway.restartICE({iceParameters:r})}catch(c){return void t.throw(c)}let{iceParameters:s}=function(c){let l=c.iceParameters;return{iceParameters:{iceUfrag:l.iceUfrag,icePwd:l.icePwd}}}(a);await t.next({remoteIceParameters:s})}),this._p2pChannel.on(Te.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(Te.RequestReconnectPC,async()=>{var e;let{iceParameters:t,dtlsParameters:i,rtpCapabilities:r}=await this._p2pChannel.startP2PConnection({turnServer:(e=this._joinInfo)===null||e===void 0?void 0:e.turnServer}),{gatewayEstablishParams:a,gatewayAddress:s}=await this._gateway.reconnectPC({iceParameters:t,dtlsParameters:i,rtpCapabilities:r}),c=SL(a,s);await this._p2pChannel.connect(c),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(Te.RequestUnpublishForReconnectPC,async(e,t,i)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(e,this._uid),t()):i()}),this._p2pChannel.on(Te.P2PLost,()=>{this.safeEmit(Me.P2P_LOST,this.store.uid)}),this._p2pChannel.on(Te.UpdateVideoEncoder,e=>{e._encoderConfig&&this._gateway.setVideoProfile(e._encoderConfig)}),this._p2pChannel.on(Te.ConnectionTypeChange,e=>{this.safeEmit(Me.IS_USING_CLOUD_PROXY,e)}),this._p2pChannel.on(Te.RequestLowStreamParameter,e=>{e(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(Te.QueryClientConnectionState,e=>{e(this.connectionState)})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(e){if(!this._joinInfo||this.connectionState!=="CONNECTED")throw new B(A.INVALID_OPERATION,"[".concat(this._clientId,"] can not create content inspect, please join channel first"));if(this._inspect)throw new B(A.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));try{let i=(t={config:e},uh("ContentInspect").create(t));this._inspect=i,this.handleVideoInspectEvents(i);let{appId:r,cname:a,sid:s,token:c,uid:l,cid:u,vid:h}=this._joinInfo;await i.init({appId:r,areaCode:"",cname:a,sid:s,token:c,uid:l,cid:u,vid:h?Number(h):0},ti)}catch(i){throw Array.isArray(i)?i[0]:i}var t}handleVideoInspectEvents(e){e.on(_i.CONNECTION_STATE_CHANGE,(t,i)=>{if(this.safeEmit(Me.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,t,i),i===Ga.CONNECTED){if(this.connectionState!=="CONNECTED")return void this.safeEmit(Me.CONTENT_INSPECT_ERROR,new B(A.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));e.inspectImage()}}),e.on(_i.INSPECT_RESULT,(t,i)=>{var r;if((i==null?void 0:i.code)===A.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return R.debug("Stop inspect content because that has left channel"),this==null||(r=this._inspect)===null||r===void 0||r.close(),void(this._inspect=void 0);this.safeEmit(Me.CONTENT_INSPECT_RESULT,t,i)}),e.on(_i.CLIENT_LOCAL_VIDEO_TRACK,t=>{t(this.localTracks.filter(i=>i.trackMediaType==="video")[0])})}async disableContentInspect(){if(!this._inspect)throw new B(A.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(e){throw Array.isArray(e)?e[0]:e}}async setImageModeration(e,t){if(Is(e,"enabled"),e){if(!t)throw new B(A.INVALID_PARAMS,"config is required");if(IB(t),!this._joinInfo)throw new B(A.INVALID_OPERATION,"can not create image moderation, please join channel first");try{if(this._moderation)this._moderation.updateConfig(t);else{let r=(i={config:t},uh("ImageModeration").create(i));this._moderation=r,this.handleImageModerationEvents(r);let{appId:a,cname:s,sid:c,token:l,uid:u,cid:h,vid:p}=this._joinInfo;await r.init({appId:a,areaCode:"",cname:s,sid:c,token:l,uid:u,cid:h,vid:p?Number(p):0},ti)}}catch(r){throw Array.isArray(r)?r[0]:r}}else{var i;if(!this._moderation)throw new B(A.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(r){throw Array.isArray(r)?r[0]:r}}}handleImageModerationEvents(e){e.on(pn.CONNECTION_STATE_CHANGE,(t,i)=>{if(this.safeEmit(Me.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,t,i),t===ha.CONNECTED){if(this.connectionState!=="CONNECTED")throw this.setImageModeration(!1),new B(A.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");e.inspectImage()}}),e.on(pn.CLIENT_LOCAL_VIDEO_TRACK,t=>{t(this.localTracks.filter(i=>i.trackMediaType==="video")[0])})}setP2PTransport(e){if(function(t){li(t,"transport",["default","auto","relay","sd-rtn"])}(e),this.mode!=="p2p")throw new B(A.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=e,R.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(e))}getJoinChannelServiceRecords(){return R.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(e){Is(e,"enabled"),at("ENABLE_PUBLISH_AUDIO_FILTER",e),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(e)}_handleResetAddStream(e,t){switch(t){case"audio":e._audio_added_=!1,e._trust_audio_stream_added_state_=!0;break;case"video":e._video_added_=!1,e._trust_video_stream_added_state_=!0}}},de(se.prototype,"leave",[Pk],Object.getOwnPropertyDescriptor(se.prototype,"leave"),se.prototype),de(se.prototype,"publish",[Lk],Object.getOwnPropertyDescriptor(se.prototype,"publish"),se.prototype),de(se.prototype,"unpublish",[kk],Object.getOwnPropertyDescriptor(se.prototype,"unpublish"),se.prototype),de(se.prototype,"subscribe",[Mk],Object.getOwnPropertyDescriptor(se.prototype,"subscribe"),se.prototype),de(se.prototype,"presubscribe",[Uk],Object.getOwnPropertyDescriptor(se.prototype,"presubscribe"),se.prototype),de(se.prototype,"massSubscribe",[xk],Object.getOwnPropertyDescriptor(se.prototype,"massSubscribe"),se.prototype),de(se.prototype,"unsubscribe",[Vk],Object.getOwnPropertyDescriptor(se.prototype,"unsubscribe"),se.prototype),de(se.prototype,"massUnsubscribe",[Bk],Object.getOwnPropertyDescriptor(se.prototype,"massUnsubscribe"),se.prototype),de(se.prototype,"setLowStreamParameter",[jk],Object.getOwnPropertyDescriptor(se.prototype,"setLowStreamParameter"),se.prototype),de(se.prototype,"enableDualStream",[Fk],Object.getOwnPropertyDescriptor(se.prototype,"enableDualStream"),se.prototype),de(se.prototype,"disableDualStream",[Gk],Object.getOwnPropertyDescriptor(se.prototype,"disableDualStream"),se.prototype),de(se.prototype,"setClientRole",[Hk],Object.getOwnPropertyDescriptor(se.prototype,"setClientRole"),se.prototype),de(se.prototype,"setProxyServer",[Wk],Object.getOwnPropertyDescriptor(se.prototype,"setProxyServer"),se.prototype),de(se.prototype,"setTurnServer",[Kk],Object.getOwnPropertyDescriptor(se.prototype,"setTurnServer"),se.prototype),de(se.prototype,"setLicense",[zk],Object.getOwnPropertyDescriptor(se.prototype,"setLicense"),se.prototype),de(se.prototype,"startProxyServer",[Yk],Object.getOwnPropertyDescriptor(se.prototype,"startProxyServer"),se.prototype),de(se.prototype,"stopProxyServer",[qk],Object.getOwnPropertyDescriptor(se.prototype,"stopProxyServer"),se.prototype),de(se.prototype,"setLocalAccessPointsV2",[Xk],Object.getOwnPropertyDescriptor(se.prototype,"setLocalAccessPointsV2"),se.prototype),de(se.prototype,"setLocalAccessPoints",[Jk],Object.getOwnPropertyDescriptor(se.prototype,"setLocalAccessPoints"),se.prototype),de(se.prototype,"setRemoteDefaultVideoStreamType",[Qk],Object.getOwnPropertyDescriptor(se.prototype,"setRemoteDefaultVideoStreamType"),se.prototype),de(se.prototype,"setRemoteVideoStreamType",[Zk],Object.getOwnPropertyDescriptor(se.prototype,"setRemoteVideoStreamType"),se.prototype),de(se.prototype,"setStreamFallbackOption",[$k],Object.getOwnPropertyDescriptor(se.prototype,"setStreamFallbackOption"),se.prototype),de(se.prototype,"setEncryptionConfig",[eM],Object.getOwnPropertyDescriptor(se.prototype,"setEncryptionConfig"),se.prototype),de(se.prototype,"renewToken",[tM],Object.getOwnPropertyDescriptor(se.prototype,"renewToken"),se.prototype),de(se.prototype,"enableAudioVolumeIndicator",[iM],Object.getOwnPropertyDescriptor(se.prototype,"enableAudioVolumeIndicator"),se.prototype),de(se.prototype,"startLiveStreaming",[rM],Object.getOwnPropertyDescriptor(se.prototype,"startLiveStreaming"),se.prototype),de(se.prototype,"setLiveTranscoding",[aM],Object.getOwnPropertyDescriptor(se.prototype,"setLiveTranscoding"),se.prototype),de(se.prototype,"stopLiveStreaming",[nM],Object.getOwnPropertyDescriptor(se.prototype,"stopLiveStreaming"),se.prototype),de(se.prototype,"startChannelMediaRelay",[sM],Object.getOwnPropertyDescriptor(se.prototype,"startChannelMediaRelay"),se.prototype),de(se.prototype,"updateChannelMediaRelay",[oM],Object.getOwnPropertyDescriptor(se.prototype,"updateChannelMediaRelay"),se.prototype),de(se.prototype,"stopChannelMediaRelay",[cM],Object.getOwnPropertyDescriptor(se.prototype,"stopChannelMediaRelay"),se.prototype),de(se.prototype,"sendCustomReportMessage",[lM],Object.getOwnPropertyDescriptor(se.prototype,"sendCustomReportMessage"),se.prototype),de(se.prototype,"pickSVCLayer",[dM],Object.getOwnPropertyDescriptor(se.prototype,"pickSVCLayer"),se.prototype),de(se.prototype,"setRTMConfig",[uM],Object.getOwnPropertyDescriptor(se.prototype,"setRTMConfig"),se.prototype),de(se.prototype,"enableContentInspect",[hM],Object.getOwnPropertyDescriptor(se.prototype,"enableContentInspect"),se.prototype),de(se.prototype,"disableContentInspect",[pM],Object.getOwnPropertyDescriptor(se.prototype,"disableContentInspect"),se.prototype),de(se.prototype,"setImageModeration",[fM],Object.getOwnPropertyDescriptor(se.prototype,"setImageModeration"),se.prototype),de(se.prototype,"setP2PTransport",[_M],Object.getOwnPropertyDescriptor(se.prototype,"setP2PTransport"),se.prototype),de(se.prototype,"getJoinChannelServiceRecords",[EM],Object.getOwnPropertyDescriptor(se.prototype,"getJoinChannelServiceRecords"),se.prototype),de(se.prototype,"setPublishAudioFilterEnabled",[mM],Object.getOwnPropertyDescriptor(se.prototype,"setPublishAudioFilterEnabled"),se.prototype),se),OB=class iy{constructor(t,i){b(this,"id",0),b(this,"element",void 0),b(this,"peerPair",void 0),b(this,"context",void 0),b(this,"audioPlayerElement",void 0),b(this,"audioTrack",void 0),iy.count+=1,this.id=iy.count,this.element=t,this.context=i}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=t=>{let i=document.createElement("audio");i.srcObject=new MediaStream([t.track]),i.play(),this.audioPlayerElement=i}}async switchSdp(){if(!this.peerPair)return;let t=async(r,a)=>{let s=a==="offer"?await r.createOffer():await r.createAnswer();return await r.setLocalDescription(s),r.iceGatheringState==="complete"?r.localDescription:new ae(c=>{r.onicegatheringstatechange=()=>{r.iceGatheringState==="complete"&&c(r.localDescription)}})},i=async(r,a)=>await r.setRemoteDescription(a);try{let r=await t(this.peerPair[0],"offer");await i(this.peerPair[1],r);let a=await t(this.peerPair[1],"answer");await i(this.peerPair[0],a)}catch(r){throw new B(A.LOCAL_AEC_ERROR,r.toString()).print()}}async getTracksFromMediaElement(t){if(this.audioTrack)return this.audioTrack;let i;try{t instanceof HTMLVideoElement&&(t.captureStream?t.captureStream():t.mozCaptureStream()),i=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(t).connect(i)}catch(a){throw new B(A.LOCAL_AEC_ERROR,a.toString()).print()}if(!i)throw new B(A.LOCAL_AEC_ERROR,"no dest node when local aec").print();let r=i.stream.getAudioTracks()[0];return this.audioTrack=r,r}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();let t=this.element,i=await this.getTracksFromMediaElement(t);this.peerPair&&this.peerPair[0].addTrack(i),await this.switchSdp()}close(){R.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(t=>{t.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}},SM,m_;b(OB,"count",0);var gQ=window.AudioContext||window.webkitAudioContext,SQ=new(SM=Se({report:fe}),de((m_=class{constructor(){b(this,"units",[]),b(this,"context",void 0)}processExternalMediaAEC(e){if(!this._doesEnvironmentNeedAEC())return R.debug("the system does not need to process local aec"),-1;this.context||(this.context=new gQ);let t=this.units.find(i=>i&&i.getElement()===e);return t||(t=new OB(e,this.context),this.units.push(t)),t.startEchoCancellation(),R.debug("start processing local audio echo cancellation, id is",t.id),t.id}_doesEnvironmentNeedAEC(){return Ge().name!==Ze.SAFARI}}).prototype,"processExternalMediaAEC",[SM],Object.getOwnPropertyDescriptor(m_.prototype,"processExternalMediaAEC"),m_.prototype),m_);function TM(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),i.push.apply(i,r)}return i}function RM(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?TM(Object(i),!0).forEach(function(r){b(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):TM(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}var OR=window||document;function wB(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!OR)return;let i=Ut._cspEventHandlerPointer;if(i&&t)return void console.error(i,t);let r=a=>{if(!(a&&a.blockedURI&&(Ut.onSecurityPolicyViolation||Ut.getListeners(Vn.SECURITY_POLICY_VIOLATION).length>0)))return;let s=a.blockedURI;k("CSP_DETECTED_HOSTNAME_LIST").some(c=>oe(s).call(s,c))&&(Ut.onSecurityPolicyViolation&&typeof Ut.onSecurityPolicyViolation=="function"&&Ut.onSecurityPolicyViolation(a),Ut.getListeners(Vn.SECURITY_POLICY_VIOLATION).length>0&&Ut.safeEmit(Vn.SECURITY_POLICY_VIOLATION,a))};i&&OR.removeEventListener("securitypolicyviolation",i),(t||e&&typeof e=="function"||Ut.getListeners(Vn.SECURITY_POLICY_VIOLATION).length>0)&&OR.addEventListener("securitypolicyviolation",r),Ut._cspEventHandlerPointer=r}var TQ=_r,RQ=Ox,vM=RegExp.prototype,vQ=function(e){return e===vM||TQ(vM,e)?RQ(e):e.flags},er=zt(vQ);function Ud(e){let t=e.length;for(;--t>=0;)e[t]=0}var SC=256,NB=286,vh=30,yh=15,ry=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),J_=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),yQ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),yM=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),bs=new Array(576);Ud(bs);var Ch=new Array(60);Ud(Ch);var zh=new Array(512);Ud(zh);var Yh=new Array(256);Ud(Yh);var TC=new Array(29);Ud(TC);var CE=new Array(vh);function wR(e,t,i,r,a){this.static_tree=e,this.extra_bits=t,this.extra_base=i,this.elems=r,this.max_length=a,this.has_stree=e&&e.length}var CM,bM,AM;function NR(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}Ud(CE);var DB=e=>e<256?zh[e]:zh[256+(e>>>7)],qh=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},Zr=(e,t,i)=>{e.bi_valid>16-i?(e.bi_buf|=t<<e.bi_valid&65535,qh(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=i-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=i)},Bn=(e,t,i)=>{Zr(e,i[2*t],i[2*t+1])},PB=(e,t)=>{let i=0;do i|=1&e,e>>>=1,i<<=1;while(--t>0);return i>>>1},LB=(e,t,i)=>{let r=new Array(16),a,s,c=0;for(a=1;a<=yh;a++)c=c+i[a-1]<<1,r[a]=c;for(s=0;s<=t;s++){let l=e[2*s+1];l!==0&&(e[2*s]=PB(r[l]++,l))}},kB=e=>{let t;for(t=0;t<NB;t++)e.dyn_ltree[2*t]=0;for(t=0;t<vh;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},MB=e=>{e.bi_valid>8?qh(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},IM=(e,t,i,r)=>{let a=2*t,s=2*i;return e[a]<e[s]||e[a]===e[s]&&r[t]<=r[i]},DR=(e,t,i)=>{let r=e.heap[i],a=i<<1;for(;a<=e.heap_len&&(a<e.heap_len&&IM(t,e.heap[a+1],e.heap[a],e.depth)&&a++,!IM(t,r,e.heap[a],e.depth));)e.heap[i]=e.heap[a],i=a,a<<=1;e.heap[i]=r},OM=(e,t,i)=>{let r,a,s,c,l=0;if(e.sym_next!==0)do r=255&e.pending_buf[e.sym_buf+l++],r+=(255&e.pending_buf[e.sym_buf+l++])<<8,a=e.pending_buf[e.sym_buf+l++],r===0?Bn(e,a,t):(s=Yh[a],Bn(e,s+SC+1,t),c=ry[s],c!==0&&(a-=TC[s],Zr(e,a,c)),r--,s=DB(r),Bn(e,s,i),c=J_[s],c!==0&&(r-=CE[s],Zr(e,r,c)));while(l<e.sym_next);Bn(e,256,t)},PR=(e,t)=>{let i=t.dyn_tree,r=t.stat_desc.static_tree,a=t.stat_desc.has_stree,s=t.stat_desc.elems,c,l,u,h=-1;for(e.heap_len=0,e.heap_max=573,c=0;c<s;c++)i[2*c]!==0?(e.heap[++e.heap_len]=h=c,e.depth[c]=0):i[2*c+1]=0;for(;e.heap_len<2;)u=e.heap[++e.heap_len]=h<2?++h:0,i[2*u]=1,e.depth[u]=0,e.opt_len--,a&&(e.static_len-=r[2*u+1]);for(t.max_code=h,c=e.heap_len>>1;c>=1;c--)DR(e,i,c);u=s;do c=e.heap[1],e.heap[1]=e.heap[e.heap_len--],DR(e,i,1),l=e.heap[1],e.heap[--e.heap_max]=c,e.heap[--e.heap_max]=l,i[2*u]=i[2*c]+i[2*l],e.depth[u]=(e.depth[c]>=e.depth[l]?e.depth[c]:e.depth[l])+1,i[2*c+1]=i[2*l+1]=u,e.heap[1]=u++,DR(e,i,1);while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((p,_)=>{let m=_.dyn_tree,S=_.max_code,C=_.stat_desc.static_tree,v=_.stat_desc.has_stree,y=_.stat_desc.extra_bits,I=_.stat_desc.extra_base,O=_.stat_desc.max_length,P,U,x,G,Z,J,q=0;for(G=0;G<=yh;G++)p.bl_count[G]=0;for(m[2*p.heap[p.heap_max]+1]=0,P=p.heap_max+1;P<573;P++)U=p.heap[P],G=m[2*m[2*U+1]+1]+1,G>O&&(G=O,q++),m[2*U+1]=G,U>S||(p.bl_count[G]++,Z=0,U>=I&&(Z=y[U-I]),J=m[2*U],p.opt_len+=J*(G+Z),v&&(p.static_len+=J*(C[2*U+1]+Z)));if(q!==0){do{for(G=O-1;p.bl_count[G]===0;)G--;p.bl_count[G]--,p.bl_count[G+1]+=2,p.bl_count[O]--,q-=2}while(q>0);for(G=O;G!==0;G--)for(U=p.bl_count[G];U!==0;)x=p.heap[--P],x>S||(m[2*x+1]!==G&&(p.opt_len+=(G-m[2*x+1])*m[2*x],m[2*x+1]=G),U--)}})(e,t),LB(i,h,e.bl_count)},wM=(e,t,i)=>{let r,a,s=-1,c=t[1],l=0,u=7,h=4;for(c===0&&(u=138,h=3),t[2*(i+1)+1]=65535,r=0;r<=i;r++)a=c,c=t[2*(r+1)+1],++l<u&&a===c||(l<h?e.bl_tree[2*a]+=l:a!==0?(a!==s&&e.bl_tree[2*a]++,e.bl_tree[32]++):l<=10?e.bl_tree[34]++:e.bl_tree[36]++,l=0,s=a,c===0?(u=138,h=3):a===c?(u=6,h=3):(u=7,h=4))},NM=(e,t,i)=>{let r,a,s=-1,c=t[1],l=0,u=7,h=4;for(c===0&&(u=138,h=3),r=0;r<=i;r++)if(a=c,c=t[2*(r+1)+1],!(++l<u&&a===c)){if(l<h)do Bn(e,a,e.bl_tree);while(--l!=0);else a!==0?(a!==s&&(Bn(e,a,e.bl_tree),l--),Bn(e,16,e.bl_tree),Zr(e,l-3,2)):l<=10?(Bn(e,17,e.bl_tree),Zr(e,l-3,3)):(Bn(e,18,e.bl_tree),Zr(e,l-11,7));l=0,s=a,c===0?(u=138,h=3):a===c?(u=6,h=3):(u=7,h=4)}},DM=!1,UB=(e,t,i,r)=>{Zr(e,0+(r?1:0),3),MB(e),qh(e,i),qh(e,~i),i&&e.pending_buf.set(e.window.subarray(t,t+i),e.pending),e.pending+=i},CQ=e=>{DM||((()=>{let t,i,r,a,s,c=new Array(16);for(r=0,a=0;a<28;a++)for(TC[a]=r,t=0;t<1<<ry[a];t++)Yh[r++]=a;for(Yh[r-1]=a,s=0,a=0;a<16;a++)for(CE[a]=s,t=0;t<1<<J_[a];t++)zh[s++]=a;for(s>>=7;a<vh;a++)for(CE[a]=s<<7,t=0;t<1<<J_[a]-7;t++)zh[256+s++]=a;for(i=0;i<=yh;i++)c[i]=0;for(t=0;t<=143;)bs[2*t+1]=8,t++,c[8]++;for(;t<=255;)bs[2*t+1]=9,t++,c[9]++;for(;t<=279;)bs[2*t+1]=7,t++,c[7]++;for(;t<=287;)bs[2*t+1]=8,t++,c[8]++;for(LB(bs,287,c),t=0;t<vh;t++)Ch[2*t+1]=5,Ch[2*t]=PB(t,5);CM=new wR(bs,ry,257,NB,yh),bM=new wR(Ch,J_,0,vh,yh),AM=new wR(new Array(0),yQ,0,19,7)})(),DM=!0),e.l_desc=new NR(e.dyn_ltree,CM),e.d_desc=new NR(e.dyn_dtree,bM),e.bl_desc=new NR(e.bl_tree,AM),e.bi_buf=0,e.bi_valid=0,kB(e)},bQ=(e,t,i,r)=>{let a,s,c=0;e.level>0?(e.strm.data_type===2&&(e.strm.data_type=(l=>{let u,h=4093624447;for(u=0;u<=31;u++,h>>>=1)if(1&h&&l.dyn_ltree[2*u]!==0)return 0;if(l.dyn_ltree[18]!==0||l.dyn_ltree[20]!==0||l.dyn_ltree[26]!==0)return 1;for(u=32;u<SC;u++)if(l.dyn_ltree[2*u]!==0)return 1;return 0})(e)),PR(e,e.l_desc),PR(e,e.d_desc),c=(l=>{let u;for(wM(l,l.dyn_ltree,l.l_desc.max_code),wM(l,l.dyn_dtree,l.d_desc.max_code),PR(l,l.bl_desc),u=18;u>=3&&l.bl_tree[2*yM[u]+1]===0;u--);return l.opt_len+=3*(u+1)+5+5+4,u})(e),a=e.opt_len+3+7>>>3,s=e.static_len+3+7>>>3,s<=a&&(a=s)):a=s=i+5,i+4<=a&&t!==-1?UB(e,t,i,r):e.strategy===4||s===a?(Zr(e,2+(r?1:0),3),OM(e,bs,Ch)):(Zr(e,4+(r?1:0),3),((l,u,h,p)=>{let _;for(Zr(l,u-257,5),Zr(l,h-1,5),Zr(l,p-4,4),_=0;_<p;_++)Zr(l,l.bl_tree[2*yM[_]+1],3);NM(l,l.dyn_ltree,u-1),NM(l,l.dyn_dtree,h-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,c+1),OM(e,e.dyn_ltree,e.dyn_dtree)),kB(e),r&&MB(e)},AQ=(e,t,i)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=i,t===0?e.dyn_ltree[2*i]++:(e.matches++,t--,e.dyn_ltree[2*(Yh[i]+SC+1)]++,e.dyn_dtree[2*DB(t)]++),e.sym_next===e.sym_end),IQ=e=>{Zr(e,2,3),Bn(e,256,bs),(t=>{t.bi_valid===16?(qh(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)})(e)},OQ={_tr_init:CQ,_tr_stored_block:UB,_tr_flush_block:bQ,_tr_tally:AQ,_tr_align:IQ},Xh=(e,t,i,r)=>{let a=65535&e|0,s=e>>>16&65535|0,c=0;for(;i!==0;){c=i>2e3?2e3:i,i-=c;do a=a+t[r++]|0,s=s+a|0;while(--c);a%=65521,s%=65521}return a|s<<16|0},wQ=new Uint32Array((()=>{let e,t=[];for(var i=0;i<256;i++){e=i;for(var r=0;r<8;r++)e=1&e?3988292384^e>>>1:e>>>1;t[i]=e}return t})()),dr=(e,t,i,r)=>{let a=wQ,s=r+i;e^=-1;for(let c=r;c<s;c++)e=e>>>8^a[255&(e^t[c])];return-1^e},Mc={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},rm={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_UNKNOWN:2,Z_DEFLATED:8},{_tr_init:NQ,_tr_stored_block:ay,_tr_flush_block:DQ,_tr_tally:Ao,_tr_align:PQ}=OQ,{Z_NO_FLUSH:Io,Z_PARTIAL_FLUSH:LQ,Z_FULL_FLUSH:kQ,Z_FINISH:qa,Z_BLOCK:PM,Z_OK:Rr,Z_STREAM_END:LM,Z_STREAM_ERROR:Wn,Z_DATA_ERROR:MQ,Z_BUF_ERROR:LR,Z_DEFAULT_COMPRESSION:UQ,Z_FILTERED:xQ,Z_HUFFMAN_ONLY:g_,Z_RLE:VQ,Z_FIXED:BQ,Z_DEFAULT_STRATEGY:jQ,Z_UNKNOWN:FQ,Z_DEFLATED:am}=rm,ny=286,GQ=30,HQ=19,WQ=2*ny+1,KQ=15,Cc=258,Kn=262,yd=42,bc=113,ph=666,Ac=(e,t)=>(e.msg=Mc[t],t),kM=e=>2*e-(e>4?9:0),mo=e=>{let t=e.length;for(;--t>=0;)e[t]=0},zQ=e=>{let t,i,r,a=e.w_size;t=e.hash_size,r=t;do i=e.head[--r],e.head[r]=i>=a?i-a:0;while(--t);t=a,r=t;do i=e.prev[--r],e.prev[r]=i>=a?i-a:0;while(--t)},Oo=(e,t,i)=>(t<<e.hash_shift^i)&e.hash_mask,fa=e=>{let t=e.state,i=t.pending;i>e.avail_out&&(i=e.avail_out),i!==0&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+i),e.next_out),e.next_out+=i,t.pending_out+=i,e.total_out+=i,e.avail_out-=i,t.pending-=i,t.pending===0&&(t.pending_out=0))},Ea=(e,t)=>{DQ(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,fa(e.strm)},jt=(e,t)=>{e.pending_buf[e.pending++]=t},eh=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},sy=(e,t,i,r)=>{let a=e.avail_in;return a>r&&(a=r),a===0?0:(e.avail_in-=a,t.set(e.input.subarray(e.next_in,e.next_in+a),i),e.state.wrap===1?e.adler=Xh(e.adler,t,a,i):e.state.wrap===2&&(e.adler=dr(e.adler,t,a,i)),e.next_in+=a,e.total_in+=a,a)},xB=(e,t)=>{let i,r,a=e.max_chain_length,s=e.strstart,c=e.prev_length,l=e.nice_match,u=e.strstart>e.w_size-Kn?e.strstart-(e.w_size-Kn):0,h=e.window,p=e.w_mask,_=e.prev,m=e.strstart+Cc,S=h[s+c-1],C=h[s+c];e.prev_length>=e.good_match&&(a>>=2),l>e.lookahead&&(l=e.lookahead);do if(i=t,h[i+c]===C&&h[i+c-1]===S&&h[i]===h[s]&&h[++i]===h[s+1]){s+=2,i++;do;while(h[++s]===h[++i]&&h[++s]===h[++i]&&h[++s]===h[++i]&&h[++s]===h[++i]&&h[++s]===h[++i]&&h[++s]===h[++i]&&h[++s]===h[++i]&&h[++s]===h[++i]&&s<m);if(r=Cc-(m-s),s=m-Cc,r>c){if(e.match_start=t,c=r,r>=l)break;S=h[s+c-1],C=h[s+c]}}while((t=_[t&p])>u&&--a!=0);return c<=e.lookahead?c:e.lookahead},Cd=e=>{let t=e.w_size,i,r,a;do{if(r=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-Kn)&&(e.window.set(e.window.subarray(t,t+t-r),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),zQ(e),r+=t),e.strm.avail_in===0)break;if(i=sy(e.strm,e.window,e.strstart+e.lookahead,r),e.lookahead+=i,e.lookahead+e.insert>=3)for(a=e.strstart-e.insert,e.ins_h=e.window[a],e.ins_h=Oo(e,e.ins_h,e.window[a+1]);e.insert&&(e.ins_h=Oo(e,e.ins_h,e.window[a+3-1]),e.prev[a&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=a,a++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<Kn&&e.strm.avail_in!==0)},VB=(e,t)=>{let i,r,a,s=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,c=0,l=e.strm.avail_in;do{if(i=65535,a=e.bi_valid+42>>3,e.strm.avail_out<a||(a=e.strm.avail_out-a,r=e.strstart-e.block_start,i>r+e.strm.avail_in&&(i=r+e.strm.avail_in),i>a&&(i=a),i<s&&(i===0&&t!==qa||t===Io||i!==r+e.strm.avail_in)))break;c=t===qa&&i===r+e.strm.avail_in?1:0,ay(e,0,0,c),e.pending_buf[e.pending-4]=i,e.pending_buf[e.pending-3]=i>>8,e.pending_buf[e.pending-2]=~i,e.pending_buf[e.pending-1]=~i>>8,fa(e.strm),r&&(r>i&&(r=i),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+r),e.strm.next_out),e.strm.next_out+=r,e.strm.avail_out-=r,e.strm.total_out+=r,e.block_start+=r,i-=r),i&&(sy(e.strm,e.strm.output,e.strm.next_out,i),e.strm.next_out+=i,e.strm.avail_out-=i,e.strm.total_out+=i)}while(c===0);return l-=e.strm.avail_in,l&&(l>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=l&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-l,e.strm.next_in),e.strstart),e.strstart+=l,e.insert+=l>e.w_size-e.insert?e.w_size-e.insert:l),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),c?4:t!==Io&&t!==qa&&e.strm.avail_in===0&&e.strstart===e.block_start?2:(a=e.window_size-e.strstart,e.strm.avail_in>a&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,a+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),a>e.strm.avail_in&&(a=e.strm.avail_in),a&&(sy(e.strm,e.window,e.strstart,a),e.strstart+=a,e.insert+=a>e.w_size-e.insert?e.w_size-e.insert:a),e.high_water<e.strstart&&(e.high_water=e.strstart),a=e.bi_valid+42>>3,a=e.pending_buf_size-a>65535?65535:e.pending_buf_size-a,s=a>e.w_size?e.w_size:a,r=e.strstart-e.block_start,(r>=s||(r||t===qa)&&t!==Io&&e.strm.avail_in===0&&r<=a)&&(i=r>a?a:r,c=t===qa&&e.strm.avail_in===0&&i===r?1:0,ay(e,e.block_start,i,c),e.block_start+=i,fa(e.strm)),c?3:1)},kR=(e,t)=>{let i,r;for(;;){if(e.lookahead<Kn){if(Cd(e),e.lookahead<Kn&&t===Io)return 1;if(e.lookahead===0)break}if(i=0,e.lookahead>=3&&(e.ins_h=Oo(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),i!==0&&e.strstart-i<=e.w_size-Kn&&(e.match_length=xB(e,i)),e.match_length>=3)if(r=Ao(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do e.strstart++,e.ins_h=Oo(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(--e.match_length!=0);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=Oo(e,e.ins_h,e.window[e.strstart+1]);else r=Ao(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(r&&(Ea(e,!1),e.strm.avail_out===0))return 1}return e.insert=e.strstart<2?e.strstart:2,t===qa?(Ea(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(Ea(e,!1),e.strm.avail_out===0)?1:2},Bl=(e,t)=>{let i,r,a;for(;;){if(e.lookahead<Kn){if(Cd(e),e.lookahead<Kn&&t===Io)return 1;if(e.lookahead===0)break}if(i=0,e.lookahead>=3&&(e.ins_h=Oo(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,i!==0&&e.prev_length<e.max_lazy_match&&e.strstart-i<=e.w_size-Kn&&(e.match_length=xB(e,i),e.match_length<=5&&(e.strategy===xQ||e.match_length===3&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){a=e.strstart+e.lookahead-3,r=Ao(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=a&&(e.ins_h=Oo(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(--e.prev_length!=0);if(e.match_available=0,e.match_length=2,e.strstart++,r&&(Ea(e,!1),e.strm.avail_out===0))return 1}else if(e.match_available){if(r=Ao(e,0,e.window[e.strstart-1]),r&&Ea(e,!1),e.strstart++,e.lookahead--,e.strm.avail_out===0)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(r=Ao(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===qa?(Ea(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(Ea(e,!1),e.strm.avail_out===0)?1:2};function Un(e,t,i,r,a){this.good_length=e,this.max_lazy=t,this.nice_length=i,this.max_chain=r,this.func=a}var fh=[new Un(0,0,0,0,VB),new Un(4,4,8,4,kR),new Un(4,5,16,8,kR),new Un(4,6,32,32,kR),new Un(4,4,16,16,Bl),new Un(8,16,32,32,Bl),new Un(8,16,128,128,Bl),new Un(8,32,128,256,Bl),new Un(32,128,258,1024,Bl),new Un(32,258,258,4096,Bl)];function YQ(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=am,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*WQ),this.dyn_dtree=new Uint16Array(2*(2*GQ+1)),this.bl_tree=new Uint16Array(2*(2*HQ+1)),mo(this.dyn_ltree),mo(this.dyn_dtree),mo(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(KQ+1),this.heap=new Uint16Array(2*ny+1),mo(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*ny+1),mo(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}var Jh=e=>{if(!e)return 1;let t=e.state;return!t||t.strm!==e||t.status!==yd&&t.status!==57&&t.status!==69&&t.status!==73&&t.status!==91&&t.status!==103&&t.status!==bc&&t.status!==ph?1:0},BB=e=>{if(Jh(e))return Ac(e,Wn);e.total_in=e.total_out=0,e.data_type=FQ;let t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap===2?57:t.wrap?yd:bc,e.adler=t.wrap===2?0:1,t.last_flush=-2,NQ(t),Rr},jB=e=>{let t=BB(e);return t===Rr&&(i=>{i.window_size=2*i.w_size,mo(i.head),i.max_lazy_match=fh[i.level].max_lazy,i.good_match=fh[i.level].good_length,i.nice_match=fh[i.level].nice_length,i.max_chain_length=fh[i.level].max_chain,i.strstart=0,i.block_start=0,i.lookahead=0,i.insert=0,i.match_length=i.prev_length=2,i.match_available=0,i.ins_h=0})(e.state),t},MM=(e,t,i,r,a,s)=>{if(!e)return Wn;let c=1;if(t===UQ&&(t=6),r<0?(c=0,r=-r):r>15&&(c=2,r-=16),a<1||a>9||i!==am||r<8||r>15||t<0||t>9||s<0||s>BQ||r===8&&c!==1)return Ac(e,Wn);r===8&&(r=9);let l=new YQ;return e.state=l,l.strm=e,l.status=yd,l.wrap=c,l.gzhead=null,l.w_bits=r,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=a+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+3-1)/3),l.window=new Uint8Array(2*l.w_size),l.head=new Uint16Array(l.hash_size),l.prev=new Uint16Array(l.w_size),l.lit_bufsize=1<<a+6,l.pending_buf_size=4*l.lit_bufsize,l.pending_buf=new Uint8Array(l.pending_buf_size),l.sym_buf=l.lit_bufsize,l.sym_end=3*(l.lit_bufsize-1),l.level=t,l.strategy=s,l.method=i,jB(e)},qQ=(e,t)=>{if(Jh(e)||t>PM||t<0)return e?Ac(e,Wn):Wn;let i=e.state;if(!e.output||e.avail_in!==0&&!e.input||i.status===ph&&t!==qa)return Ac(e,e.avail_out===0?LR:Wn);let r=i.last_flush;if(i.last_flush=t,i.pending!==0){if(fa(e),e.avail_out===0)return i.last_flush=-1,Rr}else if(e.avail_in===0&&kM(t)<=kM(r)&&t!==qa)return Ac(e,LR);if(i.status===ph&&e.avail_in!==0)return Ac(e,LR);if(i.status===yd&&i.wrap===0&&(i.status=bc),i.status===yd){let a=am+(i.w_bits-8<<4)<<8,s=-1;if(s=i.strategy>=g_||i.level<2?0:i.level<6?1:i.level===6?2:3,a|=s<<6,i.strstart!==0&&(a|=32),a+=31-a%31,eh(i,a),i.strstart!==0&&(eh(i,e.adler>>>16),eh(i,65535&e.adler)),e.adler=1,i.status=bc,fa(e),i.pending!==0)return i.last_flush=-1,Rr}if(i.status===57){if(e.adler=0,jt(i,31),jt(i,139),jt(i,8),i.gzhead)jt(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),jt(i,255&i.gzhead.time),jt(i,i.gzhead.time>>8&255),jt(i,i.gzhead.time>>16&255),jt(i,i.gzhead.time>>24&255),jt(i,i.level===9?2:i.strategy>=g_||i.level<2?4:0),jt(i,255&i.gzhead.os),i.gzhead.extra&&i.gzhead.extra.length&&(jt(i,255&i.gzhead.extra.length),jt(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(e.adler=dr(e.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=69;else if(jt(i,0),jt(i,0),jt(i,0),jt(i,0),jt(i,0),jt(i,i.level===9?2:i.strategy>=g_||i.level<2?4:0),jt(i,3),i.status=bc,fa(e),i.pending!==0)return i.last_flush=-1,Rr}if(i.status===69){if(i.gzhead.extra){let a=i.pending,s=(65535&i.gzhead.extra.length)-i.gzindex;for(;i.pending+s>i.pending_buf_size;){let l=i.pending_buf_size-i.pending;if(i.pending_buf.set(i.gzhead.extra.subarray(i.gzindex,i.gzindex+l),i.pending),i.pending=i.pending_buf_size,i.gzhead.hcrc&&i.pending>a&&(e.adler=dr(e.adler,i.pending_buf,i.pending-a,a)),i.gzindex+=l,fa(e),i.pending!==0)return i.last_flush=-1,Rr;a=0,s-=l}let c=new Uint8Array(i.gzhead.extra);i.pending_buf.set(c.subarray(i.gzindex,i.gzindex+s),i.pending),i.pending+=s,i.gzhead.hcrc&&i.pending>a&&(e.adler=dr(e.adler,i.pending_buf,i.pending-a,a)),i.gzindex=0}i.status=73}if(i.status===73){if(i.gzhead.name){let a,s=i.pending;do{if(i.pending===i.pending_buf_size){if(i.gzhead.hcrc&&i.pending>s&&(e.adler=dr(e.adler,i.pending_buf,i.pending-s,s)),fa(e),i.pending!==0)return i.last_flush=-1,Rr;s=0}a=i.gzindex<i.gzhead.name.length?255&i.gzhead.name.charCodeAt(i.gzindex++):0,jt(i,a)}while(a!==0);i.gzhead.hcrc&&i.pending>s&&(e.adler=dr(e.adler,i.pending_buf,i.pending-s,s)),i.gzindex=0}i.status=91}if(i.status===91){if(i.gzhead.comment){let a,s=i.pending;do{if(i.pending===i.pending_buf_size){if(i.gzhead.hcrc&&i.pending>s&&(e.adler=dr(e.adler,i.pending_buf,i.pending-s,s)),fa(e),i.pending!==0)return i.last_flush=-1,Rr;s=0}a=i.gzindex<i.gzhead.comment.length?255&i.gzhead.comment.charCodeAt(i.gzindex++):0,jt(i,a)}while(a!==0);i.gzhead.hcrc&&i.pending>s&&(e.adler=dr(e.adler,i.pending_buf,i.pending-s,s))}i.status=103}if(i.status===103){if(i.gzhead.hcrc){if(i.pending+2>i.pending_buf_size&&(fa(e),i.pending!==0))return i.last_flush=-1,Rr;jt(i,255&e.adler),jt(i,e.adler>>8&255),e.adler=0}if(i.status=bc,fa(e),i.pending!==0)return i.last_flush=-1,Rr}if(e.avail_in!==0||i.lookahead!==0||t!==Io&&i.status!==ph){let a=i.level===0?VB(i,t):i.strategy===g_?((s,c)=>{let l;for(;;){if(s.lookahead===0&&(Cd(s),s.lookahead===0)){if(c===Io)return 1;break}if(s.match_length=0,l=Ao(s,0,s.window[s.strstart]),s.lookahead--,s.strstart++,l&&(Ea(s,!1),s.strm.avail_out===0))return 1}return s.insert=0,c===qa?(Ea(s,!0),s.strm.avail_out===0?3:4):s.sym_next&&(Ea(s,!1),s.strm.avail_out===0)?1:2})(i,t):i.strategy===VQ?((s,c)=>{let l,u,h,p,_=s.window;for(;;){if(s.lookahead<=Cc){if(Cd(s),s.lookahead<=Cc&&c===Io)return 1;if(s.lookahead===0)break}if(s.match_length=0,s.lookahead>=3&&s.strstart>0&&(h=s.strstart-1,u=_[h],u===_[++h]&&u===_[++h]&&u===_[++h])){p=s.strstart+Cc;do;while(u===_[++h]&&u===_[++h]&&u===_[++h]&&u===_[++h]&&u===_[++h]&&u===_[++h]&&u===_[++h]&&u===_[++h]&&h<p);s.match_length=Cc-(p-h),s.match_length>s.lookahead&&(s.match_length=s.lookahead)}if(s.match_length>=3?(l=Ao(s,1,s.match_length-3),s.lookahead-=s.match_length,s.strstart+=s.match_length,s.match_length=0):(l=Ao(s,0,s.window[s.strstart]),s.lookahead--,s.strstart++),l&&(Ea(s,!1),s.strm.avail_out===0))return 1}return s.insert=0,c===qa?(Ea(s,!0),s.strm.avail_out===0?3:4):s.sym_next&&(Ea(s,!1),s.strm.avail_out===0)?1:2})(i,t):fh[i.level].func(i,t);if(a!==3&&a!==4||(i.status=ph),a===1||a===3)return e.avail_out===0&&(i.last_flush=-1),Rr;if(a===2&&(t===LQ?PQ(i):t!==PM&&(ay(i,0,0,!1),t===kQ&&(mo(i.head),i.lookahead===0&&(i.strstart=0,i.block_start=0,i.insert=0))),fa(e),e.avail_out===0))return i.last_flush=-1,Rr}return t!==qa?Rr:i.wrap<=0?LM:(i.wrap===2?(jt(i,255&e.adler),jt(i,e.adler>>8&255),jt(i,e.adler>>16&255),jt(i,e.adler>>24&255),jt(i,255&e.total_in),jt(i,e.total_in>>8&255),jt(i,e.total_in>>16&255),jt(i,e.total_in>>24&255)):(eh(i,e.adler>>>16),eh(i,65535&e.adler)),fa(e),i.wrap>0&&(i.wrap=-i.wrap),i.pending!==0?Rr:LM)},XQ=(e,t)=>{let i=t.length;if(Jh(e))return Wn;let r=e.state,a=r.wrap;if(a===2||a===1&&r.status!==yd||r.lookahead)return Wn;if(a===1&&(e.adler=Xh(e.adler,t,i,0)),r.wrap=0,i>=r.w_size){a===0&&(mo(r.head),r.strstart=0,r.block_start=0,r.insert=0);let u=new Uint8Array(r.w_size);u.set(t.subarray(i-r.w_size,i),0),t=u,i=r.w_size}let s=e.avail_in,c=e.next_in,l=e.input;for(e.avail_in=i,e.next_in=0,e.input=t,Cd(r);r.lookahead>=3;){let u=r.strstart,h=r.lookahead-2;do r.ins_h=Oo(r,r.ins_h,r.window[u+3-1]),r.prev[u&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=u,u++;while(--h);r.strstart=u,r.lookahead=2,Cd(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=2,r.match_available=0,e.next_in=c,e.input=l,e.avail_in=s,r.wrap=a,Rr},bh={deflateInit:(e,t)=>MM(e,t,am,15,8,jQ),deflateInit2:MM,deflateReset:jB,deflateResetKeep:BB,deflateSetHeader:(e,t)=>Jh(e)||e.state.wrap!==2?Wn:(e.state.gzhead=t,Rr),deflate:qQ,deflateEnd:e=>{if(Jh(e))return Wn;let t=e.state.status;return e.state=null,t===bc?Ac(e,MQ):Rr},deflateSetDictionary:XQ,deflateInfo:"pako deflate (from Nodeca project)"},JQ=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),nm={assign:function(e){let t=Array.prototype.slice.call(arguments,1);for(;t.length;){let i=t.shift();if(i){if(typeof i!="object")throw new TypeError(i+"must be non-object");for(let r in i)JQ(i,r)&&(e[r]=i[r])}}return e},flattenChunks:e=>{let t=0;for(let r=0,a=e.length;r<a;r++)t+=e[r].length;let i=new Uint8Array(t);for(let r=0,a=0,s=e.length;r<s;r++){let c=e[r];i.set(c,a),a+=c.length}return i}},FB=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{FB=!1}var Qh=new Uint8Array(256);for(let e=0;e<256;e++)Qh[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;Qh[254]=Qh[254]=1;var Zh={string2buf:e=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(e);let t,i,r,a,s,c=e.length,l=0;for(a=0;a<c;a++)i=e.charCodeAt(a),(64512&i)==55296&&a+1<c&&(r=e.charCodeAt(a+1),(64512&r)==56320&&(i=65536+(i-55296<<10)+(r-56320),a++)),l+=i<128?1:i<2048?2:i<65536?3:4;for(t=new Uint8Array(l),s=0,a=0;s<l;a++)i=e.charCodeAt(a),(64512&i)==55296&&a+1<c&&(r=e.charCodeAt(a+1),(64512&r)==56320&&(i=65536+(i-55296<<10)+(r-56320),a++)),i<128?t[s++]=i:i<2048?(t[s++]=192|i>>>6,t[s++]=128|63&i):i<65536?(t[s++]=224|i>>>12,t[s++]=128|i>>>6&63,t[s++]=128|63&i):(t[s++]=240|i>>>18,t[s++]=128|i>>>12&63,t[s++]=128|i>>>6&63,t[s++]=128|63&i);return t},buf2string:(e,t)=>{let i=t||e.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(e.subarray(0,t));let r,a,s=new Array(2*i);for(a=0,r=0;r<i;){let c=e[r++];if(c<128){s[a++]=c;continue}let l=Qh[c];if(l>4)s[a++]=65533,r+=l-1;else{for(c&=l===2?31:l===3?15:7;l>1&&r<i;)c=c<<6|63&e[r++],l--;l>1?s[a++]=65533:c<65536?s[a++]=c:(c-=65536,s[a++]=55296|c>>10&1023,s[a++]=56320|1023&c)}}return((c,l)=>{if(l<65534&&c.subarray&&FB)return String.fromCharCode.apply(null,c.length===l?c:c.subarray(0,l));let u="";for(let h=0;h<l;h++)u+=String.fromCharCode(c[h]);return u})(s,a)},utf8border:(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let i=t-1;for(;i>=0&&(192&e[i])==128;)i--;return i<0||i===0?t:i+Qh[e[i]]>t?i:t}},GB=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0},HB=Object.prototype.toString,{Z_NO_FLUSH:QQ,Z_SYNC_FLUSH:ZQ,Z_FULL_FLUSH:$Q,Z_FINISH:eZ,Z_OK:bE,Z_STREAM_END:tZ,Z_DEFAULT_COMPRESSION:iZ,Z_DEFAULT_STRATEGY:rZ,Z_DEFLATED:aZ}=rm;function Q_(e){this.options=nm.assign({level:iZ,method:aZ,chunkSize:16384,windowBits:15,memLevel:8,strategy:rZ},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new GB,this.strm.avail_out=0;let i=bh.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(i!==bE)throw new Error(Mc[i]);if(t.header&&bh.deflateSetHeader(this.strm,t.header),t.dictionary){let r;if(r=typeof t.dictionary=="string"?Zh.string2buf(t.dictionary):HB.call(t.dictionary)==="[object ArrayBuffer]"?new Uint8Array(t.dictionary):t.dictionary,i=bh.deflateSetDictionary(this.strm,r),i!==bE)throw new Error(Mc[i]);this._dict_set=!0}}function nZ(e,t){let i=new Q_(t);if(i.push(e,!0),i.err)throw i.msg||Mc[i.err];return i.result}Q_.prototype.push=function(e,t){let i=this.strm,r=this.options.chunkSize,a,s;if(this.ended)return!1;for(s=t===~~t?t:t===!0?eZ:QQ,typeof e=="string"?i.input=Zh.string2buf(e):HB.call(e)==="[object ArrayBuffer]"?i.input=new Uint8Array(e):i.input=e,i.next_in=0,i.avail_in=i.input.length;;)if(i.avail_out===0&&(i.output=new Uint8Array(r),i.next_out=0,i.avail_out=r),(s===ZQ||s===$Q)&&i.avail_out<=6)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else{if(a=bh.deflate(i,s),a===tZ)return i.next_out>0&&this.onData(i.output.subarray(0,i.next_out)),a=bh.deflateEnd(this.strm),this.onEnd(a),this.ended=!0,a===bE;if(i.avail_out!==0){if(s>0&&i.next_out>0)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else if(i.avail_in===0)break}else this.onData(i.output)}return!0},Q_.prototype.onData=function(e){this.chunks.push(e)},Q_.prototype.onEnd=function(e){e===bE&&(this.result=nm.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var sZ={deflate:nZ},S_=16209,oZ=function(e,t){let i,r,a,s,c,l,u,h,p,_,m,S,C,v,y,I,O,P,U,x,G,Z,J,q,ie=e.state;i=e.next_in,J=e.input,r=i+(e.avail_in-5),a=e.next_out,q=e.output,s=a-(t-e.avail_out),c=a+(e.avail_out-257),l=ie.dmax,u=ie.wsize,h=ie.whave,p=ie.wnext,_=ie.window,m=ie.hold,S=ie.bits,C=ie.lencode,v=ie.distcode,y=(1<<ie.lenbits)-1,I=(1<<ie.distbits)-1;e:do{S<15&&(m+=J[i++]<<S,S+=8,m+=J[i++]<<S,S+=8),O=C[m&y];t:for(;;){if(P=O>>>24,m>>>=P,S-=P,P=O>>>16&255,P===0)q[a++]=65535&O;else{if(!(16&P)){if(!(64&P)){O=C[(65535&O)+(m&(1<<P)-1)];continue t}if(32&P){ie.mode=16191;break e}e.msg="invalid literal/length code",ie.mode=S_;break e}U=65535&O,P&=15,P&&(S<P&&(m+=J[i++]<<S,S+=8),U+=m&(1<<P)-1,m>>>=P,S-=P),S<15&&(m+=J[i++]<<S,S+=8,m+=J[i++]<<S,S+=8),O=v[m&I];i:for(;;){if(P=O>>>24,m>>>=P,S-=P,P=O>>>16&255,!(16&P)){if(!(64&P)){O=v[(65535&O)+(m&(1<<P)-1)];continue i}e.msg="invalid distance code",ie.mode=S_;break e}if(x=65535&O,P&=15,S<P&&(m+=J[i++]<<S,S+=8,S<P&&(m+=J[i++]<<S,S+=8)),x+=m&(1<<P)-1,x>l){e.msg="invalid distance too far back",ie.mode=S_;break e}if(m>>>=P,S-=P,P=a-s,x>P){if(P=x-P,P>h&&ie.sane){e.msg="invalid distance too far back",ie.mode=S_;break e}if(G=0,Z=_,p===0){if(G+=u-P,P<U){U-=P;do q[a++]=_[G++];while(--P);G=a-x,Z=q}}else if(p<P){if(G+=u+p-P,P-=p,P<U){U-=P;do q[a++]=_[G++];while(--P);if(G=0,p<U){P=p,U-=P;do q[a++]=_[G++];while(--P);G=a-x,Z=q}}}else if(G+=p-P,P<U){U-=P;do q[a++]=_[G++];while(--P);G=a-x,Z=q}for(;U>2;)q[a++]=Z[G++],q[a++]=Z[G++],q[a++]=Z[G++],U-=3;U&&(q[a++]=Z[G++],U>1&&(q[a++]=Z[G++]))}else{G=a-x;do q[a++]=q[G++],q[a++]=q[G++],q[a++]=q[G++],U-=3;while(U>2);U&&(q[a++]=q[G++],U>1&&(q[a++]=q[G++]))}break}}break}}while(i<r&&a<c);U=S>>3,i-=U,S-=U<<3,m&=(1<<S)-1,e.next_in=i,e.next_out=a,e.avail_in=i<r?r-i+5:5-(i-r),e.avail_out=a<c?c-a+257:257-(a-c),ie.hold=m,ie.bits=S},T_=15,cZ=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),lZ=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),dZ=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),uZ=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),Ah=(e,t,i,r,a,s,c,l)=>{let u=l.bits,h,p,_,m,S,C,v=0,y=0,I=0,O=0,P=0,U=0,x=0,G=0,Z=0,J=0,q=null,ie=new Uint16Array(16),Ie=new Uint16Array(16),Ve,He,ut,st=null;for(v=0;v<=T_;v++)ie[v]=0;for(y=0;y<r;y++)ie[t[i+y]]++;for(P=u,O=T_;O>=1&&ie[O]===0;O--);if(P>O&&(P=O),O===0)return a[s++]=20971520,a[s++]=20971520,l.bits=1,0;for(I=1;I<O&&ie[I]===0;I++);for(P<I&&(P=I),G=1,v=1;v<=T_;v++)if(G<<=1,G-=ie[v],G<0)return-1;if(G>0&&(e===0||O!==1))return-1;for(Ie[1]=0,v=1;v<T_;v++)Ie[v+1]=Ie[v]+ie[v];for(y=0;y<r;y++)t[i+y]!==0&&(c[Ie[t[i+y]]++]=y);if(e===0?(q=st=c,C=20):e===1?(q=cZ,st=lZ,C=257):(q=dZ,st=uZ,C=0),J=0,y=0,v=I,S=s,U=P,x=0,_=-1,Z=1<<P,m=Z-1,e===1&&Z>852||e===2&&Z>592)return 1;for(;;){Ve=v-x,c[y]+1<C?(He=0,ut=c[y]):c[y]>=C?(He=st[c[y]-C],ut=q[c[y]-C]):(He=96,ut=0),h=1<<v-x,p=1<<U,I=p;do p-=h,a[S+(J>>x)+p]=Ve<<24|He<<16|ut|0;while(p!==0);for(h=1<<v-1;J&h;)h>>=1;if(h!==0?(J&=h-1,J+=h):J=0,y++,--ie[v]==0){if(v===O)break;v=t[i+c[y]]}if(v>P&&(J&m)!==_){for(x===0&&(x=P),S+=I,U=v-x,G=1<<U;U+x<O&&(G-=ie[U+x],!(G<=0));)U++,G<<=1;if(Z+=1<<U,e===1&&Z>852||e===2&&Z>592)return 1;_=J&m,a[_]=P<<24|U<<16|S-s|0}}return J!==0&&(a[S+J]=v-x<<24|64<<16|0),l.bits=P,0},{Z_FINISH:UM,Z_BLOCK:hZ,Z_TREES:R_,Z_OK:Nc,Z_STREAM_END:pZ,Z_NEED_DICT:fZ,Z_STREAM_ERROR:Xa,Z_DATA_ERROR:WB,Z_MEM_ERROR:KB,Z_BUF_ERROR:_Z,Z_DEFLATED:xM}=rm,sm=16180,AE=16190,Ss=16191,MR=16192,UR=16194,v_=16199,y_=16200,xR=16206,fi=16209,VM=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function EZ(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}var Dc=e=>{if(!e)return 1;let t=e.state;return!t||t.strm!==e||t.mode<sm||t.mode>16211?1:0},zB=e=>{if(Dc(e))return Xa;let t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=sm,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,Nc},YB=e=>{if(Dc(e))return Xa;let t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,zB(e)},qB=(e,t)=>{let i;if(Dc(e))return Xa;let r=e.state;return t<0?(i=0,t=-t):(i=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?Xa:(r.window!==null&&r.wbits!==t&&(r.window=null),r.wrap=i,r.wbits=t,YB(e))},BM=(e,t)=>{if(!e)return Xa;let i=new EZ;e.state=i,i.strm=e,i.window=null,i.mode=sm;let r=qB(e,t);return r!==Nc&&(e.state=null),r},VR,BR,jM=!0,mZ=e=>{if(jM){VR=new Int32Array(512),BR=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(Ah(1,e.lens,0,288,VR,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;Ah(2,e.lens,0,32,BR,0,e.work,{bits:5}),jM=!1}e.lencode=VR,e.lenbits=9,e.distcode=BR,e.distbits=5},XB=(e,t,i,r)=>{let a,s=e.state;return s.window===null&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new Uint8Array(s.wsize)),r>=s.wsize?(s.window.set(t.subarray(i-s.wsize,i),0),s.wnext=0,s.whave=s.wsize):(a=s.wsize-s.wnext,a>r&&(a=r),s.window.set(t.subarray(i-r,i-r+a),s.wnext),(r-=a)?(s.window.set(t.subarray(i-r,i),0),s.wnext=r,s.whave=s.wsize):(s.wnext+=a,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=a))),0},gZ=(e,t)=>{let i,r,a,s,c,l,u,h,p,_,m,S,C,v,y,I,O,P,U,x,G,Z,J=0,q=new Uint8Array(4),ie,Ie,Ve=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Dc(e)||!e.output||!e.input&&e.avail_in!==0)return Xa;i=e.state,i.mode===Ss&&(i.mode=MR),c=e.next_out,a=e.output,u=e.avail_out,s=e.next_in,r=e.input,l=e.avail_in,h=i.hold,p=i.bits,_=l,m=u,Z=Nc;e:for(;;)switch(i.mode){case sm:if(i.wrap===0){i.mode=MR;break}for(;p<16;){if(l===0)break e;l--,h+=r[s++]<<p,p+=8}if(2&i.wrap&&h===35615){i.wbits===0&&(i.wbits=15),i.check=0,q[0]=255&h,q[1]=h>>>8&255,i.check=dr(i.check,q,2,0),h=0,p=0,i.mode=16181;break}if(i.head&&(i.head.done=!1),!(1&i.wrap)||(((255&h)<<8)+(h>>8))%31){e.msg="incorrect header check",i.mode=fi;break}if((15&h)!==xM){e.msg="unknown compression method",i.mode=fi;break}if(h>>>=4,p-=4,G=8+(15&h),i.wbits===0&&(i.wbits=G),G>15||G>i.wbits){e.msg="invalid window size",i.mode=fi;break}i.dmax=1<<i.wbits,i.flags=0,e.adler=i.check=1,i.mode=512&h?16189:Ss,h=0,p=0;break;case 16181:for(;p<16;){if(l===0)break e;l--,h+=r[s++]<<p,p+=8}if(i.flags=h,(255&er(i))!==xM){e.msg="unknown compression method",i.mode=fi;break}if(57344&er(i)){e.msg="unknown header flags set",i.mode=fi;break}i.head&&(i.head.text=h>>8&1),512&er(i)&&4&i.wrap&&(q[0]=255&h,q[1]=h>>>8&255,i.check=dr(i.check,q,2,0)),h=0,p=0,i.mode=16182;case 16182:for(;p<32;){if(l===0)break e;l--,h+=r[s++]<<p,p+=8}i.head&&(i.head.time=h),512&er(i)&&4&i.wrap&&(q[0]=255&h,q[1]=h>>>8&255,q[2]=h>>>16&255,q[3]=h>>>24&255,i.check=dr(i.check,q,4,0)),h=0,p=0,i.mode=16183;case 16183:for(;p<16;){if(l===0)break e;l--,h+=r[s++]<<p,p+=8}i.head&&(i.head.xflags=255&h,i.head.os=h>>8),512&er(i)&&4&i.wrap&&(q[0]=255&h,q[1]=h>>>8&255,i.check=dr(i.check,q,2,0)),h=0,p=0,i.mode=16184;case 16184:if(1024&er(i)){for(;p<16;){if(l===0)break e;l--,h+=r[s++]<<p,p+=8}i.length=h,i.head&&(i.head.extra_len=h),512&er(i)&&4&i.wrap&&(q[0]=255&h,q[1]=h>>>8&255,i.check=dr(i.check,q,2,0)),h=0,p=0}else i.head&&(i.head.extra=null);i.mode=16185;case 16185:if(1024&er(i)&&(S=i.length,S>l&&(S=l),S&&(i.head&&(G=i.head.extra_len-i.length,i.head.extra||(i.head.extra=new Uint8Array(i.head.extra_len)),i.head.extra.set(r.subarray(s,s+S),G)),512&er(i)&&4&i.wrap&&(i.check=dr(i.check,r,S,s)),l-=S,s+=S,i.length-=S),i.length))break e;i.length=0,i.mode=16186;case 16186:if(2048&er(i)){if(l===0)break e;S=0;do G=r[s+S++],i.head&&G&&i.length<65536&&(i.head.name+=String.fromCharCode(G));while(G&&S<l);if(512&er(i)&&4&i.wrap&&(i.check=dr(i.check,r,S,s)),l-=S,s+=S,G)break e}else i.head&&(i.head.name=null);i.length=0,i.mode=16187;case 16187:if(4096&er(i)){if(l===0)break e;S=0;do G=r[s+S++],i.head&&G&&i.length<65536&&(i.head.comment+=String.fromCharCode(G));while(G&&S<l);if(512&er(i)&&4&i.wrap&&(i.check=dr(i.check,r,S,s)),l-=S,s+=S,G)break e}else i.head&&(i.head.comment=null);i.mode=16188;case 16188:if(512&er(i)){for(;p<16;){if(l===0)break e;l--,h+=r[s++]<<p,p+=8}if(4&i.wrap&&h!==(65535&i.check)){e.msg="header crc mismatch",i.mode=fi;break}h=0,p=0}i.head&&(i.head.hcrc=er(i)>>9&1,i.head.done=!0),e.adler=i.check=0,i.mode=Ss;break;case 16189:for(;p<32;){if(l===0)break e;l--,h+=r[s++]<<p,p+=8}e.adler=i.check=VM(h),h=0,p=0,i.mode=AE;case AE:if(i.havedict===0)return e.next_out=c,e.avail_out=u,e.next_in=s,e.avail_in=l,i.hold=h,i.bits=p,fZ;e.adler=i.check=1,i.mode=Ss;case Ss:if(t===hZ||t===R_)break e;case MR:if(i.last){h>>>=7&p,p-=7&p,i.mode=xR;break}for(;p<3;){if(l===0)break e;l--,h+=r[s++]<<p,p+=8}switch(i.last=1&h,h>>>=1,p-=1,3&h){case 0:i.mode=16193;break;case 1:if(mZ(i),i.mode=v_,t===R_){h>>>=2,p-=2;break e}break;case 2:i.mode=16196;break;case 3:e.msg="invalid block type",i.mode=fi}h>>>=2,p-=2;break;case 16193:for(h>>>=7&p,p-=7&p;p<32;){if(l===0)break e;l--,h+=r[s++]<<p,p+=8}if((65535&h)!=(h>>>16^65535)){e.msg="invalid stored block lengths",i.mode=fi;break}if(i.length=65535&h,h=0,p=0,i.mode=UR,t===R_)break e;case UR:i.mode=16195;case 16195:if(S=i.length,S){if(S>l&&(S=l),S>u&&(S=u),S===0)break e;a.set(r.subarray(s,s+S),c),l-=S,s+=S,u-=S,c+=S,i.length-=S;break}i.mode=Ss;break;case 16196:for(;p<14;){if(l===0)break e;l--,h+=r[s++]<<p,p+=8}if(i.nlen=257+(31&h),h>>>=5,p-=5,i.ndist=1+(31&h),h>>>=5,p-=5,i.ncode=4+(15&h),h>>>=4,p-=4,i.nlen>286||i.ndist>30){e.msg="too many length or distance symbols",i.mode=fi;break}i.have=0,i.mode=16197;case 16197:for(;i.have<i.ncode;){for(;p<3;){if(l===0)break e;l--,h+=r[s++]<<p,p+=8}i.lens[Ve[i.have++]]=7&h,h>>>=3,p-=3}for(;i.have<19;)i.lens[Ve[i.have++]]=0;if(i.lencode=i.lendyn,i.lenbits=7,ie={bits:i.lenbits},Z=Ah(0,i.lens,0,19,i.lencode,0,i.work,ie),i.lenbits=ie.bits,Z){e.msg="invalid code lengths set",i.mode=fi;break}i.have=0,i.mode=16198;case 16198:for(;i.have<i.nlen+i.ndist;){for(;J=i.lencode[h&(1<<i.lenbits)-1],y=J>>>24,I=J>>>16&255,O=65535&J,!(y<=p);){if(l===0)break e;l--,h+=r[s++]<<p,p+=8}if(O<16)h>>>=y,p-=y,i.lens[i.have++]=O;else{if(O===16){for(Ie=y+2;p<Ie;){if(l===0)break e;l--,h+=r[s++]<<p,p+=8}if(h>>>=y,p-=y,i.have===0){e.msg="invalid bit length repeat",i.mode=fi;break}G=i.lens[i.have-1],S=3+(3&h),h>>>=2,p-=2}else if(O===17){for(Ie=y+3;p<Ie;){if(l===0)break e;l--,h+=r[s++]<<p,p+=8}h>>>=y,p-=y,G=0,S=3+(7&h),h>>>=3,p-=3}else{for(Ie=y+7;p<Ie;){if(l===0)break e;l--,h+=r[s++]<<p,p+=8}h>>>=y,p-=y,G=0,S=11+(127&h),h>>>=7,p-=7}if(i.have+S>i.nlen+i.ndist){e.msg="invalid bit length repeat",i.mode=fi;break}for(;S--;)i.lens[i.have++]=G}}if(i.mode===fi)break;if(i.lens[256]===0){e.msg="invalid code -- missing end-of-block",i.mode=fi;break}if(i.lenbits=9,ie={bits:i.lenbits},Z=Ah(1,i.lens,0,i.nlen,i.lencode,0,i.work,ie),i.lenbits=ie.bits,Z){e.msg="invalid literal/lengths set",i.mode=fi;break}if(i.distbits=6,i.distcode=i.distdyn,ie={bits:i.distbits},Z=Ah(2,i.lens,i.nlen,i.ndist,i.distcode,0,i.work,ie),i.distbits=ie.bits,Z){e.msg="invalid distances set",i.mode=fi;break}if(i.mode=v_,t===R_)break e;case v_:i.mode=y_;case y_:if(l>=6&&u>=258){e.next_out=c,e.avail_out=u,e.next_in=s,e.avail_in=l,i.hold=h,i.bits=p,oZ(e,m),c=e.next_out,a=e.output,u=e.avail_out,s=e.next_in,r=e.input,l=e.avail_in,h=i.hold,p=i.bits,i.mode===Ss&&(i.back=-1);break}for(i.back=0;J=i.lencode[h&(1<<i.lenbits)-1],y=J>>>24,I=J>>>16&255,O=65535&J,!(y<=p);){if(l===0)break e;l--,h+=r[s++]<<p,p+=8}if(I&&!(240&I)){for(P=y,U=I,x=O;J=i.lencode[x+((h&(1<<P+U)-1)>>P)],y=J>>>24,I=J>>>16&255,O=65535&J,!(P+y<=p);){if(l===0)break e;l--,h+=r[s++]<<p,p+=8}h>>>=P,p-=P,i.back+=P}if(h>>>=y,p-=y,i.back+=y,i.length=O,I===0){i.mode=16205;break}if(32&I){i.back=-1,i.mode=Ss;break}if(64&I){e.msg="invalid literal/length code",i.mode=fi;break}i.extra=15&I,i.mode=16201;case 16201:if(i.extra){for(Ie=i.extra;p<Ie;){if(l===0)break e;l--,h+=r[s++]<<p,p+=8}i.length+=h&(1<<i.extra)-1,h>>>=i.extra,p-=i.extra,i.back+=i.extra}i.was=i.length,i.mode=16202;case 16202:for(;J=i.distcode[h&(1<<i.distbits)-1],y=J>>>24,I=J>>>16&255,O=65535&J,!(y<=p);){if(l===0)break e;l--,h+=r[s++]<<p,p+=8}if(!(240&I)){for(P=y,U=I,x=O;J=i.distcode[x+((h&(1<<P+U)-1)>>P)],y=J>>>24,I=J>>>16&255,O=65535&J,!(P+y<=p);){if(l===0)break e;l--,h+=r[s++]<<p,p+=8}h>>>=P,p-=P,i.back+=P}if(h>>>=y,p-=y,i.back+=y,64&I){e.msg="invalid distance code",i.mode=fi;break}i.offset=O,i.extra=15&I,i.mode=16203;case 16203:if(i.extra){for(Ie=i.extra;p<Ie;){if(l===0)break e;l--,h+=r[s++]<<p,p+=8}i.offset+=h&(1<<i.extra)-1,h>>>=i.extra,p-=i.extra,i.back+=i.extra}if(i.offset>i.dmax){e.msg="invalid distance too far back",i.mode=fi;break}i.mode=16204;case 16204:if(u===0)break e;if(S=m-u,i.offset>S){if(S=i.offset-S,S>i.whave&&i.sane){e.msg="invalid distance too far back",i.mode=fi;break}S>i.wnext?(S-=i.wnext,C=i.wsize-S):C=i.wnext-S,S>i.length&&(S=i.length),v=i.window}else v=a,C=c-i.offset,S=i.length;S>u&&(S=u),u-=S,i.length-=S;do a[c++]=v[C++];while(--S);i.length===0&&(i.mode=y_);break;case 16205:if(u===0)break e;a[c++]=i.length,u--,i.mode=y_;break;case xR:if(i.wrap){for(;p<32;){if(l===0)break e;l--,h|=r[s++]<<p,p+=8}if(m-=u,e.total_out+=m,i.total+=m,4&i.wrap&&m&&(e.adler=i.check=er(i)?dr(i.check,a,m,c-m):Xh(i.check,a,m,c-m)),m=u,4&i.wrap&&(er(i)?h:VM(h))!==i.check){e.msg="incorrect data check",i.mode=fi;break}h=0,p=0}i.mode=16207;case 16207:if(i.wrap&&er(i)){for(;p<32;){if(l===0)break e;l--,h+=r[s++]<<p,p+=8}if(4&i.wrap&&h!==(4294967295&i.total)){e.msg="incorrect length check",i.mode=fi;break}h=0,p=0}i.mode=16208;case 16208:Z=pZ;break e;case fi:Z=WB;break e;case 16210:return KB;default:return Xa}return e.next_out=c,e.avail_out=u,e.next_in=s,e.avail_in=l,i.hold=h,i.bits=p,(i.wsize||m!==e.avail_out&&i.mode<fi&&(i.mode<xR||t!==UM))&&XB(e,e.output,e.next_out,m-e.avail_out),_-=e.avail_in,m-=e.avail_out,e.total_in+=_,e.total_out+=m,i.total+=m,4&i.wrap&&m&&(e.adler=i.check=er(i)?dr(i.check,a,m,e.next_out-m):Xh(i.check,a,m,e.next_out-m)),e.data_type=i.bits+(i.last?64:0)+(i.mode===Ss?128:0)+(i.mode===v_||i.mode===UR?256:0),(_===0&&m===0||t===UM)&&Z===Nc&&(Z=_Z),Z},As={inflateReset:YB,inflateReset2:qB,inflateResetKeep:zB,inflateInit:e=>BM(e,15),inflateInit2:BM,inflate:gZ,inflateEnd:e=>{if(Dc(e))return Xa;let t=e.state;return t.window&&(t.window=null),e.state=null,Nc},inflateGetHeader:(e,t)=>{if(Dc(e))return Xa;let i=e.state;return 2&i.wrap?(i.head=t,t.done=!1,Nc):Xa},inflateSetDictionary:(e,t)=>{let i=t.length,r,a,s;return Dc(e)?Xa:(r=e.state,r.wrap!==0&&r.mode!==AE?Xa:r.mode===AE&&(a=1,a=Xh(a,t,i,0),a!==r.check)?WB:(s=XB(e,t,i,i),s?(r.mode=16210,KB):(r.havedict=1,Nc)))},inflateInfo:"pako inflate (from Nodeca project)"},SZ=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1},JB=Object.prototype.toString,{Z_NO_FLUSH:TZ,Z_FINISH:RZ,Z_OK:Ih,Z_STREAM_END:jR,Z_NEED_DICT:FR,Z_STREAM_ERROR:vZ,Z_DATA_ERROR:FM,Z_MEM_ERROR:yZ}=rm;function Z_(e){this.options=nm.assign({chunkSize:65536,windowBits:15,to:""},e||{});let t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,t.windowBits===0&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&!(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new GB,this.strm.avail_out=0;let i=As.inflateInit2(this.strm,t.windowBits);if(i!==Ih)throw new Error(Mc[i]);if(this.header=new SZ,As.inflateGetHeader(this.strm,this.header),t.dictionary&&(typeof t.dictionary=="string"?t.dictionary=Zh.string2buf(t.dictionary):JB.call(t.dictionary)==="[object ArrayBuffer]"&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(i=As.inflateSetDictionary(this.strm,t.dictionary),i!==Ih)))throw new Error(Mc[i])}function CZ(e,t){let i=new Z_(t);if(i.push(e),i.err)throw i.msg||Mc[i.err];return i.result}Z_.prototype.push=function(e,t){let i=this.strm,r=this.options.chunkSize,a=this.options.dictionary,s,c,l;if(this.ended)return!1;for(c=t===~~t?t:t===!0?RZ:TZ,JB.call(e)==="[object ArrayBuffer]"?i.input=new Uint8Array(e):i.input=e,i.next_in=0,i.avail_in=i.input.length;;){for(i.avail_out===0&&(i.output=new Uint8Array(r),i.next_out=0,i.avail_out=r),s=As.inflate(i,c),s===FR&&a&&(s=As.inflateSetDictionary(i,a),s===Ih?s=As.inflate(i,c):s===FM&&(s=FR));i.avail_in>0&&s===jR&&i.state.wrap>0&&e[i.next_in]!==0;)As.inflateReset(i),s=As.inflate(i,c);switch(s){case vZ:case FM:case FR:case yZ:return this.onEnd(s),this.ended=!0,!1}if(l=i.avail_out,i.next_out&&(i.avail_out===0||s===jR))if(this.options.to==="string"){let u=Zh.utf8border(i.output,i.next_out),h=i.next_out-u,p=Zh.buf2string(i.output,u);i.next_out=h,i.avail_out=r-h,h&&i.output.set(i.output.subarray(u,u+h),0),this.onData(p)}else this.onData(i.output.length===i.next_out?i.output:i.output.subarray(0,i.next_out));if(s!==Ih||l!==0){if(s===jR)return s=As.inflateEnd(this.strm),this.onEnd(s),this.ended=!0,!0;if(i.avail_in===0)break}}return!0},Z_.prototype.onData=function(e){this.chunks.push(e)},Z_.prototype.onEnd=function(e){e===Ih&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=nm.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var bZ={inflate:CZ},{deflate:AZ}=sZ,{inflate:IZ}=bZ,OZ=AZ,wZ=IZ,QB=function(e){return e[e.ONE_BYTE=0]="ONE_BYTE",e[e.TWO_BYTE=1]="TWO_BYTE",e}(QB||{}),NZ=class{constructor(){b(this,"_sequence",0),b(this,"_startTime",Date.now()),b(this,"isUseOneByte",!0)}get startTime(){let e=Date.now()-this._startTime;return e<Math.pow(2,16)?e:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(e){let t={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:e};if(e.byteLength>128){let c=new Uint8Array(4);c.set([1,0,0,0]);let l={id:0,length:4,data:c.buffer},u={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[l]};t.commonPacketHeader.extension=1,t.extension=u,t.payload=this.compress(e),t.commonPacketHeader.length=8+(t.extension.length+2)+t.payload.byteLength}else t.commonPacketHeader.length=8+t.payload.byteLength;k("SHOW_DATASTREAM2_LOG")&&R.debug("send data header: ".concat(JSON.stringify(t.commonPacketHeader)));let i=new ArrayBuffer(t.commonPacketHeader.length),r=new Uint8Array(i),a=new DataView(i),s=0;if(a.setUint16(s,t.commonPacketHeader.extension<<15|t.commonPacketHeader.reserved<<14|t.commonPacketHeader.length,!0),s+=2,a.setUint32(s,t.commonPacketHeader.sequence,!0),s+=4,a.setUint16(s,t.commonStreamHeader,!0),s+=2,t.extension){let c=this.serializeExtension(t.extension);r.set(new Uint8Array(c),s),s+=c.byteLength}if(r.set(new Uint8Array(t.payload),s),s+=t.payload.byteLength,s!==t.commonPacketHeader.length)throw Error("serialize error!");return i}deserialize(e){if(e.byteLength<4)return new ArrayBuffer(0);let t=new DataView(e),i=0,r=t.getUint16(i,!0);i+=2;let a={length:16383&r,reserved:(16384&r)>>14,extension:(32768&r)>>15,sequence:t.getUint16(i+2,!0)<<16|t.getUint16(i,!0)},s,c;if(i+=4,k("SHOW_DATASTREAM2_LOG")&&R.debug("receive data header: ".concat(JSON.stringify(a))),t.getUint16(i,!0),i+=2,a.extension){c=this.deserializeExtension(e.slice(i)),i+=2+c.length,s=e.slice(i);let l=!1;if(c.datas.length>0){let u=c.datas.find(h=>h.id===0);u&&(l=(1&new DataView(u.data).getUint32(0,!0))==1)}s=l?this.decompress(s):s}else s=e.slice(8);return s}serializeExtension(e){let{profile:t,length:i,datas:r}=e,a=new ArrayBuffer(i+2),s=new Uint8Array(a),c=new DataView(a),l=0;if(c.setUint8(l++,t),c.setUint8(l++,i),r.forEach(u=>{t?(c.setUint8(l++,u.id),c.setUint8(l++,u.length),s.set(new Uint8Array(u.data),l),l+=u.data.byteLength):(c.setUint8(l++,u.id|u.length<<4),s.set(new Uint8Array(u.data),l),l+=u.data.byteLength)}),l!==i+2)throw Error("serialize extension error, is ".concat(l,"!==").concat(i+2));return a}deserializeExtension(e){let t=new DataView(e),i=0,r=t.getUint8(i);i++;let a=t.getUint8(i);i++;let s=r===QB.TWO_BYTE,c=[],l=new DataView(e,2),u=0;for(;u<a;){let h=0,p=0,_=new ArrayBuffer(0);s?(h=l.getUint8(u),u++,p=l.getUint8(u),u++):(h=15&l.getUint8(u),p=l.getUint8(u)>>4,u++),p>0&&(_=l.buffer.slice(u+2,u+2+p),u+=_.byteLength),c.push({id:h,length:p,data:_})}if(u!==a)throw Error("parse error");return{profile:r,length:a,datas:c}}decompress(e){return wZ(new Uint8Array(e))}compress(e){return OZ(new Uint8Array(e))}},DZ={name:"DataStream",create:(e,t)=>{let i=t?new pJ(e):new fJ(e);return i.useDataStream(new NZ),i}},PZ=class extends Lt{constructor(e,t,i){super(),b(this,"ws",void 0),b(this,"requestId",1),b(this,"heartBeatTimer",void 0),b(this,"joinInfo",void 0),b(this,"clientId",void 0),b(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),b(this,"onClose",r=>{this.emit("close"),this.dispose()}),b(this,"onMessage",r=>{let a=JSON.parse(r.data);if(!a||a.command!=="serverResponse"||!a.requestId)return a&&a.command==="serverStatus"&&a.serverStatus&&a.serverStatus.command?(this.emit("status",a.serverStatus),void this.emit(a.serverStatus.command,a.serverStatus)):void 0;this.emit("req_".concat(a.requestId),a)}),this.joinInfo=e,this.clientId=t,this.ws=new Bh("cross-channel-".concat(this.clientId),i),this.ws.on(Ce.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(Ce.CONNECTED,this.onOpen),this.ws.on(Ce.ON_MESSAGE,this.onMessage),this.ws.on(Ce.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(e){let t=this.requestId++;return e.requestId=t,e.seq=t,this.ws.sendMessage(e),t}waitStatus(e){return new ae((t,i)=>{let r=window.setTimeout(()=>{i(new B(A.TIMEOUT,"wait status timeout, status: ".concat(e)))},5e3);this.once(e,a=>{window.clearTimeout(r),a.state&&a.state!==0?i(new B(A.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(e))):t(void 0)}),this.once("dispose",()=>{window.clearTimeout(r),i(new B(A.WS_ABORT))})})}async request(e){if(this.ws.state==="closed")throw new B(A.WS_DISCONNECT);let t=()=>new ae((s,c)=>{this.ws.once(Ce.CLOSED,()=>c(new B(A.WS_ABORT))),this.ws.once(Ce.CONNECTED,s)});this.ws.state!=="connected"&&await t();let i=this.sendMessage(e),r=new ae((s,c)=>{let l=()=>{c(new B(A.WS_ABORT))};this.ws.once(Ce.RECONNECTING,l),this.ws.once(Ce.CLOSED,l),this.once("req_".concat(i),s),yi(3e3).then(()=>{this.removeAllListeners("req_".concat(i)),this.ws.off(Ce.RECONNECTING,l),this.ws.off(Ce.CLOSED,l),c(new B(A.TIMEOUT,"cross channel ws request timeout"))})}),a=await r;if(!a||a.code!==200)throw new B(A.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(a)));return a}async connect(e){this.ws.removeAllListeners(Ce.REQUEST_NEW_URLS),this.ws.on(Ce.REQUEST_NEW_URLS,t=>{t(e)}),await this.ws.init(e)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(e){let t=this.requestId++;return e.requestId=t,this.ws.sendMessage(e),t}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}},LZ=class extends Lt{set state(e){e!==this._state&&(e!==Or.RELAY_STATE_FAILURE&&(this.errorCode=Hl.RELAY_OK),this.emit("state",e,this.errorCode),this._state=e)}get state(){return this._state}constructor(e,t,i,r,a){super(),b(this,"joinInfo",void 0),b(this,"sid",void 0),b(this,"clientId",void 0),b(this,"cancelToken",yr.CancelToken.source()),b(this,"workerToken",void 0),b(this,"requestId",0),b(this,"signal",void 0),b(this,"prevChannelMediaConfig",void 0),b(this,"httpRetryConfig",void 0),b(this,"_resolution",void 0),b(this,"_state",Or.RELAY_STATE_IDLE),b(this,"errorCode",Hl.RELAY_OK),b(this,"onStatus",s=>{R.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(s))),s&&s.command&&(s.command==="onAudioPacketReceived"&&this.emit("event",Ts.PACKET_RECEIVED_AUDIO_FROM_SRC),s.command==="onVideoPacketReceived"&&this.emit("event",Ts.PACKET_RECEIVED_VIDEO_FROM_SRC),s.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=Hl.SRC_TOKEN_EXPIRED,this.state=Or.RELAY_STATE_FAILURE),s.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=Hl.DEST_TOKEN_EXPIRED,this.state=Or.RELAY_STATE_FAILURE))}),b(this,"onReconnect",async()=>{R.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",Ts.NETWORK_DISCONNECTED),this.state=Or.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(s=>{this.state!==Or.RELAY_STATE_IDLE&&(R.error("auto restart channel media relay failed",s.toString()),this.errorCode=Hl.SERVER_CONNECTION_LOST,this.state=Or.RELAY_STATE_FAILURE)})}),this.joinInfo=e,this.clientId=t,this.sid=$l(),this.signal=new PZ(this.joinInfo,this.clientId,i),this.httpRetryConfig=r,this._resolution=a}async startChannelMediaRelay(e){if(this.state!==Or.RELAY_STATE_IDLE)throw new B(A.INVALID_OPERATION);this.state=Or.RELAY_STATE_CONNECTING,await this.connect(),R.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(e)}catch(t){throw t.data&&t.data.serverResponse&&t.data.serverResponse.command==="SetSourceChannel"?new B(A.CROSS_CHANNEL_FAILED_JOIN_SRC):t.data&&t.data.serverResponse&&t.serverResponse.command==="SetDestChannelStatus"?new B(A.CROSS_CHANNEL_FAILED_JOIN_DEST):t.data&&t.data.serverResponse&&t.serverResponse.command==="StartPacketTransfer"?new B(A.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):t}this.prevChannelMediaConfig=e}async updateChannelMediaRelay(e){if(this.state!==Or.RELAY_STATE_RUNNING)throw new B(A.INVALID_OPERATION);await this.sendUpdateMessage(e),this.prevChannelMediaConfig=e}async setVideoProfile(e){if(this._resolution=e,this.state!==Or.RELAY_STATE_RUNNING)throw new B(A.INVALID_OPERATION);let t=this.genMessage(lr.SetVideoProfile);await this.signal.request(t),R.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),R.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=Or.RELAY_STATE_IDLE,this.dispose()}dispose(){R.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=yr.CancelToken.source(),this.state=Or.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){let e=await bJ(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=e.workerToken,await this.signal.connect(e.addressList),this.emit("event",Ts.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(e){let t=this.genMessage(lr.StopPacketTransfer);await this.signal.request(t),await this.signal.waitStatus("Normal Quit"),R.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));let i=this.genMessage(lr.SetSdkProfile,e);await this.signal.request(i),R.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));let r=this.genMessage(lr.SetSourceChannel,e);await this.signal.request(r),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",Ts.PACKET_JOINED_SRC_CHANNEL),R.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));let a=this.genMessage(lr.SetSourceUserId,e);await this.signal.request(a),R.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));let s=this.genMessage(lr.SetDestChannel,e);await this.signal.request(s),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",Ts.PACKET_JOINED_DEST_CHANNEL),R.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));let c=this.genMessage(lr.StartPacketTransfer,e);await this.signal.request(c),this.emit("event",Ts.PACKET_SENT_TO_DEST_CHANNEL),this.state=Or.RELAY_STATE_RUNNING,R.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(e){let t=this.genMessage(lr.UpdateDestChannel,e);await this.signal.request(t),this.emit("event",Ts.PACKET_UPDATE_DEST_CHANNEL),R.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){let e=this.genMessage(lr.StopPacketTransfer);await this.signal.request(e),R.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(e,t){let i=[],r=[],a=[];this.requestId+=1;let s={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:Sa,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};s.sdkVersion==="4.22.0"&&(s.sdkVersion="0.0.1");let c=null,l=null;switch(e){case lr.SetSdkProfile:return s.clientRequest={command:"SetSdkProfile",type:"multi_channel"},s;case lr.SetSourceChannel:if(l=t&&t.getSrcChannelMediaInfo(),!l)throw new B(A.UNEXPECTED_ERROR,"can not find source config");return s.clientRequest={command:"SetSourceChannel",uid:"0",channelName:l.channelName,token:l.token||this.joinInfo.appId},s;case lr.SetSourceUserId:if(l=t&&t.getSrcChannelMediaInfo(),!l)throw new B(A.UNEXPECTED_ERROR,"can not find source config");return s.clientRequest={command:"SetSourceUserId",uid:l.uid+""},s;case lr.SetDestChannel:if(c=t&&t.getDestChannelMediaInfo(),!c)throw new B(A.UNEXPECTED_ERROR,"can not find dest config");return c.forEach(u=>{i.push(u.channelName),r.push(u.uid+""),a.push(u.token||this.joinInfo.appId)}),s.clientRequest={command:"SetDestChannel",channelName:i,uid:r,token:a},s;case lr.StartPacketTransfer:return s.clientRequest={command:"StartPacketTransfer"},s;case lr.Reconnect:return s.clientRequest={command:"Reconnect"},s;case lr.StopPacketTransfer:return s.clientRequest={command:"StopPacketTransfer"},s;case lr.UpdateDestChannel:if(c=t&&t.getDestChannelMediaInfo(),!c)throw new B(A.UNEXPECTED_ERROR,"can not find dest config");return c.forEach(u=>{i.push(u.channelName),r.push(u.uid+""),a.push(u.token||this.joinInfo.appId)}),s.clientRequest={command:"UpdateDestChannel",channelName:i,uid:r,token:a},s;case lr.SetVideoProfile:s.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return s}},kZ={name:"ChannelMediaRelay",create:function(e){return new LZ(e.joinInfo,e.clientId,e.websocketRetryConfig||ti,e.httpRetryConfig||ti,e.resolution)}};function GM(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),i.push.apply(i,r)}return i}function th(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?GM(Object(i),!0).forEach(function(r){b(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):GM(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}var MZ=class extends Lt{constructor(e,t,i,r){super(),b(this,"spec",void 0),b(this,"token",void 0),b(this,"websocket",void 0),b(this,"pingpongTimer",void 0),b(this,"reconnectMode","retry"),b(this,"serviceMode",void 0),b(this,"reqId",0),b(this,"commandReqId",0),b(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),b(this,"handleWebSocketMessage",a=>{if(!a.data)return;let s=JSON.parse(a.data);s.requestId?this.emit("@".concat(s.requestId,"-").concat(s.sid),s):(fe.workerEvent(this.spec.sid,{actionType:"status",serverCode:s.code,workerType:this.serviceMode===Os.TRANSCODE?1:2}),this.emit(_o.PUBLISH_STREAM_STATUS,s))}),this.spec=t,this.token=e,this.serviceMode=r,this.websocket=new Bh("live-streaming",i),this.websocket.on(Ce.CONNECTED,this.handleWebSocketOpen),this.websocket.on(Ce.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(Ce.REQUEST_NEW_URLS,(a,s)=>{ki(this,_o.REQUEST_NEW_ADDRESS).then(a).catch(s)}),this.websocket.on(Ce.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(e){return this.websocket.init(e)}async request(e,t,i,r){this.reqId+=1,e==="request"&&(this.commandReqId+=1);let a=this.commandReqId,s=this.reqId;if(!s||!this.websocket)throw new B(A.UNEXPECTED_ERROR);let c=th({command:e,sdkVersion:Sa==="4.22.0"?"0.0.1":Sa,seq:s,requestId:s,allocate:i,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},t);if(this.websocket.state==="closed")throw new B(A.WS_DISCONNECT);let l=()=>new ae((_,m)=>{this.websocket.once(Ce.CLOSED,()=>m(new B(A.WS_ABORT))),this.websocket.once(Ce.CONNECTED,_)});this.websocket.state!=="connected"&&await l(),c.clientRequest&&(c.clientRequest.workerToken=this.token);let u=new ae((_,m)=>{let S=()=>{m(new B(A.WS_ABORT))};this.websocket.once(Ce.RECONNECTING,S),this.websocket.once(Ce.CLOSED,S),this.once("@".concat(s,"-").concat(this.spec.sid),C=>{_(C)})});r&&fe.workerEvent(this.spec.sid,th(th({},r),{},{requestId:a,actionType:"request",payload:JSON.stringify(t.clientRequest),serverCode:0,code:0}));let h=Date.now();this.websocket.sendMessage(c);let p=null;try{p=await u}catch(_){if(this.websocket.state==="closed")throw _;return await l(),await this.request(e,t,i)}return r&&fe.workerEvent(this.spec.sid,th(th({},r),{},{requestId:a,actionType:"response",payload:JSON.stringify(p.serverResponse),serverCode:p.code,success:p.code===200,responseTime:Date.now()-h})),p.code!==200&&this.handleResponseError(p),p}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){let e=Sa==="4.22.0"?"0.0.1":Sa;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:e,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(e){switch(e.code){case ai.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void R.warning("live stream response already exists stream");case ai.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case ai.LIVE_STREAM_RESPONSE_BAD_STREAM:case ai.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new B(A.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:e.code}).throw();case ai.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(e.serverResponse.command==="UnpublishStream")return;throw new B(A.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case ai.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new B(A.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:e.code}).throw();case ai.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{let t=new B(A.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(_o.WARNING,t,e.serverResponse.url)}case ai.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{let t=new B(A.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(_o.WARNING,t,e.serverResponse.url)}case ai.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new B(A.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case ai.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new B(A.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:e.code}).throw();case ai.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{let t=new B(A.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(_o.WARNING,t,e.serverResponse.url)}case ai.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new B(A.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:e.code}).throw();case ai.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new B(A.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case ai.LIVE_STREAM_RESPONSE_WORKER_LOST:case ai.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(e.serverResponse.command==="UnpublishStream")return;throw new B(A.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case ai.ERROR_FAIL_SEND_MESSAGE:if(e.serverResponse.command==="UnpublishStream")return;if(e.serverResponse.command==="UpdateTranscoding"||e.serverResponse.command==="ControlStream")return new B(A.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:e.code}).throw();throw new B(A.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case ai.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case ai.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case ai.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case ai.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new B(A.LIVE_STREAMING_CDN_ERROR,"",{code:e.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(QE)},6e3)}};function HM(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),i.push.apply(i,r)}return i}function Ir(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?HM(Object(i),!0).forEach(function(r){b(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):HM(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}var UZ=class extends Lt{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:ti,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:ti;super(),b(this,"onLiveStreamWarning",void 0),b(this,"onLiveStreamError",void 0),b(this,"spec",void 0),b(this,"retryTimeout",1e4),b(this,"connection",void 0),b(this,"httpRetryConfig",void 0),b(this,"wsRetryConfig",void 0),b(this,"streamingTasks",new Map),b(this,"isStartingStreamingTask",!1),b(this,"taskMutex",new Fi("live-streaming")),b(this,"cancelToken",yr.CancelToken.source()),b(this,"transcodingConfig",void 0),b(this,"uapResponse",void 0),b(this,"lastTaskId",1),b(this,"statusError",new Map),this.spec=e,this.httpRetryConfig=i,this.wsRetryConfig=t}async setTranscodingConfig(e){let t=Ir(Ir({},D9),e);t.videoCodecProfile!==66&&t.videoCodecProfile!==77&&t.videoCodecProfile!==100&&(R.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(t.videoCodecProfile," -> 100")),t.videoCodecProfile=100),t.transcodingUsers||(t.transcodingUsers=t.userConfigs),t.transcodingUsers&&(t.transcodingUsers=t.transcodingUsers.map(s=>Ir(Ir(Ir({},N9),s),{},{zOrder:s.zOrder?s.zOrder+1:1}))),function(s){Dt(s.width)||nt(s.width,"config.width",0,1e4),Dt(s.height)||nt(s.height,"config.height",0,1e4),Dt(s.videoBitrate)||nt(s.videoBitrate,"config.videoBitrate",1,1e6),Dt(s.videoFrameRate)||nt(s.videoFrameRate,"config.videoFrameRate"),Dt(s.lowLatency)||Is(s.lowLatency,"config.lowLatency"),Dt(s.audioSampleRate)||li(s.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),Dt(s.audioBitrate)||nt(s.audioBitrate,"config.audioBitrate",1,128),Dt(s.audioChannels)||li(s.audioChannels,"config.audioChannels",[1,2,3,4,5]),Dt(s.videoGop)||nt(s.videoGop,"config.videoGop"),Dt(s.videoCodecProfile)||li(s.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),Dt(s.userCount)||nt(s.userCount,"config.userCount",0,17),Dt(s.backgroundColor)||nt(s.backgroundColor,"config.backgroundColor",0,16777215),Dt(s.userConfigExtraInfo)||Ti(s.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),s.transcodingUsers&&!Dt(s.transcodingUsers)&&(Cs(s.transcodingUsers,"config.transcodingUsers"),s.transcodingUsers.forEach((c,l)=>{em(c.uid),Dt(c.x)||nt(c.x,"transcodingUser[".concat(l,"].x"),0,1e4),Dt(c.y)||nt(c.y,"transcodingUser[".concat(l,"].y"),0,1e4),Dt(c.width)||nt(c.width,"transcodingUser[".concat(l,"].width"),0,1e4),Dt(c.height)||nt(c.height,"transcodingUser[".concat(l,"].height"),0,1e4),Dt(c.zOrder)||nt(c.zOrder-1,"transcodingUser[".concat(l,"].zOrder"),0,100),Dt(c.alpha)||nt(c.alpha,"transcodingUser[".concat(l,"].alpha"),0,1,!1)})),Dt(s.watermark)||GT(s.watermark,"watermark"),Dt(s.backgroundImage)||GT(s.backgroundImage,"backgroundImage"),s.images&&!Dt(s.images)&&(Cs(s.images,"config.images"),s.images.forEach((c,l)=>{GT(c,"images[".concat(l,"]"))}))}(t);let i=[];t.images&&i.push(...t.images.map(s=>Ir(Ir(Ir({},FT),s),{},{zOrder:255}))),t.backgroundImage&&(i.push(Ir(Ir(Ir({},FT),t.backgroundImage),{},{zOrder:0})),delete t.backgroundImage),t.watermark&&(i.push(Ir(Ir(Ir({},FT),t.watermark),{},{zOrder:255})),delete t.watermark),t.images=i,t.transcodingUsers&&(t.userConfigs=t.transcodingUsers.map(s=>Ir({},s)),t.userCount=t.transcodingUsers.length,delete t.transcodingUsers);let r=(t.userConfigs||[]).map(s=>typeof s.uid=="number"?ae.resolve(s.uid):rB(s.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await ae.all(r)).forEach((s,c)=>{t.userConfigs&&t.userConfigs[c]&&(t.userConfigs[c].uid=s)}),this.transcodingConfig=t,this.connection)try{var a;let s=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(Ns(a=this.streamingTasks).call(a)).map(c=>c.taskId).join("#")});R.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(s.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(s){if(!s.data||!s.data.retry)throw s;s.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(c=>{R.warning("[".concat(this.spec.clientId,"] live streaming receive error"),s.toString(),"try to republish",c.url),this.startLiveStreamingTask(c.url,c.mode,s).then(()=>{R.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(c.url," success"))}).catch(l=>{R.error("[".concat(this.spec.clientId,"] live streaming republish failed"),c.url,l.toString()),this.onLiveStreamError&&this.onLiveStreamError(c.url,l)})})}}async startLiveStreamingTask(e,t,i){if(!this.transcodingConfig&&t===Os.TRANSCODE)throw new B(A.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");let r={command:"PublishStream",ts:Date.now(),url:e,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};R.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(e,", mode: ").concat(t));let a=await this.taskMutex.lock();if(!this.connection&&i)return void a();if(this.streamingTasks.get(e)&&!i)return a(),new B(A.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(t))}catch(c){throw a(),c}switch(t){case Os.TRANSCODE:r.transcodingConfig=Ir({},this.transcodingConfig)}this.uapResponse&&this.uapResponse.vid&&(r.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;let s=this.lastTaskId++;try{let c=new ae((u,h)=>{yi(this.retryTimeout).then(()=>{if(i)return h(i);let p=this.statusError.get(e);return p?(this.statusError.delete(e),h(p)):void 0})}),l=await ae.race([this.connection.request("request",{clientRequest:r},!0,{url:e,command:"PublishStream",workerType:t===Os.TRANSCODE?1:2,requestByUser:!i,tid:s.toString()}),c]);this.isStartingStreamingTask=!1,R.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(l.code)),this.streamingTasks.set(e,{clientRequest:r,mode:t,url:e,taskId:s}),a()}catch(c){if(a(),this.isStartingStreamingTask=!1,!c.data||!c.data.retry||i)throw c;return c.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(e,t,c)):await this.startLiveStreamingTask(e,t,c)}}stopLiveStreamingTask(e){return new ae((t,i)=>{let r=this.streamingTasks.get(e);if(!r||!this.connection)return new B(A.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();let a=r.mode;r.abortTask=()=>{R.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(e),t()},this.connection.request("request",{clientRequest:{command:"UnpublishStream",url:r.url}},!1,{url:e,command:"UnPublishStream",workerType:a===Os.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(s=>{R.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(s.code)),this.streamingTasks.delete(e),this.streamingTasks.size===0&&(this.connection&&this.connection.close(),this.connection=void 0),t()}).catch(i)})}resetAllTask(){var e;let t=Array.from(Ns(e=this.streamingTasks).call(e));this.terminate();for(let i of t)this.startLiveStreamingTask(i.url,i.mode).catch(r=>{this.onLiveStreamError&&this.onLiveStreamError(i.url,r)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=yr.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(e){if(this.connection)throw new B(A.UNEXPECTED_ERROR,"live streaming connection has already connected");let t=await ki(this,Uv.REQUEST_WORKER_MANAGER_LIST,e);return this.uapResponse=t,this.connection=new MZ(t.workerToken,this.spec,this.wsRetryConfig,e),this.connection.on(_o.WARNING,(i,r)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(r,i)),this.connection.on(_o.PUBLISH_STREAM_STATUS,i=>this.handlePublishStreamServer(i)),this.connection.on(_o.REQUEST_NEW_ADDRESS,(i,r)=>{if(!this.connection)return r(new B(A.UNEXPECTED_ERROR,"can not get new live streaming address list"));ki(this,Uv.REQUEST_WORKER_MANAGER_LIST,e).then(a=>{this.uapResponse=a,i(a.addressList)}).catch(r)}),await this.connection.init(t.addressList),this.connection}handlePublishStreamServer(e){let t=e.serverStatus&&e.serverStatus.url||"empty_url",i=this.streamingTasks.get(t),r=e.reason;switch(e.code){case ai.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case ai.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case ai.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case ai.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{let s=new B(A.LIVE_STREAMING_CDN_ERROR,"",{code:e.code});if(i)return R.error(s.toString()),this.onLiveStreamError&&this.onLiveStreamError(t,s);if(!this.isStartingStreamingTask)return;this.statusError.set(t,s)}case ai.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{let s=new B(A.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,r);return this.onLiveStreamWarning&&this.onLiveStreamWarning(t,s)}case ai.LIVE_STREAM_RESPONSE_WORKER_LOST:case ai.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var a;if(!this.connection)return;this.connection.tryNextAddress();let s=Array.from(Ns(a=this.streamingTasks).call(a));for(let c of s)c.abortTask?c.abortTask():(R.warning("[".concat(this.spec.clientId,"] publish stream status code"),e.code,"try to republish",c.url),this.startLiveStreamingTask(c.url,c.mode,new B(A.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:e.code})).then(()=>{R.debug("[".concat(this.spec.clientId,"] republish live stream success"),c.url)}).catch(l=>{R.error(l.toString()),this.onLiveStreamError&&this.onLiveStreamError(c.url,l)}));return}}}hasUrl(e){return this.streamingTasks.has(e)}},xZ={name:"LiveStreaming",create:function(e){return new UZ(e.joinInfo,e.websocketRetryConfig||ti,e.httpRetryConfig||ti)}};function VZ(e){let t=WM();return function(i,r){let a=i.appId;a!==void 0&&(et(r,10),xn(r,a));let s=i.cid;s!==void 0&&(et(r,16),et(r,s));let c=i.cname;c!==void 0&&(et(r,26),xn(r,c));let l=i.deviceId;l!==void 0&&(et(r,34),xn(r,l));let u=i.elapse;u!==void 0&&(et(r,40),uo(r,u));let h=i.fileSize;h!==void 0&&(et(r,48),uo(r,jl(h)));let p=i.height;p!==void 0&&(et(r,56),uo(r,jl(p)));let _=i.jpg;_!==void 0&&(et(r,66),et(r,_.length),function(ge,j){let K=xd(ge,j.length);ge.bytes.set(j,K)}(r,_));let m=i.networkType;m!==void 0&&(et(r,72),uo(r,jl(m)));let S=i.osType;S!==void 0&&(et(r,80),uo(r,jl(S)));let C=i.requestId;C!==void 0&&(et(r,90),xn(r,C));let v=i.sdkVersion;v!==void 0&&(et(r,98),xn(r,v));let y=i.sequence;y!==void 0&&(et(r,104),uo(r,jl(y)));let I=i.sid;I!==void 0&&(et(r,114),xn(r,I));let O=i.timestamp;O!==void 0&&(et(r,120),uo(r,O));let P=i.uid;P!==void 0&&(et(r,128),et(r,P));let U=i.vid;U!==void 0&&(et(r,136),et(r,U));let x=i.width;x!==void 0&&(et(r,144),uo(r,jl(x)));let G=i.service;G!==void 0&&(et(r,152),et(r,G));let Z=i.callbackData;Z!==void 0&&(et(r,162),xn(r,Z));let J=i.jpgEncryption;J!==void 0&&(et(r,168),et(r,J));let q=i.requestType;q!==void 0&&(et(r,176),et(r,q));let ie=i.scorePorn;ie!==void 0&&(et(r,185),WR(r,ie));let Ie=i.scoreSexy;Ie!==void 0&&(et(r,193),WR(r,Ie));let Ve=i.scoreNeutral;Ve!==void 0&&(et(r,201),WR(r,Ve));let He=i.scene;He!==void 0&&(et(r,208),et(r,He));let ut=i.ossFilePrefix;ut!==void 0&&(et(r,218),xn(r,ut));let st=i.serviceVendor;if(st!==void 0)for(let ge of st){et(r,226);let j=WM();FZ(ge,j),et(r,j.limit),KZ(r,j),WZ(j)}}(e,t),function(i){let r=i.bytes,a=i.limit;return r.length===a?r:r.subarray(0,a)}(t)}function BZ(e){return function(i){let r={};e:for(;!ej(i);){let a=jn(i);switch(a>>>3){case 0:break e;case 1:r.code=jn(i);break;case 2:r.msg=tj(i,jn(i));break;case 3:{let s=GZ(i);r.data=jZ(i),i.limit=s;break}default:ZB(i,7&a)}}return r}({bytes:t=e,offset:0,limit:t.length});var t}function jZ(e){let t={};e:for(;!ej(e);){let i=jn(e);switch(i>>>3){case 0:break e;case 1:t.requestId=tj(e,jn(e));break;case 2:t.requestType=jn(e)>>>0;break;case 3:t.scorePorn=HR(e);break;case 4:t.scoreSexy=HR(e);break;case 5:t.scoreNeutral=HR(e);break;case 6:t.requestScene=jn(e)>>>0;break;case 7:t.scene=jn(e)>>>0;break;default:ZB(e,7&i)}}return t}function FZ(e,t){let i=e.service;i!==void 0&&(et(t,8),et(t,i));let r=e.vendor;r!==void 0&&(et(t,16),et(t,r));let a=e.token;a!==void 0&&(et(t,26),xn(t,a));let s=e.callbackUrl;s!==void 0&&(et(t,34),xn(t,s))}function GZ(e){let t=jn(e),i=e.limit;return e.limit=e.offset+t,i}function ZB(e,t){switch(t){case 0:for(;128&ij(e););break;case 2:GR(e,jn(e));break;case 5:GR(e,4);break;case 1:GR(e,8);break;default:throw new Error("Unimplemented type: "+t)}}var HZ=new Float32Array(1);new Uint8Array(HZ.buffer);var RC=new Float64Array(1),wr=new Uint8Array(RC.buffer);function jl(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}var $B=[];function WM(){let e=$B.pop();return e?(e.offset=e.limit=0,e):{bytes:new Uint8Array(64),offset:0,limit:0}}function WZ(e){$B.push(e)}function GR(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function ej(e){return e.offset>=e.limit}function xd(e,t){let i=e.bytes,r=e.offset,a=e.limit,s=r+t;if(s>i.length){let c=new Uint8Array(2*s);c.set(i),e.bytes=c}return e.offset=s,s>a&&(e.limit=s),r}function vC(e,t){let i=e.offset;if(i+t>e.limit)throw new Error("Read past limit");return e.offset+=t,i}function tj(e,t){let i=vC(e,t),r=String.fromCharCode,a=e.bytes,s="�",c="";for(let l=0;l<t;l++){let u,h,p,_,m=a[l+i];128&m?(224&m)==192?l+1>=t?c+=s:(u=a[l+i+1],(192&u)!=128?c+=s:(_=(31&m)<<6|63&u,_<128?c+=s:(c+=r(_),l++))):(240&m)==224?l+2>=t?c+=s:(u=a[l+i+1],h=a[l+i+2],(49344&(u|h<<8))!=32896?c+=s:(_=(15&m)<<12|(63&u)<<6|63&h,_<2048||_>=55296&&_<=57343?c+=s:(c+=r(_),l+=2))):(248&m)==240?l+3>=t?c+=s:(u=a[l+i+1],h=a[l+i+2],p=a[l+i+3],(12632256&(u|h<<8|p<<16))!=8421504?c+=s:(_=(7&m)<<18|(63&u)<<12|(63&h)<<6|63&p,_<65536||_>1114111?c+=s:(_-=65536,c+=r(55296+(_>>10),56320+(1023&_)),l+=3))):c+=s:c+=r(m)}return c}function xn(e,t){let i=t.length,r=0;for(let c=0;c<i;c++){let l=t.charCodeAt(c);l>=55296&&l<=56319&&c+1<i&&(l=(l<<10)+t.charCodeAt(++c)-56613888),r+=l<128?1:l<2048?2:l<65536?3:4}et(e,r);let a=xd(e,r),s=e.bytes;for(let c=0;c<i;c++){let l=t.charCodeAt(c);l>=55296&&l<=56319&&c+1<i&&(l=(l<<10)+t.charCodeAt(++c)-56613888),l<128?s[a++]=l:(l<2048?s[a++]=l>>6&31|192:(l<65536?s[a++]=l>>12&15|224:(s[a++]=l>>18&7|240,s[a++]=l>>12&63|128),s[a++]=l>>6&63|128),s[a++]=63&l|128)}}function KZ(e,t){let i=xd(e,t.limit),r=e.bytes,a=t.bytes;for(let s=0,c=t.limit;s<c;s++)r[s+i]=a[s]}function ij(e){return e.bytes[vC(e,1)]}function KM(e,t){let i=xd(e,1);e.bytes[i]=t}function HR(e){let t=vC(e,8),i=e.bytes;return wr[0]=i[t++],wr[1]=i[t++],wr[2]=i[t++],wr[3]=i[t++],wr[4]=i[t++],wr[5]=i[t++],wr[6]=i[t++],wr[7]=i[t++],RC[0]}function WR(e,t){let i=xd(e,8),r=e.bytes;RC[0]=t,r[i++]=wr[0],r[i++]=wr[1],r[i++]=wr[2],r[i++]=wr[3],r[i++]=wr[4],r[i++]=wr[5],r[i++]=wr[6],r[i++]=wr[7]}function jn(e){let t,i=0,r=0;do t=ij(e),i<32&&(r|=(127&t)<<i),i+=7;while(128&t);return r}function et(e,t){for(t>>>=0;t>=128;)KM(e,127&t|128),t>>>=7;KM(e,t)}function uo(e,t){let i=t.low>>>0,r=(t.low>>>28|t.high<<4)>>>0,a=t.high>>>24,s=a===0?r===0?i<16384?i<128?1:2:i<1<<21?3:4:r<16384?r<128?5:6:r<1<<21?7:8:a<128?9:10,c=xd(e,s),l=e.bytes;switch(s){case 10:l[c+9]=a>>>7&1;case 9:l[c+8]=s!==9?128|a:127&a;case 8:l[c+7]=s!==8?r>>>21|128:r>>>21&127;case 7:l[c+6]=s!==7?r>>>14|128:r>>>14&127;case 6:l[c+5]=s!==6?r>>>7|128:r>>>7&127;case 5:l[c+4]=s!==5?128|r:127&r;case 4:l[c+3]=s!==4?i>>>21|128:i>>>21&127;case 3:l[c+2]=s!==3?i>>>14|128:i>>>14&127;case 2:l[c+1]=s!==2?i>>>7|128:i>>>7&127;case 1:l[c]=s!==1?128|i:127&i}}function zM(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),i.push.apply(i,r)}return i}var zZ=new Map([["moderation",1],["supervise",2]]);function YM(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}var YZ=class extends Lt{get connectionState(){return this._connectionState}set connectionState(e){if(this._connectionState===e)return;let t=this._connectionState;this._connectionState=e,this.emit(_i.CONNECTION_STATE_CHANGE,t,e)}get inspectType(){return this._inspectType}set inspectType(e){var t;this._inspectMode=Sn(t=e.map(i=>zZ.get(i)||0)).call(t,(i,r)=>i+r),this._inspectType=e}get quality(){return this._quality}set quality(e){this._quality=e>1?1:e<.1?.1:e,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(e){super(),b(this,"name","AgoraRTCVideoContentInspect"),b(this,"_connectionState",Ga.CONNECTING),b(this,"_innerConnectionState",void 0),b(this,"sequence",0),b(this,"inspectStartTime",void 0),b(this,"workerManagerConnection",void 0),b(this,"workerConnection",void 0),b(this,"workerMessageLengthLimit",void 0),b(this,"inspectIntervalMinimum",void 0),b(this,"qualityRatio",void 0),b(this,"_connectInfo",void 0),b(this,"_cancelTokenSource",yr.CancelToken.source()),b(this,"_retryConfig",void 0),b(this,"wmSequence",0),b(this,"inspectInterval",void 0),b(this,"inspectTimer",null),b(this,"ossFilePrefix",void 0),b(this,"extraInfo",void 0),b(this,"_inspectType",void 0),b(this,"_inspectMode",void 0),b(this,"_quality",1),b(this,"qualityTimer",null),b(this,"_inspectId",void 0),b(this,"_needWorkUrlOnly",!1),b(this,"inspectImage",()=>{if(this.connectionState!==Ga.CONNECTED)throw new B(A.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===Ga.CONNECTED?this.requestToInspectImage():R.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=ft(5,"inspect-"),this.workerMessageLengthLimit=k("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=k("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=k("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=e.interval,this.ossFilePrefix=e.ossFilePrefix,this.extraInfo=e.extraInfo,this.inspectType=e.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new Bh("worker-manager-"+this._inspectId,ti),this.on(_i.STATE_CHANGE,(t,i)=>{this._innerConnectionState=t,R.debug("[".concat(this._inspectId,"] Inspect operation :").concat(Ua[t]," ").concat(i||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new Bh("worker-"+this._inspectId,ti),this.handleWorkerEvents()}async init(e,t){this.emit(_i.STATE_CHANGE,Ua.CONNECT_AP),this._connectInfo=e;let i=this._cancelTokenSource.token;return this._retryConfig=t,new ae((r,a)=>{this.on(_i.CONNECTION_STATE_CHANGE,(s,c)=>{c===Ga.CONNECTED&&r()}),this.requestAP(e,i,t).then(s=>{this.connectWorkerManager(s)}).catch(s=>{a(s)})})}async requestAP(e,t,i){let r=k("WEBCS_DOMAIN").map(c=>"https://".concat(c,"/api/v1")),a=await function(c,l,u,h){let{appId:p,areaCode:_,cname:m,sid:S,token:C,uid:v}=l;dd++;let y="image_moderation_api",I={service_name:y,json_body:JSON.stringify({appId:p,areaCode:_,cname:m,command:"allocateEdge",requestId:dd,seq:dd,sid:S,token:C,ts:Date.now(),uid:v+""})},O,P,U=c[0];return Rn(async()=>{O=Date.now();let x=await vn(U,{data:I,cancelToken:u,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(P=Date.now()-O,x.code!==0){let q=new B(A.UNEXPECTED_RESPONSE,"image inspect ap error, code"+x.code,{retry:!0,responseTime:P});throw R.error(q.toString()),q}let G=JSON.parse(x.json_body);if(G.code!==200){let q=new B(A.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(G.code,", reason: ").concat(G.reason),{code:G.code,responseTime:P});throw R.error(q.toString()),q}if(!G.servers||!Array.isArray(G.servers)||G.servers.length===0){let q=new B(A.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:G.code,responseTime:P});throw R.error(q.toString()),q}let Z=k("VIDEO_INSPECT_WORKER_MANAGER_HOST"),J=k("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:G.servers.map(q=>{let{address:ie,wss:Ie}=q;if(ie&&Ie)return"wss://".concat(ie.replace(/\./g,"-"),".").concat(Z,":").concat(J||Ie)}).filter(q=>!!q),workerToken:G.workerToken,vid:G.vid,responseTime:P}},(x,G)=>(fe.apworkerEvent(S,{success:!0,sc:200,serviceName:y,responseDetail:JSON.stringify(x.addressList),firstSuccess:G===0,responseTime:P,serverIp:c[G%c.length]}),!1),(x,G)=>(fe.apworkerEvent(S,{success:!1,sc:x.data&&x.data.code||200,serviceName:y,responseTime:P,serverIp:c[G%c.length]}),!!(x.code!==A.OPERATION_ABORTED&&x.code!==A.UNEXPECTED_RESPONSE||x.data&&x.data.retry)&&(U=c[(G+1)%c.length],!0)),h)}(r,e,t,i);this.emit(_i.STATE_CHANGE,Ua.AP_CONNECTED);let{addressList:s}=a;return this.wmSequence++,s}async connectWorkerManager(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=t,this.emit(_i.STATE_CHANGE,Ua.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(e,1e4)}async connectWorker(e){await this.workerConnection.init([e])}handleWorkerManagerEvents(){this.workerManagerConnection.on(Ce.CONNECTED,async()=>{this.emit(_i.STATE_CHANGE,Ua.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.22.0",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on(Ce.CLOSED,()=>{this._innerConnectionState<Ua.GET_WORKER_MANAGER_RESPONSE&&R.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(Ce.FAILED,()=>{this._innerConnectionState<Ua.GET_WORKER_MANAGER_RESPONSE&&R.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(Ce.RECONNECTING,()=>{this._innerConnectionState<Ua.GET_WORKER_MANAGER_RESPONSE&&R.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(Ce.ON_MESSAGE,async e=>{this.emit(_i.STATE_CHANGE,Ua.GET_WORKER_MANAGER_RESPONSE);let t=this.workerManagerConnection.url;this.workerManagerConnection.close();let i=JSON.parse(e.data);if(i.code!==200)throw R.error("[".concat(this._inspectId,"] Unexpected code ").concat(i.code," from worker manager")),new B(A.UNEXPECTED_RESPONSE,"response code of worker is unexpected",i);if(!(i.serverResponse&&i.serverResponse.portWss&&t))throw R.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(i))),new B(A.UNEXPECTED_RESPONSE,"response content of worker is unexpected",i);{let r=k("VIDEO_INSPECT_WORKER_PORT")||i.serverResponse.portWss,a=t.replace(/:\d+\/?$/,":".concat(r));this.emit(_i.STATE_CHANGE,Ua.CONNECT_WORKER,a),this._needWorkUrlOnly?this.emit(_i.REQUEST_NEW_WORKER_URL,a):await this.connectWorker(a)}}),this.workerManagerConnection.on(Ce.WILL_RECONNECT,(e,t,i)=>{i(e)}),this.workerManagerConnection.on(Ce.REQUEST_NEW_URLS,(e,t)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(e).catch(t)})}handleWorkerEvents(){this.workerConnection.on(Ce.CONNECTED,async()=>{this.emit(_i.STATE_CHANGE,Ua.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=Ga.CONNECTED}),this.workerConnection.on(Ce.ON_MESSAGE,async e=>{if(e.data instanceof ArrayBuffer){let i=BZ(new Uint8Array(e.data));if(k("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&R.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(i)),i.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(_i.INSPECT_RESULT,void 0,void 0);if(i.data&&i.data.scorePorn&&i.data.scoreSexy&&i.data.scoreNeutral){var t;let r={porn:i.data.scorePorn,sexy:i.data.scoreSexy,neutral:i.data.scoreNeutral},a=Sn(t=Object.keys(r)).call(t,(c,l)=>r[c]>r[l]?c:l,"porn"),s=Object.keys(r).find(c=>c===a);this.emit(_i.INSPECT_RESULT,s)}else this.emit(_i.INSPECT_RESULT,void 0,new B(A.UNEXPECTED_RESPONSE,i.code+"","There is an unexpected data on message"))}else this.emit(_i.INSPECT_RESULT,void 0,new B(A.UNEXPECTED_RESPONSE,i.code+"",i.msg))}else R.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(_i.INSPECT_RESULT,void 0,new B(A.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on(Ce.CLOSED,()=>{this.connectionState=Ga.CLOSED}),this.workerConnection.on(Ce.FAILED,()=>{this.connectionState=Ga.CLOSED}),this.workerConnection.on(Ce.RECONNECTING,()=>{this.connectionState=this.connectionState===Ga.CONNECTED?Ga.RECONNECTING:Ga.CONNECTING}),this.workerConnection.on(Ce.WILL_RECONNECT,(e,t,i)=>{e==="recover"&&i(e),i("tryNext")}),this.workerConnection.on(Ce.REQUEST_NEW_URLS,(e,t)=>{this.workerManagerConnection.close(),this.once(_i.REQUEST_NEW_WORKER_URL,i=>{e([i])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(i=>{this.connectWorkerManager(i,!0)}).catch(i=>{t(i)})})}async requestToInspectImage(){this.sequence++;let e=ga(this,_i.CLIENT_LOCAL_VIDEO_TRACK),t={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(e){if(!e.isPlaying)return void this.emit(_i.INSPECT_RESULT,void 0,new B(A.INVALID_OPERATION,"Only the track being played can be inspected"));let i=await this.generateRequestData(e,t);this.workerConnection.sendMessage(i,!0,!0)}else this.emit(_i.INSPECT_RESULT,void 0,new B(A.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(e,t){let{appId:i,cname:r,cid:a,vid:s,sid:c,uid:l}=t,u=Date.now(),h=await e.getCurrentFrameImage("image/jpeg",this.quality),p=await VV(h,i,r),_=this.sequence+"-"+a+"-"+l+"-"+u+"-"+ft(12,""),m={appId:i,cid:a,cname:r,deviceId:"",elapse:YM(Number(u-this.inspectStartTime)),fileSize:p.byteLength,jpgEncryption:2,height:h.height,width:h.width,jpg:p,networkType:6,osType:7,requestId:_,sdkVersion:"4.22.0",sequence:this.sequence,sid:c,timestamp:YM(u),uid:l,vid:s,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};this.extraInfo===void 0&&delete m.callbackData,this.ossFilePrefix===void 0&&delete m.ossFilePrefix;let S=VZ(m);if(S.byteLength<this.workerMessageLengthLimit){if(k("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){let C=function(v){for(var y=1;y<arguments.length;y++){var I=arguments[y]!=null?arguments[y]:{};y%2?zM(Object(I),!0).forEach(function(O){b(v,O,I[O])}):Object.getOwnPropertyDescriptors?Object.defineProperties(v,Object.getOwnPropertyDescriptors(I)):zM(Object(I)).forEach(function(O){Object.defineProperty(v,O,Object.getOwnPropertyDescriptor(I,O))})}return v}({},m);delete C.jpg,R.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(C))}return S}{let C=this.quality*this.qualityRatio;return this.quality=C,await this.generateRequestData(e,{appId:i,cname:r,cid:a,vid:s,sid:c,uid:l})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=yr.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=Ga.CLOSED,this.emit(_i.STATE_CHANGE,Ua.CLOSED)}},qZ={name:"ContentInspect",create:function(e){let{config:t}=e;return function(i){if(!i)throw new B(A.INVALID_PARAMS,"inspectConfig is necessary.");if(!i.inspectType||!Array.isArray(i.inspectType))throw new B(A.INVALID_PARAMS,"inspectConfig.inspectType is necessary and is an instance of Array.");{let r=[...new Set(i.inspectType)];r.forEach(a=>{var s;if(!oe(s=["supervise","moderation"]).call(s,a))throw new B(A.INVALID_PARAMS,"".concat(a," is not a valid inspect type."))}),i.inspectType=r}if(i&&i.extraInfo&&i.extraInfo.length>1024)throw new B(A.INVALID_PARAMS,"inspectConfig.extraInfo length cannot exceed 1024 bytes")}(t),new YZ(t)}};at("PROCESS_ID","process-".concat(ft(8,""),"-").concat(ft(4,""),"-").concat(ft(4,""),"-").concat(ft(4,""),"-").concat(ft(12,""))),function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(t){return void R.error("Error loading sdk config",t.message)}if(e)try{let t=JSON.parse(window.atob(e)),i=Date.now();R.debug("Loading global parameters from cache",t),Object.keys(t).forEach(r=>{if(Object.prototype.hasOwnProperty.call(Wt,r)){let{value:a,expires:s}=t[r];if(s&&s<=i)return;So[r]=a,Wt[r]=a}})}catch(t){R.error("Error loading mutableParamsCache: ".concat(e),t.message)}}(),Array.isArray(So.AREAS)&&So.AREAS.length>0&&hC(So.AREAS,!0);var qM=(e,t,i)=>{R.debug("setParameter key:".concat(e,", value:").concat(JSON.stringify(t))),at(e,t,i)};$u(kZ,!1),$u(xZ,!1),$u(EQ,!1),$u(qZ,!1),$u(DZ,!1);var Ut=function(e){let t=new Lt,i=e,r={getListeners:t.getListeners.bind(t),on:(a,s)=>(function(c,l){c===Vn.SECURITY_POLICY_VIOLATION&&wB(l,!0)}(a,s),t.on.bind(t)(a,s)),addListener:t.addListener.bind(t),once:t.once.bind(t),off:t.off.bind(t),removeAllListeners:t.removeAllListeners.bind(t),emit:t.emit.bind(t),safeEmit:t.safeEmit.bind(t)};return RM(RM({},i),r)}({__TRACK_LIST__:Wl,VERSION:Sa,BUILD:Zy,ESM_BUNDLER:!1,ESM:!0,UMD:!1,DEV:!1,setParameter:qM,getParameter:k,getSupportedCodec:async function(){let e={audio:[],video:[]};try{let t=new RTCPeerConnection,i=await async function(r){let a;return Ke().supportUnifiedPlan?(r.addTransceiver("video",{direction:"recvonly"}),r.addTransceiver("audio",{direction:"recvonly"}),a=(await r.createOffer()).sdp):a=(await r.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,a}(t);if(!i)return e;t.close(),t=null,e=function(r){let a={video:[],audio:[]};return r.match(/ VP8/i)&&a.video.push("VP8"),r.match(/ VP9/i)&&a.video.push("VP9"),r.match(/ AV1/i)&&a.video.push("AV1"),r.match(/ H264/i)&&a.video.push("H264"),r.match(/ H265/i)&&a.video.push("H265"),r.match(/ opus/i)&&a.audio.push("OPUS"),r.match(/ PCMU/i)&&a.audio.push("PCMU"),r.match(/ PCMA/i)&&a.audio.push("PCMA"),r.match(/ G722/i)&&a.audio.push("G722"),a}(i)}catch(t){throw new B(A.CREATE_OFFER_FAILED,t.toString&&t.toString()).print()}return e},checkSystemRequirements:function(){let e=fe.reportApiInvoke(null,{name:ni.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:Vt.TRACER}),t=!1;try{let s=window.RTCPeerConnection,c=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,l=window.WebSocket;t=!!(s&&c&&l),t&&Yy()&&Hx(75)&&new s().close()}catch(s){return R.error("check system requirement failed: ",s),!1}let i=!1,r=Ge();r.name===Ze.CHROME&&Number(r.version)>=58&&(En.engine.name!=="WebKit"||function(){let s=Ge();if(uE()){if(s.os===pi.MAC_OS)return!0;if(s.os===pi.IOS){let c=En.os.version&&En.os.version.split(".");if(c&&Number(c[0])===14&&c[1]&&Number(c[1])>=3||c&&Number(c[0])>14)return!0}}return!1}())&&(i=!0),(r.name===Ze.FIREFOX&&Number(r.version)>=56||r.name===Ze.OPERA&&Number(r.version)>=45||r.name===Ze.SAFARI&&Number(r.version)>=11||r.name==="WebKit"&&(pr()||Qa())&&r.osVersion&&Number(r.osVersion.split(".")[0])>=11||Yx()||Ge().name===Ze.QQ)&&(i=!0),R.debug("checkSystemRequirements, api:",t,"browser",i);let a=t&&i;return e.onSuccess(a),a},getDevices:function(e){return ea.enumerateDevices(!0,!0,e)},getMicrophones:function(e){return ea.getRecordingDevices(e)},getCameras:function(e){return ea.getCamerasDevices(e)},getElectronScreenSources:OV,getPlaybackDevices:function(e){return ea.getSpeakers(e)},createClient:function(){var e;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"},i=fe.reportApiInvoke(null,{name:ni.CREATE_CLIENT,options:[t],tag:Vt.TRACER});try{(function(r){li(r.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),li(r.mode,"config.mode",["rtc","live","p2p"]),r.audioCodec!==void 0&&li(r.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),r.proxyServer!==void 0&&Ti(r.proxyServer,"config.proxyServer",1,1e4),r.turnServer!==void 0&&Zx(r.turnServer),r.httpRetryConfig!==void 0&&FN(r.httpRetryConfig),r.websocketRetryConfig!==void 0&&FN(r.websocketRetryConfig)})(t)}catch(r){throw i.onError(r),r}return(Kx(16,0)||zx(16,0))&&(t.codec==="vp9"&&(t.codec="vp8",R.debug("browser not support vp9, force use vp8")),at("UNSUPPORTED_VIDEO_CODEC",["vp9"])),t.audioCodec===void 0&&(t.audioCodec="opus"),i.onSuccess(),new mQ(_n(_n({forceWaitGatewayResponse:!0},t),{},{role:oe(e=["rtc","p2p"]).call(e,t.mode)?"host":t.role||"audience"}))},createCameraVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=k("CAMERA_CAPTURE_CONFIG"),i=fe.reportApiInvoke(null,{tag:Vt.TRACER,name:ni.CREATE_CAM_VIDEO_TRACK,options:[At({},e),t]});t&&(e.encoderConfig=t);let r=_E(e),a=ft(8,"track-cam-"),s=null;R.info("start create camera video track with config",JSON.stringify(e),"trackId",a);try{s=(await Qr({video:r},a)).getVideoTracks()[0]||null}catch(l){throw i.onError(l),l}if(!s){let l=new H(A.UNEXPECTED_ERROR,"can not find track in media stream");return i.onError(l),l.throw(R)}e.optimizationMode&&pR(a,s,e,Hn(e.encoderConfig));let c=new Kv(s,e,r,e.scalabiltyMode?n_(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,a);return i.onSuccess(c.getTrackId()),R.info("create camera video success, trackId:",a),c},createCustomVideoTrack:function(e){let t=fe.reportApiInvoke(null,{tag:Vt.TRACER,name:ni.CREATE_CUSTOM_VIDEO_TRACK,options:[e]}),i=new St(e.mediaStreamTrack,{width:e.width,height:e.height,frameRate:e.frameRate,bitrateMax:e.bitrateMax,bitrateMin:e.bitrateMin},e.scalabiltyMode?n_(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,ft(8,"track-cus-"),[Rt.CUSTOM_TRACK]);return t.onSuccess(i.getTrackId()),R.info("create custom video track success with config",e,"trackId",i.getTrackId()),i},createScreenVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable",i=fe.reportApiInvoke(null,{tag:Vt.TRACER,name:ni.CREATE_SCREEN_VIDEO_TRACK,options:[At({},e),t]});e.encoderConfig?typeof e.encoderConfig=="string"||e.encoderConfig.width&&e.encoderConfig.height||(e.encoderConfig.width={max:1920},e.encoderConfig.height={max:1080}):e.encoderConfig="1080p_2";let r=function(p){let _={};p.screenSourceType&&(_.mediaSource=p.screenSourceType),p.extensionId&&Co()&&(_.extensionId=p.extensionId);let{displaySurface:m,selfBrowserSurface:S,surfaceSwitching:C,systemAudio:v}=p;(wv(107)||MN(107)||UN(93))&&(m&&(li(m,"displaySurface",["browser","window","monitor"]),_.displaySurface=m),S?(li(S,"selfBrowserSurface",["exclude","include"]),_.selfBrowserSurface=S):_.selfBrowserSurface="include",C&&(li(C,"surfaceSwitching",["exclude","include"]),_.surfaceSwitching=C)),(wv(105)||MN(105)||UN(91))&&v&&(li(v,"systemAudio",["exclude","include"]),_.systemAudio=v),p.electronScreenSourceId&&(_.sourceId=p.electronScreenSourceId);let y=p.encoderConfig?lR(p.encoderConfig):null;return _.mandatory={chromeMediaSource:"desktop",maxWidth:y?y.width:void 0,maxHeight:y?y.height:void 0},y&&(y.frameRate&&(typeof y.frameRate=="number"?(_.mandatory.maxFrameRate=y.frameRate,_.mandatory.minFrameRate=y.frameRate):(_.mandatory.maxFrameRate=y.frameRate.max||y.frameRate.ideal||y.frameRate.exact||void 0,_.mandatory.minFrameRate=y.frameRate.min||y.frameRate.ideal||y.frameRate.exact||void 0),_.frameRate=y.frameRate),y.width&&(_.width=y.width),y.height&&(_.height=y.height)),_}(e),a=ft(8,"track-scr-v-"),s=null,c=null,l=Ke();if(!l.supportShareAudio&&t==="enable"){let p=new H(A.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return i.onError(p),p.throw(R)}R.info("start create screen video track with config",e,"withAudio",t,"trackId",a);try{let p=await Qr({screen:r,screenAudio:t==="auto"?l.supportShareAudio:t==="enable"},a);s=p.getVideoTracks()[0]||null,c=p.getAudioTracks()[0]||null}catch(p){throw i.onError(p),p}if(!s){let p=new H(A.UNEXPECTED_ERROR,"can not find track in media stream");return i.onError(p),p.throw(R)}if(!c&&t==="enable"){s&&s.stop();let p=new H(A.SHARE_AUDIO_NOT_ALLOWED);return i.onError(p),p.throw(R)}e.optimizationMode||(e.optimizationMode="detail"),e.optimizationMode&&(pR(a,s,e,e.encoderConfig&&lR(e.encoderConfig)||void 0),e.encoderConfig&&typeof e.encoderConfig!="string"&&(e.encoderConfig.bitrateMin=e.encoderConfig.bitrateMax));let u=new St(s,e.encoderConfig?lR(e.encoderConfig):{},e.scalabiltyMode?n_(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,a,[Rt.SCREEN_TRACK]);if(!c)return i.onSuccess(u.getTrackId()),R.info("create screen video track success","video:",u.getTrackId()),u;let h=new xt(c,void 0,ft(8,"track-scr-a-"),!1);return i.onSuccess([u.getTrackId(),h.getTrackId()]),R.info("create screen video track success","video:",u.getTrackId(),"audio:",h.getTrackId()),[u,h]},createMicrophoneAndCameraTracks:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=k("CAMERA_CAPTURE_CONFIG"),r=fe.reportApiInvoke(null,{tag:Vt.TRACER,name:ni.CREATE_MIC_AND_CAM_TRACKS,options:[e,t,i]});i&&(t.encoderConfig=i);let a=_E(t),s=GD(e),c=ft(8,"track-mic-"),l=ft(8,"track-cam-"),u=null,h=null;R.info("start create camera video track(".concat(l,") and microphone audio track(").concat(c,") with config, audio: ").concat(JSON.stringify(e),", video: ").concat(JSON.stringify(t)));try{let m=await Qr({audio:s,video:a},"".concat(c,"-").concat(l));u=m.getAudioTracks()[0],h=m.getVideoTracks()[0]}catch(m){throw r.onError(m),m}if(!u||!h){let m=new H(A.UNEXPECTED_ERROR,"can not find tracks in media stream");return r.onError(m),m.throw(R)}t.optimizationMode&&pR(l,h,t,Hn(t.encoderConfig));let p=new EE(u,e,s,c),_=new Kv(h,t,a,t.scalabiltyMode?n_(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,l);return r.onSuccess([p.getTrackId(),_.getTrackId()]),R.info("create camera video track(".concat(l,") and microphone audio track(").concat(c,") success")),[p,_]},createMicrophoneAudioTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=fe.reportApiInvoke(null,{tag:Vt.TRACER,name:ni.CREATE_MIC_AUDIO_TRACK,options:[e]}),i=GD(e),r=ft(8,"track-mic-"),a=null;R.info("start create microphone audio track with config",JSON.stringify(e),"trackId",r);try{a=(await Qr({audio:i},r)).getAudioTracks()[0]||null}catch(c){throw t.onError(c),c}if(!a){let c=new H(A.UNEXPECTED_ERROR,"can not find track in media stream");return t.onError(c),c.throw(R)}let s=new EE(a,e,i,r);return t.onSuccess(s.getTrackId()),R.info("create microphone audio track success, trackId:",r),s},createCustomAudioTrack:function(e){let t=fe.reportApiInvoke(null,{tag:Vt.TRACER,name:ni.CREATE_CUSTOM_AUDIO_TRACK,options:[e]}),i=new xt(e.mediaStreamTrack,e.encoderConfig?fE(e.encoderConfig):{},ft(8,"track-cus-"),!1);return R.info("create custom audio track success with config",e,"trackId",i.getTrackId()),t.onSuccess(i.getTrackId()),i},createBufferSourceAudioTrack:async function(e){var t;let{cacheOnlineFile:i,encoderConfig:r}=e,{source:a}=e,s={source:a instanceof AudioBuffer?"AudioBuffer":a instanceof File?(t=File.name)!==null&&t!==void 0?t:"File":a,cacheOnlineFile:i,encoderConfig:r},c=fe.reportApiInvoke(null,{tag:Vt.TRACER,name:ni.CREATE_BUFFER_AUDIO_TRACK,options:[s]});if(k("DISABLE_WEBAUDIO"))throw new H(A.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");let l=ft(8,"track-buf-");R.info("start create buffer source audio track with config",JSON.stringify(s),"trackId",l);let u=a;if(!(a instanceof AudioBuffer))try{a=await async function(_,m){let S=null;if(typeof _=="string"){let v=AP.get(_);if(v)return R.debug("use cached audio resource: ",_),v;try{S=(await Rn(()=>yr.get(_,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(y){throw new H(A.FETCH_AUDIO_FILE_FAILED,y.toString())}}else S=await new ae((v,y)=>{let I=new FileReader;I.onload=O=>{O.target?v(O.target.result):y(new H(A.READ_LOCAL_AUDIO_FILE_ERROR))},I.onerror=()=>{y(new H(A.READ_LOCAL_AUDIO_FILE_ERROR))},I.readAsArrayBuffer(_)});let C=await function(v){let y=kd();return new ae((I,O)=>{y.decodeAudioData(v,P=>{I(P)},P=>{O(new H(A.DECODE_AUDIO_FILE_FAILED,P.toString()))})})}(S);return typeof _=="string"&&m&&AP.set(_,C),C}(a,i)}catch(_){return c.onError(_),_.throw(R)}let h=new hJ(a),p=new uJ(u,h,r?fE(r):{},l);return R.info("create buffer source audio track success, trackId:",l),c.onSuccess(p.getTrackId()),p},setAppType:function(e){if(R.debug("setAppType: ".concat(e)),!(Number.isInteger(e)&&e>=0))throw R.debug("Invalid appType"),new B(A.INVALID_PARAMS,"invalid app type",e);at("APP_TYPE",Math.floor(e))},setLogLevel:function(e){R.setLogLevel(e)},enableLogUpload:function(){k("USE_NEW_LOG")?at("UPLOAD_LOG",!0):R.enableLogUpload()},disableLogUpload:function(){k("USE_NEW_LOG")?at("UPLOAD_LOG",!1):R.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new pB},checkAudioTrackIsActive:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3,i=fe.reportApiInvoke(null,{tag:Vt.TRACER,name:ni.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof xt||e instanceof ld)){let u=new B(A.INVALID_TRACK,"the parameter is not a audio track");return i.onError(u),u.throw()}t&&t<1e3&&(t=1e3);let r=e instanceof xt?e.getTrackLabel():"remote_track",a=e.getVolumeLevel(),s=a,c=a,l=Date.now();return new ae(u=>{let h=setInterval(()=>{let p=e.getVolumeLevel();s=p>s?p:s,c=p<c?p:c;let _=s-c>1e-4,m=Date.now()-l;if(_||m>t){clearInterval(h);let S=_,C={duration:m,deviceLabel:r,maxVolumeLevel:s,result:S};R.info("[track-".concat(e.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(C))),i.onSuccess(C),u(S)}},200)})},checkVideoTrackIsActive:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3,i=fe.reportApiInvoke(null,{tag:Vt.TRACER,name:ni.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof St||e instanceof cd)){let _=new B(A.INVALID_TRACK,"the parameter is not a video track");return i.onError(_),_.throw()}t&&t<1e3&&(t=1e3);let r=e instanceof St?e.getTrackLabel():"remote_track",a=e.getMediaStreamTrack(!0),s=document.createElement("video");s.style.width="1px",s.style.height="1px",s.setAttribute("muted",""),s.muted=!0,s.setAttribute("playsinline",""),s.controls=!1,(Li()||uE())&&(s.style.opacity="0.01",s.style.position="fixed",s.style.left="0",s.style.top="0",document.body.appendChild(s)),s.srcObject=new MediaStream([a]),s.play();let c=document.createElement("canvas");c.width=160,c.height=120;let l=0,u=0;try{let _=Date.now();l=await function(m,S,C,v){let y,I=0,O=null;return new ae((P,U)=>{function x(){I>v&&y&&(y(),P(I));let G=C.getContext("2d");if(!G){let q=new B(A.UNEXPECTED_ERROR,"can not get canvas 2d context.");return R.error(q.toString()),void U(q)}G.drawImage(m,0,0,160,120);let Z=G.getImageData(0,0,C.width,C.height),J=Math.floor(Z.data.length/3);if(O){for(let q=0;q<J;q+=3)if(Z.data[q]!==O[q])return I+=1,void(O=Z.data);O=Z.data}else O=Z.data}setTimeout(()=>{y&&(y(),P(I))},S),y=sC(()=>{x()},30)})}(s,t,c,4),u=Date.now()-_}catch(_){throw i.onError(_),_}eQ===Ze.SAFARI&&(s.pause(),s.remove()),s.srcObject=null;let h=l>4,p={duration:u,changedPicNum:l,deviceLabel:r,result:h};return R.info("[track-".concat(e.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(p))),i.onSuccess(p),h},setArea:hC,audioElementPlayCenter:vr,resumeAudioContext:function(){vr.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(e){SQ.processExternalMediaAEC(e)},registerExtensions:function(e){let t=k("PLUGIN_INFO")||[];e.forEach(i=>{"name"in i&&!oe(t).call(t,i.name)&&t.push(i.name);let r=i;r.__registered__=!0,r.logger.hookLog=R.extLog,r.reporter.hookApiInvoke=fe.extApiInvoke,r.parameters&&Object.keys(r.parameters).forEach(a=>{r.parameters[a]=k(a)})}),qM("PLUGIN_INFO",t)},ChannelMediaRelayError:Hl,ChannelMediaRelayEvent:Ts,ChannelMediaRelayState:Or,RemoteStreamFallbackType:aJ,RemoteStreamType:rJ,ConnectionDisconnectedReason:tt,AudienceLatencyLevelType:x7,AREAS:qe,preload:async function(e,t,i,r){return SB(e,t,i,r)}});Object.defineProperties(Ut,{onAudioAutoplayFailed:{get:()=>qr.onAudioAutoplayFailed,set:e=>{qr.onAudioAutoplayFailed=e}},onAutoplayFailed:{get:()=>qr.onAutoplayFailed,set:e=>{qr.onAutoplayFailed=e}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>Ut._onSecurityPolicyViolation,set(e){Ut._onSecurityPolicyViolation=e,wB(e)}},__CLIENT_LIST__:{get:()=>k("SHOW_GLOBAL_CLIENT_LIST")?fo:[]}}),ea.on(yc.CAMERA_DEVICE_CHANGED,e=>{R.info("camera device changed",JSON.stringify(e)),Ut.onCameraChanged&&Ut.onCameraChanged(e),Ut.safeEmit(Vn.CAMERA_CHANGED,e)}),ea.on(yc.RECORDING_DEVICE_CHANGED,e=>{R.info("microphone device changed",JSON.stringify(e)),Ut.onMicrophoneChanged&&Ut.onMicrophoneChanged(e),Ut.safeEmit(Vn.MICROPHONE_CHANGED,e)}),ea.on(yc.PLAYOUT_DEVICE_CHANGED,e=>{R.debug("playout device changed",JSON.stringify(e)),Ut.onPlaybackDeviceChanged&&Ut.onPlaybackDeviceChanged(e),Ut.safeEmit(Vn.PLAYBACK_DEVICE_CHANGED,e)}),vr.onAutoplayFailed=()=>{R.info("detect audio element autoplay failed"),qr.onAudioAutoplayFailed&&qr.onAudioAutoplayFailed()},it.on("autoplay-failed",()=>{R.info("detect webaudio autoplay failed"),qr.onAudioAutoplayFailed&&qr.onAudioAutoplayFailed(),Ut.safeEmit(Vn.AUTOPLAY_FAILED)}),it.on(Ri.STATE_CHANGE,(e,t)=>{R.info("audio context state changed: ".concat(t," => ").concat(e)),Ut.onAudioContextStateChanged&&Ut.onAudioContextStateChanged(e,t),Ut.safeEmit(Vn.AUDIO_CONTEXT_STATE_CHANGED,e,t)}),Qt.on(Ql.NETWORK_STATE_CHANGE,(e,t)=>{R.info("[network-indicator] network state changed, ".concat(t," => ").concat(e))}),window&&(window.__ARTC__=Ut);function Ic(e,t,i){return e.on(t,i),()=>e.off(t,i)}function XZ(e){try{return e()}catch(t){console.error(t)}}function om(e){return()=>e.forEach(XZ)}function JZ(e,t){let i=setTimeout(e,t);return()=>clearTimeout(i)}function yC(){let e,t,i;function r(){if(t){let h=t;t=void 0,h()}}async function a(){if(i){let h=i;i=void 0;try{await h()}catch(p){console.error(p)}}}async function s(h){e=!0,await a();try{i=await h()}catch(p){console.error(p)}e=!1,r()}async function c(){e=!0,await a(),e=!1,r()}function l(h){e?t=()=>s(h):s(h)}function u(){e?t=c:c()}return{run:l,dispose:u}}var rj=typeof document<"u"?ke.useLayoutEffect:ke.useEffect;function QZ(e){return e!=null&&typeof e.then=="function"}function pp(){let e=ke.useRef(!1);return ke.useEffect(()=>(e.current=!1,()=>{e.current=!0}),[]),e}function ZZ(){let e=pp();function t(i,r){return new Promise(async(a,s)=>{try{let c=await i;e.current||a(c)}catch(c){e.current?r&&r(c):s(c)}})}return ke.useCallback(t,[e])}function aj(e){let t=ZZ(),[i,r]=ke.useState();return rj(()=>{QZ(e)?t(e).then(r):r(e)},[e,t]),i}function cm(e,t){let i=ke.useRef();ke.useEffect(()=>{let{run:r,dispose:a}=i.current||(i.current=yC());return r(e),a},t)}function $Z(e,t){let i=e.split("."),r=t.split("."),a=Math.max(i.length,r.length);for(let s=0;s<a;s++){let c=parseInt(i[s]||"0"),l=parseInt(r[s]||"0");if(c>l)return 1;if(c<l)return-1}return 0}var nj=ke.createContext(null);function e$({client:e,children:t}){return ze.jsx(nj.Provider,{value:e,children:t})}function t$(e){return ke.useContext(nj)}function fp(e){let t=t$();if(!t)throw new Error("Agora RTC client not found. Should be wrapped in <AgoraRTCProvider value={client} />");return t}ke.createContext(null);function Vd(e){let t=fp(),[i,r]=ke.useState(t?t.connectionState==="CONNECTED":!1);return ke.useEffect(()=>{if(t){r(t.connectionState==="CONNECTED");let a;return om([Ic(t,"connection-state-change",s=>{a==null||a(),a=JZ(()=>r(s==="CONNECTED"),0)}),()=>a==null?void 0:a()])}else r(!1)},[t]),i}var Uc=class extends Error{constructor(t,i){var e=(...z1)=>(super(...z1),Mu(this,"rtcMethod"),Mu(this,"rtcError"),Mu(this,"name","AgoraRTCReactException"),this);e(typeof i=="string"?i:i.message),this.rtcMethod=t,this.rtcError=i}log(t){console[t](this)}};function i$(e,t=!0,i){let r=fp(),a=Vd(),s=ke.useRef(),[c,l]=ke.useState(!1),[u,h]=ke.useState(0),[p,_]=ke.useState(null),m=pp();return cm(async()=>{if(m.current||(_(null),h(0),l(!1)),t&&r){try{m.current||l(!0);let{appid:C,channel:v,token:y,uid:I}=typeof e=="function"?await e():e,O=await r.join(C,v,y,I);m.current||h(O)}catch(C){console.error(C),m.current||_(new Uc("IAgoraRTCClient.join",C))}m.current||l(!1);let S=s.current||(s.current=yC());return om([()=>{S.dispose()},()=>{S.run(()=>r.unpublish(r.localTracks))},()=>{for(let C of r.localTracks)C.isPlaying&&C.stop(),C.close();S.run(()=>r.leave())}])}},[t,i]),{data:u,isLoading:c,isConnected:a,error:p}}function r$(e,t=!0,i){let r=fp(),a=Vd(),s=ke.useRef([]),[c,l]=ke.useState(!1),[u,h]=ke.useState(null),p=pp();return cm(async()=>{if(p.current||(l(!1),h(null)),!r||!a||!t)return;let _=e.filter(Boolean),m=v=>{let y=$Z(Ut.VERSION,"4.18.2")>=0;return y||new Uc("usePublish","please check your agora-rtc-sdk-ng version in package.json, it's recommend upgrade to >= 4.18.2").log("warn"),y?r.mode!=="live"||r.role!=="audience":!0},S=v=>s.current.some(y=>y&&y.getTrackId()===v.getTrackId()),C=v=>m()&&v.enabled&&t&&!S(v);for(let v=0;v<_.length;v++){let y=_[v];if(y&&C(y)){await r.unpublish(s.current.filter(I=>(I==null?void 0:I.trackMediaType)===y.trackMediaType));try{p.current||l(!0),await r.publish(y)}catch(I){console.error(I),p.current||h(new Uc("IAgoraRTCClient.publish",I))}p.current||l(!1)}}s.current=_},[a,t,r,e]),{isLoading:c,error:u}}function a$(e=!0,t={ANS:!0,AEC:!0},i){let r=Vd(),[a,s]=ke.useState(null),[c,l]=ke.useState(!1),[u,h]=ke.useState(null),p=pp();return cm(async()=>{if(p.current||(l(!1),h(null)),r&&e&&!a){try{p.current||l(!0);let _=await Ut.createMicrophoneAudioTrack(t);p.current||s(_)}catch(_){console.error(_),p.current||h(new Uc("IAgoraRTC.createMicrophoneAudioTrack",_))}p.current||l(!1)}!r&&!p.current&&s(null)},[r,e]),{localMicrophoneTrack:a,isLoading:c,error:u}}function n$(e=!0,t,i){let r=Vd(),[a,s]=ke.useState(null),[c,l]=ke.useState(!1),[u,h]=ke.useState(null),p=pp();return cm(async()=>{if(p.current||(l(!1),h(null)),r&&e&&!a){try{p.current||l(!0);let _=await Ut.createCameraVideoTrack(t);p.current||s(_)}catch(_){console.error(_),p.current||h(new Uc("IAgoraRTC.createCameraVideoTrack",_))}p.current||l(!1)}!r&&!p.current&&s(null)},[r,e]),{localCameraTrack:a,isLoading:c,error:u}}function XM(e,t,i){let r=fp(),a=t==="audio"?"audioTrack":"videoTrack",[s,c]=ke.useState(e&&e[a]),l=Vd(),u=ke.useRef(),[h,p]=ke.useState(!1),[_,m]=ke.useState(null);return ke.useEffect(()=>{if(!e||!l)return;let S=!1;S||m(null);let C=t==="audio"?"hasAudio":"hasVideo",v=e.uid,y=async(P,U)=>{if(P[a]&&r.remoteUsers.some(({uid:x})=>P.uid===x))try{S||p(!0),await r.unsubscribe(P,U)}catch(x){S||m(new Uc("IAgoraRTCClient.unsubscribe",x)),console.error(x)}S||(c(void 0),p(!1))},I=async(P,U)=>{try{!P[a]&&r.remoteUsers.some(({uid:x})=>P.uid===x)&&(S||p(!0),await r.subscribe(P,U)),S||c(P[a])}catch(x){S||m(new Uc("IAgoraRTCClient.subscribe",x)),console.error(x)}S||p(!1)},O=u.current||(u.current=yC());return!e[a]&&e[C]?O.run(()=>I(e,t)):c(e[a]),om([()=>{S=!0,O.dispose()},Ic(r,"user-published",(P,U)=>{P.uid===v&&U===t&&O.run(()=>I(P,t))}),Ic(r,"user-unpublished",(P,U)=>{P.uid===v&&U===t&&O.run(()=>y(P,t))})])},[l,r,e,t,a]),{track:s,isLoading:h,error:_}}function s$(e){let t=fp(),[i,r]=ke.useState(t?t.remoteUsers:[]);return ke.useEffect(()=>{if(t){let a=()=>r(t.remoteUsers.slice());return om([Ic(t,"user-joined",a),Ic(t,"user-left",a),Ic(t,"user-published",a),Ic(t,"user-unpublished",a)])}},[t]),i}var sj=ke.createContext(void 0);function oj(e,t,i,r){let a=ke.useContext(sj);ke.useEffect(()=>{if(e)return r&&t?e.play(r,i||void 0):e.stop(),a?(a.onMount(e),()=>a.onUnmount(e)):()=>{e.isPlaying&&e.stop()}},[e,r,t,a,i])}function cj(e,t){let i=ke.useContext(sj);rj(()=>{if(e)return t?e.play():e.stop(),i?(i.onMount(e),()=>i.onUnmount(e)):()=>{e.isPlaying&&e.stop()}},[e,t,i])}function o$({track:e,play:t=!1,volume:i,disabled:r,muted:a,children:s}){let c=aj(e);return cj(c,t),ke.useEffect(()=>{c&&i!=null&&c.setVolume(i)},[c,i]),ke.useEffect(()=>{c&&r!=null&&c.setEnabled(!r).catch(console.warn)},[r,c]),ke.useEffect(()=>{c&&a!=null&&c.setMuted(a).catch(console.warn)},[a,c]),s?ze.jsx(ze.Fragment,{children:s}):null}var lj={position:"relative",width:"100%",height:"100%",overflow:"hidden",background:"#000"},dj={width:"100%",height:"100%"},CC={position:"absolute",top:0,left:0,width:"100%",height:"100%",overflow:"hidden",zIndex:2},lm=(e,t)=>ke.useMemo(()=>({...e,...t}),[e,t]);function c$({track:e,play:t,disabled:i,muted:r,style:a,videoPlayerConfig:s,...c}){let l=lm(dj,a),[u,h]=ke.useState(null),p=aj(e);return oj(p,t,s,u),ke.useEffect(()=>{p&&i!=null&&p.setEnabled(!i).catch(console.warn)},[i,p]),ke.useEffect(()=>{p&&r!=null&&p.setMuted(r).catch(console.warn)},[r,p]),ze.jsx("div",{...c,ref:h,style:l})}var l$={width:"100%",height:"100%",background:"#1a1e21 center/cover no-repeat",filter:"blur(16px) brightness(0.4)"},d$={position:"absolute",top:"50%",left:"50%",maxWidth:"50%",maxHeight:"50%",aspectRatio:"1",transform:"translate(-50%, -50%)",borderRadius:"50%",overflow:"hidden",objectFit:"cover"};function uj({cover:e}){return ze.jsx("div",{style:CC,children:typeof e=="string"?ze.jsxs(ze.Fragment,{children:[ze.jsx("div",{style:{...l$,backgroundImage:`url(${e})`}}),ze.jsx("img",{src:e,style:d$})]}):e()})}function u$({micOn:e,cameraOn:t,audioTrack:i,videoTrack:r,playAudio:a,playVideo:s,volume:c,cover:l,children:u,style:h,...p}){let _=lm(lj,h);return s=s??!!t,a=a??!!e,ze.jsxs("div",{...p,style:_,children:[ze.jsx(c$,{disabled:!t,play:s,track:r}),ze.jsx(o$,{disabled:!e,play:a,track:i,volume:c}),l&&!t&&ze.jsx(uj,{cover:l}),ze.jsx("div",{style:CC,children:u})]})}function h$({track:e,play:t=!1,playbackDeviceId:i,volume:r,children:a}){return cj(e,t),ke.useEffect(()=>{e&&i!=null&&e.setPlaybackDevice(i).catch(console.warn)},[e,i]),ke.useEffect(()=>{e&&r!=null&&e.setVolume(r)},[e,r]),a?ze.jsx(ze.Fragment,{children:a}):null}function p$({track:e,play:t,style:i,videoPlayerConfig:r,...a}){let s=lm(dj,i),[c,l]=ke.useState(null);return oj(e,t,r,c),ze.jsx("div",{...a,ref:l,style:s})}function f$({user:e,playVideo:t,playAudio:i,playbackDeviceId:r,volume:a,cover:s,style:c,children:l,videoPlayerConfig:u,...h}){let p=lm(lj,c),{track:_}=XM(e,"video"),{track:m}=XM(e,"audio");return t=t??(e==null?void 0:e.hasVideo),i=i??(e==null?void 0:e.hasAudio),ze.jsxs("div",{...h,style:p,children:[ze.jsx(p$,{play:t,track:_,videoPlayerConfig:u}),ze.jsx(h$,{play:i,playbackDeviceId:r,track:m,volume:a}),s&&!t&&ze.jsx(uj,{cover:s}),ze.jsx("div",{style:CC,children:l})]})}var _$=class{constructor(){Mu(this,"appType",1001);Ut.setAppType(this.appType)}};new _$;var E$=Ut;const m$=()=>{const e=E$.createClient({mode:"rtc",codec:"vp8"});return ze.jsx(e$,{client:e,children:ze.jsx(T$,{})})},g$="9a995d36550b4bd4b247fc391a77991a",S$="lll",T$=()=>{const[e,t]=ke.useState(!1),[i,r]=ke.useState(null),a=Vd(),[s,c]=ke.useState(g$),[l,u]=ke.useState(S$),[h,p]=ke.useState(!0),[_,m]=ke.useState(!0),{localMicrophoneTrack:S}=a$(h),{localCameraTrack:C}=n$(_),v=s$();return ke.useEffect(()=>{(async()=>{try{const O=await(await fetch(`https://algora-test-server.vercel.app/api/access_token?channelName=${l}&uid=0`)).json();O.token?(r(O.token),console.log("Fetched Token:",O.token)):console.error("Token fetch failed:",O.error)}catch(I){console.error("Error fetching token:",I)}})()},[l]),i$({appid:s,channel:l,token:i},e),r$([S,C]),ze.jsxs(ze.Fragment,{children:[ze.jsx("div",{children:a?ze.jsxs("div",{children:[ze.jsx(u$,{audioTrack:S,cameraOn:_,micOn:h,videoTrack:C,style:{width:"40vw",height:300},children:ze.jsx("samp",{children:"You"})}),v.map(y=>ze.jsx("div",{children:ze.jsx(f$,{user:y,style:{width:"90%",height:300},children:ze.jsx("samp",{children:y.uid})})},y.uid))]}):ze.jsxs("div",{children:[ze.jsx("input",{onChange:y=>c(y.target.value),placeholder:"<Your app ID>",value:s}),ze.jsx("input",{onChange:y=>u(y.target.value),placeholder:"<Your channel Name>",value:l}),ze.jsx("button",{disabled:!s||!l||!i,onClick:()=>t(!0),children:ze.jsx("span",{children:"Join Channel"})})]})}),a&&ze.jsxs("div",{style:{padding:"20px"},children:[ze.jsx("button",{onClick:()=>p(y=>!y),children:h?"Disable mic":"Enable mic"}),ze.jsx("button",{onClick:()=>m(y=>!y),children:_?"Disable camera":"Enable camera"}),ze.jsx("button",{onClick:()=>t(y=>!y),children:e?"End calling":"Start calling"})]})]})};function R$(){return ze.jsxs(ze.Fragment,{children:[ze.jsx("p",{className:"read-the-docs",children:"Algora App"}),ze.jsx(m$,{})]})}G3.createRoot(document.getElementById("root")).render(ze.jsx(ke.StrictMode,{children:ze.jsx(R$,{})}));
